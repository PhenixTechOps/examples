/**
 * Copyright 2022 Phenix Real Time Solutions, Inc. All Rights Reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("phenix-web-sdk",[],e):"object"==typeof exports?exports["phenix-web-sdk"]=e():t["phenix-web-sdk"]=e()}(window,function(){return n=[function(t,e,n){function i(t){if(o[t])return o[t].exports;var e=o[t]={i:t,l:!1,exports:{}};return r[t].call(e.exports,e,e.exports,i),e.l=!0,e.exports}var r,o;t.exports=(r=[function(t,e,n){void 0!==(e=function(){"use strict";function r(t){var t=t.split("."),e=[];return a.forEach(t,function(t){e=e.concat(function(t){for(var e="",n=[],i=0,r=0;r<t.length;r++)if("["===t[r]){if(i++,!a.e(e)||1<i)return[t];e&&(n.push(e),e="")}else if("]"===t[r]){if(0!=--i)return[t];n.push(e),e=""}else{if(r===t.length-1)return[t];e+=t[r]}return n}(t))}),e}function a(){}a.clone=function(t){return a.isArray(t)?t.slice():a.a(t)?a.assign({},t):t},a.get=function(t,e,n){if(a.isNullOrUndefined(t))return n;u(t,"objectToTraverse");var i=e;if(a.e(i))i=r(e);else if(!a.isArray(i))throw new Error("Unsupported path type "+typeof e);return t=a.reduce(i,function(t,e){if(a.a(t)||a.isArray(t))return t[e]},t),a.isUndefined(t)?n:t},a.set=function(t,e,n){if(!a.a(t))return t;u(t,"objectToTraverse");var i=t,o=e;if(a.e(o))o=r(e);else if(!a.isArray(o))throw new Error("Unsupported path type "+typeof e);return a.forEach(o,function(t,r){(function(t,e,n){if(a.u(parseInt(e))&&a.isArray(t))return t[e]=n;if(a.e(e)&&a.a(t))return t[e]=n;throw new Error("Unsupported type "+typeof e+" when setting property or index")})(i,t,function(t,e,n,i){if(t.length-1===r)return i;if(i=t[r],e=t[r+1],a.isArray(n[i])||a.a(n[i]))return n[i];if(!a.isArray(n[i])&&a.u(parseInt(e)))return[];if(!a.a(n[i])&&a.e(e))return{};throw new Error("Unsupported type "+typeof i+" when setting property or index")}(o,0,i,n)),i=i[t]}),t},a.bind=function(e,n){var i=Array.prototype.slice.call(arguments,2);return function(){if(!a.h(e))throw new TypeError("_.bind - callback must be a function. Received ["+typeof e+"]");var t=i.concat(Array.prototype.slice.call(arguments));return e.apply(n,t)}},a.now=function(){return(new Date).getTime()},a.utc=function(t){return a.u(t)?t:t?Math.floor(t):NaN},a.isoString=function(){var t=new Date;return t.toISOString?t.toISOString():t.getUTCFullYear()+"-"+a.pad(t.getUTCMonth()+1,2)+"-"+a.pad(t.getUTCDate(),2)+"T"+a.pad(t.getUTCHours(),2)+":"+a.pad(t.getUTCMinutes(),2)+":"+a.pad(t.getUTCSeconds(),2)+"."+(t.getUTCMilliseconds()/1e3).toFixed(3).slice(2,5)+"Z"},a.map=function(t,n){u(t,"collection");var i=[];return t.constructor===Array?a.forEach(t,function(t,e){a.e(n)&&a.a(t)?i.push(t[n]):a.h(n)&&i.push(n(t,e))}):a.forOwn(t,function(t,e){a.h(n)&&i.push(n(t,e))}),i},a.values=function(t){return!a.a(t)||a.isArray(t)?[]:a.map(t,function(t){return t})},a.keys=function(t){return a.a(t)||a.isArray(t)?a.map(t,function(t,e){return e}):[]},a.forEach=function(t,e){if(!a.h(e))throw new Error("_.forEach argument, Callback, must be a function. Received ["+typeof e+"]");o(t,"collection");for(var n=0;n<t.length;n++)if(!1===e(t[n],n))return},a.forOwn=function(t,e){if(!a.h(e))throw new Error("Callback must be a function. Received ["+typeof e+"]");u(t,"objectWithProperties");for(var n=Object.keys(t),i=0;i<n.length;i++){var r=n[i];if((t.hasOwnProperty(r)||Object.prototype.hasOwnProperty.call(t,r))&&!1===e(t[r],r))return}},a.argumentsToArray=function(t){if(!a.a(t)||!t.length)throw new Error("Collection must be arguments. Received ["+typeof t+"]");for(var e=[],n=0;n<t.length;n++)e.push(t[n]);return e},a.assign=function(n){a.isNullOrUndefined(n)&&(n={}),u(n,"target");var t=a.argumentsToArray(arguments);return t.shift(),a.forEach(t,function(t,e){a.isNullOrUndefined(t)||(u(t,"_.assign(sources["+e+"])"),a.forOwn(t,function(t,e){n[e]=t}))}),n},a.includes=function(t,e){if(a.e(t))return h(e,"Includes value and search parameter"),-1<t.indexOf(e);if(a.isUndefined(t)||a.isUndefined(e))return!1;function n(t){if(t===e)return!(i=!0)}u(t,"collection");var i=!1;return t.constructor===Array?a.forEach(t,n):a.forOwn(t,n),i},a.reduce=function(t,n,e){u(t,"collection");var i=e===a.noop()?null:e;return t.constructor===Array?a.forEach(t,function(t,e){i=n(i,t,e)}):a.forOwn(t,function(t,e){i=n(i,t,e)}),i},a.sample=function(t){return o(t,"collection"),t[Math.floor(Math.random()*t.length)]},a.uniqueId=function(){return(a.now()*Math.random()).toString()},a.find=function(t,n,i){o(t,"collection");var r=void 0;return a.forEach(t,function(t,e){if(n(t)&&(i||0)<=e)return r=t,!1}),r},a.findIndex=function(t,n,i){o(t,"collection");var r=-1;return a.forEach(t,function(t,e){if(n(t,e)&&(i||0)<=e)return r=e,!1}),r},a.filter=function(t,e){o(t,"collection");var n=[];return a.forEach(t,function(t){e(t)&&n.push(t)}),n},a.remove=function(t,e){return o(t,"collection"),a.filter(t,function(t){return!e(t)})},a.take=function(t,e){return o(t,"collection"),t.slice(0,e)},a.hasDifferences=function(t,e,n){return 0<a.findDifferences(t,e,n).length},a.findDifferences=function(n,i,r){function t(t,e){s[e]=1,(a.a(t)||a.isArray(t))&&r?a.hasIndexOrKey(i,e)&&a.sameTypes(n[e],i[e])&&!a.hasDifferences(n[e],i[e],r)||o.push(e):n[e]!==i[e]&&o.push(e)}var o=[],s={};if(a.isArray(n)&&a.isArray(i))n.length>i.length?a.forEach(n,t):a.forEach(i,t);else{if(!a.a(n)||!a.a(i)||a.isArray(n)||a.isArray(i))throw new Error("Object types do not match");a.forOwn(n,t),a.forOwn(i,function(t,e){s.hasOwnProperty(e)||o.push(e)})}return o},a.hasIndexOrKey=function(t,e){return a.isArray(t)?t.length>parseInt(e):!!a.a(t)&&t.hasOwnProperty(e)},a.startsWith=function(t,e){return h(t,"value"),h(e,"prefix"),0===t.indexOf(e)},a.endsWith=function(t,e){h(t,"value"),h(e,"postfix");var n=t.length-e.length;return 0<=n&&t.indexOf(e,n)===n},a.sameTypes=function(t,e){return a.isNullOrUndefined(t)||a.isNullOrUndefined(e)?a.isNullOrUndefined(t)&&a.isNullOrUndefined(e):a.isArray(t)||a.isArray(e)?a.isArray(t)&&a.isArray(e):typeof t==typeof e},a.freeze=function(t){return"freeze"in Object?Object.freeze(t):t},a.noop=function(){},a.a=function(t){return null!==t&&"object"==typeof t},a.isArray=function(t){return!!a.a(t)&&t.constructor===Array},a.e=function(t){return"string"==typeof t},a.u=function(t){return!isNaN(t)&&"number"==typeof t},a.f=function(t){return"boolean"==typeof t},a.h=function(t){return"function"==typeof t},a.isNullOrUndefined=function(t){return null===t||a.isUndefined(t)},a.isUndefined=function(t){return void 0===t},a.getEnumName=function(t,e){var n=null,t=a.map(t,function(t){return t});return a.u(e)?n=a.find(t,function(t){return t.id===e}):a.e(e)&&(n=a.find(t,function(t){return t.name.toLowerCase()===e.toLowerCase()})),n?n.name:null},a.toString=function(t){if(a.e(t))return t;if(a.f(t))return t?"true":"false";if(a.u(t))return t.toString();var e="";if(t)if(a.h(t.toString))e=t.toString();else if(a.a(t.toString))try{e=t.toString()}catch(t){e="[object invalid toString()]"}if(0!==e.indexOf("[object"))return e;var n=[];return e+JSON.stringify(t,function(t,e){if(a.a(e)&&!a.isNullOrUndefined(e)){if(a.includes(n,e))return"<recursive>";n.push(e)}return""===t?e:a.toString(e)})},a.pad=function(t,e){s(t,"value"),s(e,"numberToPad");for(var n=t.toString().length,i=0;i<e-n;i++)t="0"+t.toString();return t.toString()},a.addEventListener=function(t,e,n,i){u(t,"target"),h(e,"eventName"),c(n,"listener"),t.phenixAddEventListener?t.phenixAddEventListener.call(t,e,n,!!i):t.addEventListener?t.addEventListener(e,n,!!i):t.attachEvent&&t.attachEvent("on"+e,n)},a.removeEventListener=function(t,e,n,i){u(t,"target"),h(e,"eventName"),c(n,"listener"),t.phenixRemoveEventListener?t.phenixRemoveEventListener.call(t,e,n,!!i):t.removeEventListener?t.removeEventListener(e,n,!!i):t.detachEvent&&t.detachEvent("on"+e,n)};var o=function(t){if(!a.isArray(t))throw new Error("Input must be an array. Received ["+typeof t+"]")},s=function(t,e){if(h(e,"name"),!a.u(t))throw new Error(e+" must be a number. Received ["+typeof t+"]")},u=function(t,e){if(h(e,"name"),!a.a(t))throw new Error("collection type not supported - "+e+" must be an array or object. Received ["+typeof t+"]")},c=function(t,e){if(h(e,"name"),!a.h(t))throw new Error(e+" must be a function. Received ["+typeof t+"]")},h=function(t,e){if(!a.e(e))throw new Error("Name must be a string. Received ["+typeof e+"]");if(!a.e(t))throw new Error(e+" must be a string. Received ["+typeof t+"]")};return a}.apply(e,[]))&&(t.exports=e)},function(t,e,n){n=[n(0)];void 0!==(n=function(t){"use strict";return t}.apply(e,n))&&(t.exports=n)}],o={},i.m=r,i.c=o,i.i=function(t){return t},i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:n})},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=1))},function(t,e,n){function i(t){if(o[t])return o[t].exports;var e=o[t]={i:t,l:!1,exports:{}};return r[t].call(e.exports,e,e.exports,i),e.l=!0,e.exports}var r,o;t.exports=(r=[function(t,e,n){n=[n(2)];void 0!==(n=function(i){function r(){}return r.prototype.a=function(t,e){if(r.prototype.e("name",e),!i.a(t))throw new Error('"'+e+'" must be an object. Received ['+typeof t+"]")},r.prototype.isArray=function(t,e){if(r.prototype.e("name",e),!i.isArray(t))throw new Error('"'+e+'" must be an array. Received ['+typeof t+"]")},r.prototype.e=function(t,e){if(!i.e(e))throw new Error('"name" must be a string. Received ['+typeof e+"]");if(!i.e(t))throw new Error('"'+e+'" must be a string. Received ['+typeof t+"]")},r.prototype.f=function(t,e){if(r.prototype.e("name",e),!i.f(t))throw new Error('"'+e+'" must be a boolean. Received ['+typeof t+"]")},r.prototype.u=function(t,e){if(r.prototype.e("name",e),!i.u(t))throw new Error('"'+e+'" must be a number. Received ['+typeof t+"]")},r.prototype.h=function(t,e){if(r.prototype.e("name",e),!i.h(t))throw new Error('"'+e+'" must be a function. Received ['+typeof t+"]")},r.prototype.v=function(t,e){r.prototype.g(t,e)},r.prototype.g=function(t,e){if(r.prototype.e("name",e),r.prototype.e(t,e),""===t)throw new Error('"'+e+'" must not be empty')},r.prototype.y=function(t,e,n){if(r.prototype.e("name",n),!i.a(t))throw new Error('"'+n+'" must be an instance. Received ['+typeof t+"]");if(!(t instanceof e))throw new Error('"'+n+'" must be a valid instance of class '+i.get(e,["name"],"undefined"))},r.prototype.w=function(t,e){if(r.prototype.e("name",e),i.isUndefined(t))throw new Error('"'+e+'" must not be undefined')},r.prototype.b=function(t,e,n){if(r.prototype.g(n,"name"),e=i.getEnumName(e,t),i.isNullOrUndefined(e))throw new Error('"'+n+'" must be a valid type. Unable to locate type ['+t+"]");return e},r.prototype.k=function(t,n){r.prototype.e(n,"name"),r.prototype.isArray(t,n),i.forEach(t,function(t,e){r.prototype.e(t,n+"["+e+"]")})},new r}.apply(e,n))&&(t.exports=n)},function(t,e,n){void 0!==(e=function(){"use strict";function r(t){var t=t.split("."),e=[];return a.forEach(t,function(t){e=e.concat(function(t){for(var e="",n=[],i=0,r=0;r<t.length;r++)if("["===t[r]){if(i++,!a.e(e)||1<i)return[t];e&&(n.push(e),e="")}else if("]"===t[r]){if(0!=--i)return[t];n.push(e),e=""}else{if(r===t.length-1)return[t];e+=t[r]}return n}(t))}),e}function a(){}a.clone=function(t){return a.isArray(t)?t.slice():a.a(t)?a.assign({},t):t},a.get=function(t,e,n){if(a.isNullOrUndefined(t))return n;u(t,"objectToTraverse");var i=e;if(a.e(i))i=r(e);else if(!a.isArray(i))throw new Error("Unsupported path type "+typeof e);return t=a.reduce(i,function(t,e){if(a.a(t)||a.isArray(t))return t[e]},t),a.isUndefined(t)?n:t},a.set=function(t,e,n){if(!a.a(t))return t;u(t,"objectToTraverse");var i=t,o=e;if(a.e(o))o=r(e);else if(!a.isArray(o))throw new Error("Unsupported path type "+typeof e);return a.forEach(o,function(t,r){(function(t,e,n){if(a.u(parseInt(e))&&a.isArray(t))return t[e]=n;if(a.e(e)&&a.a(t))return t[e]=n;throw new Error("Unsupported type "+typeof e+" when setting property or index")})(i,t,function(t,e,n,i){if(t.length-1===r)return i;if(i=t[r],e=t[r+1],a.isArray(n[i])||a.a(n[i]))return n[i];if(!a.isArray(n[i])&&a.u(parseInt(e)))return[];if(!a.a(n[i])&&a.e(e))return{};throw new Error("Unsupported type "+typeof i+" when setting property or index")}(o,0,i,n)),i=i[t]}),t},a.bind=function(e,n){var i=Array.prototype.slice.call(arguments,2);return function(){if(!a.h(e))throw new TypeError("_.bind - callback must be a function. Received ["+typeof e+"]");var t=i.concat(Array.prototype.slice.call(arguments));return e.apply(n,t)}},a.now=function(){return(new Date).getTime()},a.utc=function(t){return a.u(t)?t:t?Math.floor(t):NaN},a.isoString=function(){var t=new Date;return t.toISOString?t.toISOString():t.getUTCFullYear()+"-"+a.pad(t.getUTCMonth()+1,2)+"-"+a.pad(t.getUTCDate(),2)+"T"+a.pad(t.getUTCHours(),2)+":"+a.pad(t.getUTCMinutes(),2)+":"+a.pad(t.getUTCSeconds(),2)+"."+(t.getUTCMilliseconds()/1e3).toFixed(3).slice(2,5)+"Z"},a.map=function(t,n){u(t,"collection");var i=[];return t.constructor===Array?a.forEach(t,function(t,e){a.e(n)&&a.a(t)?i.push(t[n]):a.h(n)&&i.push(n(t,e))}):a.forOwn(t,function(t,e){a.h(n)&&i.push(n(t,e))}),i},a.values=function(t){if(!a.a(t)||a.isArray(t))throw new Error("_.values argument, Collection, must be an object. Received ["+typeof t+"]");return a.map(t,function(t){return t})},a.keys=function(t){if(!a.a(t)||a.isArray(t))throw new Error("_.keys argument, Collection, must be an object. Received ["+typeof t+"]");return a.map(t,function(t,e){return e})},a.forEach=function(t,e){if(!a.h(e))throw new Error("_.forEach argument, Callback, must be a function. Received ["+typeof e+"]");o(t,"collection");for(var n=0;n<t.length;n++)if(!1===e(t[n],n))return},a.forOwn=function(t,e){if(!a.h(e))throw new Error("Callback must be a function. Received ["+typeof e+"]");u(t,"objectWithProperties");for(var n=Object.keys(t),i=0;i<n.length;i++){var r=n[i];if((t.hasOwnProperty(r)||Object.prototype.hasOwnProperty.call(t,r))&&!1===e(t[r],r))return}},a.argumentsToArray=function(t){if(!a.a(t)||!t.length)throw new Error("Collection must be arguments. Received ["+typeof t+"]");for(var e=[],n=0;n<t.length;n++)e.push(t[n]);return e},a.assign=function(n){a.isNullOrUndefined(n)&&(n={}),u(n,"target");var t=a.argumentsToArray(arguments);return t.shift(),a.forEach(t,function(t,e){a.isNullOrUndefined(t)||(u(t,"_.assign(sources["+e+"])"),a.forOwn(t,function(t,e){n[e]=t}))}),n},a.includes=function(t,e){if(a.e(t))return h(e,"Includes value and search parameter"),-1<t.indexOf(e);if(a.isUndefined(t)||a.isUndefined(e))return!1;function n(t){if(t===e)return!(i=!0)}u(t,"collection");var i=!1;return t.constructor===Array?a.forEach(t,n):a.forOwn(t,n),i},a.reduce=function(t,n,e){u(t,"collection");var i=e===a.noop()?null:e;return t.constructor===Array?a.forEach(t,function(t,e){i=n(i,t,e)}):a.forOwn(t,function(t,e){i=n(i,t,e)}),i},a.sample=function(t){return o(t,"collection"),t[Math.floor(Math.random()*t.length)]},a.uniqueId=function(){return(a.now()*Math.random()).toString()},a.find=function(t,n,i){o(t,"collection");var r=void 0;return a.forEach(t,function(t,e){if(n(t)&&(i||0)<=e)return r=t,!1}),r},a.findIndex=function(t,n,i){o(t,"collection");var r=-1;return a.forEach(t,function(t,e){if(n(t,e)&&(i||0)<=e)return r=e,!1}),r},a.filter=function(t,e){o(t,"collection");var n=[];return a.forEach(t,function(t){e(t)&&n.push(t)}),n},a.remove=function(t,e){return o(t,"collection"),a.filter(t,function(t){return!e(t)})},a.take=function(t,e){return o(t,"collection"),t.slice(0,e)},a.hasDifferences=function(t,e,n){return 0<a.findDifferences(t,e,n).length},a.findDifferences=function(n,i,r){function t(t,e){s[e]=1,(a.a(t)||a.isArray(t))&&r?a.hasIndexOrKey(i,e)&&a.sameTypes(n[e],i[e])&&!a.hasDifferences(n[e],i[e],r)||o.push(e):n[e]!==i[e]&&o.push(e)}var o=[],s={};if(a.isArray(n)&&a.isArray(i))n.length>i.length?a.forEach(n,t):a.forEach(i,t);else{if(!a.a(n)||!a.a(i)||a.isArray(n)||a.isArray(i))throw new Error("Object types do not match");a.forOwn(n,t),a.forOwn(i,function(t,e){s.hasOwnProperty(e)||o.push(e)})}return o},a.hasIndexOrKey=function(t,e){return a.isArray(t)?t.length>parseInt(e):!!a.a(t)&&t.hasOwnProperty(e)},a.startsWith=function(t,e){return h(t,"value"),h(e,"prefix"),0===t.indexOf(e)},a.endsWith=function(t,e){h(t,"value"),h(e,"postfix");var n=t.length-e.length;return t.indexOf(e,n)===n},a.sameTypes=function(t,e){return a.isNullOrUndefined(t)||a.isNullOrUndefined(e)?a.isNullOrUndefined(t)&&a.isNullOrUndefined(e):a.isArray(t)||a.isArray(e)?a.isArray(t)&&a.isArray(e):typeof t==typeof e},a.freeze=function(t){return"freeze"in Object?Object.freeze(t):t},a.noop=function(){},a.a=function(t){return null!==t&&"object"==typeof t},a.isArray=function(t){return!!a.a(t)&&t.constructor===Array},a.e=function(t){return"string"==typeof t},a.u=function(t){return!isNaN(t)&&"number"==typeof t},a.f=function(t){return"boolean"==typeof t},a.h=function(t){return"function"==typeof t},a.isNullOrUndefined=function(t){return null===t||a.isUndefined(t)},a.isUndefined=function(t){return void 0===t},a.getEnumName=function(t,e){var n=null,t=a.map(t,function(t){return t});return a.u(e)?n=a.find(t,function(t){return t.id===e}):a.e(e)&&(n=a.find(t,function(t){return t.name.toLowerCase()===e.toLowerCase()})),n?n.name:null},a.toString=function(t){if(a.e(t))return t;if(a.f(t))return t?"true":"false";if(a.u(t))return t.toString();var e="";if(t)if(a.h(t.toString))e=t.toString();else if(a.a(t.toString))try{e=t.toString()}catch(t){e="[object invalid toString()]"}if(0!==e.indexOf("[object"))return e;var n=[];return e+JSON.stringify(t,function(t,e){if(a.a(e)&&!a.isNullOrUndefined(e)){if(a.includes(n,e))return"<recursive>";n.push(e)}return""===t?e:a.toString(e)})},a.pad=function(t,e){s(t,"value"),s(e,"numberToPad");for(var n=t.toString().length,i=0;i<e-n;i++)t="0"+t.toString();return t.toString()},a.addEventListener=function(t,e,n,i){u(t,"target"),h(e,"eventName"),c(n,"listener"),t.phenixAddEventListener?t.phenixAddEventListener.call(t,e,n,!!i):t.addEventListener?t.addEventListener(e,n,!!i):t.attachEvent&&t.attachEvent("on"+e,n)},a.removeEventListener=function(t,e,n,i){u(t,"target"),h(e,"eventName"),c(n,"listener"),t.phenixRemoveEventListener?t.phenixRemoveEventListener.call(t,e,n,!!i):t.removeEventListener?t.removeEventListener(e,n,!!i):t.detachEvent&&t.detachEvent("on"+e,n)};var o=function(t){if(!a.isArray(t))throw new Error("Input must be an array. Received ["+typeof t+"]")},s=function(t,e){if(h(e,"name"),!a.u(t))throw new Error(e+" must be a number. Received ["+typeof t+"]")},u=function(t,e){if(h(e,"name"),!a.a(t))throw new Error("collection type not supported - "+e+" must be an array or object. Received ["+typeof t+"]")},c=function(t,e){if(h(e,"name"),!a.h(t))throw new Error(e+" must be a function. Received ["+typeof t+"]")},h=function(t,e){if(!a.e(e))throw new Error("Name must be a string. Received ["+typeof e+"]");if(!a.e(t))throw new Error(e+" must be a string. Received ["+typeof t+"]")};return a}.apply(e,[]))&&(t.exports=e)},function(t,e,n){n=[n(1)];void 0!==(n=function(t){"use strict";return t}.apply(e,n))&&(t.exports=n)},function(t,e,n){n=[n(0)];void 0!==(n=function(t){return t}.apply(e,n))&&(t.exports=n)}],o={},i.m=r,i.c=o,i.i=function(t){return t},i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:n})},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=3))},function(t,e,n){function i(t){if(o[t])return o[t].exports;var e=o[t]={i:t,l:!1,exports:{}};return r[t].call(e.exports,e,e.exports,i),e.l=!0,e.exports}var r,o;t.exports=(r=[function(t,e,n){n=[n(5)];void 0!==(n=function(t){"use strict";return t}.apply(e,n))&&(t.exports=n)},function(t,e,n){n=[n(0),n(4)];void 0!==(n=function(t,e){"use strict";function n(t){e.h(t,"cleanup"),this.S=t}return n.prototype.dispose=function(){return this.S.call()},n.prototype.toString=function(){return t.toString(this)},n}.apply(e,n))&&(t.exports=n)},function(t,e,n){n=[n(0)];void 0!==(n=function(n){"use strict";function t(){this.R=[]}return t.prototype.add=function(t){if(!t||!n.h(t.dispose))throw new Error('"disposable" must be a disposable or implement dispose');this.R.push(t)},t.prototype.dispose=function(){var e=[];return n.forEach(this.R,function(t){e.push(t.dispose())}),this.R=[],e},t.prototype.toString=function(){return n.toString(this)},t}.apply(e,n))&&(t.exports=n)},function(t,e,n){n=[n(0)];void 0!==(n=function(i){function r(){}return r.prototype.a=function(t,e){if(r.prototype.e("name",e),!i.a(t))throw new Error('"'+e+'" must be an object. Received ['+typeof t+"]")},r.prototype.isArray=function(t,e){if(r.prototype.e("name",e),!i.isArray(t))throw new Error('"'+e+'" must be an array. Received ['+typeof t+"]")},r.prototype.e=function(t,e){if(!i.e(e))throw new Error('"name" must be a string. Received ['+typeof e+"]");if(!i.e(t))throw new Error('"'+e+'" must be a string. Received ['+typeof t+"]")},r.prototype.f=function(t,e){if(r.prototype.e("name",e),!i.f(t))throw new Error('"'+e+'" must be a boolean. Received ['+typeof t+"]")},r.prototype.u=function(t,e){if(r.prototype.e("name",e),!i.u(t))throw new Error('"'+e+'" must be a number. Received ['+typeof t+"]")},r.prototype.h=function(t,e){if(r.prototype.e("name",e),!i.h(t))throw new Error('"'+e+'" must be a function. Received ['+typeof t+"]")},r.prototype.v=function(t,e){r.prototype.g(t,e)},r.prototype.g=function(t,e){if(r.prototype.e("name",e),r.prototype.e(t,e),""===t)throw new Error('"'+e+'" must not be empty')},r.prototype.y=function(t,e,n){if(r.prototype.e("name",n),!i.a(t))throw new Error('"'+n+'" must be an instance. Received ['+typeof t+"]");if(!(t instanceof e))throw new Error('"'+n+'" must be a valid instance of class '+i.get(e,["name"],"undefined"))},r.prototype.w=function(t,e){if(r.prototype.e("name",e),i.isUndefined(t))throw new Error('"'+e+'" must not be undefined')},r.prototype.b=function(t,e,n){if(r.prototype.g(n,"name"),e=i.getEnumName(e,t),i.isNullOrUndefined(e))throw new Error('"'+n+'" must be a valid type. Unable to locate type ['+t+"]");return e},r.prototype.k=function(t,n){r.prototype.e(n,"name"),r.prototype.isArray(t,n),i.forEach(t,function(t,e){r.prototype.e(t,n+"["+e+"]")})},new r}.apply(e,n))&&(t.exports=n)},function(t,e,n){n=[n(3)];void 0!==(n=function(t){return t}.apply(e,n))&&(t.exports=n)},function(t,e,n){void 0!==(e=function(){"use strict";function r(t){var t=t.split("."),e=[];return a.forEach(t,function(t){e=e.concat(function(t){for(var e="",n=[],i=0,r=0;r<t.length;r++)if("["===t[r]){if(i++,!a.e(e)||1<i)return[t];e&&(n.push(e),e="")}else if("]"===t[r]){if(0!=--i)return[t];n.push(e),e=""}else{if(r===t.length-1)return[t];e+=t[r]}return n}(t))}),e}function a(){}a.clone=function(t){return a.isArray(t)?t.slice():a.a(t)?a.assign({},t):t},a.get=function(t,e,n){if(a.isNullOrUndefined(t))return n;u(t,"objectToTraverse");var i=e;if(a.e(i))i=r(e);else if(!a.isArray(i))throw new Error("Unsupported path type "+typeof e);return t=a.reduce(i,function(t,e){if(a.a(t)||a.isArray(t))return t[e]},t),a.isUndefined(t)?n:t},a.set=function(t,e,n){if(!a.a(t))return t;u(t,"objectToTraverse");var i=t,o=e;if(a.e(o))o=r(e);else if(!a.isArray(o))throw new Error("Unsupported path type "+typeof e);return a.forEach(o,function(t,r){(function(t,e,n){if(a.u(parseInt(e))&&a.isArray(t))return t[e]=n;if(a.e(e)&&a.a(t))return t[e]=n;throw new Error("Unsupported type "+typeof e+" when setting property or index")})(i,t,function(t,e,n,i){if(t.length-1===r)return i;if(i=t[r],e=t[r+1],a.isArray(n[i])||a.a(n[i]))return n[i];if(!a.isArray(n[i])&&a.u(parseInt(e)))return[];if(!a.a(n[i])&&a.e(e))return{};throw new Error("Unsupported type "+typeof i+" when setting property or index")}(o,0,i,n)),i=i[t]}),t},a.bind=function(e,n){var i=Array.prototype.slice.call(arguments,2);return function(){if(!a.h(e))throw new TypeError("_.bind - callback must be a function. Received ["+typeof e+"]");var t=i.concat(Array.prototype.slice.call(arguments));return e.apply(n,t)}},a.now=function(){return(new Date).getTime()},a.utc=function(t){return a.u(t)?t:t?Math.floor(t):NaN},a.isoString=function(){var t=new Date;return t.toISOString?t.toISOString():t.getUTCFullYear()+"-"+a.pad(t.getUTCMonth()+1,2)+"-"+a.pad(t.getUTCDate(),2)+"T"+a.pad(t.getUTCHours(),2)+":"+a.pad(t.getUTCMinutes(),2)+":"+a.pad(t.getUTCSeconds(),2)+"."+(t.getUTCMilliseconds()/1e3).toFixed(3).slice(2,5)+"Z"},a.map=function(t,n){u(t,"collection");var i=[];return t.constructor===Array?a.forEach(t,function(t,e){a.e(n)&&a.a(t)?i.push(t[n]):a.h(n)&&i.push(n(t,e))}):a.forOwn(t,function(t,e){a.h(n)&&i.push(n(t,e))}),i},a.values=function(t){if(!a.a(t)||a.isArray(t))throw new Error("_.values argument, Collection, must be an object. Received ["+typeof t+"]");return a.map(t,function(t){return t})},a.keys=function(t){if(!a.a(t)||a.isArray(t))throw new Error("_.keys argument, Collection, must be an object. Received ["+typeof t+"]");return a.map(t,function(t,e){return e})},a.forEach=function(t,e){if(!a.h(e))throw new Error("_.forEach argument, Callback, must be a function. Received ["+typeof e+"]");o(t,"collection");for(var n=0;n<t.length;n++)if(!1===e(t[n],n))return},a.forOwn=function(t,e){if(!a.h(e))throw new Error("Callback must be a function. Received ["+typeof e+"]");u(t,"objectWithProperties");for(var n=Object.keys(t),i=0;i<n.length;i++){var r=n[i];if((t.hasOwnProperty(r)||Object.prototype.hasOwnProperty.call(t,r))&&!1===e(t[r],r))return}},a.argumentsToArray=function(t){if(!a.a(t)||!t.length)throw new Error("Collection must be arguments. Received ["+typeof t+"]");for(var e=[],n=0;n<t.length;n++)e.push(t[n]);return e},a.assign=function(n){a.isNullOrUndefined(n)&&(n={}),u(n,"target");var t=a.argumentsToArray(arguments);return t.shift(),a.forEach(t,function(t,e){a.isNullOrUndefined(t)||(u(t,"_.assign(sources["+e+"])"),a.forOwn(t,function(t,e){n[e]=t}))}),n},a.includes=function(t,e){if(a.e(t))return h(e,"Includes value and search parameter"),-1<t.indexOf(e);if(a.isUndefined(t)||a.isUndefined(e))return!1;function n(t){if(t===e)return!(i=!0)}u(t,"collection");var i=!1;return t.constructor===Array?a.forEach(t,n):a.forOwn(t,n),i},a.reduce=function(t,n,e){u(t,"collection");var i=e===a.noop()?null:e;return t.constructor===Array?a.forEach(t,function(t,e){i=n(i,t,e)}):a.forOwn(t,function(t,e){i=n(i,t,e)}),i},a.sample=function(t){return o(t,"collection"),t[Math.floor(Math.random()*t.length)]},a.uniqueId=function(){return(a.now()*Math.random()).toString()},a.find=function(t,n,i){o(t,"collection");var r=void 0;return a.forEach(t,function(t,e){if(n(t)&&(i||0)<=e)return r=t,!1}),r},a.findIndex=function(t,n,i){o(t,"collection");var r=-1;return a.forEach(t,function(t,e){if(n(t,e)&&(i||0)<=e)return r=e,!1}),r},a.filter=function(t,e){o(t,"collection");var n=[];return a.forEach(t,function(t){e(t)&&n.push(t)}),n},a.remove=function(t,e){return o(t,"collection"),a.filter(t,function(t){return!e(t)})},a.take=function(t,e){return o(t,"collection"),t.slice(0,e)},a.hasDifferences=function(t,e,n){return 0<a.findDifferences(t,e,n).length},a.findDifferences=function(n,i,r){function t(t,e){s[e]=1,(a.a(t)||a.isArray(t))&&r?a.hasIndexOrKey(i,e)&&a.sameTypes(n[e],i[e])&&!a.hasDifferences(n[e],i[e],r)||o.push(e):n[e]!==i[e]&&o.push(e)}var o=[],s={};if(a.isArray(n)&&a.isArray(i))n.length>i.length?a.forEach(n,t):a.forEach(i,t);else{if(!a.a(n)||!a.a(i)||a.isArray(n)||a.isArray(i))throw new Error("Object types do not match");a.forOwn(n,t),a.forOwn(i,function(t,e){s.hasOwnProperty(e)||o.push(e)})}return o},a.hasIndexOrKey=function(t,e){return a.isArray(t)?t.length>parseInt(e):!!a.a(t)&&t.hasOwnProperty(e)},a.startsWith=function(t,e){return h(t,"value"),h(e,"prefix"),0===t.indexOf(e)},a.endsWith=function(t,e){h(t,"value"),h(e,"postfix");var n=t.length-e.length;return t.indexOf(e,n)===n},a.sameTypes=function(t,e){return a.isNullOrUndefined(t)||a.isNullOrUndefined(e)?a.isNullOrUndefined(t)&&a.isNullOrUndefined(e):a.isArray(t)||a.isArray(e)?a.isArray(t)&&a.isArray(e):typeof t==typeof e},a.freeze=function(t){return"freeze"in Object?Object.freeze(t):t},a.noop=function(){},a.a=function(t){return null!==t&&"object"==typeof t},a.isArray=function(t){return!!a.a(t)&&t.constructor===Array},a.e=function(t){return"string"==typeof t},a.u=function(t){return!isNaN(t)&&"number"==typeof t},a.f=function(t){return"boolean"==typeof t},a.h=function(t){return"function"==typeof t},a.isNullOrUndefined=function(t){return null===t||a.isUndefined(t)},a.isUndefined=function(t){return void 0===t},a.getEnumName=function(t,e){var n=null,t=a.map(t,function(t){return t});return a.u(e)?n=a.find(t,function(t){return t.id===e}):a.e(e)&&(n=a.find(t,function(t){return t.name.toLowerCase()===e.toLowerCase()})),n?n.name:null},a.toString=function(t){if(a.e(t))return t;if(a.f(t))return t?"true":"false";if(a.u(t))return t.toString();var e="";if(t)if(a.h(t.toString))e=t.toString();else if(a.a(t.toString))try{e=t.toString()}catch(t){e="[object invalid toString()]"}if(0!==e.indexOf("[object"))return e;var n=[];return e+JSON.stringify(t,function(t,e){if(a.a(e)&&!a.isNullOrUndefined(e)){if(a.includes(n,e))return"<recursive>";n.push(e)}return""===t?e:a.toString(e)})},a.pad=function(t,e){s(t,"value"),s(e,"numberToPad");for(var n=t.toString().length,i=0;i<e-n;i++)t="0"+t.toString();return t.toString()},a.addEventListener=function(t,e,n,i){u(t,"target"),h(e,"eventName"),c(n,"listener"),t.phenixAddEventListener?t.phenixAddEventListener.call(t,e,n,!!i):t.addEventListener?t.addEventListener(e,n,!!i):t.attachEvent&&t.attachEvent("on"+e,n)},a.removeEventListener=function(t,e,n,i){u(t,"target"),h(e,"eventName"),c(n,"listener"),t.phenixRemoveEventListener?t.phenixRemoveEventListener.call(t,e,n,!!i):t.removeEventListener?t.removeEventListener(e,n,!!i):t.detachEvent&&t.detachEvent("on"+e,n)};var o=function(t){if(!a.isArray(t))throw new Error("Input must be an array. Received ["+typeof t+"]")},s=function(t,e){if(h(e,"name"),!a.u(t))throw new Error(e+" must be a number. Received ["+typeof t+"]")},u=function(t,e){if(h(e,"name"),!a.a(t))throw new Error("collection type not supported - "+e+" must be an array or object. Received ["+typeof t+"]")},c=function(t,e){if(h(e,"name"),!a.h(t))throw new Error(e+" must be a function. Received ["+typeof t+"]")},h=function(t,e){if(!a.e(e))throw new Error("Name must be a string. Received ["+typeof e+"]");if(!a.e(t))throw new Error(e+" must be a string. Received ["+typeof t+"]")};return a}.apply(e,[]))&&(t.exports=e)},function(t,e,n){n=[n(1),n(2)];void 0!==(n=function(t,e){return{Disposable:t,DisposableList:e}}.apply(e,n))&&(t.exports=n)}],o={},i.m=r,i.c=o,i.i=function(t){return t},i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:n})},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=6))},function(t,e,n){var i;window,i=function(n,i,r,o,s){return u=[function(t,e){t.exports=n},function(t,e){t.exports=i},function(n,i,t){!function(t){var e=function(){"use strict";return"object"==typeof window?window:"object"==typeof t?t:{}}.apply(i,[]);void 0===e||(n.exports=e)}.call(this,t(8))},function(t,e,n){n=[n(0),n(4),n(5),n(2),n(11)];void 0===(n=function(r,h,o,s,a){"use strict";var u=function(){console.log.apply(console,arguments)},c=function(){console.error.apply(console,arguments)};function t(t,e,n){var i=this;this.I=t,this.T=e,this.C=n||{},this.M={},this.P=new h.DisposableList,this.O=null,n=function(t){i.x=!0,i.q=!0===t,t?d.call(i):c("Failed to create Phenix video element"),i.D&&i.D(i.q)};try{this.A=function(){this.O=new a(this.I,this.T,this.C);var t=this;return this.P.add(new h.Disposable(function(){t.O.destroy()})),this.O.getElement()}.call(this),this.A.className=this.I.className,this.A.height=this.I.height,this.A.width=this.I.width,this.U=this.I.style.cssText,this.I.style.cssText="visibility:hidden !important;width:0px !important;height:0px !important;margin:0px !important;padding:0px !important;border-style:none !important;border-width:0px !important;max-width:0px !important;max-height:0px !important;outline:none !important",this.P.add(new h.Disposable(function(){i.I.style.cssText=i.U})),this.A.onunload=function(){i.x=!1},function(){var t,e,i=this;r.get(s,["MutationObserver"])?((t=new MutationObserver(function(t){t.forEach(function(t){if("childList"===t.type)for(var e=0;e<t.addedNodes.length;e++){var n=t.addedNodes[e];t.target!==i.A&&(n===i.I?(t.target.replaceChild(i.A,i.I),d.call(i)):function(t){for(var e=i.I.parentNode;null!==e;){if(e===t)return 1;e=e.parentNode}}(t.target)&&(i.I.parentNode&&i.I.parentNode.replaceChild(i.A,i.I),d.call(i)))}})})).observe(document.body,{childList:!0,attributes:!1,characterData:!1,subtree:!0}),i.P.add(new h.Disposable(function(){t.disconnect()}))):(u("Falling back to use of DOM event listeners. This results in degraded performance for further DOM modifications and does not work for IE prior to version 9. See https://developer.mozilla.org/en-US/docs/Web/Guide/Events/Mutation_events for details."),e=function(){i.I.parentNode&&i.I.parentNode.replaceChild(i.A,i.I)},i.addEventListener("DOMNodeInserted",e,!1),i.P.add(new h.Disposable(function(){i.removeEventListener("DOMNodeInserted",e,!1)})))}.call(this),document.body&&document.body.contains||u("document.body.contains is not supported"),document.body&&document.body.contains&&document.body.contains(this.I)&&(this.I.parentNode.replaceChild(this.A,this.I),this.O&&(this.A=this.O.finishInitializationInDom()),this.P.add(new h.Disposable(function(){i.A.parentNode&&i.A.parentNode.replaceChild(i.I,i.A)}))),(new o).waitForReady(this.A,n)}catch(t){c("Error while loading Phenix RTC"+t),n(!1)}}function n(n){var i=this;i.A.phenixSetEventListener(n,function(){var t=i.M[n];if(t)for(var e=0;e<t.length;e++)t[e].apply(i,arguments)})}function f(t,e){var n;document.createEvent?(n=document.createEvent("HTMLEvents")).initEvent(e,!0,!0):(n=document.createEventObject()).eventType=e,n.eventName=e,setTimeout(function(){document.createEvent?t.dispatchEvent(n):t.fireEvent("on"+n.eventType,n)})}function d(){for(var t=Object.keys(this.M),e=0;e<t.length;e++)n.call(this,t[e]);this.hookUpEvents(),function(){var t,e,n=this,i=["style"];r.get(s,["MutationObserver"])?((t=new MutationObserver(function(t){t.forEach(function(t){"attributes"===t.type&&t.target===n.I&&-1===i.indexOf(t.attributeName)&&(n.A[t.attributeName]=n.I[t.attributeName])})})).observe(n.I,{attributes:!0}),n.P.add(new h.Disposable(function(){t.disconnect()}))):(u("Falling back to use of DOM event listeners. This results in degraded performance for further DOM modifications and does not work for IE prior to version 9. See https://developer.mozilla.org/en-US/docs/Web/Guide/Events/Mutation_events for details."),e=function(t){n.A[t.target.tagName]=n.I[t.target.tagName]},n.I.addEventListener?(n.I.addEventListener("DOMAttrModified",e,!1),n.P.add(new h.Disposable(function(){n.I.removeEventListener("DOMAttrModified",e,!1)}))):(n.I.attachEvent("onpropertychange",e),n.P.add(new h.Disposable(function(){n.I.detachEvent("DOMAttrModified",e)}))))}.call(this),this.A.id=this.I.id,this.A.style.cssText=this.U,this.A.className=this.I.className,this.A.innerHtml=this.I.innerHtml,this.A.width=this.I.width,this.A.height=this.I.height,this.A.autoplay=this.I.autoplay,this.A.muted=this.I.muted,this.A.defaultMuted=this.I.defaultMuted,this.A.volume=this.I.volume}return t.prototype.hookUpEvents=function(){function t(){f(u,"error")}function e(){u.muted=a.A.muted,f(u,"mute")}function n(){u.muted=a.A.muted,f(u,"unmute")}function i(){u.ended=a.A.ended,f(u,"ended")}function r(){u.width=a.A.width,u.height=a.A.height,f(u,"loadedmetadata")}function o(){u.width=a.A.width,u.height=a.A.height,f(u,"loadeddata")}function s(){u.width=a.A.width,u.height=a.A.height,f(u,"resize")}var a=this,u=this.I;this.addEventListener("error",t),this.addEventListener("mute",e),this.addEventListener("unmute",n),this.addEventListener("ended",i),this.addEventListener("loadedmetadata",r),this.addEventListener("loadeddata",o),this.addEventListener("resize",s);var c=new h.Disposable(function(){a.removeEventListener("error",t),a.removeEventListener("mute",e),a.removeEventListener("unmute",n),a.removeEventListener("ended",i),a.removeEventListener("loadedmetadata",r),a.removeEventListener("loadeddata",o),a.removeEventListener("resize",s)});return this.P.add(c),c},t.prototype.onReady=function(t){var e=this;this.x?setTimeout(function(){t(e.q)},1):this.D=t},t.prototype.getElement=function(){return this.A},t.prototype.addEventListener=function(t,e,n){!function(t,e){return this.O.addEventListener(t,e)}.call(this,t,e,n)},t.prototype.removeEventListener=function(t,e,n){!function(t,e){return this.O.removeEventListener(t,e)}.call(this,t,e,n)},t.prototype.destroy=function(){this.P.dispose()},t}.apply(e,n))||(t.exports=n)},function(t,e){t.exports=r},function(t,e,n){n=[n(1)];void 0===(n=function(t){"use strict";var u=new t(navigator.userAgent).detect();function e(t){this.j=t||15e3}function c(){console.error.apply(console,arguments)}return e.prototype.waitForReadyWithTimeout=function(e,n,i){function r(t){o||(o=!0,n(t))}var o=!1,s=1,a=s;Object.prototype.hasOwnProperty&&Object.prototype.hasOwnProperty.call(e,"onload")||"IE"!==u.browser&&c("No means of detecting when <object> is loaded"),e.onload=function(){r(!0)},function t(){if(4===e.readyState)return r(!0);s=Math.min(s+1e3,2*s),i<(a+=s)?(c("Timed out while waiting for <object> to load"),r(!1)):setTimeout(t,s)}()},e.prototype.waitForReady=function(t,e){this.waitForReadyWithTimeout(t,e,this.j)},e}.apply(e,n))||(t.exports=n)},function(t,e,n){"use strict";n=[n(7),n(3)];void 0===(n=function(t,e){return t.PhenixFlashVideo=e,t}.apply(e,n))||(t.exports=n)},function(t,e,n){n=[n(0),n(1),n(2),n(9)];void 0===(n=function(t,e,n,i){"use strict";return n={browser:(e=new e(navigator.userAgent).detect()).browser,browserVersion:e.version,global:n,shim:i},t.assign(n,i()),n}.apply(e,n))||(t.exports=n)},function(t,e){var n=function(){return this}();try{n=n||new Function("return this")()}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,e,n){n=[n(0),n(1),n(10),n(2),n(3)];void 0===(n=function(o,t,e,r,n){"use strict";var u=function(){},i=new t(navigator.userAgent).detect(),s=r.RTCPeerConnection,a=r.RTCSessionDescription,c=r.RTCIceCandidate,h=null,f=null,d=null,l=null,p=null,m=null,v=null,g=!1;function y(t,e,n){var i=o.bind(w,this,t,e,n);return navigator&&navigator.mediaDevices&&o.h(navigator.mediaDevices.getUserMedia)?navigator.mediaDevices.getUserMedia(t).then(function(t){return i(t)}).catch(function(t){return n(t)}):navigator&&o.h(navigator.getUserMedia)?navigator.getUserMedia(t,i,n):r&&o.h(r.getUserMedia)?r.getUserMedia(t,i,n):void 0}function w(r,o,s,a){setTimeout(function(){for(var t=a.getTracks(),e=0;e<t.length;e++){var n=t[e];if(n.onended=function(t){u(t.timeStamp,"Track",n.id,n.label,"ended")},u("Track",n.id,n.label,t[e].kind,"readyState=",t[e].readyState),"ended"===n.readyState)return b("User media not available",s,t)}var i=(r.audio?1:0)+(r.video?1:0);if(t.length!==i)return b("Unable to get all requested user media.",s,t);o(a)},100)}function b(t,e,n){try{var i=new Error(t);i.code="unavailable",e(i)}finally{!function(t){for(var e=0;e<t.length;e++)t[e].stop()}(n)}}function k(n,i){if("input"!==n&&"output"!==n)throw new Error("Unsupported device type "+n);navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices().then(function(t){var e=[];t.forEach(function(t){t.kind==="audio"+n?e.push({kind:"audio",id:t.deviceId,label:t.label}):t.kind==="video"+n&&e.push({kind:"video",id:t.deviceId,label:t.label})}),i(e)})}function S(t,e,n){return void 0!==t.srcObject?t.srcObject=e:void 0!==t.mozSrcObject?t.mozSrcObject=e:void 0!==t.src?t.src=URL.createObjectURL(e):u("Error attaching stream to element."),void 0===(e=t.play())?"function"==typeof n&&n():e.then(function(){"function"==typeof n&&n()}).catch(function(t){u("Play() failed: "+t),"function"==typeof n&&n(t)}),t}function E(t,e){return t.src=e,t.play(),t}function R(t,e){return t.src=e.src,t}function I(t,e,n){e(function(r,t){switch(i.browser){case"Edge":t.forEach(function(t){t.mediaType=function(n){var i,t,e;if(n)return e=(t=r).localDescription.sdp.split("m="),t=t.remoteDescription.sdp.split("m="),e.length===t.length&&o.findIndex(e,function(t,e){return t=t,o.startsWith(t,"video")&&o.includes(t.toLowerCase(),n.toLowerCase())&&(i="video"),void(o.startsWith(t,"audio")&&o.includes(t.toLowerCase(),n.toLowerCase())&&(i="audio"))}),i}(t.codecId),t.bytesSent=T(t.packetsSent,t.mediaType),t.bytesReceived=T(t.packetsReceived,t.mediaType)});break;case"Safari":t.forEach(function(t){o.includes(t.id.toLowerCase(),"audio")&&o.includes(t.id.toLowerCase(),"rtp")&&(t.mediaType="audio"),o.includes(t.id.toLowerCase(),"video")&&o.includes(t.id.toLowerCase(),"rtp")&&(t.mediaType="video")})}return t}(t,n))}function T(t,e){return t=parseInt(t)||0,"audio"===e?100*t:"video"===e?1080*t:void 0}return function(){!function(){if(s=r.RTCPeerConnection,a=r.RTCSessionDescription,c=r.RTCIceCandidate,navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices&&(h=o.bind(k,null,"input")),navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices&&(f=o.bind(k,null,"output")),(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia||r.getUserMedia)&&(d=y),!r.RTCPeerConnection)return function(){console.log.apply(console,arguments)}("Browser version does not appear to be WebRTC-capable",i.browser,i.version);switch(i.browser){case"Firefox":u("Firefox detected",i),p=S,v=R,l=function(t,e,n,i){t.getStats(e,o.bind(I,this,t,n),i)},g=!0;break;case"Opera":u("Opera detected",i),p=S,v=R,l=function(t,e,n,i){t.getStats(o.bind(I,this,t,n),e,i)},g=!0;break;case"Chrome":u("Webkit detected",i),p=S,v=R,l=function(t,e,n,i){t.getStats(o.bind(I,this,t,n),e,i)},g=!0;break;case"Edge":u("Edge detected",i),p=S,v=R,l=function(t,e,n,i){t.getStats(e,o.bind(I,this,t,n),i)},g=!0;break;case"Safari":u("Safari detected",i),p=function(t,e,n){return o.a(e)&&(t.__phenixHasPlayedWebRtc=!0),S(t,e,n)},m=function(t,e){return t.__phenixHasPlayedWebRtc?((t=new n(t,e,!1).getElement()).play(),t):E(t,e)},v=R,l=function(t,e,n,i){t.getStats(e).then(o.bind(I,this,t,n),i)},g=!0;break;case"ReactNative":u("React Native detected",i),p=function(){u("attachMediaStream not supported in React Native environment")},m=function(){u("attachUriStream not supported in React Native environment")},v=function(){u("reattachMediaStream not supported in React Native environment")},l=function(t,e,n,i){t.getStats(e).then(o.bind(I,this,t,n),i)},g=!0;break;default:u("Browser does not appear to be WebRTC-capable",i)}}();var t={RTCPeerConnection:s,RTCSessionDescription:a,RTCIceCandidate:c,getSources:h,getDestinations:f,getUserMedia:d,getStats:l,attachMediaStream:p,attachUriStream:m||E,reattachMediaStream:v,webrtcSupported:g,exportGlobal:function(){r.RTCPeerConnection=t.RTCPeerConnection,r.RTCSessionDescription=t.RTCSessionDescription,r.RTCIceCandidate=t.RTCIceCandidate}};return t}}.apply(e,n))||(t.exports=n)},function(t,e){t.exports=o},function(t,e,n){n=[n(0),n(1),n(4),n(12),n(5),n(2)];void 0===(n=function(a,t,r,o,e,u){"use strict";var s=function(){console.log.apply(console,arguments)},c=function(){console.error.apply(console,arguments)},n={width:480,height:360,videoWidth:480,videoHeight:360,muted:!1,volume:1,currentTime:0,duration:1/0,readyState:0,ended:!1,buffered:null,autoplay:!0},i=300,h=new t(navigator.userAgent).detect(),f="IE"===h.browser&&/(trident|microsoft)/i.test(a.get(u.navigator,["appName"],"")),d="Edge"===h.browser&&a.get(u.navigator,"msLaunchUri")&&!a.get(u.document,"documentMode");function l(t,e,n){this.P=new r.DisposableList,this.M=new o.NamedEvents,this.N="video"===t.tagName,this.F=n.swfSrc,this.L=t.id||n.streamId,this.B=t.clientWidth,this._=t.clientHeight,this.I=t,this.W=null,this.V=[],this.z=["uid="+this.L,"autoplay="+(!!a.isUndefined(t.autoplay)||t.autoplay),"muted="+(!a.isUndefined(t.muted)&&t.muted),"allowScriptAccess=always","preload=true","src="+JSON.stringify(e)];var i=this;this.P.add(new r.Disposable(function(){y.call(i,"fire_stop")}));try{this.W=(f||d?function(){return document.createElement("div")}:function(){var t=document.createElement("embed");return t.setAttribute("id","__"+this.L),t.setAttribute("name","__"+this.L),t.setAttribute("play","true"),t.setAttribute("loop","false"),t.setAttribute("quality","high"),t.setAttribute("bgcolor","#000000"),t.setAttribute("wmode","transparent"),t.setAttribute("allowScriptAccess","always"),t.setAttribute("allowFullScreen","true"),t.setAttribute("type","application/x-shockwave-flash"),t.setAttribute("pluginspage","//www.macromedia.com/go/getflashplayer"),t.setAttribute("src",this.F),t.setAttribute("flashvars",this.z.join("&")),this.N&&(t.setAttribute("width",this.B.toString()),t.setAttribute("height",this._.toString())),t}).call(this),v.call(this)}catch(t){c("Error while loading Flash Player"+t)}}function p(e,n){return a.findIndex(this.V,function(t){return t.name===e&&t.listener===n})}function m(t,e){var n=document.createElement("param");return n.setAttribute("name",t),n.setAttribute("value",e),n}function v(){a.assign(this.W,n,{id:this.L,width:this.B,height:this._,videoWidth:this.B,videoHeight:this._}),function(){var s=this;u["__event__"+this.L]=function(t,e){var n,i,r,o=(n=t,i=s.W,r=n.match(/([a-z]+\.([a-z]+))/i),i={target:i},null!==r&&(n=r[1],i.namespace=r[2]),"IE"===h.browser&&8<h.version?((r=u.document.createEvent("CustomEvent")).initCustomEvent(n,!1,!1,i),r):u.CustomEvent?new u.CustomEvent(n,{detail:i}):i);if(e)try{o.data=JSON.parse(e),o.details.data=o.data}catch(t){o.message=e}switch(t){case"ended":break;case"error":s.W.error=o.data,s.W.dispatchEvent&&s.W.dispatchEvent(new Error(e));break;case"loadeddata":case"loadedmetadata":case"loadstart":s.W.dispatchEvent&&s.W.dispatchEvent(o);break;case"pause":s.W.paused=!0;break;case"play":case"playing":s.W.paused=!1;break;case"progress":case"seeked":case"seeking":case"stalled":case"suspend":s.W.dispatchEvent&&s.W.dispatchEvent(o);break;case"timeupdate":s.W.currentTime=function(t){return(this.W["get_"+t]||a.noop).call(this.W)}.call(s,"currentTime"),s.W.dispatchEvent&&s.W.dispatchEvent(o)}s.M.fireAsync(t,[o])};var e=this.W.requestFullscreen||this.W.mozRequestFullScreen||this.W.webkitRequestFullScreen||this.W.msRequestFullscreen;function t(){y.call(s,"set_size",s.G?screen.width:s.W.clientWidth,s.G?screen.height:s.W.clientHeight)}this.P.add(new r.Disposable(function(){delete u["__event__"+s.L]})),this.W.play=function(){y.call(s,"fire_play")},this.W.load=function(){y.call(s,"fire_load")},this.W.seek=function(){y.call(s,"fire_seek")},this.W.pause=function(){y.call(s,"fire_pause")},this.W.requestFullscreen=function(){var t;s.G=!0,function(){var t=this;function e(){document.webkitIsFullScreen||document.mozFullScreen||document.msFullscreenElement||document.fullscreenElement||(document.removeEventListener("webkitfullscreenchange",e),document.removeEventListener("mozfullscreenchange",e),document.removeEventListener("fullscreenchange",e),document.removeEventListener("MSFullscreenChange",e),document.removeEventListener("keydown",n),t.G=!1,t.W.style.position=t.J,t.W.style.height=t.H,t.W.style.width=t.K)}function n(t){("key"in(t=t||u.event)?"Escape"===t.key||"Esc"===t.key:27===t.keyCode)&&e()}document.addEventListener("webkitfullscreenchange",e,!1),document.addEventListener("mozfullscreenchange",e,!1),document.addEventListener("fullscreenchange",e,!1),document.addEventListener("MSFullscreenChange",e,!1),document.addEventListener("keydown",n,!1)}.call(s),s.H=s.W.style.height,s.K=s.W.style.width,s.J=s.W.style.position,s.W.style.position="absolute",s.W.style.height="100%",s.W.style.width="100%",void 0===u.ActiveXObject||null!==(t=new u("WScript.Shell"))&&t.SendKeys("{F11}"),e.call(s.W)},a.addEventListener(u,"resize",t),this.P.add(new r.Disposable(function(){a.removeEventListener(u,"resize",t)}))}.call(this),function(){var t,e,n=this,i=["currentTime","paused","error","src"];a.get(u,["MutationObserver"])?((t=new MutationObserver(function(t){t.forEach(function(t){"attributes"!==t.type||t.target!==n.W||a.includes(i,t.attributeName)||g.call(n,t.attributeName,n.W[t.attributeName])})})).observe(n.W,{attributes:!0}),n.P.add(new r.Disposable(function(){t.disconnect()}))):(s("Falling back to use of DOM event listeners. This results in degraded performance for further DOM modifications and does not work for IE prior to version 9. See https://developer.mozilla.org/en-US/docs/Web/Guide/Events/Mutation_events for details."),e=function(t){a.includes(i,t.target.tagName)||g.call(n,t.target.tagName,n.W[t.target.tagName])},n.W.addEventListener?(n.W.addEventListener("DOMAttrModified",e,!1),n.P.add(new r.Disposable(function(){n.W.removeEventListener("DOMAttrModified",e,!1)}))):(n.W.attachEvent("onpropertychange",e),n.P.add(new r.Disposable(function(){n.W.detachEvent("DOMAttrModified",e)}))))}.call(this),function(){var t=function(){var n=this,i=n.I.muted,r=n.W.muted;return function(){var t=n.W.muted,e=n.W.muted;t===i&&e===r||((e=t!==i?r=i=t:e)!==r&&(r=i=t),n.W.muted=e,n.I.muted=e,g.call(n,"muted",e))}}.call(this),e=function(){var n=this,i=n.I.volume,r=n.W.volume;return function(){var t=n.W.volume,e=n.W.volume;t===i&&e===r||((e=t!==i?r=i=t:e)!==r&&(r=i=t),n.W.volume=e,n.I.volume=e,g.call(n,"volume",e))}}.call(this),n=setInterval(function(){t(),e()},i);this.P.add(new r.Disposable(function(){clearInterval(n)}))}.call(this)}function g(t,e){return(this.W["set_"+t]||a.noop).call(this.W,e)}function y(t){if(t=this.W[t],[].shift.apply(arguments),t)return t.apply(this.W,arguments)}return l.prototype.finishInitializationInDom=function(){return function(){if(!f&&!d)return this.W;var t=(d?"__"+this.L:this.L)+a.uniqueId(),n=document.createElement("object"),e=document.createElement("div"),i=[m("movie",this.F+"?x="+a.now()),m("flashvars",this.z.join("&")),m("quality",2),m("bgcolor","#000000"),m("wmode","transparent"),m("allowScriptAccess","always"),m("allowFullScreen","true"),e];return e.innerHTML="You are using a browser that does not have Flash player enabled or installed. Please turn on your Flash player plugin or download the latest version from https://get.adobe.com/flashplayer/",d?(n.setAttribute("type","application/x-shockwave-flash"),n.setAttribute("data",this.F),n.setAttribute("id",t),n.setAttribute("width","__"+this.B.toString()),n.setAttribute("height","__"+this._.toString())):(n.setAttribute("classid","clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"),n.setAttribute("codebase","//download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab"),n.setAttribute("id",t),n.setAttribute("width",this.B.toString()),n.setAttribute("height",this._.toString())),n.object?(a.forEach(i,function(t){a.isNullOrUndefined(a.get(n.object,[t.name]))||(n.object[t.name]=t.value)}),n.appendChild(e)):a.forEach(i,function(e){var t=a.find(n.children,function(t){return t.name===e.name});return t?n.replaceChild(e,t):n.appendChild(e)}),this.W.outerHTML=n.outerHTML,u.document.getElementById&&(this.W=u.document.getElementById(t),v.call(this)),this.W}.call(this)},l.prototype.getElement=function(){return this.W},l.prototype.addEventListener=function(t,e){var n;-1<p.call(this,t,e)||(n=this.M.listen(t,e),this.P.add(n),this.V.push({name:t,listener:e,disposable:n}))},l.prototype.removeEventListener=function(t,e){-1<(e=p.call(this,t,e))&&this.V.splice(e,1)[0].disposable.dispose()},l.prototype.destroy=function(){this.P.dispose()},l}.apply(e,n))||(t.exports=n)},function(t,e){t.exports=s}],c={},a.m=u,a.c=c,a.d=function(t,e,n){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},a.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)a.d(n,i,function(t){return e[t]}.bind(null,i));return n},a.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="",a(a.s=6);function a(t){if(c[t])return c[t].exports;var e=c[t]={i:t,l:!1,exports:{}};return u[t].call(e.exports,e,e.exports,a),e.l=!0,e.exports}var u,c},t.exports=i(n(0),n(17),n(2),n(49),n(4))},function(t,e,n){function i(t){if(o[t])return o[t].exports;var e=o[t]={i:t,l:!1,exports:{}};return r[t].call(e.exports,e,e.exports,i),e.l=!0,e.exports}var r,o;t.exports=(r=[function(t,e,n){n=[n(8)];void 0!==(n=function(t){"use strict";return t}.apply(e,n))&&(t.exports=n)},function(t,e,n){n=[n(4)];void 0!==(n=function(t){return t}.apply(e,n))&&(t.exports=n)},function(t,e,n){n=[n(0),n(1),n(7)];void 0!==(n=function(o,s,n){"use strict";function t(){this.Q=[]}function i(e,n,t){var i=this;function r(){o.forEach(i.Q,function(t){t.apply(n,e)})}o.isNullOrUndefined(e)&&(e=[]),s.isArray(e,"args"),t?setTimeout(function(){r(),t()},0):r()}return t.prototype.fire=function(t,e){i.call(this,t,e)},t.prototype.fireAsync=function(t,e,n){i.call(this,t,e,n||function(){})},t.prototype.listen=function(e){var t=this;return s.h(e,"listener"),t.Q.push(e),new n.Disposable(function(){t.Q=o.remove(t.Q,function(t){return t===e})})},t.prototype.size=function(){return this.Q.length},t.prototype.dispose=function(){this.Q=[]},t.prototype.toString=function(){return"Event|"+this.size()},t}.apply(e,n))&&(t.exports=n)},function(t,e,n){n=[n(0),n(1),n(2)];void 0!==(n=function(i,r,n){"use strict";function t(){this.M={}}return t.prototype.fire=function(t,e,n){r.g(t,"name"),i.includes(i.keys(this.M),t)&&this.M[t].fire(e,n)},t.prototype.fireAsync=function(t,e,n){r.g(t,"name"),i.includes(i.keys(this.M),t)&&this.M[t].fireAsync(e,n)},t.prototype.listen=function(t,e){return r.g(t,"name"),(i.includes(i.keys(this.M),t)?this.M[t]:this.M[t]=new n).listen(e)},t.prototype.size=function(t){return i.includes(i.keys(this.M),t)?this.M[t].size():0},t.prototype.dispose=function(){i.forOwn(this.M,function(t){t.dispose()}),this.M={}},t.prototype.toString=function(){return"NamedEvents|"+i.keys(this.M).length},t}.apply(e,n))&&(t.exports=n)},function(t,e,n){n=[n(0)];void 0!==(n=function(i){function r(){}return r.prototype.a=function(t,e){if(r.prototype.e("name",e),!i.a(t))throw new Error('"'+e+'" must be an object. Received ['+typeof t+"]")},r.prototype.isArray=function(t,e){if(r.prototype.e("name",e),!i.isArray(t))throw new Error('"'+e+'" must be an array. Received ['+typeof t+"]")},r.prototype.e=function(t,e){if(!i.e(e))throw new Error('"name" must be a string. Received ['+typeof e+"]");if(!i.e(t))throw new Error('"'+e+'" must be a string. Received ['+typeof t+"]")},r.prototype.f=function(t,e){if(r.prototype.e("name",e),!i.f(t))throw new Error('"'+e+'" must be a boolean. Received ['+typeof t+"]")},r.prototype.u=function(t,e){if(r.prototype.e("name",e),!i.u(t))throw new Error('"'+e+'" must be a number. Received ['+typeof t+"]")},r.prototype.h=function(t,e){if(r.prototype.e("name",e),!i.h(t))throw new Error('"'+e+'" must be a function. Received ['+typeof t+"]")},r.prototype.v=function(t,e){r.prototype.g(t,e)},r.prototype.g=function(t,e){if(r.prototype.e("name",e),r.prototype.e(t,e),""===t)throw new Error('"'+e+'" must not be empty')},r.prototype.y=function(t,e,n){if(r.prototype.e("name",n),!i.a(t))throw new Error('"'+n+'" must be an instance. Received ['+typeof t+"]");if(!(t instanceof e))throw new Error('"'+n+'" must be a valid instance of class '+i.get(e,["name"],"undefined"))},r.prototype.w=function(t,e){if(r.prototype.e("name",e),i.isUndefined(t))throw new Error('"'+e+'" must not be undefined')},r.prototype.b=function(t,e,n){if(r.prototype.g(n,"name"),e=i.getEnumName(e,t),i.isNullOrUndefined(e))throw new Error('"'+n+'" must be a valid type. Unable to locate type ['+t+"]");return e},r.prototype.k=function(t,n){r.prototype.e(n,"name"),r.prototype.isArray(t,n),i.forEach(t,function(t,e){r.prototype.e(t,n+"["+e+"]")})},new r}.apply(e,n))&&(t.exports=n)},function(t,e,n){n=[n(0),n(1)];void 0!==(n=function(t,e){"use strict";function n(t){e.h(t,"cleanup"),this.S=t}return n.prototype.dispose=function(){return this.S.call()},n.prototype.toString=function(){return t.toString(this)},n}.apply(e,n))&&(t.exports=n)},function(t,e,n){n=[n(0)];void 0!==(n=function(n){"use strict";function t(){this.R=[]}return t.prototype.add=function(t){if(!t||!n.h(t.dispose))throw new Error('"disposable" must be a disposable or implement dispose');this.R.push(t)},t.prototype.dispose=function(){var e=[];return n.forEach(this.R,function(t){e.push(t.dispose())}),this.R=[],e},t.prototype.toString=function(){return n.toString(this)},t}.apply(e,n))&&(t.exports=n)},function(t,e,n){n=[n(5),n(6)];void 0!==(n=function(t,e){return{Disposable:t,DisposableList:e}}.apply(e,n))&&(t.exports=n)},function(t,e,n){void 0!==(e=function(){"use strict";function r(t){var t=t.split("."),e=[];return a.forEach(t,function(t){e=e.concat(function(t){for(var e="",n=[],i=0,r=0;r<t.length;r++)if("["===t[r]){if(i++,!a.e(e)||1<i)return[t];e&&(n.push(e),e="")}else if("]"===t[r]){if(0!=--i)return[t];n.push(e),e=""}else{if(r===t.length-1)return[t];e+=t[r]}return n}(t))}),e}function a(){}a.clone=function(t){return a.isArray(t)?t.slice():a.a(t)?a.assign({},t):t},a.get=function(t,e,n){if(a.isNullOrUndefined(t))return n;u(t,"objectToTraverse");var i=e;if(a.e(i))i=r(e);else if(!a.isArray(i))throw new Error("Unsupported path type "+typeof e);return t=a.reduce(i,function(t,e){if(a.a(t)||a.isArray(t))return t[e]},t),a.isUndefined(t)?n:t},a.set=function(t,e,n){if(!a.a(t))return t;u(t,"objectToTraverse");var i=t,o=e;if(a.e(o))o=r(e);else if(!a.isArray(o))throw new Error("Unsupported path type "+typeof e);return a.forEach(o,function(t,r){(function(t,e,n){if(a.u(parseInt(e))&&a.isArray(t))return t[e]=n;if(a.e(e)&&a.a(t))return t[e]=n;throw new Error("Unsupported type "+typeof e+" when setting property or index")})(i,t,function(t,e,n,i){if(t.length-1===r)return i;if(i=t[r],e=t[r+1],a.isArray(n[i])||a.a(n[i]))return n[i];if(!a.isArray(n[i])&&a.u(parseInt(e)))return[];if(!a.a(n[i])&&a.e(e))return{};throw new Error("Unsupported type "+typeof i+" when setting property or index")}(o,0,i,n)),i=i[t]}),t},a.bind=function(e,n){var i=Array.prototype.slice.call(arguments,2);return function(){if(!a.h(e))throw new TypeError("_.bind - callback must be a function. Received ["+typeof e+"]");var t=i.concat(Array.prototype.slice.call(arguments));return e.apply(n,t)}},a.now=function(){return(new Date).getTime()},a.utc=function(t){return a.u(t)?t:t?Math.floor(t):NaN},a.isoString=function(){var t=new Date;return t.toISOString?t.toISOString():t.getUTCFullYear()+"-"+a.pad(t.getUTCMonth()+1,2)+"-"+a.pad(t.getUTCDate(),2)+"T"+a.pad(t.getUTCHours(),2)+":"+a.pad(t.getUTCMinutes(),2)+":"+a.pad(t.getUTCSeconds(),2)+"."+(t.getUTCMilliseconds()/1e3).toFixed(3).slice(2,5)+"Z"},a.map=function(t,n){u(t,"collection");var i=[];return t.constructor===Array?a.forEach(t,function(t,e){a.e(n)&&a.a(t)?i.push(t[n]):a.h(n)&&i.push(n(t,e))}):a.forOwn(t,function(t,e){a.h(n)&&i.push(n(t,e))}),i},a.values=function(t){if(!a.a(t)||a.isArray(t))throw new Error("_.values argument, Collection, must be an object. Received ["+typeof t+"]");return a.map(t,function(t){return t})},a.keys=function(t){if(!a.a(t)||a.isArray(t))throw new Error("_.keys argument, Collection, must be an object. Received ["+typeof t+"]");return a.map(t,function(t,e){return e})},a.forEach=function(t,e){if(!a.h(e))throw new Error("_.forEach argument, Callback, must be a function. Received ["+typeof e+"]");o(t,"collection");for(var n=0;n<t.length;n++)if(!1===e(t[n],n))return},a.forOwn=function(t,e){if(!a.h(e))throw new Error("Callback must be a function. Received ["+typeof e+"]");u(t,"objectWithProperties");for(var n=Object.keys(t),i=0;i<n.length;i++){var r=n[i];if((t.hasOwnProperty(r)||Object.prototype.hasOwnProperty.call(t,r))&&!1===e(t[r],r))return}},a.argumentsToArray=function(t){if(!a.a(t)||!t.length)throw new Error("Collection must be arguments. Received ["+typeof t+"]");for(var e=[],n=0;n<t.length;n++)e.push(t[n]);return e},a.assign=function(n){a.isNullOrUndefined(n)&&(n={}),u(n,"target");var t=a.argumentsToArray(arguments);return t.shift(),a.forEach(t,function(t,e){a.isNullOrUndefined(t)||(u(t,"_.assign(sources["+e+"])"),a.forOwn(t,function(t,e){n[e]=t}))}),n},a.includes=function(t,e){if(a.e(t))return h(e,"Includes value and search parameter"),-1<t.indexOf(e);if(a.isUndefined(t)||a.isUndefined(e))return!1;function n(t){if(t===e)return!(i=!0)}u(t,"collection");var i=!1;return t.constructor===Array?a.forEach(t,n):a.forOwn(t,n),i},a.reduce=function(t,n,e){u(t,"collection");var i=e===a.noop()?null:e;return t.constructor===Array?a.forEach(t,function(t,e){i=n(i,t,e)}):a.forOwn(t,function(t,e){i=n(i,t,e)}),i},a.sample=function(t){return o(t,"collection"),t[Math.floor(Math.random()*t.length)]},a.uniqueId=function(){return(a.now()*Math.random()).toString()},a.find=function(t,n,i){o(t,"collection");var r=void 0;return a.forEach(t,function(t,e){if(n(t)&&(i||0)<=e)return r=t,!1}),r},a.findIndex=function(t,n,i){o(t,"collection");var r=-1;return a.forEach(t,function(t,e){if(n(t,e)&&(i||0)<=e)return r=e,!1}),r},a.filter=function(t,e){o(t,"collection");var n=[];return a.forEach(t,function(t){e(t)&&n.push(t)}),n},a.remove=function(t,e){return o(t,"collection"),a.filter(t,function(t){return!e(t)})},a.take=function(t,e){return o(t,"collection"),t.slice(0,e)},a.hasDifferences=function(t,e,n){return 0<a.findDifferences(t,e,n).length},a.findDifferences=function(n,i,r){function t(t,e){s[e]=1,(a.a(t)||a.isArray(t))&&r?a.hasIndexOrKey(i,e)&&a.sameTypes(n[e],i[e])&&!a.hasDifferences(n[e],i[e],r)||o.push(e):n[e]!==i[e]&&o.push(e)}var o=[],s={};if(a.isArray(n)&&a.isArray(i))n.length>i.length?a.forEach(n,t):a.forEach(i,t);else{if(!a.a(n)||!a.a(i)||a.isArray(n)||a.isArray(i))throw new Error("Object types do not match");a.forOwn(n,t),a.forOwn(i,function(t,e){s.hasOwnProperty(e)||o.push(e)})}return o},a.hasIndexOrKey=function(t,e){return a.isArray(t)?t.length>parseInt(e):!!a.a(t)&&t.hasOwnProperty(e)},a.startsWith=function(t,e){return h(t,"value"),h(e,"prefix"),0===t.indexOf(e)},a.endsWith=function(t,e){h(t,"value"),h(e,"postfix");var n=t.length-e.length;return t.indexOf(e,n)===n},a.sameTypes=function(t,e){return a.isNullOrUndefined(t)||a.isNullOrUndefined(e)?a.isNullOrUndefined(t)&&a.isNullOrUndefined(e):a.isArray(t)||a.isArray(e)?a.isArray(t)&&a.isArray(e):typeof t==typeof e},a.freeze=function(t){return"freeze"in Object?Object.freeze(t):t},a.noop=function(){},a.a=function(t){return null!==t&&"object"==typeof t},a.isArray=function(t){return!!a.a(t)&&t.constructor===Array},a.e=function(t){return"string"==typeof t},a.u=function(t){return!isNaN(t)&&"number"==typeof t},a.f=function(t){return"boolean"==typeof t},a.h=function(t){return"function"==typeof t},a.isNullOrUndefined=function(t){return null===t||a.isUndefined(t)},a.isUndefined=function(t){return void 0===t},a.getEnumName=function(t,e){var n=null,t=a.map(t,function(t){return t});return a.u(e)?n=a.find(t,function(t){return t.id===e}):a.e(e)&&(n=a.find(t,function(t){return t.name.toLowerCase()===e.toLowerCase()})),n?n.name:null},a.toString=function(t){if(a.e(t))return t;if(a.f(t))return t?"true":"false";if(a.u(t))return t.toString();var e="";if(t)if(a.h(t.toString))e=t.toString();else if(a.a(t.toString))try{e=t.toString()}catch(t){e="[object invalid toString()]"}if(0!==e.indexOf("[object"))return e;var n=[];return e+JSON.stringify(t,function(t,e){if(a.a(e)&&!a.isNullOrUndefined(e)){if(a.includes(n,e))return"<recursive>";n.push(e)}return""===t?e:a.toString(e)})},a.pad=function(t,e){s(t,"value"),s(e,"numberToPad");for(var n=t.toString().length,i=0;i<e-n;i++)t="0"+t.toString();return t.toString()},a.addEventListener=function(t,e,n,i){u(t,"target"),h(e,"eventName"),c(n,"listener"),t.phenixAddEventListener?t.phenixAddEventListener.call(t,e,n,!!i):t.addEventListener?t.addEventListener(e,n,!!i):t.attachEvent&&t.attachEvent("on"+e,n)},a.removeEventListener=function(t,e,n,i){u(t,"target"),h(e,"eventName"),c(n,"listener"),t.phenixRemoveEventListener?t.phenixRemoveEventListener.call(t,e,n,!!i):t.removeEventListener?t.removeEventListener(e,n,!!i):t.detachEvent&&t.detachEvent("on"+e,n)};var o=function(t){if(!a.isArray(t))throw new Error("Input must be an array. Received ["+typeof t+"]")},s=function(t,e){if(h(e,"name"),!a.u(t))throw new Error(e+" must be a number. Received ["+typeof t+"]")},u=function(t,e){if(h(e,"name"),!a.a(t))throw new Error("collection type not supported - "+e+" must be an array or object. Received ["+typeof t+"]")},c=function(t,e){if(h(e,"name"),!a.h(t))throw new Error(e+" must be a function. Received ["+typeof t+"]")},h=function(t,e){if(!a.e(e))throw new Error("Name must be a string. Received ["+typeof e+"]");if(!a.e(t))throw new Error(e+" must be a string. Received ["+typeof t+"]")};return a}.apply(e,[]))&&(t.exports=e)},function(t,e,n){n=[n(2),n(3)];void 0!==(n=function(t,e){return{Event:t,NamedEvents:e}}.apply(e,n))&&(t.exports=n)}],o={},i.m=r,i.c=o,i.i=function(t){return t},i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:n})},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=9))},function(t,e,n){n=[n(27),n(63),n(64)];void 0===(n=function(t,e,n){"use strict";return{Observable:t,ObservableArray:e,ObservableMonitor:n}}.apply(e,n))||(t.exports=n)},function(t,e,n){void 0===(e=function(){"use strict";return{networkStates:{networkEmpty:{id:0,name:"NETWORK_EMPTY"},networkIdle:{id:1,name:"NETWORK_IDLE"},networkLoading:{id:2,name:"NETWORK_LOADING"},networkNoSource:{id:3,name:"NETWORK_NO_SOURCE"}},types:{realTime:{id:0,name:"real-time"},dash:{id:1,name:"dash"},hls:{id:2,name:"hls"},rtmp:{id:0,name:"rtmp"}},streamEvents:{playerEnded:{id:0,name:"playerended"},playerError:{id:1,name:"playererror"},stopped:{id:2,name:"stopped"}},rendererEvents:{ended:{id:0,name:"ended"},error:{id:1,name:"error"},autoMuted:{id:2,name:"autoMuted"},failedToPlay:{id:3,name:"failedToPlay"}}}}.apply(e,[]))||(t.exports=e)},function(t,e,n){"use strict";var i=!0,r=!0,u={disableLog:function(t){return"boolean"!=typeof t?new Error("Argument type: "+typeof t+". Please use a boolean."):(i=t)?"adapter.js logging disabled":"adapter.js logging enabled"},disableWarnings:function(t){return"boolean"!=typeof t?new Error("Argument type: "+typeof t+". Please use a boolean."):(r=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))},log:function(){"object"==typeof window&&(i||"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments))},deprecated:function(t,e){r&&console.warn(t+" is deprecated, please use "+e+" instead.")},extractVersion:function(t,e,n){return(e=t.match(e))&&e.length>=n&&parseInt(e[n],10)},detectBrowser:function(t){var e=t&&t.navigator,n={browser:null,version:null};if(void 0===t||!t.navigator)return n.browser="Not a browser.",n;if(e.mozGetUserMedia)n.browser="firefox",n.version=this.extractVersion(e.userAgent,/Firefox\/(\d+)\./,1);else if(e.webkitGetUserMedia)if(t.webkitRTCPeerConnection)n.browser="chrome",n.version=this.extractVersion(e.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!e.userAgent.match(/Version\/(\d+).(\d+)/))return n.browser="Unsupported webkit-based browser with GUM support but no WebRTC support.",n;n.browser="safari",n.version=this.extractVersion(e.userAgent,/AppleWebKit\/(\d+)\./,1)}else if(e.mediaDevices&&e.userAgent.match(/Edge\/(\d+).(\d+)$/))n.browser="edge",n.version=this.extractVersion(e.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!e.mediaDevices||!e.userAgent.match(/AppleWebKit\/(\d+)\./))return n.browser="Not a supported browser.",n;n.browser="safari",n.version=this.extractVersion(e.userAgent,/AppleWebKit\/(\d+)\./,1)}return n},shimCreateObjectURL:function(t){var n,e,i,r,o,s,a=t&&t.URL;"object"==typeof t&&t.HTMLMediaElement&&"srcObject"in t.HTMLMediaElement.prototype&&(n=a.createObjectURL.bind(a),e=a.revokeObjectURL.bind(a),i=new Map,r=0,a.createObjectURL=function(t){if("getTracks"in t){var e="polyblob:"+ ++r;return i.set(e,t),u.deprecated("URL.createObjectURL(stream)","elem.srcObject = stream"),e}return n(t)},a.revokeObjectURL=function(t){e(t),i.delete(t)},o=Object.getOwnPropertyDescriptor(t.HTMLMediaElement.prototype,"src"),Object.defineProperty(t.HTMLMediaElement.prototype,"src",{get:function(){return o.get.apply(this)},set:function(t){return this.srcObject=i.get(t)||null,o.set.apply(this,[t])}}),s=t.HTMLMediaElement.prototype.setAttribute,t.HTMLMediaElement.prototype.setAttribute=function(){return 2===arguments.length&&"src"===(""+arguments[0]).toLowerCase()&&(this.srcObject=i.get(arguments[1])||null),s.apply(this,arguments)})}};t.exports={log:u.log,deprecated:u.deprecated,disableLog:u.disableLog,disableWarnings:u.disableWarnings,extractVersion:u.extractVersion,shimCreateObjectURL:u.shimCreateObjectURL,detectBrowser:u.detectBrowser.bind(u)}},function(t,e,n){n=[n(61)];void 0===(n=function(t){"use strict";return t()}.apply(e,n))||(t.exports=n)},function(t,e,n){n=[n(81)];void 0===(n=function(t){"use strict";return t}.apply(e,n))||(t.exports=n)},function(t,e,n){n=[n(60),n(62),n(18)];void 0===(n=function(t,e,n){"use strict";return{createLogger:function(){return new t},Logger:t,ConsoleAppender:e,level:n.level}}.apply(e,n))||(t.exports=n)},function(t,e,n){n=[n(0),n(1),n(4)];void 0===(n=function(n,i,r){"use strict";function t(t,e){i.a(t,"logger"),this.X=t,this.Z=new r.Event,this.$=null,this.Y=!1,this.tt=null,this.et={pollFrequency:500,previousWidth:0,previousHeight:0},e&&e.pollFrequency&&(this.et.pollFrequency=15<=e.pollFrequency?e.pollFrequency:15),this.nt=null}function o(){var t;this.Y&&!this.$&&0!==this.Z.size()&&((t=this).et.previousWidth=this.tt.videoWidth,this.et.previousHeight=this.tt.videoHeight,this.$=setInterval(function(){t.tt.videoWidth===t.et.previousWidth&&t.tt.videoHeight===t.et.previousHeight||(t.et.previousWidth=t.tt.videoWidth,t.et.previousHeight=t.tt.videoHeight,t.Z.fireAsync([t.nt,{width:t.tt.videoWidth,height:t.tt.videoHeight}]))},t.et.pollFrequency))}return t.prototype.start=function(t,e){!function(t,e){e&&!n.isUndefined(e.videoWidth)||this.X.warn("Attempting to start dimensions changed monitor without providing proper 'video' element."),this.nt=t,this.tt=e,this.Y=!0,o.call(this)}.call(this,t,e)},t.prototype.stop=function(){!function(){this.Y=!1,this.$&&(clearInterval(this.$),this.$=null),this.Z.dispose()}.call(this)},t.prototype.addVideoDisplayDimensionsChangedCallback=function(t){return i.h(t,"addVideoDisplayDimensionsChangedCallback"),o.call(this),this.Z.listen(t)},t.prototype.toString=function(){return"DimensionsChangedMonitor[pollFrequency="+this.et.pollFrequency+", previousHeight="+this.et.previousHeight+", previousWidth="+this.et.previousHeight+", state="+(this.$?"running":"stopped")+"]"},t}.apply(e,n))||(t.exports=n)},function(t,e,n){n=[n(0),n(17)];void 0===(n=function(i,t){"use strict";var e={},r=new t(navigator.userAgent).detect();function o(t){var e=t.match(/^(https?\:)\/\/(([^:\/?#]*)(?:\:([0-9]+))?)([\/]{0,1}[^?#]*)(\?[^#]*|)(#.*|)$/);return e&&{href:t,protocol:e[1],host:e[2],hostname:e[3],port:e[4],pathname:e[5],search:e[6],hash:e[7],origin:e[1]+"//"+e[2]}}return e.getEnvironmentFromUrl=function(t){try{var e=URL&&"IE"!==r.browser?new URL(t):o(t);return e.port?e.protocol+"//"+e.hostname+":"+e.port:e.protocol+"//"+e.hostname}catch(t){return""}},e.parseEnvFromPcastBaseUri=function(t){return t=t.toLowerCase(),i.includes(t,"local")?"local":i.includes(t,"stg")?"staging":"production"},e.getTelemetryServerUri=function(e){if(!e)return"";try{var t=URL&&"IE"!==r.browser?new URL(e):o(e),n=t.hostname.split(".");switch(2===n.length||3===n.length&&n[n.length-2].length<=2&&n[n.length-1].length<=3?n.unshift("telemetry"):i.startsWith(n[0],"stg-")||i.endsWith(n[0],"-stg")||i.includes(n[0],"-stg-")||"stg"===n[0]?n[0]="telemetry-stg":i.startsWith(n[0],"local")||i.endsWith(n[0],"local")||(n[0]="telemetry"),t.hostname=n.join("."),t.protocol){case"ws:":t.protocol="http:";break;case"wss:":t.protocol="https:"}return t.port?t.protocol+"//"+t.hostname+":"+t.port+"/telemetry":t.protocol+"//"+t.hostname+"/telemetry"}catch(t){return e}},e}.apply(e,n))||(t.exports=n)},function(t,e,n){n=[n(83)];void 0===(n=function(t){"use strict";return new t}.apply(e,n))||(t.exports=n)},function(t,e,n){n=[n(0),n(1),n(3),n(8),n(35),n(6)];void 0===(n=function(o,n,e,i,r,s){"use strict";var a=[s.types.realTime.name,s.types.dash.name,s.types.hls.name];function u(t){n.isArray(t=t||a,"features"),o.forEach(t,function(t,e){n.b(t,s.types,"FeatureType["+e+"]")}),this.it=o.map(t,o.bind(o.getEnumName,o,s.types))}function c(){var t=o.get(i,["navigator","userAgent"],"");return/iPad|iPhone|iPod/.test(t)&&!i.MSStream}function t(){var t=o.get(i,["navigator","userAgent"],"");return/SamsungBrowser/.test(t)}function h(t,e){return o.includes(t,e)||t.push(e),t}return u.isFeatureSupported=function(t){switch(t&&n.g(t,"feature"),o.getEnumName(s.types,t)){case s.types.realTime.name:return e.webrtcSupported;case s.types.dash.name:case s.types.hls.name:case s.types.rtmp.name:return r.canPlaybackType(t);default:return!1}},u.mapFeatureToPCastCapability=function(t){switch(t&&n.g(t,"feature"),o.getEnumName(s.types,t)){case s.types.realTime.name:return"real-time";case s.types.dash.name:case s.types.hls.name:return"streaming";case s.types.rtmp.name:return"rtmp";default:return""}},u.mapPCastCapabilitiesToFeatures=function(t){return n.isArray(t,"capabilities"),o.reduce(t,function(t,e){return t.concat(u.mapPCastCapabilityToFeatures(e))},[])},u.mapPCastCapabilityToFeatures=function(t){return t&&n.g(t,"capability"),"real-time"===t?[s.types.realTime.name]:"streaming"===t?[s.types.dash.name,s.types.dash.name]:"rtmp"===t?[s.types.rtmp.name]:[]},u.prototype.getFeatures=function(){return this.it},u.prototype.getFeaturePCastCapabilities=function(){var t=o.map(this.it,u.mapFeatureToPCastCapability);return o.reduce(t,h,[])},u.prototype.getPreferredFeatureFromPublisherCapabilities=function(i,r){n.isArray(i,"capabilities");var t=o.reduce(this.it,function(t,e){var n=u.mapFeatureToPCastCapability(e),n=u.isFeatureSupported(e)&&(o.includes(i,n)||"real-time"===e&&!r);return t||(n?e:null)},null);return t===s.types.dash.name&&u.shouldUseNativeHls&&o.includes(i,u.mapFeatureToPCastCapability(s.types.hls.name))&&o.includes(this.it,s.types.hls.name)?t=s.types.hls.name:t===s.types.hls.name&&!u.shouldUseNativeHls&&o.includes(i,u.mapFeatureToPCastCapability(s.types.dash.name))&&o.includes(this.it,s.types.dash.name)&&(t=s.types.dash.name),t},u.shouldUseNativeHls=c()||"Safari"===e.browser||t(),u.isIOS=c,u.isSamsungBrowser=t,u.isAndroid=function(){var t=o.get(i,["navigator","userAgent"],"");return/(android)/i.test(t)},u.isMobile=function(){var t=o.get(i,["navigator","userAgent"],"");return c()||/Android|webOS|BlackBerry|IEMobile|Opera Mini|Mobile|mobile|CriOS/i.test(t)},u.getIOSVersion=function(){var t=o.get(i,["navigator","userAgent"],"");if(/iP(hone|od|ad)/.test(t))return t=t.match(/.*OS (\d+)_(\d+)_?(\d+)? like Mac OS X/),{major:parseInt(o.get(t,[1],0),10),minor:parseInt(o.get(t,[2],0),10),patch:parseInt(o.get(t,[3],0),10)}},u}.apply(e,n))||(t.exports=n)},function(t,e,n){void 0===(e=function(){"use strict";return{roles:{participant:{id:0,name:"Participant"},moderator:{id:1,name:"Moderator"},presenter:{id:2,name:"Presenter"},audience:{id:3,name:"Audience"}},states:{active:{id:0,name:"Active"},passive:{id:1,name:"Passive"},handRaised:{id:2,name:"HandRaised"},inactive:{id:3,name:"Inactive"},offline:{id:4,name:"Offline"}}}}.apply(e,[]))||(t.exports=e)},function(t,e,n){void 0===(e=function(){"use strict";return{types:{directChat:{id:0,name:"DirectChat"},multiPartyChat:{id:1,name:"MultiPartyChat"},moderatedChat:{id:2,name:"ModeratedChat"},townHall:{id:3,name:"TownHall"},channel:{id:4,name:"Channel"}},events:{memberJoined:{id:0,name:"MemberJoined"},memberLeft:{id:1,name:"MemberLeft"},memberUpdated:{id:2,name:"MemberUpdated"},roomUpdated:{id:3,name:"RoomUpdated"},roomEnded:{id:4,name:"RoomEnded"}}}}.apply(e,[]))||(t.exports=e)},function(t,e,n){function i(t){if(o[t])return o[t].exports;var e=o[t]={i:t,l:!1,exports:{}};return r[t].call(e.exports,e,e.exports,i),e.l=!0,e.exports}var r,o;t.exports=(r=[function(t,e,n){n=[n(2)];void 0!==(n=function(o){"use strict";function t(t){this.rt=t||""}return t.prototype.detect=function(){var t="Unknown",e="?",n=this.rt.match(/(Chrome|Chromium|Firefox|Opera|Safari)+\//),i=this.rt.match(/(Chrome|Chromium|Firefox|Version)+\/([0-9]+)\./),r=!1;return n&&2<=n.length?t=n[1]:this.rt.match(/^\(?Mozilla/)&&(t="Mozilla",(this.rt.match(/MSIE/)||this.rt.match(/; Trident\/.*rv:[0-9]+/))&&(t="IE",(i=this.rt.match(/MSIE ([0-9]+)/))?(e=parseInt(i[1],10),(i=this.rt.match(/MSIE [0-9]+.*MSIE ([0-9]+)/))&&(e=parseInt(i[1],10))):(i=this.rt.match(/rv:([0-9]+)/))&&(e=parseInt(i[1],10)))),"Chrome"===t&&this.rt.match(/OPR\//)?(t="Opera",i=this.rt.match(/(OPR)\/([0-9]+)\./)):"Chrome"===t&&this.rt.match(/Edge\//)?(t="Edge",i=this.rt.match(/(Edge)\/([0-9]+)\./)):"Firefox"!==t&&"IE"!==t||!this.rt.match(/Opera/)?"Mozilla"===t&&(this.rt.match(/iphone|ipod|ipad/i)||this.rt.match(/AppleWebKit/i))&&(e=this.rt.match(/iphone|ipod|ipad/i)?(t="Safari",parseInt(o.get(this.rt.match(/OS\s([0-9]+)/),[1]),10)):(t="Safari",13),r=!0):(t="Opera",i=this.rt.match(/(Opera) ([0-9]+)\./)),"Chrome"===t&&(this.rt.match(/; wv/)||this.rt.match(/Android/)&&this.rt.match(/Version\/[0-9].[0-9]/))&&(r=!0),"IE"!==t&&i&&3<=i.length&&(e=parseInt(i[2],10)),"ReactNative"===navigator.product&&(t="ReactNative",e=navigator.productSub||"?"),{browser:t,version:e,isWebview:r}},t}.apply(e,n))&&(t.exports=n)},function(t,e,n){void 0!==(e=function(){"use strict";function r(t){var t=t.split("."),e=[];return a.forEach(t,function(t){e=e.concat(function(t){for(var e="",n=[],i=0,r=0;r<t.length;r++)if("["===t[r]){if(i++,!a.e(e)||1<i)return[t];e&&(n.push(e),e="")}else if("]"===t[r]){if(0!=--i)return[t];n.push(e),e=""}else{if(r===t.length-1)return[t];e+=t[r]}return n}(t))}),e}function a(){}a.clone=function(t){return a.isArray(t)?t.slice():a.a(t)?a.assign({},t):t},a.get=function(t,e,n){if(a.isNullOrUndefined(t))return n;u(t,"objectToTraverse");var i=e;if(a.e(i))i=r(e);else if(!a.isArray(i))throw new Error("Unsupported path type "+typeof e);return t=a.reduce(i,function(t,e){if(a.a(t)||a.isArray(t))return t[e]},t),a.isUndefined(t)?n:t},a.set=function(t,e,n){if(!a.a(t))return t;u(t,"objectToTraverse");var i=t,o=e;if(a.e(o))o=r(e);else if(!a.isArray(o))throw new Error("Unsupported path type "+typeof e);return a.forEach(o,function(t,r){(function(t,e,n){if(a.u(parseInt(e))&&a.isArray(t))return t[e]=n;if(a.e(e)&&a.a(t))return t[e]=n;throw new Error("Unsupported type "+typeof e+" when setting property or index")})(i,t,function(t,e,n,i){if(t.length-1===r)return i;if(i=t[r],e=t[r+1],a.isArray(n[i])||a.a(n[i]))return n[i];if(!a.isArray(n[i])&&a.u(parseInt(e)))return[];if(!a.a(n[i])&&a.e(e))return{};throw new Error("Unsupported type "+typeof i+" when setting property or index")}(o,0,i,n)),i=i[t]}),t},a.bind=function(e,n){var i=Array.prototype.slice.call(arguments,2);return function(){if(!a.h(e))throw new TypeError("_.bind - callback must be a function. Received ["+typeof e+"]");var t=i.concat(Array.prototype.slice.call(arguments));return e.apply(n,t)}},a.now=function(){return(new Date).getTime()},a.utc=function(t){return a.u(t)?t:t?Math.floor(t):NaN},a.isoString=function(){var t=new Date;return t.toISOString?t.toISOString():t.getUTCFullYear()+"-"+a.pad(t.getUTCMonth()+1,2)+"-"+a.pad(t.getUTCDate(),2)+"T"+a.pad(t.getUTCHours(),2)+":"+a.pad(t.getUTCMinutes(),2)+":"+a.pad(t.getUTCSeconds(),2)+"."+(t.getUTCMilliseconds()/1e3).toFixed(3).slice(2,5)+"Z"},a.map=function(t,n){u(t,"collection");var i=[];return t.constructor===Array?a.forEach(t,function(t,e){a.e(n)&&a.a(t)?i.push(t[n]):a.h(n)&&i.push(n(t,e))}):a.forOwn(t,function(t,e){a.h(n)&&i.push(n(t,e))}),i},a.values=function(t){return!a.a(t)||a.isArray(t)?[]:a.map(t,function(t){return t})},a.keys=function(t){return a.a(t)||a.isArray(t)?a.map(t,function(t,e){return e}):[]},a.forEach=function(t,e){if(!a.h(e))throw new Error("_.forEach argument, Callback, must be a function. Received ["+typeof e+"]");o(t,"collection");for(var n=0;n<t.length;n++)if(!1===e(t[n],n))return},a.forOwn=function(t,e){if(!a.h(e))throw new Error("Callback must be a function. Received ["+typeof e+"]");u(t,"objectWithProperties");for(var n=Object.keys(t),i=0;i<n.length;i++){var r=n[i];if((t.hasOwnProperty(r)||Object.prototype.hasOwnProperty.call(t,r))&&!1===e(t[r],r))return}},a.argumentsToArray=function(t){if(!a.a(t)||!t.length)throw new Error("Collection must be arguments. Received ["+typeof t+"]");for(var e=[],n=0;n<t.length;n++)e.push(t[n]);return e},a.assign=function(n){a.isNullOrUndefined(n)&&(n={}),u(n,"target");var t=a.argumentsToArray(arguments);return t.shift(),a.forEach(t,function(t,e){a.isNullOrUndefined(t)||(u(t,"_.assign(sources["+e+"])"),a.forOwn(t,function(t,e){n[e]=t}))}),n},a.includes=function(t,e){if(a.e(t))return h(e,"Includes value and search parameter"),-1<t.indexOf(e);if(a.isUndefined(t)||a.isUndefined(e))return!1;function n(t){if(t===e)return!(i=!0)}u(t,"collection");var i=!1;return t.constructor===Array?a.forEach(t,n):a.forOwn(t,n),i},a.reduce=function(t,n,e){u(t,"collection");var i=e===a.noop()?null:e;return t.constructor===Array?a.forEach(t,function(t,e){i=n(i,t,e)}):a.forOwn(t,function(t,e){i=n(i,t,e)}),i},a.sample=function(t){return o(t,"collection"),t[Math.floor(Math.random()*t.length)]},a.uniqueId=function(){return(a.now()*Math.random()).toString()},a.find=function(t,n,i){o(t,"collection");var r=void 0;return a.forEach(t,function(t,e){if(n(t)&&(i||0)<=e)return r=t,!1}),r},a.findIndex=function(t,n,i){o(t,"collection");var r=-1;return a.forEach(t,function(t,e){if(n(t,e)&&(i||0)<=e)return r=e,!1}),r},a.filter=function(t,e){o(t,"collection");var n=[];return a.forEach(t,function(t){e(t)&&n.push(t)}),n},a.remove=function(t,e){return o(t,"collection"),a.filter(t,function(t){return!e(t)})},a.take=function(t,e){return o(t,"collection"),t.slice(0,e)},a.hasDifferences=function(t,e,n){return 0<a.findDifferences(t,e,n).length},a.findDifferences=function(n,i,r){function t(t,e){s[e]=1,(a.a(t)||a.isArray(t))&&r?a.hasIndexOrKey(i,e)&&a.sameTypes(n[e],i[e])&&!a.hasDifferences(n[e],i[e],r)||o.push(e):n[e]!==i[e]&&o.push(e)}var o=[],s={};if(a.isArray(n)&&a.isArray(i))n.length>i.length?a.forEach(n,t):a.forEach(i,t);else{if(!a.a(n)||!a.a(i)||a.isArray(n)||a.isArray(i))throw new Error("Object types do not match");a.forOwn(n,t),a.forOwn(i,function(t,e){s.hasOwnProperty(e)||o.push(e)})}return o},a.hasIndexOrKey=function(t,e){return a.isArray(t)?t.length>parseInt(e):!!a.a(t)&&t.hasOwnProperty(e)},a.startsWith=function(t,e){return h(t,"value"),h(e,"prefix"),0===t.indexOf(e)},a.endsWith=function(t,e){h(t,"value"),h(e,"postfix");var n=t.length-e.length;return t.indexOf(e,n)===n},a.sameTypes=function(t,e){return a.isNullOrUndefined(t)||a.isNullOrUndefined(e)?a.isNullOrUndefined(t)&&a.isNullOrUndefined(e):a.isArray(t)||a.isArray(e)?a.isArray(t)&&a.isArray(e):typeof t==typeof e},a.freeze=function(t){return"freeze"in Object?Object.freeze(t):t},a.noop=function(){},a.a=function(t){return null!==t&&"object"==typeof t},a.isArray=function(t){return!!a.a(t)&&t.constructor===Array},a.e=function(t){return"string"==typeof t},a.u=function(t){return!isNaN(t)&&"number"==typeof t},a.f=function(t){return"boolean"==typeof t},a.h=function(t){return"function"==typeof t},a.isNullOrUndefined=function(t){return null===t||a.isUndefined(t)},a.isUndefined=function(t){return void 0===t},a.getEnumName=function(t,e){var n=null,t=a.map(t,function(t){return t});return a.u(e)?n=a.find(t,function(t){return t.id===e}):a.e(e)&&(n=a.find(t,function(t){return t.name.toLowerCase()===e.toLowerCase()})),n?n.name:null},a.toString=function(t){if(a.e(t))return t;if(a.f(t))return t?"true":"false";if(a.u(t))return t.toString();var e="";if(t)if(a.h(t.toString))e=t.toString();else if(a.a(t.toString))try{e=t.toString()}catch(t){e="[object invalid toString()]"}if(0!==e.indexOf("[object"))return e;var n=[];return e+JSON.stringify(t,function(t,e){if(a.a(e)&&!a.isNullOrUndefined(e)){if(a.includes(n,e))return"<recursive>";n.push(e)}return""===t?e:a.toString(e)})},a.pad=function(t,e){s(t,"value"),s(e,"numberToPad");for(var n=t.toString().length,i=0;i<e-n;i++)t="0"+t.toString();return t.toString()},a.addEventListener=function(t,e,n,i){u(t,"target"),h(e,"eventName"),c(n,"listener"),t.phenixAddEventListener?t.phenixAddEventListener.call(t,e,n,!!i):t.addEventListener?t.addEventListener(e,n,!!i):t.attachEvent&&t.attachEvent("on"+e,n)},a.removeEventListener=function(t,e,n,i){u(t,"target"),h(e,"eventName"),c(n,"listener"),t.phenixRemoveEventListener?t.phenixRemoveEventListener.call(t,e,n,!!i):t.removeEventListener?t.removeEventListener(e,n,!!i):t.detachEvent&&t.detachEvent("on"+e,n)};var o=function(t){if(!a.isArray(t))throw new Error("Input must be an array. Received ["+typeof t+"]")},s=function(t,e){if(h(e,"name"),!a.u(t))throw new Error(e+" must be a number. Received ["+typeof t+"]")},u=function(t,e){if(h(e,"name"),!a.a(t))throw new Error("collection type not supported - "+e+" must be an array or object. Received ["+typeof t+"]")},c=function(t,e){if(h(e,"name"),!a.h(t))throw new Error(e+" must be a function. Received ["+typeof t+"]")},h=function(t,e){if(!a.e(e))throw new Error("Name must be a string. Received ["+typeof e+"]");if(!a.e(t))throw new Error(e+" must be a string. Received ["+typeof t+"]")};return a}.apply(e,[]))&&(t.exports=e)},function(t,e,n){n=[n(1)];void 0!==(n=function(t){"use strict";return t}.apply(e,n))&&(t.exports=n)},function(t,e,n){n=[n(0)];void 0!==(n=function(t){return t}.apply(e,n))&&(t.exports=n)}],o={},i.m=r,i.c=o,i.i=function(t){return t},i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:n})},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=3))},function(t,e,n){void 0===(e=function(){"use strict";return{level:{TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,FATAL:5}}}.apply(e,[]))||(t.exports=e)},function(t,e,n){n=[n(0),n(1),n(10),n(12),n(65)];void 0===(n=function(t,o,s,a,u){"use strict";function e(){}return e.prototype.createPCastLogger=function(t,e,n){t&&o.g(t,"baseUri");var i=new s.Logger,r=a.getEnvironmentFromUrl(t),t=u.getAppender(t);return i.setEnvironment(r),n?t.setThreshold(n):t.setThreshold(s.level.INFO),e||i.addAppender(new s.ConsoleAppender),i.addAppender(t),i.isPCastLogger=!0,i},new e}.apply(e,n))||(t.exports=n)},function(t,e,n){n=[n(67),n(78),n(29)];void 0===(n=function(t,e,n){return{MQWebSocket:t,BatchHttpProto:e,MQService:n}}.apply(e,n))||(t.exports=n)},function(t,e,n){n=[n(1),n(0),n(2),n(87)];void 0===(n=function(r,a,o,u){"use strict";function t(t,e,n,i){r.g(t,"version"),r.g(e,"baseUri"),r.a(n,"logger"),this.ot=t,this.st=e,this.X=n,this.P=new o.DisposableList,this.at=i}function c(t,e){var n;4===t.readyState&&(200===t.status?(n=(n=t).getAllResponseHeaders(),n=a.reduce(n.trim().split(/[\r\n]+/),function(t,e){var e=(n=e.split(": ")).shift(),n=n.join(": ");return e&&(t[e]=n),t},{}),e(null,{data:t.response||t.responseText,headers:n,rawXhr:t})):((n=new Error(0===t.status?"timeout":"Status=["+t.status+"]")).code=t.status,e(n)))}return t.DefaultPCastUri="https://pcast.phenixrts.com",t.prototype.getBaseUri=function(){return this.st},t.prototype.resolveUri=function(t){return function(t,n){var i,e=0===t.lastIndexOf("wss:",0),r=0===t.lastIndexOf("ws:",0),o=0===t.lastIndexOf("https:",0),s=0===t.lastIndexOf("http:",0);e||r?n(void 0,{uri:t+"/ws",roundTripTime:0}):o||s?function(t,n){(t=function(t){var e=new XMLHttpRequest;if("withCredentials"in e)e.open("GET",t,!0);else{if("undefined"==typeof XDomainRequest)return;(e=new XDomainRequest).open("GET",t)}return e}(t+"/pcast/endPoints?version=2022-04-13T15:08:08Z&_="+a.now())).addEventListener("readystatechange",a.bind(c,this,t,function(t,e){return t?n(new Error("Failed to resolve an end point",t)):((e=e.data.split(",")).length<1&&n(new Error("Failed to discover end points")),void n(void 0,e))})),t.timeout=15e3,t.send(null)}.call(i=this,t,function(t,e){return t?n(t):((t=new u({logger:i.X,version:i.ot},n,function(t,e){t?503===t.code?i.X.debug("The end point [%s] is temporarily disabled",a.get(e,["endPoint"])):i.X.warn("An error occurred in resolving an endpoint [%s]",a.get(e,["endPoint"]),t):(t=0===e.endPoint.lastIndexOf("https:",0),i.at.recordMetric("RoundTripTime",{uint64:e.time},null,{resource:e.endPoint,kind:t?"https":"http"}))})).resolveAll(e),void i.P.add(t))}):n(new Error("Uri not supported ["+t+"]"))}.call(this,this.st,t)},t.prototype.dispose=function(){this.P.dispose()},t.prototype.toString=function(){return"PCastEndPoint["+this.st+"]"},t}.apply(e,n))||(t.exports=n)},function(t,e,n){n=[n(0),n(3)];void 0===(n=function(c,n){"use strict";function t(){}function h(t,e,n,i,r){return c.u(t)?t:c.u(e)?e:c.u(n)?n:c.u(i)?i:r}function f(t,e,n,i,r){return c.e(t)?t:c.e(e)?e:c.e(n)?n:c.u(i)?i:r}function d(t,e){if(e=parseInt(t,e),!isNaN(e))return e}function l(t){if(t=parseFloat(t),!isNaN(t))return t}function p(t){return c.includes(t.id,"send")||c.includes(t.id,"outbound")||"outboundrtp"===t.type||"outbound-rtp"===t.type||"kOutboundRtp"===t.type}function m(t){return c.includes(t.id,"recv")||"inboundrtp"===t.type||"inbound-rtp"===t.type||"kInboundRtp"===t.type}return t.convertPeerConnectionStats=function(t,s){if(!t)return null;var a=[],t=function(e){var i={};switch(n.browser){case"Firefox":return c.forOwn(e,function(n,t){c.includes(t,"rtcp")&&c.forOwn(e,function(t,e){c.includes(e,"rtp")&&n.mediaType===t.mediaType&&(t.jitter=1e3*(n.jitter||t.jitter),t.roundTripTime=n.roundTripTime)})}),e;case"IE":return c.forOwn(e,function(t,e){c.startsWith(e,"ssrc")&&(i[t.id]=t)}),i;case"Edge":return e.forEach(function(t){i[t.id]=t,c.hasIndexOrKey(t,"jitter")&&(t.jitter*=1e3)}),c.forOwn(i,function(e){"track"===e.type&&c.hasIndexOrKey(e,"framesPerSecond")&&c.forOwn(i,function(t){"video"===t.mediaType&&(t.framesPerSecond=parseInt(e.framesPerSecond,10))})}),i;case"Safari":return e.forEach(function(t){i[t.id]=t}),c.forOwn(i,function(e){var t;c.hasIndexOrKey(e,"id")&&m(e)&&(t=parseInt(c.get(e.id.split("_"),[1]),10),e.ssrc=t||e.ssrc),c.hasIndexOrKey(e,"jitter")&&(e.jitter*=1e3),"candidate-pair"===e.type&&c.forOwn(i,function(t){"audio"!==t.mediaType&&"video"!==t.mediaType||(t.currentRoundTripTime=1e3*e.currentRoundTripTime)}),"track"===e.type&&c.forOwn(i,function(t){"audio"===t.mediaType&&m(t)?t.audioOutputLevel=1e5*e.audioLevel:"audio"===t.mediaType&&p(t)&&(t.audioInputLevel=1e5*e.audioLevel)})}),i;case"ReactNative":return(c.e(e)?JSON.parse(e):e).forEach(function(t){var n={id:t.id,type:t.type};t.values.forEach(function(e){c.keys(e).forEach(function(t){n[t]=e[t]})}),n.timestamp=t.timestamp,i[n.id]=n}),i;default:return e.result().forEach(function(e){var n={id:e.id,type:e.type};e.names().forEach(function(t){n[t]=e.stat(t)}),n.timestamp=e.timestamp.getTime(),i[n.id]=n}),i}}(t),u=!1;function e(t){var e,n,i,r,o;u=u||!0,c.hasIndexOrKey(t,"ssrc")&&t.ssrc&&!c.includes(t.id,"rtcp")&&(e=t.id||t.ssrc,c.hasIndexOrKey(s,e)||(s[e]={timestamp:c.now()}),n="?",r=parseFloat(t.timestamp)-s[e].timestamp,i=function(t,e,n){if(!c.isUndefined(e))return t?8*(t-(e||0))/n:0}(parseFloat(t.bytesSent),s[e].bytesSent,r),o=function(t,e,n){if(!c.isUndefined(e))return t?8*(t-(e||0))/n:0}(parseFloat(t.bytesReceived),s[e].bytesReceived,r),r=function(t,e,n){if(!c.isUndefined(e))return(t-e)/(n/1e3)}(h(d(t.framesEncoded),d(t.framesDecoded)),s[e].framesEncoded||s[e].framesDecoded,r),p(t)&&(n="upload"),m(t)&&(n="download"),o={uploadRate:i,downloadRate:o,mediaType:t.mediaType,ssrc:t.ssrc,direction:n,nativeReport:t,rtt:h(d(t.rtt),d(t.googRtt),d(t.roundTripTime),d(t.currentRoundTripTime)),bitrateMean:d(t.bitrateMean,10)||1e3*(p(t)?i:o),targetDelay:d(f(t.targetDelay,t.googTargetDelayMs),10),currentDelay:d(f(t.currentDelay,t.currentDelayMs,t.googCurrentDelayMs),10)},c.assign(s[e],t),"video"===t.mediaType&&(o=c.assign(o,{droppedFrames:d(t.droppedFrames,10)||0,framerateMean:h(t.framerateMean,t.framesPerSecond,r)||0,cpuLimitedResolution:f(t.cpuLimitedResolution,t.googCpuLimitedResolution),avgEncode:d(f(t.avgEncode,t.avgEncodeMs,t.googAvgEncodeMs),10)})),"audio"===t.mediaType&&(o=c.assign(o,{audioInputLevel:f(t.audioInputLevel,t.googAudioInputLevel),audioOutputLevel:f(t.audioOutputLevel,t.googAudioOutputLevel),jitter:d(f(t.jitter,t.jitterReceived,t.googJitterReceived),10),jitterBuffer:d(f(t.jitterBuffer,t.jitterBufferMs,t.googJitterBufferMs),10),totalSamplesDuration:l(t.totalSamplesDuration),totalAudioEnergy:l(t.totalAudioEnergy)})),a.push(o))}return c.forOwn(t,e),!u&&a.length<=0&&t.forEach&&t.forEach(e),a},t}.apply(e,n))||(t.exports=n)},function(t,e,n){n=[n(0),n(1),n(5),n(24),n(41)];void 0===(n=function(i,r,o,t,e){"use strict";var n=t.types,s=e.states,a="pcast://phenixp2p.com/";function u(t,e,n,i){this.init(t,e,n,i)}function c(t){return i.includes(t,a)?a:"pcast://phenixrts.com/"}function h(t){var n={};return 2!==(t=t.split("?")).length||(t=t[1].split("&"),i.forEach(t,function(t){var t=(e=t.split("="))[0],e=decodeURIComponent(e[1]);n[t]=e,"capabilities"===t&&(n[t]=e&&e.split(",")||[])})),n}function f(t){return r.b(t,n,"streamType"),i.getEnumName(n,t)}function d(t){return r.b(t,s,"trackState"),i.getEnumName(s,t)}return u.prototype.init=function(t,e,n,i){r.e(t,"uri"),this.ut=new o.Observable(t),this.ct=new o.Observable(e,f),this.ht=new o.Observable(n||s.trackEnabled.name,d),this.ft=new o.Observable(i||s.trackEnabled.name,d),this.dt=u.parsePCastStreamIdFromStreamUri(t)},u.prototype.getUri=function(){return this.ut.getValue()},u.prototype.getType=function(){return this.ct.getValue()},u.prototype.getObservableAudioState=function(){return this.ht},u.prototype.getObservableVideoState=function(){return this.ft},u.prototype.toJson=function(){return{uri:this.ut.getValue(),type:this.ct.getValue(),audioState:this.ht.getValue(),videoState:this.ft.getValue()}},u.prototype.lt=function(t){var e,n;i.a(t)&&(Object.prototype.hasOwnProperty.call(t,"uri")&&t.uri!==this.ut.getValue()&&(e=t.uri,n=this.ut.getValue(),u.parsePCastStreamIdFromStreamUri(e)===u.parsePCastStreamIdFromStreamUri(n))&&(this.ut.setValue(t.uri),this.dt=u.parsePCastStreamIdFromStreamUri(t.uri)),Object.prototype.hasOwnProperty.call(t,"audioState")&&this.ht.setValue(t.audioState),Object.prototype.hasOwnProperty.call(t,"videoState")&&this.ft.setValue(t.videoState))},u.prototype.isPCastStream=function(){return!!this.dt},u.prototype.getPCastStreamId=function(){return this.dt},u.prototype.getInfo=function(){return h(this.ut.getValue())},u.getPCastPrefix=function(){return a},u.parsePCastStreamIdFromStreamUri=function(t){return i.includes(t,c(t))?t.replace(c(t),"").split("?")[0]:null},u.getInfoFromStreamUri=h,u}.apply(e,n))||(t.exports=n)},function(t,e,n){void 0===(e=function(){"use strict";return{types:{user:{id:0,name:"User"},presentation:{id:1,name:"Presentation"},audio:{id:2,name:"Audio"}}}}.apply(e,[]))||(t.exports=e)},function(t,e){var n=function(){return this}();try{n=n||new Function("return this")()}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,e,n){n=[n(0),n(1),n(5),n(2),n(19),n(9),n(13),n(12),n(32),n(84),n(21),n(89),n(90),n(33),n(11),n(91),n(93),n(94),n(22),n(96),n(35),n(100),n(14),n(6),n(36),n(3),n(34)];void 0===(n=function(b,k,r,o,e,t,s,S,n,a,u,c,i,y,h,f,d,l,w,p,m,v,E,R,I,T,g){"use strict";var C=50,M=/^(?:room|channel)Id[:](.*)$/,P=/^(?:room|channel)Alias[:](.*)$/;function O(t){function e(t){t=t?t.error:"Unknown Error",n.X.error("Window Error Event Triggered with pcast in [%s] state [%s]",n.pt.getValue(),t,t)}k.a(t=t||{},"options"),t.streamingSourceMapping&&(k.a(t.streamingSourceMapping,"options.streamingSourceMapping"),k.g(t.streamingSourceMapping.replacement,"options.streamingSourceMapping.replacement"),t.streamingSourceMapping.patternToReplace instanceof RegExp||k.g(t.streamingSourceMapping.patternToReplace,"options.streamingSourceMapping.patternToReplace")),b.isNullOrUndefined(t.disableMultiplePCastInstanceWarning)||k.f(t.disableMultiplePCastInstanceWarning,"options.disableMultiplePCastInstanceWarning"),b.isNullOrUndefined(t.disableGlobalErrorListener)||k.f(t.disableGlobalErrorListener,"options.disableGlobalErrorListener"),b.isNullOrUndefined(t.disableBeforeUnload)||k.f(t.disableBeforeUnload,"options.disableBeforeUnload"),b.isNullOrUndefined(t.disableConsoleLogging)||k.f(t.disableConsoleLogging,"options.disableConsoleLogging"),b.isNullOrUndefined(t.loggingLevel)||k.u(t.loggingLevel,"options.loggingLevel"),b.isNullOrUndefined(t.treatBackgroundAsOffline)||k.f(t.treatBackgroundAsOffline,"options.treatBackgroundAsOffline"),b.isNullOrUndefined(t.reAuthenticateOnForeground)||k.f(t.reAuthenticateOnForeground,"options.reAuthenticateOnForeground"),!0===t.treatBackgroundAsOffline&&!1===t.reAuthenticateOnForeground&&this.X.warn('Conflicting options "reAuthenticateOnForeground" can not be false when "treatBackgroundAsOffline" is true. Will reauthenticate upon entering foreground.'),t.shakaLoader&&k.h(t.shakaLoader,"options.shakaLoader"),t.webPlayerLoader&&k.h(t.webPlayerLoader,"options.webPlayerLoader"),this.pt=new r.Observable("offline"),this.mt=new r.Observable(0),this.vt=new r.Observable(null),this.gt=t.deviceId||"",this.ot="2022-04-13T15:08:08Z",t.authToken?(i=this.parseUriFromToken.call(this,t.authToken))?(this.st=i,x.call(this,t),t.uri&&this.X.warn("Trying to join room with both authToken and uri. Please only use authToken."),this.X.info("Base uri is set to [%s] from authToken [%s]",i,t.authToken)):(this.st=t.uri||u.DefaultPCastUri,x.call(this,t),t.uri&&(this.X.warn("Trying to join room with options uri. Please use authToken."),this.X.info("Base uri is set to [%s] from options uri",t.uri))):(this.st=t.uri||u.DefaultPCastUri,x.call(this,t)),this.yt=new c(t,this.X),this.wt=t.shakaLoader,this.bt=t.webPlayerLoader,this.kt=t.rtmp||{},this.St=t.streamingSourceMapping,this.P=new o.DisposableList,this.Et=t.disableMultiplePCastInstanceWarning,this.Rt=!0===t.treatBackgroundAsOffline,this.It=!0===t.reAuthenticateOnForeground,this.Tt=0,this.Ct=0,this.Mt=!0,this.Pt=[],this.Ot=[],this.xt=new E(t.features),this.qt={},this.Dt={};var n=this,i=b.filter(this.xt.getFeatures(),E.isFeatureSupported);this.X.info("Device supports features [%s], user selected [%s]",i,this.xt.getFeatures()),b.addEventListener(T.global,"unload",function(){return n.X.info("Window Unload Event Triggered"),n.stop("window-unload")}),t.disableGlobalErrorListener||(b.addEventListener(T.global,"error",e),T.global.__phenixGlobalErrorListenerDisposable&&T.global.__phenixGlobalErrorListenerDisposable.dispose(),T.global.__phenixGlobalErrorListenerDisposable=new o.Disposable(function(){b.removeEventListener(T.global,"unload",e)})),t.disableBeforeUnload||b.addEventListener(T.global,"beforeunload",function(){return n.X.info("Window Before Unload Event Triggered"),n.stop("window-beforeunload")}),T.webrtcSupported||"ReactNative"!==T.browser||T.shim(),T.webrtcSupported&&"online"===this.pt.getValue()&&(function(){var n=this,i=new T.RTCPeerConnection;"Safari"===T.browser&&10<T.browserVersion&&(i.addTransceiver("audio"),i.addTransceiver("video"));try{var t=function(t){var e=g.getH264ProfileIds(t.sdp);if(n.Ot=g.getSupportedCodecs(t.sdp),n.X.info("Supported WebRTC video codecs [%s]",n.Ot),0===e.length)return n.X.info("Unable to find local h264 profile level id",t.sdp);n.X.info("Found local h264 profile level ids [%s]",e,t.sdp),n.Pt=e,i.close&&i.close()},e=function(t){n.X.error("Unable to create offer to get local h264 profile level id",t),i.close&&i.close()},r={offerToReceiveAudio:!0,offerToReceiveVideo:!0};if("function"==typeof T.global.Promise)return i.createOffer(r).then(t).catch(e);i.createOffer(t,e,r)}catch(t){n.X.error("Failed to set environment defaults. Creating the Offer failed",t),i.close&&i.close()}}.call(this),z.call(this))}function x(t){this.X=t.logger||e.createPCastLogger(this.st,t.disableConsoleLogging,t.loggingLevel),this.At=t.metricsTransmitter||f.createMetricsTransmitter(this.st)}function q(e){if(!b.startsWith(e,"DIGEST:"))throw this.X.warn("Failed to parse the `streamToken` [%s]",e),new Error("Bad `streamToken`");try{var t=e.split(":")[1],n=T.global.atob(t),i=JSON.parse(n).token;return JSON.parse(i)}catch(t){throw i=this.getProtocol().getSessionId(),this.X.warn("[%s] Failed to parse the `streamToken` [%s]",i,e),new Error(t)}}function D(){var n,i,r=this;r.Ut?r.X.warn("[%s] Skip connect due to stopped state",r):(N.call(r)&&"offline"===r.pt.getValue()&&(this.X.warn("[PCast] connected after being offline. Reconnecting."),A.call(r)),this.jt=!0,n=r.Nt,i=++r.Tt,n.authenticate(r.Ft,function(t,e){n===r.Nt?i===r.Tt?r.Lt&&(t?(r.X.error("Failed to authenticate [%s]",t),tt.call(r,"unauthorized"),r.Lt.call(r,r,"unauthorized","")):"ok"!==e.status?(r.X.warn("Failed to authenticate, status [%s]",e.status),tt.call(r,"unauthorized"),r.Lt.call(r,r,"unauthorized","")):(tt.call(r,"online"),r.Lt.call(r,r,e.status,e.sessionId))):r.X.info("Ignoring authentication response as a latter request is already underway"):r.X.info("Ignoring authentication response as reset took place")}))}function A(){tt.call(this,"reconnecting")}function U(t){t&&k.e("reason",t),tt.call(this,"reconnected",t),this.X.info("Attempting to re-authenticate after reconnected event [%s]",t),function(){var i,r,o=this;o.Ut?o.X.info("Skip re-authentication due to stopped state"):(i=o.Nt,r=++o.Ct,i.authenticate(o.Ft,function(t,e){var n=!0===o.jt;if(i===o.Nt){if(r===o.Ct)return t?(o.X.error("Unable to authenticate after reconnect to WebSocket [%s]",t),tt.call(o,"reconnect-failed")):"ok"===e.status?(o.jt=!0,o.X.info("Successfully authenticated after reconnect to WebSocket"),tt.call(o,"online",null,n)):(o.X.warn("Unable to authenticate after reconnect to WebSocket, status [%s]",e.status),e="capacity"===e.status?e.status:"reconnect-failed",tt.call(o,e));o.X.info("Ignoring re-authentication response as a latter request is already underway")}else o.X.info("Ignoring re-authentication response as reset took place")}))}.call(this)}function j(){if(N.call(this)&&"reconnecting"===this.pt.getValue())return this.X.warn("[PCast] disconnected after attempting to reconnect. Going offline."),tt.call(this,"critical-network-issue"),this.stop("critical-network-issue");this.jt=!1,tt.call(this,"offline")}function N(){return b.reduce(this.Bt,function(t,e){return t&&"closed"===e.iceConnectionState},!0)}function F(t){var e=t.streamId,t=t.reason;return B.call(this,e,t)}function L(t){var e=t.streamId,n=t.status,i=t.reason;(t=this._t[e])&&t.dataQualityChangedCallback(n,i),(e=this.Wt[e])&&b.h(e.dataQualityChangedCallback)&&e.dataQualityChangedCallback(e,n,i)}function B(t,e){this.X.info("[%s] Stream ended with reason [%s]",t,e);var n=this._t[t];n&&n.streamEndedCallback(p.getStreamEndedStatus(e),e,!0),delete this._t[t],(n=this.Wt[t])&&b.h(n.publisherEndedCallback)&&n.publisherEndedCallback(n,p.getStreamEndedStatus(e),e),delete this.Wt[t],(e=this.Bt[t])&&et.call(this,t,e,"ended"),delete this.Bt[t]}function _(r,o,s,a,u,c){function t(t){if(!o.failed&&!d){var n,e=g.getNumberOfActiveSections(s),t=t.stream||b.get(t,["streams",0]),i="real-time";if(!t)return o.failed=!0,f.X.warn("[%s] No remote stream",r),u.call(f,void 0,"failed");h&&clearTimeout(h),e===t.getTracks().length||"ReactNative"===T.browser?(d=!0,f.X.info("[%s] Got remote stream",r),a.setProperty("kind",i),e=b.assign({networkLag:f.Vt},c),e=new v(r,t,s,a,e,f.X),(n=new p(i,e,f.X)).on(R.streamEvents.playerError.name,function(t,e){f.X.info("Phenix Real-Time stream error [%s] [%s]",t,e),n.streamErrorCallback(i,e)}),n.on(R.streamEvents.stopped.name,function(t){!o.stopped&&f.Nt&&(f.X.info("[%s] media stream has stopped with reason [%s]",r,t),et.call(f,r,s,"stop"),f.Nt.destroyStream(r,t||"",function(t,e){t?f.X.error("[%s] failed to destroy stream [%s]",r,t):"ok"===e.status?f.X.info("[%s] destroyed stream",r):f.X.warn("[%s] failed to destroy stream, status [%s]",r,e.status)}),o.stopped=!0)}),f._t[r]=n,u.call(f,e)):h=setTimeout(function(){return o.failed=!0,f.X.warn("[%s] Did not receive all tracks within [%s] ms",r,3e3),u.call(f,void 0,"failed")},3e3)}}var h,f=this,d=!1;b.addEventListener(s,"addstream",t),b.addEventListener(s,"track",t)}function W(e,t,n){var i=this;b.addEventListener(t,"icecandidate",function(t){(t=t.candidate)?i.X.info("[%s] ICE candidate: [%s] [%s] [%s]",e,t.sdpMid,t.sdpMLineIndex,t.candidate):i.X.info("[%s] ICE candidate discovery complete",e),n&&n(t)})}function V(e,n){var i=this;b.addEventListener(n,"negotiationneeded",function(t){i.X.info("[%s] Negotiation needed",e)}),b.addEventListener(n,"iceconnectionstatechange",function(t){i.X.info("[%s] ICE connection state changed [%s]",e,n.iceConnectionState)}),b.addEventListener(n,"icegatheringstatechange ",function(t){i.X.info("[%s] ICE gathering state changed [%s]",e,n.iceGatheringState)}),b.addEventListener(n,"signalingstatechange",function(t){i.X.info("[%s] Signaling state changed [%s]",e,n.signalingState)}),b.addEventListener(n,"connectionstatechange",function(t){i.X.info("[%s] Connection state changed [%s]",e,n.connectionState)})}function z(e){var n=this;if("Edge"===T.browser)return T.getDestinations(function(t){0===b.filter(t,function(t){return"audio"===t.kind}).length?(n.Mt&&n.X.info("Detected no audio devices attached to machine"),n.Mt=!1):n.Mt=!0,e&&e()});e&&e()}function G(t,i,e,n,r,o){if("IE"===T.browser)throw new Error("Subscribing in real-time not supported on IE");var s=this,a={failed:!1,stopped:!1},u=e.match(/a=crypto:/i),c=e.match(/m=application /i),h=new T.RTCPeerConnection(t,{optional:[{DtlsSrtpKeyAgreement:!u},{RtpDataChannels:c}]});function f(t){a.failed||(t instanceof Error&&(s.X.info("[%s] Failed to setup peer connection",i,t),t="failed"),a.failed=!0,a.stopped=!0,delete s.Bt[i],delete s._t[i],delete s.zt[i],et.call(s,i,h,"failure"),r.call(s,void 0,t||"failed"))}at(h),s.Bt[i]=h,"Firefox"!==T.browser&&"Edge"!==T.browser||(e.match(/(\nm=video)/g)&&e.match(/(\nm=audio)/g)&&(e=e.replace(c=/(a=candidate)((.|\n)*)(?=m=)/g,e.match(c)+"a=end-of-candidates\n")),e=(e+="a=end-of-candidates").replace(/(\na=ice-options:trickle)/g,"")),"ReactNative"===T.browser&&(e=g.setGroupLineOrderToMatchMediaSectionOrder(e)),_.call(s,i,a,h,n,r,o),W.call(s,i,h,function(t){s.zt[i]&&s.zt[i](t)}),V.call(s,i,h);var e=new T.RTCSessionDescription({type:"offer",sdp:e}),d={mandatory:{}};if("Chrome"===T.browser||"ReactNative"===T.browser?(d.mandatory.OfferToReceiveVideo=!1!==o.receiveVideo,d.mandatory.OfferToReceiveAudio=!1!==o.receiveAudio):(d.mandatory.offerToReceiveVideo=!1!==o.receiveVideo,d.mandatory.offerToReceiveAudio=!1!==o.receiveAudio),"function"==typeof T.global.Promise)return h.setRemoteDescription(e).then(b.bind(H,s,h)).then(function(){return h.createAnswer(d)}).then(b.bind(K,s)).then(function(n){return new T.global.Promise(function(t,e){Q.call(s,i,n,t,e)})}).then(function(t){return h.setLocalDescription(t)}).then(b.bind(J,s,h)).then(function(){s.X.info("[%s] Peer connection setup completed",i)}).catch(f);s.X.info("[%s] Using legacy peer connection api to subscribe",i),h.setRemoteDescription(e,function(){H.call(s,h),h.createAnswer(function(t){K.call(s,t),Q.call(s,i,t,function(t){h.setLocalDescription(t,function(){J.call(s,h),s.X.info("[%s] Peer connection setup completed",i)},f)},f)},f,d)},f)}function J(t){this.X.debug("Set local description [%s] [%s]",b.get(t,["localDescription","type"]),b.get(t,["localDescription","sdp"]))}function H(t){this.X.debug("Set remote description [%s] [%s]",b.get(t,["localDescription","type"]),b.get(t,["remoteDescription","sdp"]))}function K(t){return this.X.info("Created answer [%s]",t.sdp),t}function Q(n,t,i,r){var o=this;o.Nt.setAnswerDescription(n,t.sdp,function(t,e){return t?(o.X.error("Failed to set answer description [%s]",t),r()):"ok"!==e.status?(o.X.warn("Failed to set answer description, status [%s]",e.status),r(e.status)):(e&&b.includes(e.options,"ice-candidates")&&(o.zt[n]=b.bind(X,o,n)),t=e.sessionDescription.sdp,E.isIOS()&&(e=b.get(E.getIOSVersion(),["major"]),o.X.info("iOS Version is [%s]",e),e<11&&(t=t.replace("BUNDLE audio video","BUNDLE video audio"))),t=new T.RTCSessionDescription({type:"answer",sdp:t}),void i(t))})}function X(t,e){var n=this,i=(i=this.qt[t])||(this.qt[t]=[]);e&&b.get(e,["candidate"])?i.push(e):(n.Dt[t]&&(n.X.debug("[%s] Dismissing scheduled batch for adding ICE candidates. Sending candidates immediately because there are no more candidates.",t),clearTimeout(n.Dt[t])),Z.call(n,t,["completed"]),delete this.qt[t],delete this.Dt[t]),this.Dt[t]?n.X.debug("[%s] Using existing batch for adding ICE candidates",t):(this.Dt[t]=setTimeout(function(){Z.call(n,t,[]),delete n.Dt[t]},C),this.P.add(new o.Disposable(function(){n.Dt[t]&&clearTimeout(n.Dt[t]),delete n.qt[t],delete n.Dt[t]})))}function Z(n,t){var i,e=this.qt[n]||[];0===e.length&&0===t.length||(delete(i=this).qt[n],this.X.info("[%s] Adding [%s] ICE Candidates with Options [%s]",n,e.length,t),this.Nt.addIceCandidates(n,e,t,function(t,e){return t?i.X.error("Failed to add ICE candidate [%s]",t):"ok"!==e.status?i.X.warn("Failed to add ICE candidate, status [%s]",e.status):void(b.includes(e.options,"cancel")&&delete i.zt[n])}))}function $(t,e,n,i,r){var o=this,s=/a=x-rtmp:(rtmp:\/\/[^\n]*)/m,a=e.match(s),u=e.match(/a=x-playlist:([^\n]*[.]mpd\??[^\s]*)/m),c=e.match(/a=x-playlist:([^\n]*[.]m3u8\??[^\s]*)/m),h=b.get(u,[1],""),f=b.get(c,[1],""),d=u&&2===u.length,l=c&&2===c.length,u=!!a,c=[];switch((d||l)&&c.push("streaming"),u&&c.push("rtmp"),u=this.xt.getPreferredFeatureFromPublisherCapabilities(c,!0),this.St&&(h=h.replace(this.St.patternToReplace,this.St.replacement),f=f.replace(this.St.patternToReplace,this.St.replacement)),u){case R.types.rtmp.name:var p=[],m=S.parseEnvFromPcastBaseUri(this.st);for(this.X.info("Selecting flash playback for rtmp.");a;){var v=b.get(a,[1],""),g=b.get(v.match(/(rtmp:\/\/[^\n\s]*)/),[0]),y=b.get(v.match(/bitrate=([^\n\s;]*)/),[1]),w=b.get(v.match(/resolution=([^\n\s;]*)/),[1]);e=e.replace(v,""),g&&p.push({uri:g,bitrate:y,resolution:w}),a=e.match(s)}return Y.call(o,t,p,R.types.rtmp.name,n,i,b.assign({env:m},this.kt,r));case R.types.dash.name:return this.X.info("Selecting dash playback for live stream."),r.isDrmProtectedContent=/[?&]drmToken=([^&]*)/.test(h)||/x-widevine-service-certificate/.test(e),r.isDrmProtectedContent&&(r.widevineServiceCertificateUrl=e.match(/a=x-widevine-service-certificate:([^\n][^\s]*)/m)[1],r.playreadyLicenseUrl=e.match(/a=x-playready-license-url:([^\n][^\s]*)/m)[1]),Y.call(o,t,h,R.types.dash.name,n,i,r);case R.types.hls.name:return this.X.info("Selecting hls playback for live stream."),r.isDrmProtectedContent=/[?&]drmToken=([^&]*)/.test(f),r.hlsTargetDuration&&(k.u(r.hlsTargetDuration,"options.hlsTargetDuration"),f=f+(-1<f.indexOf("?")?"&":"?")+"targetDuration="+r.hlsTargetDuration),Y.call(o,t,f,R.types.hls.name,n,i,b.assign({preferNative:E.shouldUseNativeHls},r))}return o.X.warn("[%s] Device does not support [%s] playback. Creating live viewer stream failed.",t,E.mapPCastCapabilitiesToFeatures(c)),i.call(o,void 0,"failed")}function Y(i,e,r,o,s,a){var u=this,n=0,c=null,h=null;return this.wt||this.bt?(this.wt&&n++,this.bt&&n++,this.wt&&this.wt(function(t){if(c=t,0==--n)return f()}),this.bt&&this.bt(function(t){if(h=t,0==--n)return f()}),0===n?f():void 0):(u.X.warn("[%s] No player available for [%s] and uri [%s]. Please provide a loader via options.",i,r,e),u.Nt.destroyStream(i,"unsupported-features",function(t,e){t?u.X.error("[%s] failed to destroy stream with unsupported features, [%s]",i,t):"ok"!==e.status&&u.X.warn("[%s] failed to destroy stream with unsupported features, status [%s]",i,e.status)}),s.call(u,void 0,"unsupported-features"));function f(){if(!c&&!h)return u.X.warn("[%s] No player available for [%s] and uri [%s]. Please make sure the loader properly provides the player.",i,r,e),s.call(u,void 0,"unsupported-features");var t=new m(r,i,e,o,a,c,h,u.X),n=new p(r,t,u.X);o.setProperty("kind",r),n.on(R.streamEvents.playerError.name,function(t,e){u.X.warn("Phenix Live Stream Player Error [%s] [%s]",t,e),n.streamErrorCallback(t,e)}),n.on(R.streamEvents.stopped.name,function(t){return u.Nt?void u.Nt.destroyStream(i,t||"",function(t,e){t?u.X.error("[%s] failed to destroy stream, [%s]",i,t):"ok"!==e.status&&u.X.warn("[%s] failed to destroy stream, status [%s]",i,e.status)}):u.X.warn("Unable to destroy stream [%s]",i)}),u._t[i]=n,s.call(u,n.getPhenixMediaStream())}}function tt(t,e,n){var i=this.getStatus();if(i!==t&&("critical-network-issue"!==(r=i)&&"offline"!==r||"offline"!==t)){this.pt.setValue(t);var r=(r=this.getProtocol())?r.getSessionId():"";if(this.X.debug("[%s] Transition from [%s] to [%s] with reason [%s]",r,i,t,e),!n)switch(t){case"connecting":case"reconnecting":case"reconnected":break;case"critical-network-issue":case"unauthorized":case"reconnect-failed":case"offline":return this.Gt.call(this);case"online":return this.Jt.call(this)}}}function et(t,e,n){"closed"===e.signalingState||e.__closing?this.X.debug("[%s] Peer connection is already closed [%s]",t,n):(this.X.debug("[%s] close peer connection [%s]",t,n),e.close(),e.__closing=!0)}function nt(){(this.Rt||this.It)&&U.call(this,"entered-foreground")}function it(){this.Rt&&tt.call(this,"offline","entered-background")}function rt(t){if(!t)return t;var e=b.isArray(t)?[]:{},n=b.bind(ot,null,e);return b.isArray(t)?b.forEach(t,n):b.forOwn(t,n),e}function ot(t,e,n){if(null!==e)return b.a(e)||b.isArray(e)?t[n]=rt(e):b.e(e)&&b.e(n)?(e=b.startsWith(e.toLowerCase(),n.toLowerCase())?e.substring(n.length,e.length).toLowerCase():e,void(t[n]=e)):t[n]=e}function st(t){switch(T.browser){case"Firefox":(e=t)&&b.forEach(e.iceServers,function(t){t.urls=b.filter(t.urls,function(t){return!b.startsWith(t,"turns")})});break;case"Edge":(e=t)&&b.forEach(e.iceServers,function(t){t.urls=b.map(t.urls,function(t){return t.replace("transport=tcp","transport=udp")})})}var e;return t}O.prototype.getBaseUri=function(){return this.st},O.prototype.getStatus=function(){return this.pt.getValue()},O.prototype.getObservableStatus=function(){return this.pt},O.prototype.getRemoteDescriptionSdp=function(t){if(k.g(t,"streamId"),this.Bt)return b.get(this.Bt,[t,"remoteDescription","sdp"])},O.prototype.isStarted=function(){return this.Ht},O.prototype.reAuthenticate=function(t){if(k.g(t,"authToken"),"online"===this.pt.getValue())return this.X.warn("Already authenticated. Denying request to re-authenticate");this.X.info("Attempting to re-authenticate with new auth token [%s]",t),this.Ft=t,U.call(this)},O.prototype.start=function(t,e,n,i){if(k.g(t,"authToken"),k.h(e,"authenticationCallback"),k.h(n,"onlineCallback"),k.h(i,"offlineCallback"),this.Ht)throw new Error('"Already started"');b.u(T.global.__phenixInstantiatedPCastCount)?T.global.__phenixInstantiatedPCastCount++:T.global.__phenixInstantiatedPCastCount=1,1<T.global.__phenixInstantiatedPCastCount&&!this.Et&&this.X.warn("Avoid using multiple instances of PCast as this uses unnecessary resources and will reduce performance. This is your [%s] simultaneous instance. Remember to dispose all resources when done with them by calling .stop() or .dispose()",T.global.__phenixInstantiatedPCastCount),this.Ut=!1,this.Ht=!0,this.Ft=t,this.Lt=e,this.Jt=n,this.Gt=i,this.at=new l(this.X,this.At),this.Kt=new u(this.ot,this.st,this.X,this.at),tt.call(this,"connecting"),this.Bt={},this._t={},this.zt={},this.Wt={},this.Qt=[],this.P.add(this.Kt),this.P.add(this.at),this.P.add(s.onBackground(b.bind(it,this))),this.P.add(s.onForeground(b.bind(nt,this)));var r=this;r.Kt.resolveUri(function(t,e){if(t){if(r.X.error("Failed to connect to [%s]",r.st,t),r.Lt)switch(t.code){case 0:r.Lt.call(r,r,"network-unavailable","");break;case 503:r.Lt.call(r,r,"capacity","");break;default:return void r.Lt.call(r,r,"critical-network-issue","")}return tt.call(r,"offline"),r.Ut=!0,void(r.Ht=!1)}r.X.info("Discovered end point [%s] with RTT [%s]",e.uri,e.roundTripTime),r.Vt=e.roundTripTime/2,r.Xt=e.uri,r.Ht&&function(t){this.Nt=new a(t,this.gt,this.ot,this.X),this.Nt.onEvent("connected",b.bind(D,this)),this.Nt.onEvent("reconnecting",b.bind(A,this)),this.Nt.onEvent("reconnected",b.bind(U,this)),this.Nt.onEvent("disconnected",b.bind(j,this)),this.Nt.onEvent("pcast.StreamEnded",b.bind(F,this)),this.Nt.onEvent("pcast.StreamDataQuality",b.bind(L,this)),this.X.setObservableSessionId&&this.X.setObservableSessionId(this.Nt.getObservableSessionId()),this.Zt&&(this.Zt.dispose(),this.at.setSessionId(null)),this.$t&&this.$t.dispose(),this.$t=this.Nt.getObservableSessionId().subscribe(b.bind(function(t){this.vt.setValue(t)},this)),this.Zt=this.Nt.getObservableSessionId().subscribe(b.bind(this.at.setSessionId,this.at))}.call(r,e.uri)})},O.prototype.stop=function(n){if(n=n||"",k.e(n,"reason"),this.Ht){this.X.info("Stopping pcast instance with reason [%s]",n),this.Ut=!0,this.Ht=!1,delete this.Lt;try{var i=this;b.forOwn(this._t,function(t,e){B.call(i,e,n)}),b.forOwn(this.Wt,function(t,e){B.call(i,e,n),b.includes(t.getOptions(),"detached")||t.stop(n,!0)}),b.forOwn(this.Bt,function(t,e){B.call(i,e,n)}),b.forEach(this.Qt,function(t){t=t.getTracks(),b.forEach(t,function(t){t.stop()})})}catch(t){i.X.warn("Pcast stop caught an error",t)}finally{if(this.Nt){try{this.Nt.disconnect()}catch(t){i.X.warn("Failed to disconnect pcast",t)}this.Nt=null}this.X.setObservableSessionId&&this.X.setObservableSessionId(null),this.Zt&&(this.Zt.dispose(),this.at.setSessionId(null)),this.$t&&(this.$t.dispose(),this.vt.setValue(null)),T.global.__phenixInstantiatedPCastCount--,this.P.dispose()}}},O.prototype.getUserMedia=function(t,e,n){if("IE"===T.browser)throw new Error("Publishing not supported on IE");return k.a(t,"options"),k.h(e,"callback"),n&&k.h(n,"onScreenShare"),new i(this.X,this.yt,n).getUserMedia(t,e)},O.prototype.publish=function(t,s,a,e,u){if("IE"===T.browser)throw new Error("Publishing not supported on IE");if(!this.Ht)throw new Error("PCast not started. Unable to publish. Please start pcast first.");if(e=e||[],u=u||{},k.g(t,"streamToken"),k.h(a,"callback"),k.isArray(e,"tags"),k.a(u,"options"),!b.a(s)&&!b.e(s))throw new Error('"streamToPublish" must be an object or URI');var c=this,h=b.assign({},u,{negotiate:!0});b.e(s)?(h.negotiate=!1,h.connectUri=s):h.connectUri=u.connectUri,0<e.length&&(h.tags=e);var f=new d(this.getProtocol().getSessionId(),this.X,this.At);f.setProperty("resource","upload"),this.Nt.setupStream("upload",t,h,2*c.Vt,function(t,e){if(t)return c.X.error("Failed to create uploader [%s]",t),a.call(c,c,"failed");if("ok"===e.status){var n=e.createStreamResponse.streamId;if(f.setStreamId(n),f.setStartOffset(e.createStreamResponse.offset),f.recordMetric("Provisioned"),f.recordMetric("RoundTripTime",{uint64:2*c.Vt},null,{resource:c.Xt,kind:"https"}),!0!==h.negotiate)return function(n,t,e){var i=this,r={stopped:!1},o={getStreamId:function(){return n},getStream:function(){return i.X.debug("[%s] Unable to get stream for remote origin.",n),null},getStats:function(){return i.X.debug("[%s] Unable to get stream stats for remote origin.",n),null},isActive:function(){return!r.stopped},hasEnded:function(){return r.stopped},stop:function(t){r.stopped||(i.X.info("[%s] stopping publisher with reason [%s]",n,t),i.Nt.destroyStream(n,t||"",function(t,e){t?i.X.error("[%s] failed to destroy stream [%s]",n,t):"ok"===e.status?i.X.info("[%s] destroyed stream",n):i.X.warn("[%s] failed to destroy stream, status [%s]",n,e.status)}),r.stopped=!0)},setPublisherEndedCallback:function(t){k.h(t,"callback"),this.publisherEndedCallback=t},setDataQualityChangedCallback:function(t){k.h(t,"callback"),this.dataQualityChangedCallback=t},getOptions:function(){return e},monitor:function(t,e){k.a(t,"options"),k.h(e,"callback")},getMonitor:function(){return null}};t(i.Wt[n]=o)}.call(c,n,function(t,e){f.recordMetric("SetupCompleted",{string:e?"failed":"ok"}),e?a.call(c,c,"failed",null):a.call(c,c,"ok",t)},e.createStreamResponse.options);var i,r=e.createStreamResponse.createOfferDescriptionResponse.sessionDescription.sdp,o=st(rt(e.createStreamResponse.rtcConfiguration));return"Opera"===T.browser&&0<c.Pt.length&&(i=b.get(g.getH264ProfileIds(r),[0]),(t=g.getH264ProfileIdWithSameProfileAndEqualToOrHigherLevel(c.Pt,i))?i!==t&&(c.X.info("[%s] Replacing publisher h264 profile level id [%s] with new value [%s] in offer sdp",n,i,t),r=g.replaceH264ProfileId(r,i,t)):c.X.warn("[%s] Unable to find h264 profile level id to replace [%s]. Rejected environment defaults of [%s]",n,i,c.Pt)),function(t,s,a,e,n,u,i,c){var h=this,f={failed:!1,stopped:!1},r=e.match(/a=crypto:/i),o=e.match(/m=application /i),d=new T.RTCPeerConnection(t,{optional:[{DtlsSrtpKeyAgreement:!r},{RtpDataChannels:o}]}),l=null,p=null;function m(t){f.failed||(t instanceof Error&&(h.X.info("[%s] Failed to setup peer connection",a,t),t="failed"),f.failed=!0,f.stopped=!0,delete h.Bt[a],delete h.Wt[a],delete h.zt[a],et.call(h,a,d,"failure"),u.call(h,void 0,t||"failed"))}function v(){var n=/(b=AS:([0-9]*)[\n\r]*)/gi,i=/(mid:video)([\n\r]*)/gi,r=0,t=n.exec(e);t&&3<=t.length&&(r=1e3*t[2]);var o={getStreamId:function(){return a},getStream:function(){return s},isActive:function(){return!f.stopped},hasEnded:function(){switch(d.iceConnectionState){case"new":case"checking":case"connected":case"completed":return!1;default:return!0}},stop:function(t){!f.stopped&&h.Nt&&(h.X.info("[%s] stopping publisher with reason [%s]",a,t||"client-action"),et.call(h,a,d,"closed"),h.Nt.destroyStream(a,t||"",function(t,e){t?h.X.error("[%s] failed to destroy stream [%s]",a,t):"ok"===e.status?h.X.info("[%s] destroyed stream",a):h.X.warn("[%s] failed to destroy stream, status [%s]",a,e.status)}),f.stopped=!0)},setPublisherEndedCallback:function(t){k.h(t,"callback"),this.publisherEndedCallback=t},setDataQualityChangedCallback:function(t){k.h(t,"callback"),this.dataQualityChangedCallback=t},limitBandwidth:function(t){if("Edge"===T.browser)return h.X.warn("Limit bandwidth not support on [%s]",T.browser);k.u(t,"bandwidthLimit");var o=r?Math.min(t,r):t,e=d.remoteDescription;return h.X.info("Changing bandwidth limit to [%s]",o),t=(t=e.sdp.replace(n,"")).replace(i,function(t,e,n,i,r){return[e,n,"b=AS:",Math.ceil(o/1e3),n].join("")}),t=new T.RTCSessionDescription({type:e.type,sdp:t}),d.setRemoteDescription(t),{dispose:function(){d.setRemoteDescription(e)}}},getMonitor:function(){return p},monitor:function(t,n){k.a(t,"options"),k.h(n,"callback");var e=new y(a,d,h.X);return t.direction="outbound",t.setNetworkRTT=function(t){h.mt.setValue(t)},e.start(t,function(){return h.Wt[a]===o&&!f.stopped},function(t,e){return t&&h.X.warn("[%s] Publisher monitor triggered unrecoverable error [%s]",t),h.X.warn("[%s] Publisher triggered monitor condition for [%s]",a,e.reasons),n(o,"client-side-failure",e)}),b.forEach(s.getTracks(),function(t){b.addEventListener(t,"readystatechange",function(){if("ended"===t.readyState)return h.X.warn("[%s] Publisher track has failed [%s]",a,t),n(o,"camera-track-failure",{type:t.kind+"-track-ended",message:"Publisher "+t.kind+" track has ended in an unrecoverable way. This may require reconfiguring your camera or microphone."})})}),p=e},addBitRateThreshold:function(t,e){return new I("Publisher",p,function(){return r}).addThreshold(t,e)},setRemoteMediaStreamCallback:function(t){k.h(t,"callback"),this.remoteMediaStreamCallback=t,l&&t(o,l)},getOptions:function(){return c},getStats:function(e){k.h(e,"callback"),this.Yt||(this.Yt={});var n=this;return T.getStats(d,null,function(t){e(w.convertPeerConnectionStats(t,n.Yt))})},networkRTT:h.mt};h.Wt[a]=o,u.call(h,o)}at(d),(h.Bt[a]=d).addStream(s),"Firefox"!==T.browser&&"Edge"!==T.browser||(e.match(/(\nm=video)/g)&&e.match(/(\nm=audio)/g)&&(e=e.replace(o=/(a=candidate)((.|\n)*)(?=m=)/g,e.match(o)+"a=end-of-candidates\n")),e=(e+="a=end-of-candidates").replace(/(\na=ice-options:trickle)/g,"")),_.call(h,a,f,d,n,function(t){var e=h.Wt[a];l=t,e&&e.remoteMediaStreamCallback&&e.remoteMediaStreamCallback(e,t)},i),W.call(h,a,d,function(t){h.zt[a]&&h.zt[a](t)}),V.call(h,a,d);var n=new T.RTCSessionDescription({type:"offer",sdp:e}),g={mandatory:{}};if("Chrome"===T.browser||"ReactNative"===T.browser?(g.mandatory.OfferToReceiveVideo=!0===i.receiveVideo,g.mandatory.OfferToReceiveAudio=!0===i.receiveAudio):(g.mandatory.offerToReceiveVideo=!0===i.receiveVideo,g.mandatory.offerToReceiveAudio=!0===i.receiveAudio),"function"==typeof T.global.Promise)return d.setRemoteDescription(n).then(b.bind(H,h,d)).then(function(){return d.createAnswer(g)}).then(b.bind(K,h)).then(function(n){return new T.global.Promise(function(t,e){Q.call(h,a,n,t,e)})}).then(function(t){return d.setLocalDescription(t)}).then(b.bind(J,h,d)).then(function(){h.X.info("[%s] Peer connection setup completed",a)}).then(v).catch(m);h.X.info("[%s] Using legacy peer connection api to publish",a),d.setRemoteDescription(n,function(){H.call(h,d),d.createAnswer(function(t){K.call(h,t),Q.call(h,a,t,function(t){d.setLocalDescription(t,function(){J.call(h,d),h.X.info("[%s] Peer connection setup completed",a),v()},m)},m)},m,g)},m)}.call(c,o,s,n,r,f,function(t,e){f.recordMetric("SetupCompleted",{string:e?"failed":"ok"}),e?a.call(c,c,"failed",null):a.call(c,c,"ok",t)},u,e.createStreamResponse.options)}switch(c.X.warn("Failed to create uploader, status [%s]",e.status),e.status){case"timeout":case"capacity":case"unauthorized":return a.call(c,c,e.status);default:return a.call(c,c,"failed")}})},O.prototype.subscribe=function(n,a,i){if(!this.Ht)throw new Error("PCast not started. Unable to subscribe. Please start pcast first.");i=i||{},k.g(n,"streamToken"),k.h(a,"callback"),k.a(i,"options");var u=this;z.call(u,function(){var t="download",e=b.assign({},i,{negotiate:!1!==i.negotiate}),o=new d(u.getProtocol().getSessionId(),u.X,u.At),s=b.assign({},i);s.canPlaybackAudio=u.Mt,s.capabilities=u.parseCapabilitiesFromToken(n),!u.Mt&&i.disableAudioIfNoOutputFound&&!1!==i.receiveAudio&&(e.receiveAudio=!1,s.receiveAudio=!1,s.forcedAudioDisabled=!0),i.originStreamId&&(e.originStreamId=i.originStreamId),o.setProperty("resource",t),u.Nt.setupStream(t,n,e,2*u.Vt,function(t,e){if(t)return u.X.error("Failed to create downloader [%s]",t),a.call(u,u,"failed");if("ok"!==e.status)return u.X.warn("Failed to create downloader, status [%s]",e.status),a.call(u,u,e.status);var n=e.createStreamResponse.streamId,i=e.createStreamResponse.createOfferDescriptionResponse.sessionDescription.sdp,r=st(rt(e.createStreamResponse.rtcConfiguration)),t=b.bind(G,u,r);return(r=!(i.match(/m=audio /)||i.match(/m=video /))&&(i.match(/a=x-playlist:/)||i.match(/a=x-rtmp:/)))&&(t=$),o.setStreamId(n),o.setStartOffset(e.createStreamResponse.offset),o.recordMetric("Provisioned"),o.recordMetric("RoundTripTime",{uint64:2*u.Vt},null,{resource:u.getBaseUri(),kind:"https"}),s.originStartTime=b.now()-e.createStreamResponse.offset+u.Vt,!r&&("Chrome"===T.browser&&62<=T.browserVersion&&E.isMobile()||"Opera"===T.browser)&&0<u.Pt.length&&(e=b.get(g.getH264ProfileIds(i),[0]),(r=g.getH264ProfileIdWithSameOrHigherProfileAndEqualToOrHigherLevel(u.Pt,e))?e!==r&&(u.X.info("[%s] Replacing subscriber h264 profile level id [%s] with new value [%s] in offer sdp",n,e,r),i=g.replaceH264ProfileId(i,e,r)):u.X.warn("[%s] Unable to find new subscriber h264 profile level id to replace [%s]. Rejected environment defaults of [%s]",n,e,u.Pt)),t.call(u,n,i,o,function(t,e){o.recordMetric("SetupCompleted",{string:e?"failed":"ok"}),e?a.call(u,u,"failed",null):a.call(u,u,"ok",t)},s)})})},O.prototype.getProtocol=function(){return this.Nt},O.prototype.getLogger=function(){return this.X},O.prototype.getObservableSessionId=function(){return this.vt},O.prototype.toString=function(){var t=this.getProtocol();return"PCast["+(t?t.getSessionId():"")||!1},O.prototype.parseCapabilitiesFromToken=function(t){return b.get(q.call(this,t),["capabilities"],[])},O.prototype.parseUriFromToken=function(t){return b.get(q.call(this,t),["uri"],"")},O.prototype.parseRoomOrChannelIdFromToken=function(t){return(t=b.get(q.call(this,t),["requiredTag"],"").match(M))?t[1]:null},O.prototype.parseRoomOrChannelAliasFromToken=function(t){return(t=b.get(q.call(this,t),["requiredTag"],"").match(P))?t[1]:null};var at=function(n){var e,t;b.isUndefined(n.onaddstream)&&(e=[],t=[],b.addEventListener(n,"track",function(t){b.forEach(t.streams,function(t){b.includes(e,t)||e.push(t)})}),n.getRemoteStreams=function(){return e},n.getLocalStreams=function(){return t},n.addStream=function(e){b.includes(t,e)||t.push(e),b.forEach(e.getTracks(),function(t){n.addTrack(t,e)})})};return O}.apply(e,n))||(t.exports=n)},function(t,e,n){n=[n(0),n(1),n(2)];void 0===(n=function(o,s,a){"use strict";function t(t,e){this.latestValue=null,this.subscribeCallbacks={},this.subscriptionTimeout=100,this.subscriptionCount=0,this.resetOnChange=!1,this.lastChangeTime=0,this.isPendingChanges=!1,this.beforeChange=e,i.call(this,t)}function n(t){return null!=t&&o.isArray(t)?t.slice():t}function i(t){var e=t;this.beforeChange&&(e=this.beforeChange(t)),this.latestValue=n(e)}function u(t,e){if(this.lastChangeTime=o.now(),!this.isPendingChanges&&0!==this.subscriptionCount){if(this.isPendingChanges=!0,e)return c.call(this);r.call(this,t)}}function r(t){var e=this;setTimeout(function(){var t=o.now()-e.lastChangeTime;e.resetOnChange&&t<e.subscriptionTimeout?r.call(e,e.subscriptionTimeout-t):c.call(e)},t)}function c(){try{!function(){var e=this;o.forOwn(e.subscribeCallbacks,function(t){o.h(t)&&t(e.latestValue)})}.call(this)}finally{this.isPendingChanges=!1}}return t.prototype.getValue=function(){return n(this.latestValue)},t.prototype.setValue=function(t){t!==this.latestValue&&(i.call(this,t),u.call(this,this.subscriptionTimeout))},t.prototype.subscribe=function(t,e){s.h(t,"callback"),e&&s.a(e,"options");var n,i=this,r=o.uniqueId();return i.subscribeCallbacks[r]=t,i.subscriptionCount+=1,e&&("notify"===e.initial&&u.call(i,i.subscriptionTimeout,!0),e.listenForChanges&&(n=setInterval(function(){var t=e.listenForChanges.callback();t!==i.latestValue&&i.setValue(t)},e.listenForChanges.timeout))),new a.Disposable(function(){delete i.subscribeCallbacks[r],n&&(clearInterval(n),n=null),--i.subscriptionCount})},t.prototype.extend=function(t){switch(s.a(t,"options"),t.method){case"notifyWhenChangesStop":this.subscriptionTimeout=t.timeout,this.resetOnChange=!0;break;case"notifyAtFixedRate":this.subscriptionTimeout=t.timeout}return o.u(t.rateLimit)&&(this.subscriptionTimeout=t.rateLimit),this},t}.apply(e,n))||(t.exports=n)},function(t,e,n){n=[n(70)];void 0===(n=function(t){"use strict";return t}.apply(e,n))||(t.exports=n)},function(t,e,n){n=[n(0),n(1),n(4),n(2),n(30),n(75)];void 0===(n=function(c,s,o,i,a,u){"use strict";var h="continuation",f=18e3;function t(t,e,n,i,r){s.a(t,"logger"),s.h(e,"sendCallback"),s.h(n,"receiveCallback"),this.X=t,this.te=new a(i,r),this.ee=0,this.ne=new o.NamedEvents,this.ie={},this.re={},this.oe={},this.se={},this.ae={},this.ue={},this.ce=n,this.he=e,n(c.bind(d,this))}function d(t){if(this.fe)return this.X.warn("Proto already disposed of. Unable process message");var e,n,i;try{e=this.te.decode("mq.Message",u.toByteArray(t.data)),i=this.ie[e.requestId],this.X.info(">> [%s] [%s]",e.messageType,e.type),n=this.te.decode(e.type,e.payload)}catch(t){if(this.X.error(t),i)return i(t);throw t}switch(function(t,e,n){var i=c.now(),r=this.ae[t.requestId];c.u(r)&&(t.wallTime=[r=i-r].concat(t.wallTime)),this.ne.fireAsync("received",[{key:t.requestId,messageType:t.messageType,type:t.type,wallTime:t.wallTime,received:i,bytes:n,payload:e}]),delete this.ae[t.requestId]}.call(this,e,n,t.data.length),e.messageType){case"Response":return n.status!==h&&delete this.ie[e.requestId],clearTimeout(this.se[e.requestId]),delete this.se[e.requestId],i?"mq.Error"!==e.type?i(null,n):i(n,null):void 0;case"Request":var r=c.bind(this.sendResponse,this,e.requestId,e.type+"Response"),o=this.oe[e.type];this.re[e.requestId]=c.now(),o?o(n,r):this.X.info("Received request without a subscribed listener");break;case"Event":return function(t,e){this.ne.fire(t,e,this)}.call(this,e.type,[n]);default:return this.X.warn(">> Unsupported message type [%s]",e.messageType)}}function l(t,e,n,i,r,o,s){return s&&s.status===h?(!this.ue[t]&&this.ie[t]&&(this.ue[t]=function(t,e){return setTimeout(c.bind(v,this,t,3e5,e),3e5)}.call(this,t,r)),function(t,e,n,i,r,o){if(!i||!i.continuationId&&!i.routeKey)return this.X.warn("Received request for continuation without a continuationId or routeKey"),o();var s=c.assign({},n,{continuationId:i.continuationId,routeKey:i.routeKey}),a={requestId:t,type:e,payload:this.te.encode(e,s),messageType:"Request"},u=this;return setTimeout(function(){if(u.ie[t])return p.call(u,t,a,s,r,o)},2e3)}.call(this,t,e,n,s,i,r)):(clearTimeout(this.ue[t]),delete this.ue[t],r(o,s))}function p(t,e,n,i,r){return this.se[t]&&clearTimeout(this.se[t]),i=i||f,this.se[t]=setTimeout(c.bind(v,this,t,i,r),i),m.call(this,e,n)}function m(t,e){var n=u.toString(this.te.encode("mq.Message",t));return function(t,e,n){var i=c.now();this.ae[t.requestId]=i,this.ne.fireAsync("sent",[{key:t.requestId,messageType:t.messageType,type:t.type,received:i,bytes:n,payload:e}])}.call(this,t,e,n.length),this.he(n)}function v(t,e,n){if(this.ie[t])return function(t,e){this.ne.fireAsync("timeout",[{key:t,timeout:e}]),delete this.ae[t]}.call(this,t,e),this.X.warn("Request [%s] has not completed in [%s] ms. Dropping request.",t,e),delete this.ie[t],n(null,{status:"timeout"})}return t.prototype.onEvent=function(t,e){return this.fe?this.X.warn("Proto already disposed of. Unable to listen for event"):(s.g(t,"eventName"),s.h(e,"handler"),this.ne.listen(t,e))},t.prototype.onRequest=function(t,e){if(this.fe)return this.X.warn("Proto already disposed of. Unable to listen for request");s.g(t,"requestName"),s.h(e,"handler"),this.oe[t]&&this.X.warn("May not set multiple handlers for the same request. Overriding existing handlers for request [%s]",t),this.oe[t]=e;var n=this;return new i.Disposable(function(){n.oe[t]=null})},t.prototype.sendRequest=function(t,e,n,i){if(this.fe)return this.X.warn("Proto already disposed of. Unable to send request"),n(null,{status:"proto-disposed"});i=i||{},s.g(t,"type"),s.a(e,"message"),s.a(i,"settings"),n&&s.h(n,"callback"),i.timeout&&s.u(i.timeout,"settings.timeout");var r="C"+(this.ee++).toString(),o={requestId:r,type:t,payload:this.te.encode(t,e),messageType:"Request"};return this.ie[r]=c.bind(l,this,r,t,e,i.timeout,n),p.call(this,r,o,e,i.timeout,n)},t.prototype.sendResponse=function(t,e,n,i){if(this.fe)return this.X.warn("Proto already disposed of. Unable to send response"),i(null,{status:"proto-disposed"});s.g(t,"requestId"),s.g(e,"type"),s.a(n,"message");var r=this.re[t];return r||(this.X.error("Already responded to request [%s]",t),i(new Error("no-response-handler"))),r={requestId:t,type:e,payload:this.te.encode(e,n),messageType:"Response",wallTime:[c.now()-r]},m.call(this,r,n),delete this.re[t],i(null,{status:"ok"})},t.prototype.disposeOfRequests=function(){c.forOwn(this.se,function(t){clearTimeout(t)}),c.forOwn(this.ue,function(t){clearTimeout(t)}),this.ie={},this.re={},this.oe={},this.se={},this.ae={},this.ue={}},t.prototype.dispose=function(){this.fe=!0,this.ce=null,this.he=null,this.disposeOfRequests(),this.ne.dispose()},t.prototype.getApiVersion=function(){return this.te.getApiVersion()},t.prototype.toString=function(){return"Proto["+this.de.toString()+"]"},t}.apply(e,n))||(t.exports=n)},function(t,e,n){n=[n(0),n(71),n(73),n(74)];void 0===(n=function(r,o,i,s){"use strict";function t(t,e){var n=this;this.le={},this.le[s.package]=new i(s),r.forEach(t,function(t){n.le[t.package]=new i(t)}),this.pe=e||3}return t.prototype.getApiVersion=function(){return this.pe},t.prototype.encode=function(t,e){if("string"!=typeof t)throw new Error("'type' must be a string");if("object"!=typeof e)throw new Error("'data' must be an object");var n=t.split("."),i=r.get(n,[0]),t=r.get(n,[1]),n=r.get(this.le,[i]),i=new o;return n.write(t,e,i),i.finish()},t.prototype.decode=function(t,e){if("string"!=typeof t)throw new Error("'type' must be a string");var n=t.split("."),t=r.get(n,[0]),n=r.get(n,[1]),t=r.get(this.le,[t]),e=new o(e);return t.read(n,e)},t}.apply(e,n))||(t.exports=n)},function(t,e,n){void 0===(e=function(){"use strict";return{package:"telemetry",messages:[{name:"LogData",fields:[{rule:"required",type:"LogLevel",name:"level",id:1},{rule:"required",type:"string",name:"timestamp",id:2},{rule:"required",type:"string",name:"category",id:3},{rule:"required",type:"string",name:"message",id:4},{rule:"optional",type:"string",name:"source",id:5},{rule:"optional",type:"string",name:"fullQualifiedName",id:11},{rule:"optional",type:"string",name:"sessionId",id:6},{rule:"optional",type:"string",name:"userId",id:7},{rule:"optional",type:"string",name:"environment",id:8},{rule:"optional",type:"string",name:"version",id:9},{rule:"optional",type:"float",name:"runtime",id:10}]},{name:"StoreLogRecords",fields:[{rule:"repeated",type:"LogData",name:"records",id:1}]},{name:"StoreLogRecordsResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"required",type:"uint64",name:"storedRecords",id:2}]},{name:"MetricValue",fields:[{rule:"optional",type:"string",name:"string",id:1},{rule:"optional",type:"float",name:"float",id:2},{rule:"optional",type:"uint64",name:"uint64",id:3},{rule:"optional",type:"int64",name:"int64",id:4},{rule:"optional",type:"bool",name:"boolean",id:5},{rule:"optional",type:"string",name:"timestamp",id:6}]},{name:"MetricData",fields:[{rule:"required",type:"string",name:"timestamp",id:1},{rule:"optional",type:"string",name:"sessionId",id:2},{rule:"optional",type:"string",name:"streamId",id:3},{rule:"optional",type:"string",name:"source",id:4},{rule:"optional",type:"string",name:"resource",id:5},{rule:"optional",type:"string",name:"kind",id:6},{rule:"required",type:"Metric",name:"metric",id:7},{rule:"optional",type:"MetricValue",name:"value",id:8},{rule:"optional",type:"MetricValue",name:"previousValue",id:9},{rule:"optional",type:"uint64",name:"elapsed",id:10},{rule:"optional",type:"string",name:"fullQualifiedName",id:11},{rule:"optional",type:"string",name:"environment",id:12},{rule:"optional",type:"string",name:"version",id:13},{rule:"optional",type:"string",name:"tool",id:14},{rule:"optional",type:"string",name:"toolVersion",id:15},{rule:"required",type:"float",name:"runtime",id:16}]},{name:"SubmitMetricRecords",fields:[{rule:"repeated",type:"MetricData",name:"records",id:1}]},{name:"SubmitMetricRecordsResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"required",type:"uint64",name:"storedRecords",id:2}]}],enums:[{name:"LogLevel",values:[{name:"Trace",id:0},{name:"Debug",id:1},{name:"Info",id:2},{name:"Warn",id:3},{name:"Error",id:4},{name:"Fatal",id:5}]},{name:"Metric",values:[{name:"RoundTripTime",id:0},{name:"DownlinkThroughputCapacity",id:26},{name:"Initialized",id:1},{name:"Provisioned",id:2},{name:"SetupCompleted",id:3},{name:"Offset",id:4},{name:"TimeToFirstFrame",id:5},{name:"Playing",id:6},{name:"Stalled",id:7},{name:"Buffering",id:8},{name:"Seeking",id:22},{name:"Stopped",id:9},{name:"BitRateAdaptation",id:10},{name:"ResolutionChanged",id:11},{name:"DisplayResolutionChanged",id:23},{name:"VideoBitRate",id:28},{name:"AudioBitRate",id:29},{name:"FrameRateChanged",id:12},{name:"FramesDropped",id:13},{name:"PacketsLost",id:14},{name:"PictureLost",id:15},{name:"PlayoutDelayChanged",id:16},{name:"CodecChanged",id:17},{name:"PlayerEvent",id:21},{name:"MetricDropped",id:18},{name:"NetworkOffline",id:19},{name:"NetworkOnline",id:20},{name:"NetworkType",id:27},{name:"ApplicationForeground",id:24},{name:"ApplicationBackground",id:25}]}]}}.apply(e,[]))||(t.exports=e)},function(t,e,n){n=[n(3)];void 0===(n=function(t){"use strict";function e(){this.init()}return e.prototype.init=function(){if(!t.global.AudioContext&&!t.global.webkitAudioContext)throw new Error("Browser does not support AudioContext");this.me=new(t.global.AudioContext||t.global.webkitAudioContext)},e.prototype.getNativeAudioContext=function(){return this.me},e.prototype.toString=function(){return"AudioContext"},e}.apply(e,n))||(t.exports=n)},function(t,e,n){n=[n(0),n(1),n(4),n(3),n(34),n(22)];void 0===(n=function(b,r,o,k,S,a){"use strict";function t(t,e,n){r.e(t,"name"),r.a(e,"peerConnection"),r.a(n,"logger"),this.ve=t,this.ge=e,this.X=n,this.Yt={}}function E(t){var e=R(t),t=I(t);if(0===e.length||0===t.length)return 0!==e.length?e:0!==t.length?t:[];var n=[];return b.forEach(e,function(t){n.push(t)}),b.forEach(t,function(t){n.push(t)}),n}function R(t){var e=t.getSenders?b.map(t.getSenders(),function(t){return t.track}):[];return 0!==(e=b.filter(e,function(t){return!b.isNullOrUndefined(t)})).length?e:(t=t.getLocalStreams?t.getLocalStreams():[],b.reduce(t,function(t,e){return t.concat(e.getTracks())},[]))}function I(t){var e=t.getReceivers?b.map(t.getReceivers(),function(t){return t.track}):[];return 0!==(e=b.filter(e,function(t){return!b.isNullOrUndefined(t)})).length?e:(t=t.getRemoteStreams?t.getRemoteStreams():[],b.reduce(t,function(t,e){return t.concat(e.getTracks())},[]))}function T(e,t){var t=b.filter(t,function(t){return t.kind===e}),n=b.filter(this.ye,function(t){return t.kind===e});return b.reduce(t,function(t,e){return t&&(t=!!b.find(n,function(t){return t.id===e.id}),!e.enabled||t)},!0)}return t.prototype.start=function(t,e,n){if(r.a(t,"options"),r.h(e,"activeCallback"),r.h(n,"monitorCallback"),"inbound"!==t.direction&&"outbound"!==t.direction)throw new Error("Invalid monitoring direction");var i;if(i=!Object.prototype.hasOwnProperty.call(t,"monitoringInterval")||0<t.monitoringInterval)return this.we=t.frameRateThreshold||2,this.be=t.videoBitRateThreshold||1e3,this.ke=t.audioBitRateThreshold||5e3,this.Se=t.conditionCountForNotificationThreshold||3,this.Ee=Math.max(500,t.monitoringInterval||4e3),this.Re=Math.max(500,t.conditionMonitoringInterval||1500),this.Ie=!Object.prototype.hasOwnProperty.call(t,"monitorFrameRate")||t.monitorFrameRate,this.Te=!Object.prototype.hasOwnProperty.call(t,"monitorBitRate")||t.monitorBitRate,this.Ce=!Object.prototype.hasOwnProperty.call(t,"monitorState")||t.monitorState,this.ye=[],this.Me=new o.Event,"Edge"===k.browser&&(i=this.Re*this.Se,this.Ee=Math.max(this.Ee,6e3),this.Re=Math.max(this.Re,6e3),this.Se=Math.max(Math.ceil(i/this.Ee),2),this.X.info("Using modified options for optimal monitoring of PeerConnection on [Edge]. Monitor Interval [%s], Condition Monitor Interval [%s], Condition Count For Notification [%s]",this.Ee,this.Re,this.Se)),function(h,f,d,l,p){var m=this,v=0,g=void 0,y=void 0,w=void 0;setTimeout(function c(){!function(t,e,n,i,r,o){if(!i())return this.X.info("[%s] Finished monitoring of peer connection",this.ve);var s=this;k.getStats(t,null,function(t){t=a.convertPeerConnectionStats(t,s.Yt),t=b.filter(t,function(t){return"inbound"===e.direction&&"download"===t.direction||"outbound"===e.direction&&"upload"===t.direction}),r(t)},function(t){o(t)})}.call(m,f,d,null,l,function(t){var e=!1,n=!1,i=!1;if(!l())return m.X.info("[%s] Finished monitoring of peer connection",h);if(!t)throw new Error("Report must be a valid PeerConnection.getStats Report");if(b.forEach(t,function(t){if("outbound"===d.direction&&"upload"===t.direction)switch(t.mediaType){case"video":m.X.debug("[%s] [%s] [%s] [%s] with RTT [%s], bitrate [%s], dropped frames [%s], frame rate [%s] and average encoding time [%s] ms (CPU limited=[%s])",h,d.direction,t.mediaType,t.ssrc,t.rtt,t.bitrateMean,t.droppedFrames,t.framerateMean,t.avgEncode,t.cpuLimitedResolution),g=t.framerateMean,y=t.uploadRate&&1e3*t.uploadRate,n=e=!0,d.setNetworkRTT&&d.setNetworkRTT(t.rtt),"Edge"===k.browser&&(e=!1);break;case"audio":m.X.debug("[%s] [%s] [%s] [%s] with RTT [%s], jitter [%s] and audio input level [%s]",h,d.direction,t.mediaType,t.ssrc,t.rtt,t.jitter,t.audioInputLevel),i=!0,w=t.uploadRate&&1e3*t.uploadRate,d.setNetworkRTT&&d.setNetworkRTT(t.rtt)}if("inbound"===d.direction&&"download"===t.direction)switch(t.mediaType){case"video":m.X.debug("[%s] [%s] [%s] [%s] with framerate [%s], current delay [%s] ms and target delay [%s] ms",h,d.direction,t.mediaType,t.ssrc,t.framerateMean,t.currentDelay,t.targetDelay),e=!0,g=t.framerateMean||0,n=!0,y=t.downloadRate&&1e3*t.downloadRate,"Edge"===k.browser&&(e=!1);break;case"audio":m.X.debug("[%s] [%s] [%s] [%s] with jitter [%s], jitter buffer [%s] ms, audio output level [%s], total audio energy [%s] and total samples duration [%s]",h,d.direction,t.mediaType,t.ssrc,t.jitter,t.jitterBuffer,t.audioOutputLevel,t.totalAudioEnergy,t.totalSamplesDuration),i=!0,w=t.downloadRate&&1e3*t.downloadRate}}),b.isUndefined(w)&&b.isUndefined(y))return setTimeout(c,m.Ee);var r=S.hasActiveAudio(f),o=S.hasActiveVideo(f);(n&&0===y||i&&0===w||e&&0===g)&&(n=n&&o,i=i&&r,e=e&&o),(i||n||e)&&(m.X.debug("[%s] [%s] Current bit rate is [%s] bps for audio and [%s] bps for video with [%s] FPS",h,d.direction,Math.ceil(w||0),Math.ceil(y||0),g||"?"),0<b.values(m.Yt).length&&m.Me.fire([{videoBitRate:y,audioBitRate:w,frameRate:g}]));var s=[];if(m.Ce&&("closed"===f.connectionState||"disconnected"===f.connectionState||"failed"===f.connectionState||"disconnected"===f.iceConnectionState||"failed"===f.iceConnectionState)){var a=r&&o,u=E.call(m,f);if(!a&&S.hasMediaSectionsInLocalSdp(f))return void m.X.info("[%s] [%s] Finished monitoring of peer connection with [%s] inactive tracks",h,d.direction,u.length);s.push("connection")}u=("outbound"===d.direction?R:I).call(this,f),m.Ie&&e&&g<=m.we&&!T.call(m,"video",u)&&s.push("frameRate"),m.Te&&i&&w<=m.ke&&!T.call(m,"audio",u)&&s.push("audioBitRate"),m.Te&&n&&y<=m.be&&!T.call(m,"video",u)&&s.push("videoBitRate"),0===y&&o&&!T.call(m,"video",u)&&s.push("noVideoData"),0===w&&r&&!T.call(m,"audio",u)&&s.push("noAudioData"),r=function(){m.X.info("[%s] [%s] Failure has been acknowledged",h,d.direction),v=Number.MIN_VALUE,setTimeout(c,m.Ee)},0<s.length?v++:v=0,v>=m.Se?(u="["+h+"] ["+d.direction+"] Failure detected with frame rate ["+g+"] FPS, audio bit rate ["+w+"] bps, video bit rate ["+y+"] bps, connection state ["+f.connectionState+"], and ice connection state ["+f.iceConnectionState+"] after ["+v+"] checks",p(null,{type:"condition",reasons:s,message:u,report:t,frameRate:g,videoBitRate:y,audioBitRate:w,acknowledgeFailure:r})?r():m.X.info(u+": [%s]",t)):setTimeout(c,0<v?m.Re:m.Ee)},function(t){p(t,{type:"error",message:"Unable to get Connection statistics. Connection may have failed."})})},m.Ee)}.call(this,this.ve,this.ge,t,e,n);this.X.info("[%s] Monitoring is disabled",name)},t.prototype.setMonitorTrackState=function(e,t){r.a(e,"track"),r.f(t,"state");try{var n=E.call(this,this.ge);if(!b.find(n,function(t){return t.id===e.id}))return this.X.warn("[%s] Unable to find track [%s] [%s] in peer connection",this.ve,e.kind,e.id)}catch(t){"Firefox"===k.browser&&"InvalidStateError: Peer connection is closed"===t.message?this.X.debug("Failed to verify monitor track due to closed peer connection"):this.X.warn("Failed to verify monitor track due to [%s]",t.message)}if(!t)return this.X.info("[%s] Pausing monitoring of track [%s] [%s]",this.ve,e.kind,e.id),this.ye.push(e);t=this.ye.length,this.ye=b.filter(this.ye,function(t){return t.id!==e.id}),t!==this.ye.length&&this.X.info("[%s] Starting monitoring of track [%s] [%s] after it was paused",this.ve,e.kind,e.id)},t.prototype.on=function(t,e){if(r.g(t,"eventName"),r.h(e,"listener"),"calculatedmetrics"!==t)throw new Error("Unsupported event "+t);return this.Me.listen(e)},t.prototype.toString=function(){return"PeerConnectionMonitor["+this.ve+"]"},t}.apply(e,n))||(t.exports=n)},function(t,e,n){n=[n(0),n(1)];void 0===(n=function(o,s){"use strict";var a=/profile-level-id=[^;\n]*/,n=/vp8/i,i=/vp9/i,r=/h264/i,u=/h265/i;function t(){}return t.prototype.getH264ProfileIds=function(t){s.g(t,"offerSdp");for(var e=[],n=t.match(a),i=t;n;){var r=o.get(n,"0","");e.push(r.split("=")[1]),n=(i=i.substring(n.index+r.length,t.length)).match(a)}return e},t.prototype.replaceH264ProfileId=function(t,e,n){s.g(t,"offerSdp"),s.g(n,"newProfileId");var i=this.getH264ProfileIds(t);return o.includes(i,e)?t.replace("profile-level-id="+e,"profile-level-id="+n):t},t.prototype.getH264ProfileIdWithSameProfileAndEqualToOrHigherLevel=function(t,e){return o.includes(t,e)?e:(t=o.reduce(t,function(t,e){var n=parseInt(t.substring(0,2),16),i=parseInt(t.substring(4,6),16),r=parseInt(e.substring(0,2),16),o=parseInt(e.substring(4,6),16);return n!==r||o<=i?t:e},e))===e?null:t},t.prototype.getH264ProfileIdWithSameOrHigherProfileAndEqualToOrHigherLevel=function(t,e){var n=this.getH264ProfileIdWithSameProfileAndEqualToOrHigherLevel(t,e);return n||((t=o.reduce(t,function(t,e){var n=parseInt(t.substring(0,2),16),i=parseInt(t.substring(4,6),16),r=parseInt(e.substring(0,2),16),o=parseInt(e.substring(4,6),16);return n<r||!(r<n||o<i)?e:t},e))===e?null:t)},t.prototype.getSupportedCodecs=function(t){s.g(t,"offerSdp");var e=[];return n.test(t)&&e.push("VP8"),i.test(t)&&e.push("VP9"),r.test(t)&&e.push("H264"),u.test(t)&&e.push("H265"),e},t.prototype.hasMediaSectionsInLocalSdp=function(t){return this.findInSdpSections(t,function(t){return o.startsWith(t,"video")||o.startsWith(t,"audio")})<0},t.prototype.hasActiveAudio=function(t){return this.findInSdpSections(t,function(t,e,n){return!!o.startsWith(t,"audio")&&!o.includes(t,"a=inactive")&&!o.includes(n[e],"a=inactive")})<0},t.prototype.hasActiveVideo=function(t){return this.findInSdpSections(t,function(t,e,n){return!!o.startsWith(t,"video")&&!o.includes(t,"a=inactive")&&!o.includes(n[e],"a=inactive")})<0},t.prototype.findInSdpSections=function(t,n){var e=this.getLocalSdp(t).split("m="),i=this.getRemoteSdp(t).split("m=");return e.length===i.length&&o.findIndex(e,function(t,e){return n(t,e,i)})},t.prototype.getNumberOfActiveSections=function(t){return t=(this.getLocalSdp(t)||this.getRemoteSdp(t)).split("m="),o.filter(t,function(t){return!o.includes(t,"a=inactive")&&(o.startsWith(t,"audio")||o.startsWith(t,"video"))}).length},t.prototype.getLocalSdp=function(t){return o.get(t,["localDescription","sdp"],"")},t.prototype.getRemoteSdp=function(t){return o.get(t,["remoteDescription","sdp"],"")},t.prototype.setGroupLineOrderToMatchMediaSectionOrder=function(n){var t=n.match(/(?=a=group:BUNDLE).*/),e=o.get(o.get(t,[0],"").split("a=group:BUNDLE "),[1],"");return n=0<(t=e.split(" ").sort(function(t,e){return n.indexOf("m="+t)-n.indexOf("m="+e)})).length?n.replace(e,t.join(" ")):n},new t}.apply(e,n))||(t.exports=n)},function(t,e,n){n=[n(0),n(1),n(4),n(3),n(97),n(98),n(99),n(6)];void 0===(n=function(i,n,u,r,t,o,s,a){"use strict";function e(t,e,n,i,r,o,s,a){this.ct=t,this.dt=e,this.ut=n,this.Pe=i,this.C=r,this.Oe=o,this.xe=s,this.X=a,this.qe=[],this.De=null,this.ne=new u.NamedEvents}return e.prototype.on=function(t,e){this.ne.listen(t,e)},e.prototype.createRenderer=function(){var e=null;switch(this.ct){case a.types.dash.name:if(this.xe)e=new o(this.dt,this.ut,this.Pe,this.C,this.xe,this.X);else if(this.Oe){if(!this.Oe.Player.isBrowserSupported())throw this.X.warn("[%s] Shaka does not support this browser",this.dt),new Error("Shaka does not support this browser");e=new t(this.dt,this.ut,this.Pe,this.C,this.Oe,this.X)}break;case a.types.hls.name:e=new o(this.dt,this.ut,this.Pe,this.C,this.xe,this.X);break;case a.types.rtmp.name:e=new s(this.dt,this.ut,this.Pe,this.C,this.X);break;default:throw new Error("Unsupported Live stream Type "+this.ct)}var n=this;return e.on(a.rendererEvents.error.name,function(t,e){n.ne.fire(a.streamEvents.playerError.name,[t,e])}),e.on(a.rendererEvents.ended.name,function(t){n.qe=i.filter(n.qe,function(t){return t!==e}),0===n.qe.length&&(n.Pe.stop(),n.ne.fire(a.streamEvents.playerEnded.name,[t]))}),this.qe.push(e),e},e.prototype.select=function(t){return this.X.warn("[%s] selection of tracks not supported for [%s] live streams",this.dt,this.ct),this},e.prototype.setStreamEndedCallback=function(t){n.h(t,"callback"),this.streamEndedCallback=t},e.prototype.setStreamErrorCallback=function(t){n.h(t,"callback"),this.streamErrorCallback=t},e.prototype.stop=function(t){this.isActive()&&(this.X.info("[%s] stop [live] media stream with reason [%s]",this.dt,t),this.ne.fire(a.streamEvents.stopped.name,[t]),this.Ae=!0)},e.prototype.monitor=function(t,e){n.a(t,"options"),n.h(e,"callback")},e.prototype.getMonitor=function(){return null},e.prototype.addBitRateThreshold=function(t,e){n.h(e,"callback")},e.prototype.getStream=function(){return this.X.debug("[%s] [%s] This type of stream has no internal stream object",this.dt,this.ct),null},e.prototype.isActive=function(){return!this.Ae},e.prototype.getStreamId=function(){return this.dt},e.prototype.getStats=function(){return this.X.debug("[%s] [%s] This type of stream has no stats",this.dt,this.ct),null},e.prototype.getRenderer=function(){return i.get(this.qe,[0],null)},e.canPlaybackType=function(t){var e=!!r.global.MediaSource,n=e||"object"==typeof document&&"maybe"===document.createElement("video").canPlayType("application/vnd.apple.mpegURL");switch(t){case a.types.dash.name:return e;case a.types.hls.name:return n;case a.types.rtmp.name:return s.isSupported();default:return!1}},e}.apply(e,n))||(t.exports=n)},function(t,e,n){n=[n(0),n(1)];void 0===(n=function(l,i){"use strict";function t(t,e,n){i.g(t,"name"),i.a(e,"monitor"),i.h(n,"getLimit"),this.ve=t,this.Ue=e,this.je=n||l.noop}return t.prototype.addThreshold=function(t,c){var h=function(t){var e=[];if(l.isArray(t))l.forEach(t,function(t){i.u(t,"threshold")}),e=t.sort();else if(l.a(t)){i.u(t.levels,"threshold.levels");for(var n=0;n<t.levels;n++)e.push(n/t.levels)}else i.u(t,"threshold"),e.push(t);return e.push(3),e}(t),f=null,d=this;return d.Ue.on("calculatedmetrics",function(t){var i,r,e=d.je(),n=t.videoBitRate+t.audioBitRate,o=(r=n/e,l.reduce(i=h,function(t,e,n){return null===t&&r<=e||e<i[t]&&r<=e?n:t},null)),s=l.get(h,[o]),a=s*e,u=l.get(h,[f],1),t=u*e;if(0!==e)return null===f?f=o:void(o!==f&&(o<f?c({isIncreasing:!1,bitRate:n,currentThreshold:a,targetBitRate:e,index:o,lastIndex:f,message:d.ve+" bit rate is below "+s+" * "+e+" threshold of "+a+" with a bit rate of "+n}):f<o&&c({isIncreasing:!0,bitRate:n,currentThreshold:t,targetBitRate:e,index:o,lastIndex:f,message:d.ve+" bit rate is above "+u+" * "+e+" threshold of "+t+" with a bit rate of "+n}),f=o))})},t}.apply(e,n))||(t.exports=n)},function(t,e,n){n=[n(0),n(1),n(5),n(2),n(38),n(39),n(102),n(40),n(103),n(16),n(15)];void 0===(n=function(h,o,s,a,e,r,n,u,t,i,c){"use strict";var f=h.freeze({status:"not-in-room"}),d=h.freeze({status:"already-in-room"}),l=h.freeze({status:"in-another-room"});function p(t){this.Ne=new s.Observable(null),this.Fe=new s.Observable(null),this.Le=new s.Observable(null),this.Be=null,this._e=new e(t),this.setPCast(t)}function m(){this.Ne.setValue(null),this.Fe.setValue(null),this.Le.setValue(null),this.Be=null,this.P&&this.P.dispose(),this.P=null}function v(t){o.a(t,"event"),o.e(t.roomId,"event.roomId"),o.e(t.eventType,"event.eventType"),o.isArray(t.members,"event.members"),h.forEach(t.members,function(t){o.a(t,"member")});var e=this;switch(t.eventType){case i.events.memberJoined.name:return e.X.debug("[%s] Member joined [%s]",t.roomId,t.members),function(t,e){var n,i=this.Fe.getValue(),r=this.Le.getValue();i&&i.getRoomId()===t&&(i.We(e),i.Ve(e),r.We(e),r.Ve(e),n=this,r=h.find(e,function(t){return t.sessionId===n.getSelf().getSessionId()}),e=!1,r&&(e=C.call(n,i),i.ze([r])),this.X.info("[%s] Room has now [%d] members (Self is present in room [%s])",t,i.getObservableMembers().getValue().length,e))}.call(e,t.roomId,t.members);case i.events.memberLeft.name:return e.X.debug("[%s] Member left [%s]",t.roomId,t.members),function(t,e){var n,i,r,o=this.Fe.getValue(),s=this.Le.getValue();o&&o.getRoomId()===t&&(n=this,i=h.find(e,function(t){return t.sessionId===n.getSelf().getSessionId()}),(r=this.getSelf())&&i&&r.getObservableLastUpdate().setValue(i.lastUpdate),o.We(e),s.We(e),this.X.info("[%s] Room has now [%d] members",t,o.getObservableMembers().getValue().length))}.call(e,t.roomId,t.members);case i.events.memberUpdated.name:return e.X.debug("[%s] Member updated [%s]",t.roomId,t.members),function(t,e){var n,i=this.Fe.getValue(),r=this.Le.getValue();i&&i.getRoomId()===t&&(n=function(t){var n=this;return h.map(t,function(t){var e=w(t.sessionId,n.Le);return(e=S(new u(n,t.state,t.sessionId,t.screenName,t.role,t.streams,t.lastUpdate),e)).lastUpdate=t.lastUpdate,e})}.call(this,e),i.ze(n),r.ze(n),this.X.info("[%s] Room has [%d] updated members",t,e.length))}.call(e,t.roomId,t.members);case i.events.roomUpdated.name:return e.X.debug("[%s] Room updated [%s]",t.roomId,t.room),function(t,e){var n=this.Fe.getValue(),i=this.Le.getValue();n&&n.getRoomId()===t&&(i.lt(e),n.lt(e))}.call(e,t.roomId,t.room);case i.events.roomEnded.name:e.X.info("[%s] Room ended",t.roomId);break;default:e.X.warn("Unsupported room event [%s]",t.eventType)}}function g(t){this.getSelf()&&this.getSelf().getSessionId()===(t||"")?this.X.info("[%s] Skip session ID change since it is the same as in self model",t):function(t){var e=this.Ne.getValue().toJson();this.X.info("Resetting self after sessionId changed to [%s]",t),this.Ne.setValue(new u(this,e.state,t||"",e.screenName,e.role,e.streams,e.lastUpdate))}.call(this,t)}function y(t){var n,i=this;t&&(!t.getSessionId()||(n=i.Fe.getValue())&&(i.X.info("[%s] Updating self in room after update",n.getRoomId()),R.call(this,this.getSelf(),function(t,e){"ok"===h.get(e,["status"])?i.X.info("[%s] Updated self in room after update",n.getRoomId()):i.X.info("[%s] Self was not updated in room after update",n.getRoomId())})))}function w(t,e){var e=e.getValue().getObservableMembers().getValue(),n=t;return h.find(e,function(t){return n===t.getSessionId()})}function b(t){this.X.info("PCast status changed from [%s] to [%s]",this.Ge,t),"online"===(this.Ge=t)&&function(){var t,e,n,i=this,r=i.Fe.getValue();!h.a(r)||(t=i.Ne.getValue())&&t.getSessionId()&&(e=r.getRoomId(),n=r.getObservableAlias().getValue(),i.X.info("[%s] Re-entering room [%s]",e,n),i.Be&&(i.X.info("Performing soft reset on room chat service for room [%s]",e),i.Be.stop()),E.call(i,e,n,function(){i.Be&&(i.X.info("[%s] Refreshing room chat service after re-entering room [%s]",e,n),i.Be.start(i.Be.getBatchSize())),i.X.info("[%s] Room [%s] completed reset",e,n)},{reenter:!0}))}.call(this)}function k(){var t=this.Nt.onEvent("chat.RoomEvent",h.bind(v,this)),e=this.Ne.subscribe(h.bind(y,this)),n=this._e.getObservableStatus().subscribe(h.bind(b,this)),i=this._e.getObservableSessionId().subscribe(h.bind(g,this));this.P.add(t),this.P.add(e),this.P.add(n),this.P.add(i)}function S(t,e){var n=function(t,e){if(!e)return t.toJson();var n={},i=t.toJson(),e=e.toJson(),e=h.findDifferences(i,e,!0);return h.forEach(e,function(t){n[t]=i[t]}),n}(t,e);return n.sessionId=t.getSessionId(),n.lastUpdate=e?e.getLastUpdate():h.now(),n}function E(n,i,r,t){var e=!0===h.get(t,"reenter"),o=this.Fe.getValue();if(o&&((a=n===o.getRoomId()||i===o.getObservableAlias().getValue())&&!e))return this.X.info("Unable to join room. Already in [%s]/[%s] room.",o.getRoomId(),o.getObservableAlias().getValue()),r(null,h.assign({room:o},a?d:l));this._e.assertAuthorized();var s=(u=this.Ne.getValue()).getObservableScreenName().getValue(),t=u.getObservableRole().getValue(),o=S.call(this,u,null),a=[],u=h.now();e&&a.push("reenter"),this.X.info("Enter room [%s]/[%s] with screen name [%s] and role [%s]",n,i,s,t);var c=this;c.Je?c.X.info("[%s] We are already entering the room [%s], skipping",n,i):(c.Je=!0,this.Nt.enterRoom(n,i,o,a,u,function(t,e){return c.Je=!1,t?(c.X.error("Joining of room failed with error [%s]",t),r(t,null)):(t={status:e.status},"ok"!==e.status?(c.X.warn("Joining of room failed with status [%s]",e.status),r(null,t)):(t.room=function(t){var e=this.Fe.getValue(),n=this.Le.getValue(),i=T.call(this,t),r=T.call(this,t);return C.call(this,i),e&&n?(this.X.debug("[%s] Updating existing room model.",e.getRoomId()),e.lt(t.room),n.lt(t.room),e.getObservableMembers().setValue(i.getObservableMembers().getValue()),n.getObservableMembers().setValue(r.getObservableMembers().getValue()),e):(this.Fe.setValue(i),this.Le.setValue(r),i)}.call(c,e),"ok"===e.status&&e.self&&c.getSelf().lt(e.self),c.X.info("Successfully entered room [%s]/[%s]",n,i),void r(null,t)))}))}function R(t,n){if(!this.Fe.getValue())return this.X.warn("Not in a room. Please Enter a room before updating member."),n(null,f);this._e.assertAuthorized();var e=this.Fe.getValue().getRoomId(),i=t.getSessionId()===this.getSelf().getSessionId(),r=w(t.getSessionId(),this.Le),o=S.call(this,t,r),s=h.now(),a=i&&o.role===c.roles.audience.name;i&&!r&&(o.lastUpdate=t.getObservableLastUpdate().getValue()),this.X.info("Updating member info [%s] for active room [%s]",o,e);var u=this;this.Nt.updateMember(e,o,s,function(t,e){return t?(u.X.error("Update of member failed with error [%s]",t),n(t,null)):(t={status:e.status,lastUpdate:e.lastUpdate},"ok"!==e.status&&u.X.info("Update of member failed with status [%s]",e.status),"ok"===e.status&&a&&h.u(e.lastUpdate)&&u.getSelf().getObservableLastUpdate().setValue(e.lastUpdate),void n(null,t))})}function I(t){var e=t.room,t=t.members||[];return new n(this,e.roomId,e.alias,e.name,e.description,e.type,t,e.bridgeId,e.pin)}function T(t){var e=t.room,t=t.members;return new r(this,e.roomId,e.alias,e.name,e.description,e.type,t,e.bridgeId,e.pin)}function C(t){var e=this.Ne.getValue(),n=t.getObservableMembers().getValue(),i=h.findIndex(n,function(t){return e.getSessionId()===t.getSessionId()});return i<0?(this.X.debug("Self not in server room model."),!1):(e.lt(n[i].toJson()),n[i]=e,t.getObservableMembers().setValue(n),!0)}return p.prototype.setPCast=function(t){o.a(t,"pcast"),o.h(t.getLogger,"pcast.getLogger"),o.h(t.getProtocol,"pcast.getProtocol"),this.He&&this.X.info("Resetting pcast instance for room service"),this.He=t,this.X=t.getLogger(),this.Nt=t.getProtocol(),o.a(this.X,"this._logger"),o.a(this.Nt,"this._protocol"),this._e.setPCast(t),this.Be&&this.Be.setPCast(t),this.Ht&&(this.P.dispose(),k.call(this))},p.prototype.start=function(t,e){if(!this.Ht){o.g(t,"role"),o.g(e,"screenName");var n=c.states.passive.name,i=this._e.getPCastSessionId(),r=e,e=h.now(),e=new u(this,n,i,r,t,[],e);return this.Ne=new s.Observable(e),this.P=new a.DisposableList,k.call(this),this.Ht=!0,e}this.X.warn("RoomService already started.")},p.prototype.getRoomInfo=function(t,e,n){t?o.g(t,"roomId"):o.g(e,"alias"),o.h(n,"callback"),function(t,e,n){this._e.assertAuthorized();var i=this;this.Nt.getRoomInfo(t,e,function(t,e){return t?(i.X.error("Request to get room info failed with error [%s]",t),n(t,null)):(t={status:e.status},"ok"!==e.status?(i.X.warn("Request to get room info failed with status [%s]",e.status),n(null,t)):(t.room=h.freeze(I.call(i,e)),void n(null,t)))})}.call(this,t,e,n)},p.prototype.createRoom=function(t,e){o.a(t,"room"),o.g(t.name,"room.name"),o.g(t.type,"room.type"),o.e(t.description,"room.description"),o.h(e,"callback"),function(t,n){this._e.assertAuthorized();var i=this,t=function(t){return new r(this,"",t.alias,t.name,t.description,t.type,[],t.bridgeId,t.pin).toJson()}.call(i,t);this.Nt.createRoom(t,function(t,e){return t?(i.X.error("Creating room failed with error [%s]",t),n(t,null)):(t={status:e.status},"ok"!==e.status&&"already-exists"!==e.status?(i.X.warn("Creating room failed with status [%s]",e.status),n(null,t)):(t.room=h.freeze(I.call(i,e)),void n(null,t)))})}.call(this,t,e)},p.prototype.enterRoom=function(t,e,n){t?o.g(t,"roomId"):o.g(e,"alias"),o.h(n,"callback"),E.call(this,t,e,n)},p.prototype.leaveRoom=function(t,e){return function(n,i){var t,r,e=this.Fe.getValue();if(h.f(i)||(i=!0),!e)return this.X.info("Not currently in a room."),n(null,f);""!==this._e.getPCastSessionId()&&null!==this._e.getPCastSessionId()?this.Ke||(this._e.assertAuthorized(),t=e.getRoomId(),e=h.now(),this.X.info("Leave room [%s]",t),(r=this).Ke=!0,setTimeout(function(){r.Fe.setValue(null),r.Le.setValue(null),i&&(r.Ke=!1,n(null,{status:"ok"}))}),this.Nt.leaveRoom(t,e,function(t,e){return r.Ke=!1,t?(r.X.error("Leaving room failed with error [%s]",t),i?void 0:n(t,null)):("ok"!==e.status&&r.X.warn("Leaving room failed with status [%s]",e.status),i?void 0:n(null,{status:e.status}))})):this.X.warn("Unable to leave room. We are currently not connected. Status [%s]",this.Ge)}.call(this,t,e)},p.prototype.getChatService=function(){return!this.Be&&this.Fe.getValue()&&(this.Be=new t(this)),this.Be},p.prototype.getSelf=function(){return this.Ne.getValue()},p.prototype.getObservableActiveRoom=function(){return this.Fe},p.prototype.updateSelf=function(t){o.h(t,"callback"),R.call(this,this.getSelf(),t)},p.prototype.updateMember=function(t,e){o.h(e,"callback"),o.a(t,"member"),R.call(this,t,e)},p.prototype.updateRoom=function(t){o.h(t,"callback"),function(n){if(!this.Fe.getValue())return this.X.warn("Not in a room. Please Enter a room before updating member."),n(null,f);this._e.assertAuthorized();var t=this.Fe.getValue(),e=h.now(),i=this;this.Nt.updateRoom(t.toJson(),e,function(t,e){return t?(i.X.error("Update of room failed with error [%s]",t),n(t,null)):(t={status:e.status},"ok"!==e.status&&i.X.warn("Update of room failed with status [%s]",e.status),void n(null,t))})}.call(this,t)},p.prototype.revertRoomChanges=function(){var t=this.Fe.getValue(),e=this.Le.getValue();if(!t||!e)return this.X.warn("Unable to revert changes to room. Not currently in a room.");t.lt(e.toJson())},p.prototype.revertMemberChanges=function(t){o.a(t,"member");var e=w(t.getSessionId(),this.Le),t=w(t.getSessionId(),this.Fe);if(!e||!t)return this.X.warn("Unable to revert changes to member. Member is currently not in room.");t.lt(e.toJson())},p.prototype.isInRoom=function(){return!!this.Fe.getValue()},p.prototype.toString=function(){return"RoomService"},p.prototype.stop=function(t){var e=this.Fe.getValue(),n=this;if(this.X.info("Stopping room service with reason [%s]",t),e)return this.leaveRoom(function(t,e){t&&n.X.warn("Failure to stop room service. Unable to leave room",t),e&&"ok"!==e.status&&n.X.warn("Failure to stop room service. Unable to leave room. Status: [%s]",e.status),e&&"ok"===e.status&&(m.call(n),n.Ht=!1)});m.call(this),n.Ht=!1},p}.apply(e,n))||(t.exports=n)},function(t,e,n){n=[n(0),n(1)];void 0===(n=function(t,e){"use strict";function n(t){this.setPCast(t)}function i(t){return null!=t&&""!==t}function r(t){return null!=t&&""!==t&&"offline"!==t.toLowerCase()}return n.prototype.setPCast=function(t){e.a(t,"pcast"),e.h(t.getObservableStatus,"pcast.getObservableStatus"),e.h(t.getLogger,"pcast.getLogger"),e.h(t.getProtocol,"pcast.getProtocol"),t!==this.He&&(this.He=t,this.X=t.getLogger(),this.Nt=t.getProtocol(),e.a(this.X,"this._logger"),e.a(this.Nt,"this._protocol"),e.h(this.Nt.getObservableSessionId,"this._protocol.getObservableSessionId"),e.h(this.He.getObservableStatus,"this._pcast.getObservableStatus"),this.Qe=this.Nt.getObservableSessionId(),this.Xe=this.He.getObservableStatus())},n.prototype.checkAuthorized=function(){return!!r(this.getPCastStatus())&&!!i(this.getPCastSessionId())},n.prototype.assertAuthorized=function(){if(!r(this.getPCastStatus()))throw new Error("Unable to perform action. Status ["+this.getPCastStatus()+"]. Please wait to reconnect.");if(!i(this.getPCastSessionId()))throw new Error("Unable to perform action. Invalid sessionId ["+this.getPCastSessionId()+"] with status ["+this.getPCastStatus()+"]")},n.prototype.getObservableSessionId=function(){return this.Qe},n.prototype.getObservableStatus=function(){return this.Xe},n.prototype.getPCastSessionId=function(){return this.Qe.getValue()},n.prototype.getPCastStatus=function(){return this.Xe.getValue()},n}.apply(e,n))||(t.exports=n)},function(t,e,n){n=[n(0),n(1),n(5),n(40),n(16)];void 0===(n=function(i,c,h,n,t){"use strict";var e=t.types;function r(t,e,n,i,r,o,s,a,u){this.init(t,e,n,i,r,o,s,a,u)}function f(t,e){return i.map(t,function(t){return new n(e,t.state,t.sessionId,t.screenName,t.role,t.streams,t.lastUpdate)})}function d(t){if(!(t=i.getEnumName(e,t)))throw new Error('"type" must be a valid room type');return t}return r.prototype.init=function(t,e,n,i,r,o,s,a,u){c.a(t,"roomService"),c.g(i,"name"),c.e(r,"description"),c.isArray(s,"members"),e&&c.g(e,"id"),n&&c.g(n,"alias"),a&&c.g(a,"bridgeId"),u&&c.g(u,"pin"),this.Ze=new h.Observable(e),this.$e=new h.Observable(n),this.ve=new h.Observable(i),this.Ye=new h.Observable(r),this.ct=new h.Observable(o,d),this.tn=new h.ObservableArray([]).extend({method:"notifyWhenChangesStop",timeout:400}),this.C=new h.ObservableArray,this.en=new h.Observable(a),this.nn=new h.Observable(u),this.in=t,function(t){t=f(t,this.in),this.tn.setValue(t)}.call(this,s)},r.prototype.getRoomId=function(){return this.Ze.getValue()},r.prototype.getObservableAlias=function(){return this.$e},r.prototype.getObservableName=function(){return this.ve},r.prototype.getObservableDescription=function(){return this.Ye},r.prototype.getObservableType=function(){return this.ct},r.prototype.getObservableMembers=function(){return this.tn},r.prototype.getObservableBridgeId=function(){return this.en},r.prototype.getObservablePin=function(){return this.nn},r.prototype.toString=function(){return this.ct.getValue()+"["+this.Ze.getValue()+"]"},r.prototype.toJson=function(){return{roomId:this.Ze.getValue(),alias:this.$e.getValue(),name:this.ve.getValue(),description:this.Ye.getValue(),type:this.ct.getValue(),pin:this.nn.getValue(),bridgeId:this.en.getValue()}},r.prototype.commitChanges=function(t){c.a(this.in,"this._roomService"),this.in.updateRoom(this,t)},r.prototype.reload=function(){c.a(this.in,"this._roomService"),this.in.revertRoomChanges(this)},r.prototype.lt=function(t){i.a(t)&&(t.roomId&&this.Ze.setValue(t.roomId),t.alias&&this.$e.setValue(t.alias),t.name&&this.ve.setValue(t.name),t.description&&this.Ye.setValue(t.description),t.type&&this.ct.setValue(t.type),t.options&&this.C.setValue(t.options),t.bridgeId&&this.en.setValue(t.bridgeId),t.pin&&this.nn.setValue(t.pin),t.members)},r.prototype.Ve=function(t){var e=this,t=f(t,this.in);i.forEach(t,function(t){e.tn.push(t)})},r.prototype.We=function(t){var n=this;i.forEach(t,function(e){n.tn.remove(function(t){return e.sessionId===t.getSessionId()&&e.lastUpdate>=t.getObservableLastUpdate().getValue()})})},r.prototype.ze=function(n){i.forEach(this.tn.getValue(),function(e){var t=i.find(n,function(t){return e.getSessionId()===t.sessionId&&t.lastUpdate>e.getObservableLastUpdate().getValue()});t&&e.lt(t)})},r}.apply(e,n))||(t.exports=n)},function(t,e,n){n=[n(0),n(1),n(5),n(23),n(15)];void 0===(n=function(a,u,c,o,t){"use strict";var e=t.roles,n=t.states;function i(t,e,n,i,r,o,s){this.init(t,e,n,i,r,o,s)}function s(t){return new o(t.uri,t.type,t.audioState,t.videoState)}function h(t){return u.b(t,e,"memberRole"),a.getEnumName(e,t)}function f(t){return u.b(t,n,"memberState"),a.getEnumName(n,t)}return i.prototype.init=function(t,e,n,i,r,o,s){u.a(t,"roomService"),u.e(n,"sessionId"),u.e(i,"screenName"),u.isArray(o,"streams"),u.u(a.utc(s),"lastUpdate"),this.Qe=new c.Observable(n),this.rn=new c.Observable(i),this.sn=new c.ObservableArray([]),this.an=new c.Observable(e,f).extend({rateLimit:500}),this.un=new c.Observable(r,h),this.cn=new c.Observable(s,a.utc),this.in=t,this.setStreams(o)},i.prototype.getObservableState=function(){return this.an},i.prototype.getSessionId=function(){return this.Qe.getValue()},i.prototype.getObservableScreenName=function(){return this.rn},i.prototype.getObservableRole=function(){return this.un},i.prototype.getObservableStreams=function(){return this.sn},i.prototype.getObservableLastUpdate=function(){return this.cn},i.prototype.getLastUpdate=function(){return this.cn.getValue()},i.prototype.getStreams=function(){return a.map(this.sn.getValue(),function(t){return t.toJson()})},i.prototype.getRoomService=function(){return this.in},i.prototype.commitChanges=function(t){u.a(this.in,"this._roomService"),this.in.updateMember(this,t)},i.prototype.reload=function(){u.a(this.in,"this._roomService"),this.in.revertMemberChanges(this)},i.prototype.setStreams=function(t){t=a.map(t,s),this.sn.setValue(t)},i.prototype.toString=function(){return this.getObservableRole().getValue()+"["+this.getObservableScreenName().getValue()+","+this.getSessionId()+"]"},i.prototype.toJson=function(){var e={sessionId:this.Qe.getValue(),screenName:this.rn.getValue(),role:this.un.getValue(),state:this.an.getValue(),streams:[],lastUpdate:this.cn.getValue()};return a.forEach(this.sn.getValue(),function(t){e.streams.push(t.toJson())}),e},i.prototype.lt=function(t){a.a(t)&&(Object.prototype.hasOwnProperty.call(t,"state")&&this.an.setValue(t.state),Object.prototype.hasOwnProperty.call(t,"screenName")&&this.rn.setValue(t.screenName),Object.prototype.hasOwnProperty.call(t,"role")&&this.un.setValue(t.role),Object.prototype.hasOwnProperty.call(t,"lastUpdate")&&this.cn.setValue(t.lastUpdate),Object.prototype.hasOwnProperty.call(t,"streams")&&function(t){var e=this.sn.getValue(),n=[];a.forEach(t,function(i){var r=o.parsePCastStreamIdFromStreamUri(i.uri),t=a.find(e,function(t){var e=t.getUri()===i.uri,n=t.isPCastStream()&&t.getPCastStreamId()===r,n=e||n;return t.getType()===i.type&&n});t?t.lt(i):t=s(i),n.push(t)}),this.sn.setValue(n)}.call(this,t.streams))},i}.apply(e,n))||(t.exports=n)},function(t,e,n){void 0===(e=function(){"use strict";return{states:{trackEnabled:{id:0,name:"TrackEnabled"},trackDisabled:{id:1,name:"TrackDisabled"},trackEnded:{id:2,name:"TrackEnded"}}}}.apply(e,[]))||(t.exports=e)},function(t,e,n){n=[n(0),n(1),n(3),n(111)];void 0===(n=function(m,o,v,s){"use strict";function t(t,e){o.a(t,"pcast"),e&&o.a(e,"options"),e&&e.screenShare&&o.h(e.screenShare,"options.screenShare"),this.He=t,this.X=t.getLogger(),this.C=e||{},this.hn=m.get(e,["onScreenShare"])}function g(a,u,c,h,f){var d=this.getVendorSpecificConstraints(a,u||{},c),l=!!d.video,p=this;this.He.getUserMedia(d,function(t,e,n,i){if("ok"===e)return p.X.info("Acquired user media with constraints [%s]",d),f(null,{userMedia:n,options:{frameRate:l?c:null,resolution:l?m.get(u,["resolution"],null):null,aspectRatio:l?m.get(u,["aspectRatio"],null):null}});p.X.info("Failed to acquire user media with constraints [%s]",d);var r=u,o=c,s=(n=i).constraintName||n.constraint||"";if(i&&("ConstraintNotSatisfiedError"===i.name||"OverconstrainedError"===i.name||"OverconstrainedError"===i.constructor.name||"unavailable"===i.code&&"Edge"===v.browser))switch(s.toLowerCase()){case"width":case"height":if(!u||!h.canResolveNextResolution())break;return p.X.warn("Unable to get user media with constraint [%s] with height [%s] and width [%s]. Retrying with next closest resolution.",s,r.height,r.width),r=h.getNextResolution(u.height,u.aspectRatio),g.call(p,a,r,o,h,f);default:if(c)return p.X.warn("Unable to get user media with constraint [%s] and frame rate [%s]. Retrying without frame rate constraint.",s,c),g.call(p,a,r,o=null,h,f);if(!u||!h.canResolveNextResolution())break;return p.X.warn("Unable to get user media with constraint [%s] with height [%s] and width [%s]. Retrying with next closest resolution.",s,r.height,r.width),r=h.getNextResolution(u.height,u.aspectRatio),g.call(p,a,r,o,h,f)}return p.X.error("Unable to get user media with status [%s]",e,i),f(i)},function(t){var e,n,i,r,o,s=t;if(p.hn&&"Chrome"===v.browser){var a,t=(e=t,n=m.get(e,["video","mandatory","chromeMediaSource"]),i=m.get(e,["audio","mandatory","chromeMediaSource"]),r=m.get(e,["video","mandatory","chromeMediaSourceId"]),o=m.get(e,["audio","mandatory","chromeMediaSourceId"]),e={},(n||o)&&(m.set(e,["screen","mediaSource"],n),m.set(e,["screen","mediaSourceId"],r)),(i||o)&&(m.set(e,["screenAudio","mediaSource"],i),m.set(e,["screenAudio","mediaSourceId"],o)),e);if((s=p.hn(t)).resolution&&s.aspectRatio)switch(this.fn){case"9x16":case"3x4":a={width:s.resolution,height:h.calculateLongerDimensionByAspectRatio(s.resolution,s.aspectRatio)};break;default:a={width:h.calculateLongerDimensionByAspectRatio(s.resolution,s.aspectRatio),height:s.resolution}}s=function(t,e,n){var i=this.getVendorSpecificConstraints(t,e,n);i.screen&&(i.video=i.screen,delete i.screen),i.screenAudio&&(i.audio=i.screenAudio,delete i.screenAudio);var r=m.get(i,["video","mandatory","mediaSource"]),t=m.get(i,["audio","mandatory","mediaSource"]),e=m.get(i,["video","mandatory","mediaSourceId"]),n=m.get(i,["audio","mandatory","mediaSourceId"]);return(r||e)&&(m.set(i,["video","mandatory","chromeMediaSource"],r),m.set(i,["video","mandatory","chromeMediaSourceId"],e),delete i.video.mandatory.mediaSource,delete i.video.mandatory.mediaSourceId),(t||n)&&(m.set(i,["audio","mandatory","chromeMediaSource"],t),m.set(i,["audio","mandatory","chromeMediaSourceId"],n),delete i.audio.mandatory.mediaSource,delete i.audio.mandatory.mediaSourceId),i}.call(p,t,a,s.frameRate)}return s})}return t.prototype.getUserMedia=function(t,e){o.a(t,"deviceOptions");var n=new s(this.C),i=n.getDefaultResolution(),r=n.getDefaultFrameRate();g.call(this,t,i,r,n,e)},t.prototype.getVendorSpecificConstraints=function(t,e,n){if(e=e||{},!t||!t.audio&&!t.video&&!t.screen&&!t.screenAudio)throw new Error("Invalid device options. Must pass in at least one device option.");return("Firefox"===v.browser&&38<v.browserVersion||"Chrome"===v.browser&&52<v.browserVersion&&!t.screen&&!t.screenAudio||"Safari"===v.browser&&10<v.browserVersion||"Opera"===v.browser&&40<v.browserVersion?function(t,e,n){var i=t.video,r=t.audio,o=t.screen,s=t.screenAudio,a=e.width,t=e.height,e={};return i&&(e.video={height:{min:t,ideal:t,max:t},width:{min:a,ideal:a,max:a},frameRate:{ideal:n,max:n}},i.deviceId&&(e.video.deviceId={exact:i.deviceId}),i.facingMode&&(e.video.facingMode=i.facingMode),a||delete e.video.width,t||delete e.video.height,n||delete e.video.frameRate,a||t||n||i.deviceId||i.facingMode||(e.video=!0)),r&&(e.audio={},r.deviceId&&(e.audio.deviceId={exact:r.deviceId}),r.mediaSource&&(e.audio.mediaSource=r.mediaSource),r.mediaSourceId&&(e.audio.mediaSourceId=r.mediaSourceId),r.deviceId||r.mediaSource||r.mediaSourceId||(e.audio=!0)),s&&(e.screenAudio={},s.deviceId&&(e.screenAudio.deviceId={exact:s.deviceId}),s.mediaSource&&(e.screenAudio.mediaSource=s.mediaSource),s.mediaSourceId&&(e.screenAudio.mediaSourceId=s.mediaSourceId),s.deviceId||s.mediaSource||s.mediaSourceId||(e.screenAudio=!0)),o&&(e.screen={height:{min:t,ideal:t,max:t},width:{min:a,ideal:a,max:a},frameRate:{ideal:n,max:n}},a||delete e.screen.width,t||delete e.screen.height,n||delete e.screen.frameRate,o.mediaSource&&(e.screen.mediaSource=o.mediaSource),a||t||n||o.mediaSource||(e.screen=!0)),o&&i&&(e.screen=!0),e}:"Edge"===v.browser?function(t,e,n){var i=t.video,r=t.audio,o=t.screen,s=e.width,t=e.height,e={};return i&&(e.video={height:{min:t,max:t,exact:t},width:{min:s,max:s,exact:s},frameRate:n},i.deviceId&&(e.video.deviceId=i.deviceId),i.facingMode&&(e.video.facingMode=i.facingMode),s||delete e.video.width,t||delete e.video.height,n||delete e.video.frameRate,s||t||n||i.deviceId||i.facingMode||(e.video=!0)),r&&(e.audio=!0,r.deviceId&&(e.audio={deviceId:r.deviceId})),o&&(e.screen=!0),e}:function(t,e,n){var i=t.video,r=t.audio,o=t.screen,s=t.screenAudio,a=e.width,t=e.height,e={};return i&&(e.video={mandatory:{minHeight:t,maxHeight:t,minWidth:a,maxWidth:a,maxFrameRate:n}},i.deviceId&&(e.video.mandatory.sourceId=i.deviceId),i.facingMode&&(e.video.facingMode=i.facingMode),i.mediaSource&&(e.video.mandatory.mediaSource=i.mediaSource),i.mediaSourceId&&(e.video.mandatory.mediaSourceId=i.mediaSourceId),a||(delete e.video.mandatory.minWidth,delete e.video.mandatory.maxWidth),t||(delete e.video.mandatory.minHeight,delete e.video.mandatory.maxHeight),n||delete e.video.mandatory.maxFrameRate,a||t||n||i.deviceId||i.facingMode||i.mediaSource||i.mediaSourceId||(e.video=!0)),r&&(e.audio={mandatory:{}},r.deviceId&&(e.audio.mandatory.sourceId=r.deviceId),r.mediaSource&&(e.audio.mandatory.mediaSource=r.mediaSource),r.mediaSourceId&&(e.audio.mandatory.mediaSourceId=r.mediaSourceId),r.deviceId||r.mediaSource||r.mediaSourceId||(e.audio=!0)),s&&(e.screenAudio={mandatory:{}},s.deviceId&&(e.screenAudio.mandatory.sourceId=s.deviceId),s.mediaSource&&(e.screenAudio.mandatory.mediaSource=s.mediaSource),s.mediaSourceId&&(e.screenAudio.mandatory.mediaSourceId=s.mediaSourceId),s.deviceId||s.mediaSource||s.mediaSourceId||(e.screenAudio=!0)),o&&(e.screen={mandatory:{minHeight:t,maxHeight:t,minWidth:a,maxWidth:a,maxFrameRate:n}},a||(delete e.screen.mandatory.minWidth,delete e.screen.mandatory.maxWidth),t||(delete e.screen.mandatory.minHeight,delete e.screen.mandatory.maxHeight),n||delete e.screen.mandatory.maxFrameRate,o.mediaSource&&(e.screen.mandatory.mediaSource=o.mediaSource),o.mediaSourceId&&(e.screen.mandatory.mediaSourceId=o.mediaSourceId),a||t||n||o.mediaSource||(e.screen=!0)),o&&i&&(e.screen=!0),e})(t,e,n)},t}.apply(e,n))||(t.exports=n)},function(t,e,n){n=[n(0),n(1),n(5),n(44),n(42),n(26),n(3),n(112)];void 0===(n=function(l,p,e,t,r,i,m,d){"use strict";var n=0,v="unauthorized",u=1e3,o=500,s={maxOfflineTime:18e4,maxReconnectFrequency:6e4};function a(t){if(p.a(t,"options"),t.authToken&&p.g(t.authToken,"options.authToken"),t.authToken&&t.adminApiProxyClient)throw new Error('Do not pass "options.adminApiProxyClient" if you are using "options.authToken"');if(t.onError&&p.h(t.onError,"options.onError"),!l.isNullOrUndefined(t.onlineTimeout)&&(p.u(t.onlineTimeout,"options.onlineTimeout"),t.onlineTimeout<0))throw new Error('"options.onlineTimeout" must be a positive number');t.reconnectOptions&&(p.a(t.reconnectOptions,"options.reconnectOptions"),p.u(t.reconnectOptions.maxOfflineTime,"options.reconnectOptions.maxOfflineTime"),p.u(t.reconnectOptions.maxReconnectFrequency,"options.reconnectOptions.maxReconnectFrequency")),t.adminApiProxyClient&&(p.a(t.adminApiProxyClient,"options.adminApiProxyClient"),p.h(t.adminApiProxyClient.createAuthenticationToken,"options.adminApiProxyClient.createAuthenticationToken")),this.dn=++n,this.ln=new e.Observable(null).extend({rateLimit:0}),this.pn=new e.Observable(null).extend({rateLimit:0}),this.Wt={},this.mn=t.adminApiProxyClient,this.vn=!1,this.gn=0,this.yn=0,this.fe=!1,this.Ft=t.authToken,this.wn=t.onError,this.C=t,this.bn=l.u(t.onlineTimeout)?t.onlineTimeout:2e4,this.kn=t.reconnectOptions||s,this.X=null,this.Sn={},h.call(this),t.adminApiProxyClient||((t.backendUri||l.e(t.backendUri))&&this.X.warn("Passing options.backendUri is deprecated. Please create an instance of the sdk.net.AdminApiProxyClient and pass that instead"),t.authenticationData&&this.X.warn("Passing options.authenticationData is deprecated. Please create an instance of the sdk.net.AdminApiProxyClient and pass that instead"))}a.prototype.toString=function(){return"PCastExpress["+this.dn+"]"},a.prototype.dispose=function(){this.En&&(this.En.dispose(),this.En=null),this.ln.getValue()&&(this.ln.getValue().stop(),this.ln.setValue(null)),this.pn.getValue()&&this.pn.setValue(null),l.u(this.Rn)&&(clearTimeout(this.Rn),this.Rn=null),this.mn&&this.mn.dispose(),this.sessionIdSubscription&&this.sessionIdSubscription.dispose(),this.pn&&this.pn.dispose&&this.pn.dispose(),this.gn=0,this.yn=0,this.fe=!0,this.X.info("[%s] Disposed PCast Express instance",this)},a.prototype.getPCast=function(){return this.ln.getValue()},a.prototype.getPCastObservable=function(){return this.ln},a.prototype.getSessionIdObservable=function(){return this.pn},a.prototype.getAdminAPI=function(){return this.mn},a.prototype.getUserMedia=function(e,n){var i=this;if(p.a(e.mediaConstraints,"options.mediaConstraints"),p.h(n,"callback"),e.resolution&&p.u(e.resolution,"options.resolution"),e.frameRate&&p.u(e.frameRate,"options.frameRate"),e.aspectRatio&&p.g(e.aspectRatio,"options.aspectRatio"),e.onResolveMedia&&p.h(e.onResolveMedia,"options.onResolveMedia"),e.onScreenShare&&p.h(e.onScreenShare,"options.onScreenShare"),i.ln.getValue())return b.call(i,i.ln.getValue(),e,n);var r=i.ln.subscribe(function(t){t&&(r.dispose(),b.call(i,t,e,n))})},a.prototype.publish=function(n,i){if(p.a(n,"options"),p.h(i,"callback"),n.capabilities&&p.isArray(n.capabilities,"options.capabilities"),n.connectOptions&&p.isArray(n.connectOptions,"options.connectOptions"),n.mediaConstraints?p.a(n.mediaConstraints,"options.mediaConstraints"):p.a(n.userMediaStream,"options.userMediaStream"),n.videoElement&&p.a(n.videoElement,"options.videoElement"),n.monitor&&(p.a(n.monitor,"options.monitor"),p.h(n.monitor.callback,"options.monitor.callback"),n.monitor.options&&p.a(n.monitor.options,"options.monitor.options")),n.publishToken&&p.g(n.publishToken,"options.publishToken"),n.streamToken&&p.g(n.streamToken,"options.streamToken"),n.publishToken&&n.streamToken)throw new Error("Do not pass streamToken with publishToken. Please use publishToken.");var r=this;this.waitForOnline(function(t){return t?i(t):n.userMediaStream?k.call(r,n.userMediaStream,n,!1,i):void r.getUserMedia(n,function(t,e){return t?i(t):"ok"!==e.status?i(null,e):void k.call(r,e.userMedia,n,!0,i)})},n.isContinuation)};var c=["streaming","low-latency","on-demand","uld","vvld","vld","ld","sd","hd","fhd","uhd"];function h(){var t,n=this;if(this.ln.getValue()||(t=l.assign({logger:this.X},this.C),this.ln.setValue(new i(t))),this.X||(this.X=this.ln.getValue().getLogger()),this.In||(this.In=this.ln.getValue().getObservableStatus().subscribe(l.bind(f,this))),this.sessionIdSubscription&&this.sessionIdSubscription.dispose(),this.sessionIdSubscription=this.ln.getValue().getObservableSessionId().subscribe(l.bind(function(t){this.pn.setValue(t)},this)),this.Ft)return this.ln.getValue().start(this.Ft,function(t,e){if("critical-network-issue"===e)return f.call(n,e)},l.noop,l.noop);if(!this.Ft&&!n.mn)throw new Error("Use auth token, or set adminApiProxyClient");this.mn.createAuthenticationToken(function(t,e){return t&&"timeout"===t.message?f.call(n,t.message):t?w.call(n,t):"ok"!==e.status?f.call(n,e.status):void(n.ln.getValue()?n.ln.getValue().start(e.authenticationToken,l.noop,l.noop,l.noop):n.X.warn("[%s] Unable to authenticate. PCast not instantiated.",this))})}function f(t){switch(t){case"timeout":case"critical-network-issue":return this.ln.getValue()&&(this.ln.getValue().stop("recovery"),this.ln.setValue(null)),this.pn.getValue()&&this.pn.setValue(null),this.In&&(this.In.dispose(),this.In=null),this.gn++,g.call(this);case"reconnect-failed":case"unauthorized":return delete this.Ft,this.mn?(this.yn++,1<this.yn?w.call(this,new Error(t)):(this.X.info("[%s] Attempting to create new authToken and re-connect after [%s] response",this,v),y.call(this))):w.call(this,new Error(t));case"capacity":case"network-unavailable":return this.gn++,g.call(this);case"online":return this.vn?this.X.info("[%s] Successfully reconnected (reconnectCount=[%s],reauthCount=[%s])",this,this.gn,this.yn):this.X.info("[%s] Successfully instantiated",this),this.yn=0,this.gn=0,void(this.vn=!0);case"reconnecting":case"reconnected":case"connecting":break;case"offline":return;default:return w.call(this,new Error(t))}}function g(){var t=this,e=Math.min(u*t.gn*t.gn,this.kn.maxReconnectFrequency),n=Math.min(e/1e4,5),n=e+Math.random()*n*1e3;this.X.info("[%s] Waiting for [%s] ms before continuing to attempt to reconnect to PCast",this,n),this.Rn=setTimeout(function(){return(t.ln.getValue()&&t.ln.getValue().isStarted()?y:h).call(t)},n)}function y(){var n=this;this.mn.createAuthenticationToken(function(t,e){return t&&"timeout"===t.message?f.call(n,t.message):t?w.call(n,t):"ok"!==e.status?f.call(n,e.status):void(n.ln.getValue()?n.ln.getValue().reAuthenticate(e.authenticationToken):n.X.warn("[%s] Unable to authenticate. PCast not instantiated.",this))})}function w(t){if(!this.wn)throw t;this.wn(t)}function b(t,n,i){new r(t,{aspectRatio:n.aspectRatio,resolution:n.resolution,frameRate:n.frameRate,resolutionSelectionStrategy:n.resolutionSelectionStrategy,onScreenShare:function(t){return(t=n.onScreenShare?n.onScreenShare(t):t).resolution&&p.u(t.resolution,"clientOptions.resolution"),t.frameRate&&p.u(t.frameRate,"screenOptions.frameRate"),t.aspectRatio&&p.g(t.aspectRatio,"screenOptions.aspectRatio"),l.assign({resolution:t.resolution},t)}}).getUserMedia(n.mediaConstraints,function(t,e){return t?i(t):(n.onResolveMedia&&n.onResolveMedia(e.options),void i(null,l.assign({status:"ok"},e)))})}function k(i,r,o,s){var a=this;if(r.publishToken){try{var t=a.parseCapabilitiesFromToken(r.publishToken);r.capabilities=t}catch(t){return s(new Error("Bad `publishToken`",t),{status:"bad-token"})}return S.call(a,r.publishToken,i,r,o,s)}if(r.streamToken){try{var e=a.parseCapabilitiesFromToken(r.streamToken);r.capabilities=e}catch(t){return s(new Error("Bad `streamToken`",t),{status:"bad-token"})}return S.call(a,r.streamToken,i,r,o,s)}r.capabilities&&p.isArray(r.capabilities,"options.capabilities"),a.waitForOnline(function(t){if(t)return a.X.error("[%s] Failed to create stream token for publishing after waiting for online status",this,t),s(t);var n=a.ln.getValue().getProtocol().getSessionId(),e=l.includes(r.capabilities,"egress"),t=l.bind(a.mn.createStreamTokenForPublishing,a.mn,n,r.capabilities);e&&(t=l.bind(a.mn.createStreamTokenForPublishingToExternal,a.mn,n,r.capabilities,r.streamId)),a.X.info("[%s] [%s] Creating stream token for publishing",this,n),t(function(t,e){return t?(a.X.error("[%s] [%s] Failed to create stream token for publishing",this,n,t),s(t)):"ok"!==e.status?(a.X.warn("[%s] [%s] Failed to create stream token for publishing with status [%s]",this,n,e.status),s(null,e)):void S.call(a,e.streamToken,i,r,o,s)})},r.isContinuation)}function S(o,s,a,u,c){var h=this,f=!1,d=null;function e(t,e,n){function i(t){var e=l.assign({streamToken:o,isContinuation:!0},a);h.X.warn("[%s] Retrying publisher after failure with reason [%s]",this,t),h.Sn[n.getStreamId()]=!0,"camera-track-failure"===t?(n.stop(t,!1),h.publish(a,c)):(n.stop(t,!0),k.call(h,s,e,u,c))}if(e===v&&(a.streamToken||a.publishToken||!a.authFailure)||"timeout"===e){h.X.info("[%s] Attempting to create new streamToken and re-publish after [%s] response",this,v);var r=l.assign({isContinuation:!0,authFailure:!0},a);return delete r.streamToken,delete r.publishToken,k.call(h,s,r,u,c)}if("ok"!==e)return h.X.warn("[%s] Failure to publish with status [%s]",this,e),d&&(h.Sn[d.getStreamId()]=!0),c(null,{status:e});delete a.authFailure,h.Wt[n.getStreamId()]=n,d=n,r=l.bind(M,h,function(){},i,!0),a.monitor&&(e=l.bind(C,h,a.monitor.callback,i),n.monitor(a.monitor.options||{},e),r=l.bind(M,h,a.monitor.callback,i,!0)),n.setPublisherEndedCallback(r),r=function(n,i,r){var o=this,s=l.bind(n.stop,n);return n.stop=function(t,e){o.X.info("[%s] [%s] Stopping publisher with reason [%s]",o,n.getStreamId(),t),s(t),i&&(i.src="",i.srcObject=null),!r||!n.getStream()||e||(e=n.getStream())&&e.getTracks().forEach(function(t){t.stop()})},n.enableAudio=function(){return R.call(o,n,!0)},n.disableAudio=function(){return R.call(o,n,!1)},n.enableVideo=function(){return I.call(o,n,!0)},n.disableVideo=function(){return I.call(o,n,!1)},n.setPublisherEndedCallback=function(){},n}.call(h,n,a.videoElement,u),a.videoElement&&!f&&(m.attachMediaStream(a.videoElement,s,function(t){t&&h.X.warn("[%s] [%s] Failed to attach publish media stream to video element.",this,n.getStreamId(),t)}),f=!0),c(null,{status:"ok",publisher:r})}a.tags&&p.isArray(a.tags,"options.tags"),a.connectOptions&&p.isArray(a.connectOptions,"options.connectOptions"),h.waitForOnline(function(t){return t?c(t):void h.ln.getValue().publish(o,s,e,a.tags,{connectOptions:a.connectOptions})},a.isContinuation)}function E(a,u,c){function e(t,e,n){function i(t){var e=l.assign({isContinuation:!0},u);h.Sn[n.getStreamId()]=!0,n.stop(t),h.X.warn("[%s] [%s] Stream failure occurred with reason [%s]. Attempting to recover from failure.",this,u.streamId,t),E.call(h,a,e,c)}var r;if((!u.skipRetryOnUnauthorized&&e===v&&(u.streamToken||!u.authFailure)||"timeout"===e)&&h.mn){h.X.info("[%s] [%s] Attempting to create new streamToken and re-subscribe after [%s] response",this,u.streamId,v);var o=l.assign({isContinuation:!0,authFailure:!0},u);return delete o.streamToken,h.subscribe(o,c)}if("streaming-not-ready"===e)return h.X.warn("[%s] Failure to subscribe with status [%s]. Try again in a few seconds.",this,e),c(null,{status:e,retry:l.bind(i,h,e)});if("ok"!==e)return h.X.warn("[%s] Failure to subscribe with status [%s]",this,e),f&&(h.Sn[f.getStreamId()]=!0),c(null,{status:e});delete u.authFailure,f=n,u.videoElement&&(r=n.createRenderer()).start(u.videoElement),o=l.noop,e=l.bind(M,h,o,i,!1),u.monitor&&(o=l.bind(C,h,u.monitor.callback,i),n.monitor(u.monitor.options||{},o),e=l.bind(M,h,u.monitor.callback,i,!1)),n.setStreamEndedCallback(e);var s=function(e,n){var i=this,r=l.bind(e.stop,e);return e.stop=function(t){i.X.info("[%s] [%s] Stopping subscriber with reason [%s]",i,e,t),n&&n.stop(t),r(t)},e.enableAudio=function(){return R(e.getStream(),!0)},e.disableAudio=function(){return R(e.getStream(),!1)},e.enableVideo=function(){return I(e.getStream(),!0)},e.disableVideo=function(){return I(e.getStream(),!1)},e.setStreamEndedCallback=function(){},e}.call(h,n,r),e={status:"ok",mediaStream:s};n.setStreamErrorCallback(function(t,e,n){return"real-time"===e&&"connection-timeout"===n.message?i.call(h,n.message):"shaka"!==e||n.severity===d.errorSeverity.critical.id?"phenix-player"!==e||1!==n.severity?(h.X.warn("[%s] [%s] Error occurred while playing stream with Express API. Stopping stream.",this,s.getStreamId(),n),s.stop(),c(n)):(h.X.warn("[%s] [%s] Recoverable error occurred while playing stream with Express API. Attempting to subscribe again.",this,s.getStreamId(),n),delete(n=l.assign({isContinuation:!0},u)).streamToken,h.subscribe(n,c)):void 0}),r&&(e.renderer=r),c(null,e)}var h=this,f=null;h.waitForOnline(function(t){return t?c(t):(t=l.clone(u.subscriberOptions||{}),u.streamId&&(t.originStreamId=u.streamId),void h.ln.getValue().subscribe(a,e,t))},u.isContinuation)}function R(t,e){var n=this.getPCast();if(n){var i=t.getStreamId(),r=n.getRemoteDescriptionSdp(i);if(r&&(n=t.getStream(),!((i=r.lastIndexOf("m=audio"))<0)&&((t=r.lastIndexOf("m=video"))<i&&(t=r.length),!(t=r.substring(i,t)).includes("a=inactive")&&n)))return T(n.getAudioTracks(),e),e}}function I(t,e){var n=this.getPCast();if(n){var i=t.getStreamId(),r=n.getRemoteDescriptionSdp(i);if(r&&(n=t.getStream(),!((i=r.lastIndexOf("m=video"))<0)&&((t=r.lastIndexOf("m=audio"))<i&&(t=r.length),!(t=r.substring(i,t)).includes("a=inactive")&&n)))return T(n.getVideoTracks(),e),e}}function T(t,e){p.isArray(t,"tracks"),l.forEach(t,function(t){t.updateState(e)})}function C(t,e,n,i,r){switch(i){case"camera-track-failure":case"client-side-failure":t(null,l.assign({status:i,retry:l.bind(e,null,i)},r))}}function M(t,e,n,i,r,o){var s={status:"stream-ended",reason:r,description:o};if(this.Sn[i.getStreamId()])this.X.info("[%s] Ignoring stream end due to recovery in progress [%s]",this,i.getStreamId());else switch(r){case"egress-setup-failed":case"ended":case"censored":var a={status:r,reason:r,description:o};return n?a.publisher=i:a.mediaStream=i,t(null,a);case"custom":return t(null,s);case"egress-failed":case"capacity":return void setTimeout(function(){if(!this.fe)return e(r)},u);case"failed":case"maintenance":case"overload":return e(r);default:return s.retry=e,t(null,s)}}return a.prototype.publishRemote=function(n,i){if(p.a(n,"options"),p.h(i,"callback"),p.g(n.streamUri,"options.streamUri"),n.capabilities&&p.isArray(n.capabilities,"options.capabilities"),n.connectOptions&&p.isArray(n.connectOptions,"options.connectOptions"),n.mediaConstraints)throw new Error("Invalid argument: mediaConstraints, passed on publishRemote. Local media not allowed when publishing remote content.");if(n.videoElement)throw new Error("May not preview remote stream. Please subscribe to view.");if(n.prerollSkipDuration&&p.u(n.prerollSkipDuration,"options.prerollSkipDuration"),n.monitor&&(p.a(n.monitor,"options.monitor"),p.h(n.monitor.callback,"options.monitor.callback"),n.monitor.options&&p.a(n.monitor.options,"options.monitor.options")),n.frameRate&&(p.a(n.frameRate,"options.frameRate"),n.frameRate.exact&&p.u(n.frameRate.exact,"options.frameRate.exact"),n.frameRate.max&&p.u(n.frameRate.max,"options.frameRate.max")),n.publishToken&&p.g(n.publishToken,"options.publishToken"),n.streamToken&&p.g(n.streamToken,"options.streamToken"),n.publishToken&&n.streamToken)throw new Error("Do not pass streamToken with publishToken. Please use publishToken.");var r=this;this.waitForOnline(function(t){if(t)return i(t);var e=l.assign({connectOptions:[],capabilities:[]},n);l.includes(e.capabilities,"publish-uri")||e.capabilities.push("publish-uri"),l.forEach(c,function(t){l.includes(e.capabilities,t)&&e.connectOptions.push("publisher-capability="+t)}),n.frameRate&&n.frameRate.exact&&e.connectOptions.push("source-uri-video-fps="+n.frameRate.exact),n.frameRate&&n.frameRate.max&&e.connectOptions.push("source-uri-video-fps-max="+n.frameRate.max),e.connectOptions.push("source-uri-preroll-skip-duration="+(l.u(n.prerollSkipDuration)?n.prerollSkipDuration:o).toString()),k.call(r,e.streamUri,e,!1,i)})},a.prototype.publishStreamToExternal=function(e,n){if(p.a(e,"options"),p.h(n,"callback"),p.g(e.streamId,"options.streamId"),p.g(e.externalUri,"options.externalUri"),e.capabilities&&p.isArray(e.capabilities,"options.capabilities"),e.connectOptions&&p.isArray(e.connectOptions,"options.connectOptions"),e.mediaConstraints)throw new Error("Invalid argument: mediaConstraints, passed on publishStreamToExternal. Local media not allowed when publishing remote content.");if(e.videoElement)throw new Error("May not preview external stream. Please subscribe to view.");e.monitor&&(p.a(e.monitor,"options.monitor"),p.h(e.monitor.callback,"options.monitor.callback"),e.monitor.options&&p.a(e.monitor.options,"options.monitor.options")),e.streamToken&&p.g(e.streamToken,"options.streamToken");var i=this;this.waitForOnline(function(t){return t?n(t):(t=l.assign({connectOptions:[],capabilities:[]},e),l.includes(t.capabilities,"egress")||t.capabilities.push("egress"),l.includes(t.capabilities,"egress-own-stream")||t.capabilities.push("egress-own-stream"),void k.call(i,t.externalUri,t,!1,n))})},a.prototype.publishScreen=function(t,e){return t=l.assign({mediaConstraints:{screen:!0}},t),l.set(t,["monitor","options"],l.assign({},{monitorFrameRate:!1,videoBitRateThreshold:100,conditionCountForNotificationThreshold:8},l.get(t,["monitor","options"],{}))),this.publish(t,e)},a.prototype.subscribe=function(n,i){p.a(n,"options"),p.h(i,"callback"),p.g(n.streamId,"options.streamId"),n.videoElement&&p.a(n.videoElement,"options.videoElement"),n.monitor&&(p.a(n.monitor,"options.monitor"),p.h(n.monitor.callback,"options.monitor.callback"),n.monitor.options&&p.a(n.monitor.options,"options.monitor.options")),n.streamToken?p.g(n.streamToken,"options.streamToken"):p.a(n.capabilities,"options.capabilities"),n.subscriberOptions&&p.a(n.subscriberOptions,"options.subscriberOptions");var r=this;this.waitForOnline(function(t){if(t)return r.X.error("[%s] Failed to subscribe after error waiting for online status",this,t),i(t);if(n.streamToken)return E.call(r,n.streamToken,n,i);if(!n.streamToken&&!r.mn)throw new Error("Use stream token, or set adminApiProxyClient");r.X.info("[%s] [%s] Generating stream token for subscribing to origin [%s]",this,r.ln.getValue().getProtocol().getSessionId(),n.streamId),r.mn.createStreamTokenForSubscribing(r.ln.getValue().getProtocol().getSessionId(),n.capabilities,n.streamId,null,function(t,e){return t?(r.X.error("[%s] Failed to create stream token for subscribing",this,t),i(t)):"ok"!==e.status?(r.X.warn("[%s] Failed to create stream token for subscribing with status [%s]",this,e.status),i(null,e)):void E.call(r,e.streamToken,n,i)})},n.isContinuation)},a.prototype.subscribeToScreen=function(t,e){return t=l.assign({},t),l.set(t,["monitor","options"],l.assign({},{monitorFrameRate:!1,videoBitRateThreshold:100,conditionCountForNotificationThreshold:8},l.get(t,["monitor","options"],{}))),this.subscribe(t,e)},a.prototype.waitForOnline=function(e,t){if(p.h(e,"callback"),this.ln.getValue()&&"online"===this.ln.getValue().getStatus())return e();var n=this,i=t?l.get(n.kn,["maxOfflineTime"]):this.bn,r=null,o=null,s=setTimeout(function(){n.X.info("[%s] Disposing of online listener after [%s] ms",this,i),r&&r.dispose(),o&&o.dispose(),n.fe?n.X.info("[%s] Instance was disposed while waiting for online, ignoring callback",this):e(new Error("timeout"))},i);this.X.info("[%s] Waiting for online status before continuing. Timeout set to [%s]",this,i),r=this.ln.subscribe(function(t){o&&o.dispose(),t&&(o=t.getObservableStatus().subscribe(function(t){return n.fe?(n.X.info("[%s] Instance was disposed while waiting for online, canceling waiting and skip triggering callback",this),clearTimeout(s),o.dispose(),void r.dispose()):"online"===t?(clearTimeout(s),o.dispose(),r.dispose(),e()):void n.X.info("[%s] Still waiting for online status before continuing. Current status is [%s]",this,t)},{initial:"notify"}))},{initial:"notify"})},a.prototype.parseCapabilitiesFromToken=function(t){return this.ln.getValue().parseCapabilitiesFromToken(t)},a.prototype.parseRoomOrChannelIdFromToken=function(t){return this.ln.getValue().parseRoomOrChannelIdFromToken(t)},a.prototype.parseRoomOrChannelAliasFromToken=function(t){return this.ln.getValue().parseRoomOrChannelAliasFromToken(t)},a}.apply(e,n))||(t.exports=n)},function(t,e,n){n=[n(0),n(1),n(9),n(2)];void 0===(n=function(o,s,a,r){"use strict";var u={timeout:2e4,retryOptions:{backoff:1.5,delay:1e3,maxAttempts:3,additionalRetryErrorCodes:[0]}},c={body:{id:1,name:"body"},header:{id:2,name:"header"}},e={createStreamTokenPath:"/stream",createAuthTokenPath:"/auth"},h="auth",f="stream";function t(){this.Tn=null,this.Cn="",this.Mn=e,this.Pn={},this.On=c.body.name,this.P=new r.DisposableList}function d(t,n){var i=null,e=t(o.bind(p,this,function(t,e){switch(clearTimeout(i),o.get(t,["code"])){case 401:return n(null,{status:"unauthorized"});case 404:return n(null,{status:"origin-not-found"});case 410:return n(null,{status:"origin-ended"});default:return n(t,e)}})),i=setTimeout(function(){e.dispose(),n(new Error("timeout"))},2e4);return this.P.add(e),this.P.add(new r.Disposable(function(){clearTimeout(i)})),e}function l(t,e,n,i,r){switch(this.On){case c.body.name:i=function(t){return o.assign({},t,this.Pn)}.call(this,i);break;case c.header.name:r=function(t){return t.headers?(t.headers=o.assign({},this.Pn,t.headers),t):o.assign({},{headers:this.Pn},t)}.call(this,r);break;default:throw new Error("Unsupported Authentication Mode "+this.On)}return o.bind(t,e,n,JSON.stringify(i),r)}function p(t,e,n){return e?t(e,{}):"ok"!==(n=JSON.parse(n.data)).status?t(null,{status:n.status||"status-code-missing"}):t(null,n)}function m(t,e,n,i){if(!i||n)return e(n,{status:"failed"});var r={status:"ok"};switch(t){case h:r.authenticationToken=i;break;case f:r.streamToken=i;break;default:throw new Error("Unsupported request type "+t)}return e(n,r)}return t.prototype.dispose=function(){return this.P.dispose()},t.prototype.toString=function(){return"AdminApiProxyClient[customRequestHandler="+(!!this.Tn).toString()+",backendUri="+this.Cn+",authenticationDataLocationInPayload="+this.On+",customEndpointPaths="+(this.Mn===e).toString()+",customAuthenticationData="+(0<o.keys(this.Pn).length).toString()+"]"},t.prototype.getBackendUri=function(){return this.Cn},t.prototype.setBackendUri=function(t){s.e(t,"backendUri"),this.Cn=t},t.prototype.getEndpointPaths=function(){return o.assign({},this.Mn)},t.prototype.setEndpointPaths=function(t){s.a(t,"endpointPaths"),t.createStreamTokenPath&&s.g(t.createStreamTokenPath,"endpointPaths.createStreamTokenPath"),t.createAuthTokenPath&&s.g(t.createAuthTokenPath,"endpointPaths.createAuthTokenPath"),this.Mn=o.assign({},e,t)},t.prototype.getAuthenticationData=function(){return o.assign({},this.Pn)},t.prototype.setAuthenticationData=function(t){s.a(t,"authenticationData"),this.Pn=t},t.prototype.getAuthenticationDataLocationInPayload=function(){return this.On},t.prototype.setAuthenticationDataLocationInPayload=function(t){s.b(t,c,"authenticationDataLocationInPayload"),this.On=t},t.prototype.getRequestHandler=function(){return this.Tn},t.prototype.setRequestHandler=function(t){if(s.h(t,"callback"),this.Cn)throw new Error("Conflicting parameter [backendUri]");if(0<o.keys(this.Pn).length)throw new Error("Conflicting parameter [authenticationData]");if(this.On!==c.body.name)throw new Error("Conflicting parameter [authenticationDataLocationInPayload]");if(this.Mn!==e)throw new Error("Conflicting parameter [endpointPaths]");this.Tn=t},t.prototype.createAuthenticationToken=function(t){if(this.Tn)return this.Tn(h,{},o.bind(m,this,h,t));if(this.Cn){var e=l.call(this,a.postWithRetry,a,this.Cn+this.Mn.createAuthTokenPath,{},u);return d.call(this,e,t)}t(null,{status:"unauthorized"})},t.prototype.createStreamTokenForPublishing=function(t,e,n){return s.g(t,"sessionId"),s.a(e,"capabilities"),e={sessionId:t,capabilities:e},this.Tn?this.Tn(f,e,o.bind(m,this,f,n)):this.Cn?(e=l.call(this,a.postWithRetry,a,this.Cn+this.Mn.createStreamTokenPath,e,u),d.call(this,e,n)):void n(null,{status:"unauthorized"})},t.prototype.createStreamTokenForPublishingToExternal=function(t,e,n,i){this.createStreamTokenForSubscribing(t,e,n,null,i)},t.prototype.createStreamTokenForSubscribing=function(t,e,n,i,r){return s.g(t,"sessionId"),s.a(e,"capabilities"),o.isNullOrUndefined(i)||(s.isArray(i,"additionalStreamIds"),o.forEach(i,function(t){s.g(t,"alternateOriginStreamId")})),n={sessionId:t,capabilities:e,originStreamId:n},i&&0<i.length&&(n.alternateOriginStreamIds=i),this.Tn?this.Tn(f,n,o.bind(m,this,f,r)):this.Cn?(n=l.call(this,a.postWithRetry,a,this.Cn+this.Mn.createStreamTokenPath,n,u),d.call(this,n,r)):void r(null,{status:"unauthorized"})},t}.apply(e,n))||(t.exports=n)},function(t,e,n){n=[n(0),n(1),n(5),n(2),n(43),n(37),n(46),n(23),n(16),n(15),n(24),n(41),n(14)];void 0===(n=function(g,y,t,w,e,s,l,b,p,d,c,k,S){"use strict";var m=["streaming","rtmp"];function n(t){y.a(t,"options"),t.pcastExpress&&y.a(t.pcastExpress,"options.pcastExpress"),this.xn=t.pcastExpress||new e(t),this.qn=!t.pcastExpress,this.Dn={},this.An=[],this.Un={},this.jn=[],this.Nn={},this.X=this.xn.getPCast().getLogger(),this.P=new w.DisposableList,this.fe=!1,this.xt=new S(t.features),this.Fn=!1,this.Ln=null;var n=this;this.xn.getPCastObservable().subscribe(function(e){e&&(n.X.info("Resetting Room Express after change in pcast."),n.xn.waitForOnline(function(){n.xn.getPCastObservable().getValue()===e&&g.forOwn(n.Dn,function(t){t.setPCast(e)})}))})}function E(t){try{return this.xn.parseCapabilitiesFromToken(t)}catch(t){return}}function v(e,n,i){var r=this,o=g.uniqueId();this.xn.waitForOnline(function(t){return t?i(t):(t=R.call(r,e,n))?(r.X.info("Reusing room service for room [%s]/[%s]",e,n),i(null,{status:"ok",roomService:t})):(r.Dn[o]=new s(r.xn.getPCast()),t=function(r,t){var o=this,e=r.stop,s=r.leaveRoom;return r.stop=function(){e.apply(r,arguments),delete o.Dn[t]},r.leaveRoom=function(n,t){var i=r.getObservableActiveRoom().getValue();s.call(r,function(t,e){return t?(r.stop("leave-room-failure"),n(t)):("ok"!==e.status&&"not-in-room"!==e.status||(o.X.info("Successfully disposed Express Room Service [%s]",i?i.getRoomId():"Uninitialized"),r.stop("leave-room")),n(null,e))},t)},r}.call(r,r.Dn[o],o),r.X.info("Creating room service for room [%s]/[%s]",e,n),void i(null,{status:"ok",roomService:t}))})}function R(e,n){return g.find(this.jn,function(t){return(t=t.getObservableActiveRoom().getValue())&&(t.getRoomId()===e||t.getObservableAlias().getValue()===n)})}function h(s,a,u){var c=this,h=s.role,f=s.screenName||g.uniqueId();v.call(c,s.roomId,s.alias,function(t,e){if(t)return a(t);if("ok"!==e.status)return a(null,e);function n(){var t=r.getValue();t?(c.X.info("Setup member subscription for room [%s]",t.getRoomId()),o=t.getObservableMembers().subscribe(u,{initial:"notify"}),c.P.add(r.subscribe(function(t){o&&(u([]),o.dispose(),o=null),t&&(o=t.getObservableMembers().subscribe(u,{initial:"notify"}))}))):c.X.warn("Unable to setup members subscription. Not in room.")}var i=e.roomService,r=i.getObservableActiveRoom(),t=r.getValue(),o=null;if(t||i.start(h,f),s.streams&&0<s.streams.length){if(e=s.streams[0],s.streamsWildcardTokenCapabilities&&!g.includes(s.streams[0].uri,b.getPCastPrefix())&&(s.streams[0].uri=b.getPCastPrefix()+s.streams[0].uri,c.An.push(s.streams[0].uri)),s.streamsWildcardTokenCapabilities&&t&&!g.includes(e.uri,"streamToken"))return T.call(c,s,e,t,function(t,e){if(a(t,g.assign({roomService:i},e)),u)return n()});e=!s.streamsWildcardTokenCapabilities||t||g.includes(e.uri,"streamToken")?s.role:d.roles.audience.name,function(t,e,n,i){var r=n?n.getObservableActiveRoom().getValue():null;if(t&&n&&n.getSelf().setStreams(t),e&&n&&n.getSelf().getObservableRole().setValue(0===t.length?d.roles.audience.name:e),r&&n.getSelf())return q.call(this,n.getSelf(),i)}.call(c,s.streams,e,i,function(t){if(t)return a(t)})}if(t)return a(null,{status:"ok",roomService:i}),void(u&&n());i.enterRoom(s.roomId,s.alias,function(t,e){return t?(i.stop("enter-room-failure"),a(t)):"not-found"===e.status?(i.stop("enter-room-failure"),a(null,{status:"room-not-found"})):"ok"!==e.status&&"already-in-room"!==e.status?(i.stop("enter-room-failure"),a(null,e)):(t=e.room,e=g.get(s,["streams",0]),c.jn.push(i),s.streamsWildcardTokenCapabilities&&e&&!g.includes(e.uri,"streamToken")?T.call(c,s,e,t,function(t,e){if(a(t,g.assign({roomService:i},e)),u)return n()}):(a(null,{status:"ok",roomService:i}),u?n():void 0))})})}function f(e,t){this.Un[t.getRoomId()]&&e&&(this.Un[t.getRoomId()]=g.filter(this.Un[t.getRoomId()],function(t){return t.getStreamId()!==e.getStreamId()}))}function I(t,e,n,i){var r,o,s,a=t.streamType,u=t.streamInfo,c=[];if(t.streamToken){var h=E.call(this,t.streamToken);if(!h)return i(new Error("Bad `streamToken`"),{status:"bad-token"});c=h}else c=t.capabilities;return r=a,o=u,s=c,e=(a=(h=e).getStream())?a.getAudioTracks():null,a=a?a.getVideoTracks():null,e=0<e.length&&e[0].enabled,a=0<a.length&&a[0].enabled,s.includes("audio-only")&&(a=!1),s.includes("video-only")&&(e=!1),a={uri:b.getPCastPrefix()+h.getStreamId(),type:r,audioState:(e?k.states.trackEnabled:k.states.trackDisabled).name,videoState:(a?k.states.trackEnabled:k.states.trackDisabled).name},delete(o=g.assign({},o,{streamToken:void 0,streamTokenForBroadcastStream:void 0,streamTokenForLiveStream:void 0})).streamToken,delete o.streamTokenForBroadcastStream,delete o.streamTokenForLiveStream,0<(o=g.reduce(o,function(t,e,n){return t+(t?"&":"?")+n+"="+e},"")).length&&(a.uri=a.uri+o),u=M(a,"capabilities",s.join(",")),t.enableWildcardCapability?T.call(this,t,u,n,i):(c=R.call(this,n.getRoomId(),n.getObservableAlias().getValue()),u=g.assign({},t,{streams:O.call(this,u,n)}),x.call(this,u.streams,u.memberRole,c,n,u,i))}function T(o,s,n,a){var u,c=this,t="high-availability"===o.viewerStreamSelectionStrategy&&n.getObservableType().getValue()===p.types.channel.name,h=[],i=a,f=b.parsePCastStreamIdFromStreamUri(g.get(s,"uri","")),e=c.getPCastExpress().getPCast().getProtocol(),r=e?e.getSessionId():"",d=c.Nn[f];if(!g.includes(s,"capabilities"))if(o.streamToken){if(!(e=E.call(c,o.streamToken)))return a(new Error("Bad `streamToken`"),{status:"bad-token"});s=M(s,"capabilities",e.join(","))}else s=M(s,"capabilities",o.capabilities.join(","));return t&&(h=P(l.getSimilarMembers(o.screenName,r,n.getObservableMembers().getValue())),i=function(t,e){a(t,e);var i,r=g.get(e,"roomService",R.call(c,n.getRoomId(),n.getObservableAlias().getValue()));t||"ok"!==e.status||u||!r||(i=r.getObservableActiveRoom().getValue(),u=i.getObservableMembers().subscribe(function(t){var e=(n=r.getSelf())?n.getSessionId():"",t=(t=P(l.getSimilarMembers(o.screenName,e,t))).length===h.length&&g.reduce(t,function(t,e){return t&&g.includes(h,e)},!0),n=n?n.getObservableStreams().getValue():[];if(!g.find(n,function(t){return t.getPCastStreamId()===f}))return u.dispose(),void(u=null);t||(c.X.debug("Members with similar content to stream [%s] have changed. Generating new wildcard viewer token",f),u.dispose(),u=null,T.call(c,o,s,i,function(t,e){!t&&"ok"===e.status||a(t,e)}))}),d&&d.add(u))}),function(t,e,n,i,r){function o(t,e){if(!u){if(t||"ok"!==e.status)return c(),u=!0,r(t,e);++a===s.length&&r(null,{status:"ok"})}}var s=[],a=0,u=!1,c=function(){g.forEach(s,function(t){t.dispose()})};this.X.debug("Creating [real-time] and [broadcast] viewer wildcard stream token for published stream [%s] with [%s] additional streams",e,n.length),s.push(C.call(this,[],e,n,i,"streamToken",o)),s.push(C.call(this,["broadcast"],e,n,i,"streamTokenForBroadcastStream",o));var h=g.filter(t,g.bind(g.includes,null,m));return 0<h.length&&(this.X.debug("Creating [%s] viewer wildcard stream token for published stream [%s] with [%s] additional streams",h,e,n.length),s.push(C.call(this,h,e,n,i,"streamTokenForLiveStream",o))),g.includes(t,"drm")&&(this.X.debug("Creating [drm-open-access] and [drm-hollywood] viewer wildcard stream token for published stream [%s] with [%s] additional streams",e,n.length),s.push(C.call(this,["streaming","drm-open-access"],e,n,i,"streamTokenForLiveStreamWithDrmOpenAccess",o)),s.push(C.call(this,["streaming","drm-hollywood"],e,n,i,"streamTokenForLiveStreamWithDrmHollywood",o))),c}.call(this,o.capabilities,f,h,s,function(t,e){return t?a(t):"ok"!==e.status?a(null,e):(t=R.call(c,n.getRoomId(),n.getObservableAlias().getValue()),e=g.assign({},o,{streams:O.call(c,s,n)}),x.call(c,e.streams,e.memberRole,t,n,e,i))})}function C(t,e,n,i,r,o){if(!this.xn.getAdminAPI())throw new Error('Set "options.enableWildcardCapability" to "false", or set adminApiProxyClient on initiating room express');return this.xn.getAdminAPI().createStreamTokenForSubscribing("*",t,e,n,function(t,e){return t?o(t):"ok"!==e.status?o(null,e):(i=M(i,r,e.streamToken),void o(null,e))})}function M(t,e,n){var i=-1<(r=t.uri.indexOf("?"))?"&":"?",r=-1===(o=t.uri.indexOf("#",-1===r?t.uri.length:r))?t.uri:t.uri.substring(0,o),o=-1===o?"":t.uri.substring(o);return t.uri=r+i+e+"="+n+o,t}function P(t){return g.reduce(t,function(t,e){return(e=(e=g.get(e.getObservableStreams().getValue(),"0"))?e.getPCastStreamId():"")&&t.push(e),t},[])}function O(r,t){var e=this,n=R.call(this,t.getRoomId(),t.getObservableAlias().getValue()),i=r?[r]:[];if(!n)return i;if(!(n=n.getSelf()))return i;var n=g.map(n.getObservableStreams().getValue(),function(t){return t.toJson()}),t=this.Un[t.getRoomId()]||[],o=g.map(t,function(t){return t.getStreamId()});return n&&0!==n.length?(r&&(n=g.filter(n,function(t){var e=t.uri===r.uri,n=!!(i=b.parsePCastStreamIdFromStreamUri(t.uri))&&i===b.parsePCastStreamIdFromStreamUri(r.uri),i=r.uri.split("?")[0]===t.uri.split("?")[0],t=t.type===r.type;return!e&&!n&&!i||!t})).push(r),g.filter(n,function(t){return!b.parsePCastStreamIdFromStreamUri(t.uri)||g.includes(o,b.parsePCastStreamIdFromStreamUri(t.uri)||t.uri)||g.includes(e.An,t.uri.split("?")[0])})):i}function x(t,e,n,i,r,o){var s=R.call(this,i.getRoomId(),i.getObservableAlias().getValue()),a=n?n.getObservableActiveRoom().getValue():null,n=!a&&!s;return this.fe?this.X.warn("Unable to update self after express room service disposal."):(t&&s&&(this.X.debug("Preparing member streams for update in room [%s].",i.getRoomId()),s.getSelf().setStreams(t)),e&&s&&s.getSelf().getObservableRole().getValue()!==e&&(this.X.debug("Preparing member role for update in room [%s].",i.getRoomId()),s.getSelf().getObservableRole().setValue(e)),a&&s.getSelf()?q.call(this,s.getSelf(),o):void(n&&(this.X.info("Joining room with member [%s].",i.getRoomId()),r=g.assign({role:e,alias:g.get(r,["room","alias"]),roomId:g.get(r,["room","roomId"])},r),h.call(this,r,function(t,e){return t?o(t):"ok"!==e.status&&"already-in-room"!==e.status?o(null,e):void o(t,e)}))))}function q(i,r){var o=0,s=this;try{i.commitChanges(function t(e,n){return!e&&n||o++,e=(e=i.getRoomService())?e.getObservableActiveRoom().getValue():null,n&&"ok"===n.status||!e&&"not-found"===n.status?(o=0,s.Fn=!1,!r||r(null,n)):(n&&"ok"!==n.status&&o++,5<=o?(s.X.warn("Unable to update self after [%s] attempts.",5),g.u(n.lastUpdate)&&(s.X.warn("Updating self last update from [%s] to [%s] to prevent permanent failure state. Our awareness of self does not match up with the server anymore.",i.getObservableLastUpdate().getValue(),n.lastUpdate),i.getObservableLastUpdate().setValue(n.lastUpdate)),s.Fn=!1,r(new Error("Unable to update self"))):0<o&&o<5?(s.X.info("Unable to update self after [%s] attempts. Retrying.",o),i.commitChanges(t)):void 0)})}catch(t){r(t)}}function D(t,e,n){return e?t(e):n.retry?n.retry():void t(e,n)}return n.prototype.dispose=function(){this.fe=!0,function(){g.forOwn(this.Un,function(t){g.forEach(t,function(t){t.stop("dispose")})}),g.forOwn(this.Dn,function(t){t.stop("dispose")}),this.Un={},this.An=[],this.Dn={},this.jn=[]}.call(this),this.qn&&this.xn.dispose(),this.P.dispose(),this.X.info("Disposed Room Express Instance")},n.prototype.getPCastExpress=function(){return this.xn},n.prototype.createRoom=function(i,r){y.h(r,"callback"),y.a(i.room,"options.room"),y.g(i.room.name,"options.room.name"),y.g(i.room.type,"options.room.type"),i.room.description&&y.g(i.room.description,"options.room.description");var o=i.room.description||function(){switch(i.room.type){case p.types.channel.name:return"Room Channel";case p.types.moderatedChat.name:return"Moderated Chat";case p.types.multiPartyChat.name:return"Multi Party Chat";case p.types.townHall.name:return"Town Hall";case p.types.directChat.name:return"Direct Chat";default:throw new Error("Unsupported Room Type")}}();v.call(this,null,null,function(t,e){if(t)return r(t);if("ok"!==e.status)return r(null,e);var n=e.roomService;(e=g.assign({},i.room)).description||(e.description=o),n.createRoom(e,function(t,e){return t?r(t):(n.stop("create"),r(null,e))})})},n.prototype.joinRoom=function(t,o,e){var n;y.a(t,"options"),y.h(o,"joinRoomCallback"),y.g(t.role,"options.role"),e&&y.h(e,"membersChangedCallback"),t.screenName&&y.g(t.screenName,"options.screenName"),t.roomId&&y.g(t.roomId,"options.roomId"),t.alias&&y.g(t.alias,"options.alias"),t.streams&&y.isArray(t.streams,"options.streams"),t.streamToken&&(y.g(t.streamToken,"options.streamToken"),t.roomId&&this.X.warn("Trying to join room with both streamToken and roomId. Please only use streamToken."),t.alias&&this.X.warn("Trying to join room with both streamToken and alias. Please only use streamToken."),n=this.xn.parseRoomOrChannelIdFromToken(t.streamToken),r=this.xn.parseRoomOrChannelAliasFromToken(t.streamToken),n&&(t.roomId=n,this.X.info("Room ID is set to [%s] from streamToken [%s]",n,t.streamToken)),r&&(t.alias=r,this.X.info("Alias is set to [%s] from streamToken [%s]",r,t.streamToken)));var i=this,r=function(r){r&&h.call(i,t,function(t,e){var n,i=e;i&&i.roomService&&(n=i.roomService.leaveRoom,i.roomService.leaveRoom=function(t,e){s&&"offline"!==r.getObservableStatus()&&s.dispose(),n(t,e)}),o(t,e)},e)};if(this.xn.getPCastObservable())return r(this.xn.getPCastObservable());var s=this.xn.getPCastObservable().subscribe(r)},n.prototype.publishToRoom=function(r,o){y.a(r,"options"),y.h(o,"callback"),y.a(r.room,"options.room");var t=this.xn.getAdminAPI();if(r.streamUri?y.g(r.streamUri,"options.streamUri"):r.mediaConstraints?y.a(r.mediaConstraints,"options.mediaConstraints"):y.a(r.userMediaStream,"options.userMediaStream"),r.videoElement&&y.a(r.videoElement,"options.videoElement"),r.screenName&&y.g(r.screenName,"options.screenName"),r.tags&&y.isArray(r.tags,"options.tags"),r.streamInfo&&y.a(r.streamInfo,"options.streamInfo"),r.streamToken&&(y.g(r.streamToken,"options.streamToken"),this.X.warn("`options.streamToken` is deprecated please use `options.publishToken`.")),r.publishToken&&r.capabilities)throw new Error("Do not pass `options.capabilities` with `options.publishToken`. `options.publishToken` should include capabilities in the token.");if(r.publishToken&&r.streamToken)throw new Error("Do not pass `options.streamToken` with `options.publishToken`. Please use `options.publishToken`.");if(r.streamToken&&r.capabilities)throw new Error("Do not pass `options.capabilities` with `options.streamToken`. `options.streamToken` should include capabilities in the token.");if(!r.streamToken&&!r.publishToken&&!t)throw new Error("Pass `options.publishToken`, or set adminApiProxyClient on initiating room express");r.viewerStreamSelectionStrategy&&y.g(r.viewerStreamSelectionStrategy,"options.viewerStreamSelectionStrategy"),r.capabilities&&y.isArray(r.capabilities,"options.capabilities"),g.isUndefined(r.enableWildcardCapability)&&(r.enableWildcardCapability=!(r.publishToken||r.streamToken)),y.b(r.streamType,c.types,"options.streamType"),y.b(r.memberRole,d.roles,"options.memberRole"),y.f(r.enableWildcardCapability,"options.enableWildcardCapability");var s=this,a=r.screenName||g.uniqueId(),e=r.room.roomId,n=r.room.alias;function i(t,n){var e=g.assign({monitor:{callback:g.bind(D,s,o),options:{conditionCountForNotificationThreshold:8}},streamInfo:{}},r);if(t.getObservableType().getValue()===p.types.channel.name?e.tags=["channelId:"+t.getRoomId(),"channelAlias:"+t.getObservableAlias().getValue()].concat(e.tags||[]):e.tags=["roomId:"+t.getRoomId(),"roomAlias:"+t.getObservableAlias().getValue()].concat(e.tags||[]),r.streamUri){var i=g.assign({connectOptions:[]},e);return g.find(i.connectOptions,function(t){return g.startsWith(t,"room-id")})||(i.connectOptions=i.connectOptions.concat(["room-id="+t.getRoomId(),"member-role="+r.memberRole,"member-stream-type="+r.streamType,"screen-name="+a])),r.enableWildcardCapability&&i.connectOptions.concat(["member-stream-token-type=Wildcard","member-stream-token-refresh-interval="+3e5]),s.xn.publishRemote(i,function(t,e){o(t,e&&g.assign({roomService:null},e))})}!function(r,o,n){function t(t,e){if(a&&s&&clearInterval(a),t)return c(t);if("ok"!==e.status)return c(null,e);!function(t,e){this.Un[e.getRoomId()]||(this.Un[e.getRoomId()]=[]),this.Un[e.getRoomId()].push(t)}.call(u,e.publisher,o),f.call(u,s,o),s=e.publisher,u.Nn[s.getStreamId()]=new w.DisposableList;var i=g.bind(s.stop,s);s.stop=function(){clearInterval(a),f.call(u,s,o);var t=O.call(u,null,o),e=R.call(u,o.getRoomId()),n=u.Nn[s.getStreamId()];n&&(n.dispose(),delete u.Nn[s.getStreamId()]),i.apply(s,arguments),e&&x.call(u,t,0===t.length?d.roles.audience.name:r.memberRole,e,o,r,function(t){if(t)return c(t)})},function(r,o,s){var t,a=this,u=r.getStream();u&&(t=u.getTracks(),g.forEach(t,function(i){var e=function(){a.Fn=!0;var t=(i.enabled?k.states.trackEnabled:k.states.trackDisabled).name;if((n=R.call(a,o.getRoomId()))&&n.getSelf()){var e=n.getSelf().getObservableStreams().getValue(),n=g.find(e,function(t){return t.getPCastStreamId()===r.getStreamId()}),e=function(e){var t=g.find(this.jn,function(t){return t=(t=t.getSelf())?t.getObservableStreams().getValue():[],g.find(t,function(t){return e===t})});return t?t.getSelf():null}.call(a,n);if(!n)return a.X.warn("[%s] [%s] Unable to update member state change after track state change [%s]. Member stream no longer exists on member model.",u.id,i.id,i.enabled);a.X.info("[%s] [%s] Track state changed to [%s], updating room member stream state [%s]",u.id,i.id,i.enabled,t),("video"===i.kind?n.getObservableVideoState():n.getObservableAudioState()).setValue(t),e&&q.call(a,e,s)}};i.updateState=function(t){this.enabled=t,function t(){a.Ln&&(clearTimeout(a.Ln),a.Ln=null),a.Fn?a.Ln=setTimeout(function(){t()}):e()}()}}))}.call(u,s,o,c),r.enableWildcardCapability&&(a=setInterval(function(){u.X.info("Refresh wildcard viewer stream token for [%s] interval of [%s] has expired. Creating new token.",s.getStreamId(),3e5);var t=(t=R.call(u,o.getRoomId(),o.getObservableAlias().getValue()))?t.getObservableActiveRoom().getValue():o;I.call(u,r,s,t,function(t,e){!t&&"ok"===e.status||c(t,e)})},3e5),u.P.add(new w.Disposable(function(){clearInterval(a)}))),I.call(u,r,e.publisher,o,c)}var s,a,u=this,c=function(t,e){n(t,e&&g.assign({publisher:s},e))};if(g.get(r,["mediaConstraints","screen"],!1))return g.set(r,["streamInfo","isScreen"],!0),this.xn.publishScreen(r,t);this.xn.publish(r,t)}.call(s,e,t,function(t,e){o(t,e&&g.assign({roomService:n.roomService},e))})}(r.publishToken||r.streamToken)&&(e=this.xn.parseRoomOrChannelIdFromToken(r.publishToken||r.streamToken),n=this.xn.parseRoomOrChannelAliasFromToken(r.publishToken||r.streamToken),this.X.info("[%s] [%s] RoomId and Alias read from token [%s]",e,n,r.publishToken||r.streamToken));var u=R.call(s,e,n);u?i(t=u.getObservableActiveRoom().getValue(),{roomService:u}):(n=g.assign({},r,{role:d.roles.audience.name,roomId:e,alias:n}),h.call(this,n,function(t,e){return t?o(t):"ok"!==e.status?o(null,e):void i(t=e.roomService.getObservableActiveRoom().getValue(),e)},function(){return null}))},n.prototype.publishScreenToRoom=function(t,e){t=g.assign({mediaConstraints:{screen:!0}},t),this.publishToRoom(t,e)},n.prototype.subscribeToMemberStream=function(n,r,o,s){var a=this;if(y.a(n,"memberStream"),y.a(r,"options"),y.h(o,"callback"),s=g.u(s)?s:0,r.capabilities)throw new Error("subscribeToMemberStream options.capabilities is deprecated. Please use the constructor features option");if(r.streamToken&&!(l=E.call(a,r.streamToken)))return a.X.warn("Failed to parse the `streamToken` [%s]",r.streamToken),o(new Error("Bad `streamToken`"),{status:"bad-token"});var t,e,u=n.getUri(),c=n.getPCastStreamId(),i=n.getInfo(),h=g.get(i,["isScreen"],!1),f=null,d=i.capabilities||(t=u,e=b.getInfoFromStreamUri(t),t=[],e.streamTokenForLiveStream&&t.push("streaming"),t)||[],e=this.xt.getPreferredFeatureFromPublisherCapabilities(l||d),t=S.mapFeatureToPCastCapability(e),l=t?[t]:[],p=this.xt.getFeaturePCastCapabilities(),m=!1;if(!c)throw this.X.error("Invalid Member Stream. Unable to parse streamId from uri"),new Error("Invalid Member Stream. Unable to parse streamId from uri");if(g.hasIndexOrKey(i,"capabilities")){if(!e)return this.X.warn("Unable to find supported feature. Publisher capabilities [%s]. Requested feature capabilities [%s]",i.capabilities,p),o(null,{status:"unsupported-features"});f=function(t){var e=b.getInfoFromStreamUri(u);switch(t){case"rtmp":case"hls":case"dash":return e.streamTokenForLiveStream;case"real-time":return e.streamToken;default:return}}(e)}else{if(!e){if(!(d=g.get(p,[s]))&&s>=p.length)return o(null,{status:"no-supported-features"});l=d?[d]:[],e=d?g.get(S.mapPCastCapabilityToFeatures(d),[0]):null}if(!i.streamTokenForLiveStream&&"streaming"===t)return this.X.warn("Streaming is not available for stream [%].",c),o(null,{status:"streaming-not-available"});f=function(t,e){var n=b.getInfoFromStreamUri(u),i=n.streamTokenForLiveStream&&g.includes(e,"streaming"),t=n.streamTokenForLiveStream&&g.includes(e,"rtmp");if(!g.includes(e,"drm-open-access")||!g.includes(e,"drm-hollywood"))return i&&n.streamTokenForLiveStreamWithDrmOpenAccess&&(g.includes(e,"drm-open-access")||S.isAndroid())?n.streamTokenForLiveStreamWithDrmOpenAccess:i&&n.streamTokenForLiveStreamWithDrmHollywood&&g.includes(e,"drm-hollywood")?n.streamTokenForLiveStreamWithDrmHollywood:i||t?n.streamTokenForLiveStream:n.streamTokenForBroadcastStream&&g.includes(e,"broadcast")?n.streamTokenForBroadcastStream:g.includes(e,"streaming")||g.includes(e,"broadcast")||g.includes(e,"rtmp")?void 0:n.streamToken}(0,l),m=!0}this.X.info("Subscribing to member stream with feature [%s] and pre-generated token [%s]",e,!!f);var l=g.assign({},{streamId:c,streamToken:f,capabilities:l},r),v=new w.DisposableList;!function(t,e,i){function n(t,e){if(t)return i(t);if("ok"!==e.status&&"streaming-not-ready"!==e.status)return i(null,e);if(o++,!("streaming-not-ready"===e.status&&o<3))return"streaming-not-ready"===e.status&&3<=o?i(null,{status:e.status}):(e=g.assign({},e,{status:"ok"}),1<o?(e.reason="stream-failure-recovered",i(null,e)):void i(null,e));t=o*o*1e3,r.X.info("Waiting for [%s] ms before retrying after [streaming-not-ready] status.",t);var n=setTimeout(e.retry,t);r.P.add(new w.Disposable(function(){clearTimeout(n)}))}var r=this,o=0;return e?r.xn.subscribeToScreen(t,n):r.xn.subscribe(t,n)}.call(this,l,h,function(t,i){if(v.dispose(),i&&"ok"===i.status&&i.mediaStream&&i.mediaStream.getStream()&&(v.add(n.getObservableAudioState().subscribe(function(t){var e=i.mediaStream.getMonitor(),n=i.mediaStream.getStream().getAudioTracks();e&&1===n.length&&e.setMonitorTrackState(n[0],t===k.states.trackEnabled.name)},{initial:"notify"})),v.add(n.getObservableVideoState().subscribe(function(t){var e=i.mediaStream.getMonitor(),n=i.mediaStream.getStream().getVideoTracks();e&&1===n.length&&e.setMonitorTrackState(n[0],t===k.states.trackEnabled.name)},{initial:"notify"}))),t&&6===parseInt(t.category))return o(t,{status:"device-insecure"});if(i&&("failed"===i.status||"streaming-not-available"===i.status)&&m&&s<p.length)return a.X.info("Attempting to subscribe to member stream with next available feature after failure"),a.subscribeToMemberStream(n,r,o,s+1);var e=g.assign({originStreamId:c},i);o(t,e)})},n}.apply(e,n))||(t.exports=n)},function(t,e,n){n=[n(0),n(1)];void 0===(n=function(o,i){"use strict";var s="most-recent";function t(t,e,n){t&&i.g(t,"selectionStrategy"),i.a(e,"logger"),this.Bn=t||s,this.X=e,this._n=o.get(n,["failureCountForBanningAMember"],100),this.Wn=o.get(n,["banMemberOnCapacityFailureCount"],5),this.reset()}function a(t){return t?t.getSessionId()+t.getObservableScreenName().getValue():""}function u(t){return h(t.getObservableScreenName().getValue())}function c(t){return f(t.getObservableScreenName().getValue())}function h(t){return/primary/i.test(t)}function f(t){return/alternate/i.test(t)}return t.prototype.getNext=function(t){this.X.info("Select member from [%s]",t);var e=function(t){var e,i=this;switch(this.Bn){case s:return e=o.reduce(t,function(t,e){var n=a(e);return o.get(i.Vn,[n],!1)||t.push(e),t},[]),o.reduce(e,function(t,e){return t&&t.getLastUpdate()>e.getLastUpdate()?t:e});case"high-availability":if(this.zn&&o.includes(t,this.zn))return this.zn;var n=void 0,r=Number.MAX_VALUE;return o.forEach(t,function(t){var e=a(t);o.get(i.Vn,[e],!1)||((e=o.get(i.Gn,[t],0))<r?(r=e,n=t):e===r&&(n?u(t)?u(n)||(n=t):c(t)&&(u(n)||c(n)||(n=t)):n=t))}),n;default:throw new Error("Invalid Selection Strategy")}}.call(this,t);return e?this.X.info("Selecting new member [%s]/[%s]",e.getSessionId(),e.getObservableScreenName().getValue()):this.X.info("Unable to select new member from [%s]",t),this.zn=e},t.prototype.getStrategy=function(){return this.Bn},t.prototype.markFailed=function(t){if(this.zn){var e=a(this.zn);if(o.get(t,["failedDueToCapacity"],!1)){var n=o.get(this.Jn,[e],0);if(o.set(this.Jn,[e],++n),n>=this.Wn)return this.X.info("Disabling member [%s] that has exceeded threshold due to [%s] capacity failures",e,n),this.markDead()}if(n=o.get(this.Gn,[e],0),this.X.info("Failure count for member [%s] is now [%s]",e,++n),o.set(this.Gn,[e],n),n>=this._n)return this.X.info("Disabling member [%s] that has exceeded threshold due to [%s] failures",e,n),this.markDead();this.zn=null}else this.X.warn("Marking failed member but there was no recent selected member")},t.prototype.markDead=function(){var t;this.zn?(t=a(this.zn),this.X.info("Member [%s] is now permanently removed",t),o.set(this.Vn,[t],!0),this.zn=null):this.X.warn("Marking dead member but there was no recent selected member")},t.prototype.getNumberOfMembersWithFailures=function(){return o.keys(this.Gn).length},t.prototype.reset=function(){this.zn=null,this.Gn={},this.Jn={},this.Vn={}},t.prototype.dispose=function(){this.reset()},t.getSimilarMembers=function(e,n,t){var i=o.filter(t,function(t){return t.getObservableScreenName().getValue()!==e&&(!n||t.getSessionId()!==n)}),r=o.filter(i,u),t=o.filter(i,c);return h(e)?r||t||i:f(e)?t||r||i:i||r||t},t}.apply(e,n))||(t.exports=n)},function(t,e,n){n=[n(0),n(1)];void 0===(n=function(t,e){"use strict";function n(t){e.a(t,"room"),this.Hn=t}return n.prototype.getChannelId=function(){return this.Hn.getRoomId.apply(this.Hn,arguments)},n.prototype.getObservableAlias=function(){return this.Hn.getObservableAlias.apply(this.Hn,arguments)},n.prototype.getObservableName=function(){return this.Hn.getObservableName.apply(this.Hn,arguments)},n.prototype.getObservableDescription=function(){return this.Hn.getObservableDescription.apply(this.Hn,arguments)},n.prototype.getObservableType=function(){return this.Hn.getObservableType.apply(this.Hn,arguments)},n.prototype.getObservableMembers=function(){return this.Hn.getObservableMembers.apply(this.Hn,arguments)},n.prototype.getObservableBridgeId=function(){return this.Hn.getObservableBridgeId.apply(this.Hn,arguments)},n.prototype.getObservablePin=function(){return this.Hn.getObservablePin.apply(this.Hn,arguments)},n.prototype.toString=function(){return this.Hn.toString.apply(this.Hn,arguments)},n.prototype.toJson=function(){return{channelId:this.Hn.getRoomId(),alias:this.Hn.getObservableAlias().getValue(),name:this.Hn.getObservableName().getValue(),description:this.Hn.getObservableDescription().getValue(),type:this.Hn.getObservableType().getValue(),pin:this.Hn.getObservablePin().getValue(),bridgeId:this.Hn.getObservableBridgeId().getValue()}},n.prototype.commitChanges=function(){return this.Hn.commitChanges.apply(this.Hn,arguments)},n.prototype.reload=function(){return this.Hn.reload.apply(this.Hn,arguments)},n.prototype.lt=function(){return this.Hn.lt.apply(this.Hn,arguments)},n.prototype.Ve=function(){return this.Hn.Ve.apply(this.Hn,arguments)},n.prototype.We=function(){return this.Hn.We.apply(this.Hn,arguments)},n.prototype.ze=function(){return this.Hn.ze.apply(this.Hn,arguments)},n}.apply(e,n))||(t.exports=n)},function(t,e,n){n=[n(3),n(10),n(26),n(37),n(105),n(109),n(42),n(43),n(45),n(113),n(44)];void 0===(n=function(t,e,n,i,r,o,s,a,u,c,h){"use strict";return{express:{PCastExpress:a,RoomExpress:u,ChannelExpress:c},lowLevel:{PCast:t.global.PhenixPCast=n,RoomService:i},media:{AudioSpeakerDetector:r,UserMediaResolver:s},net:{AdminApiProxyClient:h},utils:{BandwidthMonitor:o,logging:e,rtc:t},AudioSpeakerDetector:r,BandwidthMonitor:o,logging:e,PCast:n,RoomService:i,RTC:t,UserMediaResolver:s}}.apply(e,n))||(t.exports=n)},function(n,t,i){"use strict";!function(t){var e=i(50);n.exports=e({window:t.window})}.call(this,i(25))},function(t,e,d){"use strict";t.exports=function(t,e){var n,i=t&&t.window,r={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0};for(n in e)hasOwnProperty.call(e,n)&&(r[n]=e[n]);var o=d(7),s=o.log,a={browserDetails:t=o.detectBrowser(i),extractVersion:o.extractVersion,disableLog:o.disableLog,disableWarnings:o.disableWarnings},u=d(51)||null,c=d(53)||null,h=d(57)||null,f=d(59)||null;switch(t.browser){case"chrome":if(!u||!u.shimPeerConnection||!r.shimChrome)return s("Chrome shim is not included in this adapter release."),a;s("adapter.js shimming chrome."),(a.browserShim=u).shimGetUserMedia(i),u.shimMediaStream(i),o.shimCreateObjectURL(i),u.shimSourceObject(i),u.shimPeerConnection(i),u.shimOnTrack(i),u.shimAddTrackRemoveTrack(i),u.shimGetSendersWithDtmf(i);break;case"firefox":if(!h||!h.shimPeerConnection||!r.shimFirefox)return s("Firefox shim is not included in this adapter release."),a;s("adapter.js shimming firefox."),(a.browserShim=h).shimGetUserMedia(i),o.shimCreateObjectURL(i),h.shimSourceObject(i),h.shimPeerConnection(i),h.shimOnTrack(i);break;case"edge":if(!c||!c.shimPeerConnection||!r.shimEdge)return s("MS edge shim is not included in this adapter release."),a;s("adapter.js shimming edge."),(a.browserShim=c).shimGetUserMedia(i),o.shimCreateObjectURL(i),c.shimPeerConnection(i),c.shimReplaceTrack(i);break;case"safari":if(!f||!r.shimSafari)return s("Safari shim is not included in this adapter release."),a;s("adapter.js shimming safari."),a.browserShim=f,o.shimCreateObjectURL(i),f.shimRTCIceServerUrls(i),f.shimCallbacksAPI(i),f.shimLocalStreamsAPI(i),f.shimRemoteStreamsAPI(i),f.shimGetUserMedia(i);break;default:s("Unsupported browser!")}return a}},function(t,e,n){"use strict";var s=n(7),i=s.log,r={shimMediaStream:function(t){t.MediaStream=t.MediaStream||t.webkitMediaStream},shimOnTrack:function(o){var t;"object"!=typeof o||!o.RTCPeerConnection||"ontrack"in o.RTCPeerConnection.prototype||(Object.defineProperty(o.RTCPeerConnection.prototype,"ontrack",{get:function(){return this.Kn},set:function(t){this.Kn&&this.removeEventListener("track",this.Kn),this.addEventListener("track",this.Kn=t)}}),t=o.RTCPeerConnection.prototype.setRemoteDescription,o.RTCPeerConnection.prototype.setRemoteDescription=function(){var r=this;return r.Qn||(r.Qn=function(i){i.stream.addEventListener("addtrack",function(e){var t=o.RTCPeerConnection.prototype.getReceivers?r.getReceivers().find(function(t){return t.track.id===e.track.id}):{track:e.track},n=new Event("track");n.track=e.track,n.receiver=t,n.streams=[i.stream],r.dispatchEvent(n)}),i.stream.getTracks().forEach(function(e){var t=o.RTCPeerConnection.prototype.getReceivers?r.getReceivers().find(function(t){return t.track.id===e.id}):{track:e},n=new Event("track");n.track=e,n.receiver=t,n.streams=[i.stream],r.dispatchEvent(n)})},r.addEventListener("addstream",r.Qn)),t.apply(r,arguments)})},shimGetSendersWithDtmf:function(t){var i,r,e,n,o,s;"object"==typeof t&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype?(i=function(t,e){return{track:e,get dtmf(){return void 0===this.Xn&&("audio"===e.kind?this.Xn=t.createDTMFSender(e):this.Xn=null),this.Xn},Zn:t}},t.RTCPeerConnection.prototype.getSenders||(t.RTCPeerConnection.prototype.getSenders=function(){return this.$n=this.$n||[],this.$n.slice()},r=t.RTCPeerConnection.prototype.addTrack,t.RTCPeerConnection.prototype.addTrack=function(t,e){var n=r.apply(this,arguments);return n||(n=i(this,t),this.$n.push(n)),n},e=t.RTCPeerConnection.prototype.removeTrack,t.RTCPeerConnection.prototype.removeTrack=function(t){e.apply(this,arguments),-1!==(t=this.$n.indexOf(t))&&this.$n.splice(t,1)}),n=t.RTCPeerConnection.prototype.addStream,t.RTCPeerConnection.prototype.addStream=function(t){var e=this;e.$n=e.$n||[],n.apply(e,[t]),t.getTracks().forEach(function(t){e.$n.push(i(e,t))})},o=t.RTCPeerConnection.prototype.removeStream,t.RTCPeerConnection.prototype.removeStream=function(t){var n=this;n.$n=n.$n||[],o.apply(n,[n.sn[t.id]||t]),t.getTracks().forEach(function(e){var t=n.$n.find(function(t){return t.track===e});t&&n.$n.splice(n.$n.indexOf(t),1)})}):"object"==typeof t&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)&&(s=t.RTCPeerConnection.prototype.getSenders,t.RTCPeerConnection.prototype.getSenders=function(){var e=this,t=s.apply(e,[]);return t.forEach(function(t){t.Zn=e}),t},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this.Xn&&("audio"===this.track.kind?this.Xn=this.Zn.createDTMFSender(this.track):this.Xn=null),this.Xn}}))},shimSourceObject:function(t){var n=t&&t.URL;"object"==typeof t&&(!t.HTMLMediaElement||"srcObject"in t.HTMLMediaElement.prototype||Object.defineProperty(t.HTMLMediaElement.prototype,"srcObject",{get:function(){return this.Yn},set:function(t){var e=this;this.Yn=t,this.src&&n.revokeObjectURL(this.src),t?(this.src=n.createObjectURL(t),t.addEventListener("addtrack",function(){e.src&&n.revokeObjectURL(e.src),e.src=n.createObjectURL(t)}),t.addEventListener("removetrack",function(){e.src&&n.revokeObjectURL(e.src),e.src=n.createObjectURL(t)})):this.src=""}}))},shimAddTrackRemoveTrack:function(r){var n,i,e;r.RTCPeerConnection.prototype.addTrack||(n=r.RTCPeerConnection.prototype.getLocalStreams,r.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this,t=n.apply(this);return e.ti=e.ti||{},t.map(function(t){return e.ti[t.id]})},i=r.RTCPeerConnection.prototype.addStream,r.RTCPeerConnection.prototype.addStream=function(t){var e,n=this;n.sn=n.sn||{},n.ti=n.ti||{},t.getTracks().forEach(function(e){if(n.getSenders().find(function(t){return t.track===e}))throw new DOMException("Track already exists.","InvalidAccessError")}),n.ti[t.id]||(e=new r.MediaStream(t.getTracks()),n.sn[t.id]=e,n.ti[e.id]=t,t=e),i.apply(n,[t])},e=r.RTCPeerConnection.prototype.removeStream,r.RTCPeerConnection.prototype.removeStream=function(t){this.sn=this.sn||{},this.ti=this.ti||{},e.apply(this,[this.sn[t.id]||t]),delete this.ti[(this.sn[t.id]||t).id],delete this.sn[t.id]},r.RTCPeerConnection.prototype.addTrack=function(e,t){var n=this;if("closed"===n.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var i=[].slice.call(arguments,1);if(1!==i.length||!i[0].getTracks().find(function(t){return t===e}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(n.getSenders().find(function(t){return t.track===e}))throw new DOMException("Track already exists.","InvalidAccessError");return n.sn=n.sn||{},n.ti=n.ti||{},(i=n.sn[t.id])?(i.addTrack(e),n.dispatchEvent(new Event("negotiationneeded"))):(i=new r.MediaStream([e]),n.sn[t.id]=i,n.ti[i.id]=t,n.addStream(i)),n.getSenders().find(function(t){return t.track===e})},r.RTCPeerConnection.prototype.removeTrack=function(e){var n,i=this;if("closed"===i.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e.Zn)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(e.Zn!==i)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");i.sn=i.sn||{},Object.keys(i.sn).forEach(function(t){i.sn[t].getTracks().find(function(t){return e.track===t})&&(n=i.sn[t])}),n&&(1===n.getTracks().length?i.removeStream(n):n.removeTrack(e.track),i.dispatchEvent(new Event("negotiationneeded")))})},shimPeerConnection:function(n){var o,t=s.detectBrowser(n);n.RTCPeerConnection?(o=n.RTCPeerConnection,n.RTCPeerConnection=function(t,e){if(t&&t.iceServers){for(var n=[],i=0;i<t.iceServers.length;i++){var r=t.iceServers[i];!r.hasOwnProperty("urls")&&r.hasOwnProperty("url")?(s.deprecated("RTCIceServer.url","RTCIceServer.urls"),(r=JSON.parse(JSON.stringify(r))).urls=r.url,n.push(r)):n.push(t.iceServers[i])}t.iceServers=n}return new o(t,e)},n.RTCPeerConnection.prototype=o.prototype,Object.defineProperty(n.RTCPeerConnection,"generateCertificate",{get:function(){return o.generateCertificate}})):(n.RTCPeerConnection=function(t,e){return i("PeerConnection"),t&&t.iceTransportPolicy&&(t.iceTransports=t.iceTransportPolicy),new n.webkitRTCPeerConnection(t,e)},n.RTCPeerConnection.prototype=n.webkitRTCPeerConnection.prototype,n.webkitRTCPeerConnection.generateCertificate&&Object.defineProperty(n.RTCPeerConnection,"generateCertificate",{get:function(){return n.webkitRTCPeerConnection.generateCertificate}}));var a=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(t,e,n){var i=this,r=arguments;if(0<arguments.length&&"function"==typeof t)return a.apply(this,arguments);if(0===a.length&&(0===arguments.length||"function"!=typeof t))return a.apply(this,[]);function o(t){var i={};return t.result().forEach(function(e){var n={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach(function(t){n[t]=e.stat(t)}),i[n.id]=n}),i}function s(e){return new Map(Object.keys(e).map(function(t){return[t,e[t]]}))}return 2<=arguments.length?a.apply(this,[function(t){r[1](s(o(t)))},t]):new Promise(function(e,t){a.apply(i,[function(t){e(s(o(t)))},t])}).then(e,n)},t.version<51&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var r=n.RTCPeerConnection.prototype[t];n.RTCPeerConnection.prototype[t]=function(){var n=arguments,i=this,t=new Promise(function(t,e){r.apply(i,[n[0],t,e])});return n.length<2?t:t.then(function(){n[1].apply(null,[])},function(t){3<=n.length&&n[2].apply(null,[t])})}}),t.version<52&&["createOffer","createAnswer"].forEach(function(t){var r=n.RTCPeerConnection.prototype[t];n.RTCPeerConnection.prototype[t]=function(){var n=this;if(arguments.length<1||1===arguments.length&&"object"==typeof arguments[0]){var i=1===arguments.length?arguments[0]:void 0;return new Promise(function(t,e){r.apply(n,[t,e,i])})}return r.apply(this,arguments)}}),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var e=n.RTCPeerConnection.prototype[t];n.RTCPeerConnection.prototype[t]=function(){return arguments[0]=new("addIceCandidate"===t?n.RTCIceCandidate:n.RTCSessionDescription)(arguments[0]),e.apply(this,arguments)}});var e=n.RTCPeerConnection.prototype.addIceCandidate;n.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?e.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}};t.exports={shimMediaStream:r.shimMediaStream,shimOnTrack:r.shimOnTrack,shimAddTrackRemoveTrack:r.shimAddTrackRemoveTrack,shimGetSendersWithDtmf:r.shimGetSendersWithDtmf,shimSourceObject:r.shimSourceObject,shimPeerConnection:r.shimPeerConnection,shimGetUserMedia:n(52)}},function(t,e,n){"use strict";var u=n(7),c=u.log;t.exports=function(t){function i(n,i){if((n=JSON.parse(JSON.stringify(n)))&&"object"==typeof n.audio&&((t=function(t,e,n){e in t&&!(n in t)&&(t[n]=t[e],delete t[e])})((n=JSON.parse(JSON.stringify(n))).audio,"autoGainControl","googAutoGainControl"),t(n.audio,"noiseSuppression","googNoiseSuppression"),n.audio=s(n.audio)),n&&"object"==typeof n.video){var r,o=(o=n.video.facingMode)&&("object"==typeof o?o:{ideal:o}),t=e.version<61;if(o&&("user"===o.exact||"environment"===o.exact||"user"===o.ideal||"environment"===o.ideal)&&(!a.mediaDevices.getSupportedConstraints||!a.mediaDevices.getSupportedConstraints().facingMode||t)&&(delete n.video.facingMode,"environment"===o.exact||"environment"===o.ideal?r=["back","rear"]:"user"!==o.exact&&"user"!==o.ideal||(r=["front"]),r))return a.mediaDevices.enumerateDevices().then(function(t){var e=(t=t.filter(function(t){return"videoinput"===t.kind})).find(function(e){return r.some(function(t){return-1!==e.label.toLowerCase().indexOf(t)})});return(e=!e&&t.length&&-1!==r.indexOf("back")?t[t.length-1]:e)&&(n.video.deviceId=o.exact?{exact:e.deviceId}:{ideal:e.deviceId}),n.video=s(n.video),c("chrome: "+JSON.stringify(n)),i(n)});n.video=s(n.video)}return c("chrome: "+JSON.stringify(n)),i(n)}function r(t){return{name:{PermissionDeniedError:"NotAllowedError",InvalidStateError:"NotReadableError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotReadableError",MediaDeviceKillSwitchOn:"NotReadableError"}[t.name]||t.name,message:t.message,constraint:t.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}}function s(r){if("object"!=typeof r||r.mandatory||r.optional)return r;var o={};return Object.keys(r).forEach(function(e){var n,i,t;"require"!==e&&"advanced"!==e&&"mediaSource"!==e&&(void 0!==(n="object"==typeof r[e]?r[e]:{ideal:r[e]}).exact&&"number"==typeof n.exact&&(n.min=n.max=n.exact),i=function(t,e){return t?t+e.charAt(0).toUpperCase()+e.slice(1):"deviceId"===e?"sourceId":e},void 0!==n.ideal&&(o.optional=o.optional||[],t={},"number"==typeof n.ideal?(t[i("min",e)]=n.ideal,o.optional.push(t),(t={})[i("max",e)]=n.ideal):t[i("",e)]=n.ideal,o.optional.push(t)),void 0!==n.exact&&"number"!=typeof n.exact?(o.mandatory=o.mandatory||{},o.mandatory[i("",e)]=n.exact):["min","max"].forEach(function(t){void 0!==n[t]&&(o.mandatory=o.mandatory||{},o.mandatory[i(t,e)]=n[t])}))}),r.advanced&&(o.optional=(o.optional||[]).concat(r.advanced)),o}var n,e=u.detectBrowser(t),a=t&&t.navigator;function o(n){return new Promise(function(t,e){a.getUserMedia(n,t,e)})}a.getUserMedia=function(t,e,n){i(t,function(t){a.webkitGetUserMedia(t,e,function(t){n(r(t))})})},a.mediaDevices||(a.mediaDevices={getUserMedia:o,enumerateDevices:function(){return new Promise(function(e){var n={audio:"audioinput",video:"videoinput"};return t.MediaStreamTrack.getSources(function(t){e(t.map(function(t){return{label:t.label,kind:n[t.kind],deviceId:t.id,groupId:""}}))})})},getSupportedConstraints:function(){return{deviceId:!0,echoCancellation:!0,facingMode:!0,frameRate:!0,height:!0,width:!0}}}),a.mediaDevices.getUserMedia?(n=a.mediaDevices.getUserMedia.bind(a.mediaDevices),a.mediaDevices.getUserMedia=function(t){return i(t,function(e){return n(e).then(function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach(function(t){t.stop()}),new DOMException("","NotFoundError");return t},function(t){return Promise.reject(r(t))})})}):a.mediaDevices.getUserMedia=o,void 0===a.mediaDevices.addEventListener&&(a.mediaDevices.addEventListener=function(){c("Dummy mediaDevices.addEventListener called.")}),void 0===a.mediaDevices.removeEventListener&&(a.mediaDevices.removeEventListener=function(){c("Dummy mediaDevices.removeEventListener called.")})}},function(t,e,n){"use strict";var i=n(7),r=n(54);t.exports={shimGetUserMedia:n(56),shimPeerConnection:function(t){var n,e=i.detectBrowser(t);t.RTCIceGatherer&&(t.RTCIceCandidate||(t.RTCIceCandidate=function(t){return t}),t.RTCSessionDescription||(t.RTCSessionDescription=function(t){return t}),e.version<15025&&(n=Object.getOwnPropertyDescriptor(t.MediaStreamTrack.prototype,"enabled"),Object.defineProperty(t.MediaStreamTrack.prototype,"enabled",{set:function(t){n.set.call(this,t);var e=new Event("enabled");e.enabled=t,this.dispatchEvent(e)}}))),!t.RTCRtpSender||"dtmf"in t.RTCRtpSender.prototype||Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this.Xn&&("audio"===this.track.kind?this.Xn=new t.RTCDtmfSender(this):"video"===this.track.kind&&(this.Xn=null)),this.Xn}}),t.RTCPeerConnection=r(t,e.version)},shimReplaceTrack:function(t){!t.RTCRtpSender||"replaceTrack"in t.RTCRtpSender.prototype||(t.RTCRtpSender.prototype.replaceTrack=t.RTCRtpSender.prototype.setTrack)}}},function(t,e,n){"use strict";var P=n(55);function d(s,a){function u(t,e){t=parseInt(t,10);for(var n=0;n<e.length;n++)if(e[n].payloadType===t||e[n].preferredPayloadType===t)return e[n]}var c={codecs:[],headerExtensions:[],fecMechanisms:[]};return s.codecs.forEach(function(n){for(var t,e,i,r=0;r<a.codecs.length;r++){var o=a.codecs[r];if(n.name.toLowerCase()===o.name.toLowerCase()&&n.clockRate===o.clockRate&&("rtx"!==n.name.toLowerCase()||!n.parameters||!o.parameters.apt||(t=o,e=s.codecs,i=a.codecs,e=u(n.parameters.apt,e),i=u(t.parameters.apt,i),e&&i&&e.name.toLowerCase()===i.name.toLowerCase()))){(o=JSON.parse(JSON.stringify(o))).numChannels=Math.min(n.numChannels,o.numChannels),c.codecs.push(o),o.rtcpFeedback=o.rtcpFeedback.filter(function(t){for(var e=0;e<n.rtcpFeedback.length;e++)if(n.rtcpFeedback[e].type===t.type&&n.rtcpFeedback[e].parameter===t.parameter)return!0;return!1});break}}}),s.headerExtensions.forEach(function(t){for(var e=0;e<a.headerExtensions.length;e++){var n=a.headerExtensions[e];if(t.uri===n.uri){c.headerExtensions.push(n);break}}}),c}function o(t,e,n){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[e][t].indexOf(n)}t.exports=function(C,M){function t(t){var e,i,r,n=this,o=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(t){n[t]=o[t].bind(o)}),this.needNegotiation=!1,this.onicecandidate=null,this.onaddstream=null,this.ontrack=null,this.onremovestream=null,this.onsignalingstatechange=null,this.oniceconnectionstatechange=null,this.onicegatheringstatechange=null,this.onnegotiationneeded=null,this.ondatachannel=null,this.canTrickleIceCandidates=null,this.localStreams=[],this.remoteStreams=[],this.getLocalStreams=function(){return n.localStreams},this.getRemoteStreams=function(){return n.remoteStreams},this.localDescription=new C.RTCSessionDescription({type:"",sdp:""}),this.remoteDescription=new C.RTCSessionDescription({type:"",sdp:""}),this.signalingState="stable",this.iceConnectionState="new",this.iceGatheringState="new",this.iceOptions={gatherPolicy:"all",iceServers:[]},t&&t.iceTransportPolicy)switch(t.iceTransportPolicy){case"all":case"relay":this.iceOptions.gatherPolicy=t.iceTransportPolicy}this.usingBundle=t&&"max-bundle"===t.bundlePolicy,t&&t.iceServers&&(this.iceOptions.iceServers=(e=t.iceServers,i=M,r=!1,(e=JSON.parse(JSON.stringify(e))).filter(function(t){if(t&&(t.urls||t.url)){var e=t.urls||t.url;t.url&&!t.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var n="string"==typeof e,e=(e=n?[e]:e).filter(function(t){return 0!==t.indexOf("turn:")||-1===t.indexOf("transport=udp")||-1!==t.indexOf("turn:[")||r?0===t.indexOf("stun:")&&14393<=i:r=!0});return delete t.url,t.urls=n?e[0]:e,!!e.length}return!1}))),this.ei=t||{},this.transceivers=[],this.ni=[],this.ii=P.generateSessionId()}return t.prototype.ri=function(){var t=new Event("icegatheringstatechange");this.dispatchEvent(t),null!==this.onicegatheringstatechange&&this.onicegatheringstatechange(t)},t.prototype.oi=function(){var n=this,i=P.splitSections(n.localDescription.sdp);this.ni.forEach(function(t){if(t.candidate&&0!==Object.keys(t.candidate).length)i[t.candidate.sdpMLineIndex+1]+="a="+t.candidate.candidate+"\r\n";else for(var e=1;e<i.length;e++)-1===i[e].indexOf("\r\na=end-of-candidates\r\n")&&(i[e]+="a=end-of-candidates\r\n");n.localDescription.sdp=i.join(""),n.dispatchEvent(t),null!==n.onicecandidate&&n.onicecandidate(t),t.candidate||"complete"===n.iceGatheringState||n.transceivers.every(function(t){return t.iceGatherer&&"completed"===t.iceGatherer.state})&&"complete"!==n.iceGatheringStateChange&&(n.iceGatheringState="complete",n.ri())}),this.ni=[]},t.prototype.getConfiguration=function(){return this.ei},t.prototype.si=function(t){var e=0<this.transceivers.length,t={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:t,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,wantReceive:!0};return this.usingBundle&&e?(t.iceTransport=this.transceivers[0].iceTransport,t.dtlsTransport=this.transceivers[0].dtlsTransport):(e=this.ai(),t.iceTransport=e.iceTransport,t.dtlsTransport=e.dtlsTransport),this.transceivers.push(t),t},t.prototype.addTrack=function(t,e){for(var n,i=0;i<this.transceivers.length;i++)this.transceivers[i].track||this.transceivers[i].kind!==t.kind||(n=this.transceivers[i]);return(n=n||this.si(t.kind)).track=t,n.stream=e,n.rtpSender=new C.RTCRtpSender(t,n.dtlsTransport),this.ui(),n.rtpSender},t.prototype.addStream=function(e){var i,n=this;15025<=M?(this.localStreams.push(e),e.getTracks().forEach(function(t){n.addTrack(t,e)})):(i=e.clone(),e.getTracks().forEach(function(t,e){var n=i.getTracks()[e];t.addEventListener("enabled",function(t){n.enabled=t.enabled})}),i.getTracks().forEach(function(t){n.addTrack(t,i)}),this.localStreams.push(i)),this.ui()},t.prototype.removeStream=function(t){-1<(t=this.localStreams.indexOf(t))&&(this.localStreams.splice(t,1),this.ui())},t.prototype.getSenders=function(){return this.transceivers.filter(function(t){return!!t.rtpSender}).map(function(t){return t.rtpSender})},t.prototype.getReceivers=function(){return this.transceivers.filter(function(t){return!!t.rtpReceiver}).map(function(t){return t.rtpReceiver})},t.prototype.ci=function(r,o){var s=this,a=new C.RTCIceGatherer(s.iceOptions);return a.onlocalcandidate=function(t){var e=new Event("icecandidate");e.candidate={sdpMid:r,sdpMLineIndex:o};var n=!(t=t.candidate)||0===Object.keys(t).length;n?void 0===a.state&&(a.state="completed"):(t.component=1,e.candidate.candidate=P.writeCandidate(t)),(t=P.splitSections(s.localDescription.sdp))[e.candidate.sdpMLineIndex+1]+=n?"a=end-of-candidates\r\n":"a="+e.candidate.candidate+"\r\n",s.localDescription.sdp=t.join("");var i=(s.hi||s.transceivers).every(function(t){return t.iceGatherer&&"completed"===t.iceGatherer.state});switch(s.iceGatheringState){case"new":n||s.ni.push(e),n&&i&&s.ni.push(new Event("icecandidate"));break;case"gathering":s.oi(),n||(s.dispatchEvent(e),null!==s.onicecandidate&&s.onicecandidate(e)),i&&(s.dispatchEvent(new Event("icecandidate")),null!==s.onicecandidate&&s.onicecandidate(new Event("icecandidate")),s.iceGatheringState="complete",s.ri())}},a},t.prototype.ai=function(){var t=this,e=new C.RTCIceTransport(null);e.onicestatechange=function(){t.fi()};var n=new C.RTCDtlsTransport(e);return n.ondtlsstatechange=function(){t.fi()},n.onerror=function(){Object.defineProperty(n,"state",{value:"failed",writable:!0}),t.fi()},{iceTransport:e,dtlsTransport:n}},t.prototype.di=function(t){var e=this.transceivers[t].iceGatherer;e&&(delete e.onlocalcandidate,delete this.transceivers[t].iceGatherer),(e=this.transceivers[t].iceTransport)&&(delete e.onicestatechange,delete this.transceivers[t].iceTransport),(e=this.transceivers[t].dtlsTransport)&&(delete e.ondtlsstatechange,delete e.onerror,delete this.transceivers[t].dtlsTransport)},t.prototype.li=function(t,e,n){var i=d(t.localCapabilities,t.remoteCapabilities);e&&t.rtpSender&&(i.encodings=t.sendEncodingParameters,i.rtcp={cname:P.localCName,compound:t.rtcpParameters.compound},t.recvEncodingParameters.length&&(i.rtcp.ssrc=t.recvEncodingParameters[0].ssrc),t.rtpSender.send(i)),n&&t.rtpReceiver&&("video"===t.kind&&t.recvEncodingParameters&&M<15019&&t.recvEncodingParameters.forEach(function(t){delete t.rtx}),i.encodings=t.recvEncodingParameters,i.rtcp={cname:t.rtcpParameters.cname,compound:t.rtcpParameters.compound},t.sendEncodingParameters.length&&(i.rtcp.ssrc=t.sendEncodingParameters[0].ssrc),t.rtpReceiver.receive(i))},t.prototype.setLocalDescription=function(t){var c,h,f=this;if(!o("setLocalDescription",t.type,this.signalingState)){var e=new Error("Can not set local "+t.type+" in state "+this.signalingState);return e.name="InvalidStateError",2<arguments.length&&"function"==typeof arguments[2]&&C.setTimeout(arguments[2],0,e),Promise.reject(e)}switch("offer"===t.type?this.hi&&(r=P.splitSections(t.sdp),c=r.shift(),r.forEach(function(t,e){t=P.parseRtpParameters(t),f.hi[e].localCapabilities=t}),this.transceivers=this.hi,delete this.hi):"answer"===t.type&&(c=(r=P.splitSections(f.remoteDescription.sdp)).shift(),h=0<P.matchPrefix(c,"a=ice-lite").length,r.forEach(function(t,e){var n,i=f.transceivers[e],r=i.iceGatherer,o=i.iceTransport,s=i.dtlsTransport,a=i.localCapabilities,u=i.remoteCapabilities;P.isRejected(t)||i.isDatachannel||(n=P.getIceParameters(t,c),t=P.getDtlsParameters(t,c),h&&(t.role="server"),f.usingBundle&&0!==e||(o.start(r,n,h?"controlling":"controlled"),s.start(t)),u=d(a,u),f.li(i,0<u.codecs.length,!1))})),this.localDescription={type:t.type,sdp:t.sdp},t.type){case"offer":this.pi("have-local-offer");break;case"answer":this.pi("stable");break;default:throw new TypeError('unsupported type "'+t.type+'"')}var n,i=1<arguments.length&&"function"==typeof arguments[1];i&&(n=arguments[1],C.setTimeout(function(){n(),"new"===f.iceGatheringState&&(f.iceGatheringState="gathering",f.ri()),f.oi()},0));var r=Promise.resolve();return r.then(function(){i||("new"===f.iceGatheringState&&(f.iceGatheringState="gathering",f.ri()),C.setTimeout(f.oi.bind(f),500))}),r},t.prototype.setRemoteDescription=function(b){var k=this;if(!o("setRemoteDescription",b.type,this.signalingState)){var t=new Error("Can not set remote "+b.type+" in state "+this.signalingState);return t.name="InvalidStateError",2<arguments.length&&"function"==typeof arguments[2]&&C.setTimeout(arguments[2],0,t),Promise.reject(t)}var S={},E=[],e=P.splitSections(b.sdp),R=e.shift(),I=0<P.matchPrefix(R,"a=ice-lite").length,T=0<P.matchPrefix(R,"a=group:BUNDLE ").length;switch(this.usingBundle=T,t=P.matchPrefix(R,"a=ice-options:")[0],this.canTrickleIceCandidates=!!t&&0<=t.substr(14).split(" ").indexOf("trickle"),e.forEach(function(t,e){var n,i,r,o,s,a,u,c,h,f,d,l=P.splitLines(t),p=P.getKind(t),m=P.isRejected(t),v=l[0].substr(2).split(" ")[2],g=P.getDirection(t,R),y=P.parseMsid(t),w=P.getMid(t)||P.generateIdentifier();"application"!==p||"DTLS/SCTP"!==v?(a=P.parseRtpParameters(t),m||(u=P.getIceParameters(t,R),(c=P.getDtlsParameters(t,R)).role="client"),h=P.parseRtpEncodingParameters(t),f=P.parseRtcpParameters(t),d=0<P.matchPrefix(t,"a=end-of-candidates",R).length,l=P.matchPrefix(t,"a=candidate:").map(function(t){return P.parseCandidate(t)}).filter(function(t){return"1"===t.component||1===t.component}),("offer"===b.type||"answer"===b.type)&&!m&&T&&0<e&&k.transceivers[e]&&(k.di(e),k.transceivers[e].iceGatherer=k.transceivers[0].iceGatherer,k.transceivers[e].iceTransport=k.transceivers[0].iceTransport,k.transceivers[e].dtlsTransport=k.transceivers[0].dtlsTransport,k.transceivers[e].rtpSender&&k.transceivers[e].rtpSender.setTransport(k.transceivers[0].dtlsTransport),k.transceivers[e].rtpReceiver&&k.transceivers[e].rtpReceiver.setTransport(k.transceivers[0].dtlsTransport)),"offer"!==b.type||m?"answer"!==b.type||m||(v=(n=k.transceivers[e]).iceGatherer,t=n.iceTransport,m=n.dtlsTransport,i=n.rtpReceiver,r=n.sendEncodingParameters,o=n.localCapabilities,k.transceivers[e].recvEncodingParameters=h,k.transceivers[e].remoteCapabilities=a,k.transceivers[e].rtcpParameters=f,T&&0!==e||((I||d)&&l.length&&t.setRemoteCandidates(l),t.start(v,u,"controlling"),m.start(c)),k.li(n,"sendrecv"===g||"recvonly"===g,"sendrecv"===g||"sendonly"===g),!i||"sendrecv"!==g&&"sendonly"!==g?delete n.rtpReceiver:(s=i.track,y?(S[y.stream]||(S[y.stream]=new C.MediaStream),S[y.stream].addTrack(s),E.push([s,i,S[y.stream]])):(S.default||(S.default=new C.MediaStream),S.default.addTrack(s),E.push([s,i,S.default])))):((n=k.transceivers[e]||k.si(p)).mid=w,n.iceGatherer||(n.iceGatherer=T&&0<e?k.transceivers[0].iceGatherer:k.ci(w,e)),!d||!l.length||T&&0!==e||n.iceTransport.setRemoteCandidates(l),o=C.RTCRtpReceiver.getCapabilities(p),M<15019&&(o.codecs=o.codecs.filter(function(t){return"rtx"!==t.name})),r=[{ssrc:1001*(2*e+2)}],"sendrecv"!==g&&"sendonly"!==g||(s=(i=new C.RTCRtpReceiver(n.dtlsTransport,p)).track,y?(S[y.stream]||(S[y.stream]=new C.MediaStream,Object.defineProperty(S[y.stream],"id",{get:function(){return y.stream}})),Object.defineProperty(s,"id",{get:function(){return y.track}}),S[y.stream].addTrack(s),E.push([s,i,S[y.stream]])):(S.default||(S.default=new C.MediaStream),S.default.addTrack(s),E.push([s,i,S.default]))),n.localCapabilities=o,n.remoteCapabilities=a,n.rtpReceiver=i,n.rtcpParameters=f,n.sendEncodingParameters=r,n.recvEncodingParameters=h,k.li(k.transceivers[e],!1,"sendrecv"===g||"sendonly"===g))):k.transceivers[e]={mid:w,isDatachannel:!0}}),this.remoteDescription={type:b.type,sdp:b.sdp},b.type){case"offer":this.pi("have-remote-offer");break;case"answer":this.pi("stable");break;default:throw new TypeError('unsupported type "'+b.type+'"')}return Object.keys(S).forEach(function(t){var e,r=S[t];r.getTracks().length&&(k.remoteStreams.push(r),(e=new Event("addstream")).stream=r,k.dispatchEvent(e),null!==k.onaddstream&&C.setTimeout(function(){k.onaddstream(e)},0),E.forEach(function(t){var e,n=t[0],i=t[1];r.id===t[2].id&&((e=new Event("track")).track=n,e.receiver=i,e.streams=[r],k.dispatchEvent(e),null!==k.ontrack&&C.setTimeout(function(){k.ontrack(e)},0))}))}),C.setTimeout(function(){k&&k.transceivers&&k.transceivers.forEach(function(t){t.iceTransport&&"new"===t.iceTransport.state&&0<t.iceTransport.getRemoteCandidates().length&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),t.iceTransport.addRemoteCandidate({}))})},4e3),1<arguments.length&&"function"==typeof arguments[1]&&C.setTimeout(arguments[1],0),Promise.resolve()},t.prototype.close=function(){this.transceivers.forEach(function(t){t.iceTransport&&t.iceTransport.stop(),t.dtlsTransport&&t.dtlsTransport.stop(),t.rtpSender&&t.rtpSender.stop(),t.rtpReceiver&&t.rtpReceiver.stop()}),this.pi("closed")},t.prototype.pi=function(t){this.signalingState=t,t=new Event("signalingstatechange"),this.dispatchEvent(t),null!==this.onsignalingstatechange&&this.onsignalingstatechange(t)},t.prototype.ui=function(){var e=this;"stable"===this.signalingState&&!0!==this.needNegotiation&&(this.needNegotiation=!0,C.setTimeout(function(){var t;!1!==e.needNegotiation&&(e.needNegotiation=!1,t=new Event("negotiationneeded"),e.dispatchEvent(t),null!==e.onnegotiationneeded&&e.onnegotiationneeded(t))},0))},t.prototype.fi=function(){var t,e={new:0,closed:0,connecting:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};this.transceivers.forEach(function(t){e[t.iceTransport.state]++,e[t.dtlsTransport.state]++}),e.connected+=e.completed,t="new",0<e.failed?t="failed":0<e.connecting||0<e.checking?t="connecting":0<e.disconnected?t="disconnected":0<e.new?t="new":(0<e.connected||0<e.completed)&&(t="connected"),t!==this.iceConnectionState&&(this.iceConnectionState=t,t=new Event("iceconnectionstatechange"),this.dispatchEvent(t),null!==this.oniceconnectionstatechange&&this.oniceconnectionstatechange(t))},t.prototype.createOffer=function(){var s=this;if(this.hi)throw new Error("createOffer called while there is a pending offer.");1===arguments.length&&"function"!=typeof arguments[0]?t=arguments[0]:3===arguments.length&&(t=arguments[2]);var e=this.transceivers.filter(function(t){return"audio"===t.kind}).length,n=this.transceivers.filter(function(t){return"video"===t.kind}).length;if(t){if(t.mandatory||t.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==t.offerToReceiveAudio&&(e=!0===t.offerToReceiveAudio?1:!1===t.offerToReceiveAudio?0:t.offerToReceiveAudio),void 0!==t.offerToReceiveVideo&&(n=!0===t.offerToReceiveVideo?1:!1===t.offerToReceiveVideo?0:t.offerToReceiveVideo)}for(this.transceivers.forEach(function(t){"audio"===t.kind?--e<0&&(t.wantReceive=!1):"video"===t.kind&&--n<0&&(t.wantReceive=!1)});0<e||0<n;)0<e&&(this.si("audio"),e--),0<n&&(this.si("video"),n--);var a=function(t){var e=t.filter(function(t){return"audio"===t.kind}),n=t.filter(function(t){return"video"===t.kind});for(t=[];e.length||n.length;)e.length&&t.push(e.shift()),n.length&&t.push(n.shift());return t}(this.transceivers),i=P.writeSessionBoilerplate(this.ii);a.forEach(function(t,e){var n=t.track,i=t.kind,r=P.generateIdentifier();t.mid=r,t.iceGatherer||(t.iceGatherer=s.usingBundle&&0<e?a[0].iceGatherer:s.ci(r,e));var o=C.RTCRtpSender.getCapabilities(i);M<15019&&(o.codecs=o.codecs.filter(function(t){return"rtx"!==t.name})),o.codecs.forEach(function(t){"H264"===t.name&&void 0===t.parameters["level-asymmetry-allowed"]&&(t.parameters["level-asymmetry-allowed"]="1")}),r=[{ssrc:1001*(2*e+1)}],n&&15019<=M&&"video"===i&&(r[0].rtx={ssrc:1001*(2*e+1)+1}),t.wantReceive&&(t.rtpReceiver=new C.RTCRtpReceiver(t.dtlsTransport,i)),t.localCapabilities=o,t.sendEncodingParameters=r}),"max-compat"!==this.ei.bundlePolicy&&(i+="a=group:BUNDLE "+a.map(function(t){return t.mid}).join(" ")+"\r\n"),i+="a=ice-options:trickle\r\n",a.forEach(function(t,e){i+=P.writeMediaSection(t,t.localCapabilities,"offer",t.stream),i+="a=rtcp-rsize\r\n"}),this.hi=a;var t=new C.RTCSessionDescription({type:"offer",sdp:i});return arguments.length&&"function"==typeof arguments[0]&&C.setTimeout(arguments[0],0,t),Promise.resolve(t)},t.prototype.createAnswer=function(){var i=P.writeSessionBoilerplate(this.ii);this.usingBundle&&(i+="a=group:BUNDLE "+this.transceivers.map(function(t){return t.mid}).join(" ")+"\r\n"),this.transceivers.forEach(function(t,e){var n;t.isDatachannel?i+="m=application 0 DTLS/SCTP 5000\r\nc=IN IP4 0.0.0.0\r\na=mid:"+t.mid+"\r\n":(t.stream&&("audio"===t.kind?n=t.stream.getAudioTracks()[0]:"video"===t.kind&&(n=t.stream.getVideoTracks()[0]),n&&15019<=M&&"video"===t.kind&&(t.sendEncodingParameters[0].rtx={ssrc:1001*(2*e+2)+1})),!(e=d(t.localCapabilities,t.remoteCapabilities)).codecs.filter(function(t){return"rtx"===t.name.toLowerCase()}).length&&t.sendEncodingParameters[0].rtx&&delete t.sendEncodingParameters[0].rtx,i+=P.writeMediaSection(t,e,"answer",t.stream),t.rtcpParameters&&t.rtcpParameters.reducedSize&&(i+="a=rtcp-rsize\r\n"))});var t=new C.RTCSessionDescription({type:"answer",sdp:i});return arguments.length&&"function"==typeof arguments[0]&&C.setTimeout(arguments[0],0,t),Promise.resolve(t)},t.prototype.addIceCandidate=function(t){if(t){var e=t.sdpMLineIndex;if(t.sdpMid)for(var n=0;n<this.transceivers.length;n++)if(this.transceivers[n].mid===t.sdpMid){e=n;break}var i=this.transceivers[e];if(i){var r=0<Object.keys(t.candidate).length?P.parseCandidate(t.candidate):{};if("tcp"===r.protocol&&(0===r.port||9===r.port))return Promise.resolve();if(r.component&&"1"!==r.component&&1!==r.component)return Promise.resolve();i.iceTransport.addRemoteCandidate(r),(i=P.splitSections(this.remoteDescription.sdp))[e+1]+=(r.type?t.candidate.trim():"a=end-of-candidates")+"\r\n",this.remoteDescription.sdp=i.join("")}}else for(var o=0;o<this.transceivers.length;o++)if(this.transceivers[o].iceTransport.addRemoteCandidate({}),this.usingBundle)return Promise.resolve();return 1<arguments.length&&"function"==typeof arguments[1]&&C.setTimeout(arguments[1],0),Promise.resolve()},t.prototype.getStats=function(){var n=[];this.transceivers.forEach(function(e){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(t){e[t]&&n.push(e[t].getStats())})});var r=1<arguments.length&&"function"==typeof arguments[1]&&arguments[1];return new Promise(function(e){var i=new Map;Promise.all(n).then(function(t){t.forEach(function(n){Object.keys(n).forEach(function(t){var e;n[t].type={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[(e=n[t]).type]||e.type,i.set(t,n[t])})}),r&&C.setTimeout(r,0,i),e(i)})})},t}},function(t,e,n){"use strict";var c={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};c.localCName=c.generateIdentifier(),c.splitLines=function(t){return t.trim().split("\n").map(function(t){return t.trim()})},c.splitSections=function(t){return t.split("\nm=").map(function(t,e){return(0<e?"m="+t:t).trim()+"\r\n"})},c.getDescription=function(t){return(t=c.splitSections(t))&&t[0]},c.getMediaSections=function(t){return(t=c.splitSections(t)).shift(),t},c.matchPrefix=function(t,e){return c.splitLines(t).filter(function(t){return 0===t.indexOf(e)})},c.parseCandidate=function(t){for(var e=(0===t.indexOf("a=candidate:")?t.substring(12):t.substring(10)).split(" "),n={foundation:e[0],component:parseInt(e[1],10),protocol:e[2].toLowerCase(),priority:parseInt(e[3],10),ip:e[4],address:e[4],port:parseInt(e[5],10),type:e[7]},i=8;i<e.length;i+=2)switch(e[i]){case"raddr":n.relatedAddress=e[i+1];break;case"rport":n.relatedPort=parseInt(e[i+1],10);break;case"tcptype":n.tcpType=e[i+1];break;case"ufrag":n.ufrag=e[i+1],n.usernameFragment=e[i+1];break;default:n[e[i]]=e[i+1]}return n},c.writeCandidate=function(t){var e=[];e.push(t.foundation),e.push(t.component),e.push(t.protocol.toUpperCase()),e.push(t.priority),e.push(t.address||t.ip),e.push(t.port);var n=t.type;return e.push("typ"),e.push(n),"host"!==n&&t.relatedAddress&&t.relatedPort&&(e.push("raddr"),e.push(t.relatedAddress),e.push("rport"),e.push(t.relatedPort)),t.tcpType&&"tcp"===t.protocol.toLowerCase()&&(e.push("tcptype"),e.push(t.tcpType)),(t.usernameFragment||t.ufrag)&&(e.push("ufrag"),e.push(t.usernameFragment||t.ufrag)),"candidate:"+e.join(" ")},c.parseIceOptions=function(t){return t.substr(14).split(" ")},c.parseRtpMap=function(t){var e=t.substr(9).split(" "),t={payloadType:parseInt(e.shift(),10)},e=e[0].split("/");return t.name=e[0],t.clockRate=parseInt(e[1],10),t.channels=3===e.length?parseInt(e[2],10):1,t.numChannels=t.channels,t},c.writeRtpMap=function(t){var e=t.payloadType;void 0!==t.preferredPayloadType&&(e=t.preferredPayloadType);var n=t.channels||t.numChannels||1;return"a=rtpmap:"+e+" "+t.name+"/"+t.clockRate+(1!==n?"/"+n:"")+"\r\n"},c.parseExtmap=function(t){return t=t.substr(9).split(" "),{id:parseInt(t[0],10),direction:0<t[0].indexOf("/")?t[0].split("/")[1]:"sendrecv",uri:t[1]}},c.writeExtmap=function(t){return"a=extmap:"+(t.id||t.preferredId)+(t.direction&&"sendrecv"!==t.direction?"/"+t.direction:"")+" "+t.uri+"\r\n"},c.parseFmtp=function(t){for(var e,n={},i=t.substr(t.indexOf(" ")+1).split(";"),r=0;r<i.length;r++)n[(e=i[r].trim().split("="))[0].trim()]=e[1];return n},c.writeFmtp=function(e){var n,t="",i=e.payloadType;return void 0!==e.preferredPayloadType&&(i=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length&&(n=[],Object.keys(e.parameters).forEach(function(t){e.parameters[t]?n.push(t+"="+e.parameters[t]):n.push(t)}),t+="a=fmtp:"+i+" "+n.join(";")+"\r\n"),t},c.parseRtcpFb=function(t){return{type:(t=t.substr(t.indexOf(" ")+1).split(" ")).shift(),parameter:t.join(" ")}},c.writeRtcpFb=function(t){var e="",n=t.payloadType;return void 0!==t.preferredPayloadType&&(n=t.preferredPayloadType),t.rtcpFeedback&&t.rtcpFeedback.length&&t.rtcpFeedback.forEach(function(t){e+="a=rtcp-fb:"+n+" "+t.type+(t.parameter&&t.parameter.length?" "+t.parameter:"")+"\r\n"}),e},c.parseSsrcMedia=function(t){var e=t.indexOf(" "),n={ssrc:parseInt(t.substr(7,e-7),10)},i=t.indexOf(":",e);return-1<i?(n.attribute=t.substr(e+1,i-e-1),n.value=t.substr(i+1)):n.attribute=t.substr(e+1),n},c.parseSsrcGroup=function(t){return{semantics:(t=t.substr(13).split(" ")).shift(),ssrcs:t.map(function(t){return parseInt(t,10)})}},c.getMid=function(t){if(t=c.matchPrefix(t,"a=mid:")[0])return t.substr(6)},c.parseFingerprint=function(t){return{algorithm:(t=t.substr(14).split(" "))[0].toLowerCase(),value:t[1]}},c.getDtlsParameters=function(t,e){return{role:"auto",fingerprints:c.matchPrefix(t+e,"a=fingerprint:").map(c.parseFingerprint)}},c.writeDtlsParameters=function(t,e){var n="a=setup:"+e+"\r\n";return t.fingerprints.forEach(function(t){n+="a=fingerprint:"+t.algorithm+" "+t.value+"\r\n"}),n},c.parseCryptoLine=function(t){return t=t.substr(9).split(" "),{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},c.writeCryptoLine=function(t){return"a=crypto:"+t.tag+" "+t.cryptoSuite+" "+("object"==typeof t.keyParams?c.writeCryptoKeyParams(t.keyParams):t.keyParams)+(t.sessionParams?" "+t.sessionParams.join(" "):"")+"\r\n"},c.parseCryptoKeyParams=function(t){return 0!==t.indexOf("inline:")?null:{keyMethod:"inline",keySalt:(t=t.substr(7).split("|"))[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},c.writeCryptoKeyParams=function(t){return t.keyMethod+":"+t.keySalt+(t.lifeTime?"|"+t.lifeTime:"")+(t.mkiValue&&t.mkiLength?"|"+t.mkiValue+":"+t.mkiLength:"")},c.getCryptoParameters=function(t,e){return c.matchPrefix(t+e,"a=crypto:").map(c.parseCryptoLine)},c.getIceParameters=function(t,e){var n=c.matchPrefix(t+e,"a=ice-ufrag:")[0],e=c.matchPrefix(t+e,"a=ice-pwd:")[0];return n&&e?{usernameFragment:n.substr(12),password:e.substr(10)}:null},c.writeIceParameters=function(t){return"a=ice-ufrag:"+t.usernameFragment+"\r\na=ice-pwd:"+t.password+"\r\n"},c.parseRtpParameters=function(t){for(var e={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},n=c.splitLines(t)[0].split(" "),i=3;i<n.length;i++){var r=n[i];if(s=c.matchPrefix(t,"a=rtpmap:"+r+" ")[0]){var o=c.parseRtpMap(s),s=c.matchPrefix(t,"a=fmtp:"+r+" ");switch(o.parameters=s.length?c.parseFmtp(s[0]):{},o.rtcpFeedback=c.matchPrefix(t,"a=rtcp-fb:"+r+" ").map(c.parseRtcpFb),e.codecs.push(o),o.name.toUpperCase()){case"RED":case"ULPFEC":e.fecMechanisms.push(o.name.toUpperCase())}}}return c.matchPrefix(t,"a=extmap:").forEach(function(t){e.headerExtensions.push(c.parseExtmap(t))}),e},c.writeRtpDescription=function(t,e){var n="";n+="m="+t+" ",n+=0<e.codecs.length?"9":"0",n+=" UDP/TLS/RTP/SAVPF ",n+=e.codecs.map(function(t){return void 0!==t.preferredPayloadType?t.preferredPayloadType:t.payloadType}).join(" ")+"\r\n",n+="c=IN IP4 0.0.0.0\r\n",n+="a=rtcp:9 IN IP4 0.0.0.0\r\n",e.codecs.forEach(function(t){n+=c.writeRtpMap(t),n+=c.writeFmtp(t),n+=c.writeRtcpFb(t)});var i=0;return e.codecs.forEach(function(t){t.maxptime>i&&(i=t.maxptime)}),0<i&&(n+="a=maxptime:"+i+"\r\n"),n+="a=rtcp-mux\r\n",e.headerExtensions&&e.headerExtensions.forEach(function(t){n+=c.writeExtmap(t)}),n},c.parseRtpEncodingParameters=function(t){var e,n=[],i=c.parseRtpParameters(t),r=-1!==i.fecMechanisms.indexOf("RED"),o=-1!==i.fecMechanisms.indexOf("ULPFEC"),s=c.matchPrefix(t,"a=ssrc:").map(function(t){return c.parseSsrcMedia(t)}).filter(function(t){return"cname"===t.attribute}),a=0<s.length&&s[0].ssrc;0<(s=c.matchPrefix(t,"a=ssrc-group:FID").map(function(t){return t.substr(17).split(" ").map(function(t){return parseInt(t,10)})})).length&&1<s[0].length&&s[0][0]===a&&(e=s[0][1]),i.codecs.forEach(function(t){"RTX"===t.name.toUpperCase()&&t.parameters.apt&&(t={ssrc:a,codecPayloadType:parseInt(t.parameters.apt,10)},a&&e&&(t.rtx={ssrc:e}),n.push(t),r&&((t=JSON.parse(JSON.stringify(t))).fec={ssrc:a,mechanism:o?"red+ulpfec":"red"},n.push(t)))}),0===n.length&&a&&n.push({ssrc:a});var u=c.matchPrefix(t,"b=");return u.length&&(u=0===u[0].indexOf("b=TIAS:")?parseInt(u[0].substr(7),10):0===u[0].indexOf("b=AS:")?1e3*parseInt(u[0].substr(5),10)*.95-16e3:void 0,n.forEach(function(t){t.maxBitrate=u})),n},c.parseRtcpParameters=function(t){var e={},n=c.matchPrefix(t,"a=ssrc:").map(function(t){return c.parseSsrcMedia(t)}).filter(function(t){return"cname"===t.attribute})[0];return n&&(e.cname=n.value,e.ssrc=n.ssrc),n=c.matchPrefix(t,"a=rtcp-rsize"),e.reducedSize=0<n.length,e.compound=0===n.length,t=c.matchPrefix(t,"a=rtcp-mux"),e.mux=0<t.length,e},c.parseMsid=function(t){var e,n=c.matchPrefix(t,"a=msid:");return 1===n.length?{stream:(e=n[0].substr(7).split(" "))[0],track:e[1]}:0<(t=c.matchPrefix(t,"a=ssrc:").map(function(t){return c.parseSsrcMedia(t)}).filter(function(t){return"msid"===t.attribute})).length?{stream:(e=t[0].value.split(" "))[0],track:e[1]}:void 0},c.parseSctpDescription=function(t){var e,n=c.parseMLine(t),i=c.matchPrefix(t,"a=max-message-size:");return 0<i.length&&(e=parseInt(i[0].substr(19),10)),isNaN(e)&&(e=65536),0<(i=c.matchPrefix(t,"a=sctp-port:")).length?{port:parseInt(i[0].substr(12),10),protocol:n.fmt,maxMessageSize:e}:0<c.matchPrefix(t,"a=sctpmap:").length?(t=c.matchPrefix(t,"a=sctpmap:")[0].substr(10).split(" "),{port:parseInt(t[0],10),protocol:t[1],maxMessageSize:e}):void 0},c.writeSctpDescription=function(t,e){var n=[],n="DTLS/SCTP"!==t.protocol?["m="+t.kind+" 9 "+t.protocol+" "+e.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+e.port+"\r\n"]:["m="+t.kind+" 9 "+t.protocol+" "+e.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+e.port+" "+e.protocol+" 65535\r\n"];return void 0!==e.maxMessageSize&&n.push("a=max-message-size:"+e.maxMessageSize+"\r\n"),n.join("")},c.generateSessionId=function(){return Math.random().toString().substr(2,21)},c.writeSessionBoilerplate=function(t,e,n){return e=void 0!==e?e:2,"v=0\r\no="+(n||"thisisadapterortc")+" "+(t=t||c.generateSessionId())+" "+e+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},c.writeMediaSection=function(t,e,n,i){return e=c.writeRtpDescription(t.kind,e),e+=c.writeIceParameters(t.iceGatherer.getLocalParameters()),e+=c.writeDtlsParameters(t.dtlsTransport.getLocalParameters(),"offer"===n?"actpass":"active"),e+="a=mid:"+t.mid+"\r\n",t.direction?e+="a="+t.direction+"\r\n":t.rtpSender&&t.rtpReceiver?e+="a=sendrecv\r\n":t.rtpSender?e+="a=sendonly\r\n":t.rtpReceiver?e+="a=recvonly\r\n":e+="a=inactive\r\n",t.rtpSender&&(e+="a="+(i="msid:"+i.id+" "+t.rtpSender.track.id+"\r\n"),e+="a=ssrc:"+t.sendEncodingParameters[0].ssrc+" "+i,t.sendEncodingParameters[0].rtx&&(e+="a=ssrc:"+t.sendEncodingParameters[0].rtx.ssrc+" "+i,e+="a=ssrc-group:FID "+t.sendEncodingParameters[0].ssrc+" "+t.sendEncodingParameters[0].rtx.ssrc+"\r\n")),e+="a=ssrc:"+t.sendEncodingParameters[0].ssrc+" cname:"+c.localCName+"\r\n",t.rtpSender&&t.sendEncodingParameters[0].rtx&&(e+="a=ssrc:"+t.sendEncodingParameters[0].rtx.ssrc+" cname:"+c.localCName+"\r\n"),e},c.getDirection=function(t,e){for(var n=c.splitLines(t),i=0;i<n.length;i++)switch(n[i]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return n[i].substr(2)}return e?c.getDirection(e):"sendrecv"},c.getKind=function(t){return c.splitLines(t)[0].split(" ")[0].substr(2)},c.isRejected=function(t){return"0"===t.split(" ",2)[1]},c.parseMLine=function(t){return{kind:(t=c.splitLines(t)[0].substr(2).split(" "))[0],port:parseInt(t[1],10),protocol:t[2],fmt:t.slice(3).join(" ")}},c.parseOLine=function(t){return{username:(t=c.matchPrefix(t,"o=")[0].substr(2).split(" "))[0],sessionId:t[1],sessionVersion:parseInt(t[2],10),netType:t[3],addressType:t[4],address:t[5]}},c.isValidSDP=function(t){if("string"!=typeof t||0===t.length)return!1;for(var e=c.splitLines(t),n=0;n<e.length;n++)if(e[n].length<2||"="!==e[n].charAt(1))return!1;return!0},t.exports=c},function(t,e,n){"use strict";t.exports=function(t){var e=(t=t&&t.navigator).mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(t){return e(t).catch(function(t){return Promise.reject({name:{PermissionDeniedError:"NotAllowedError"}[t.name]||t.name,message:t.message,constraint:t.constraint,toString:function(){return this.name}})})}}},function(t,e,n){"use strict";var i=n(7),r={shimOnTrack:function(t){"object"!=typeof t||!t.RTCPeerConnection||"ontrack"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get:function(){return this.Kn},set:function(t){this.Kn&&(this.removeEventListener("track",this.Kn),this.removeEventListener("addstream",this.Qn)),this.addEventListener("track",this.Kn=t),this.addEventListener("addstream",this.Qn=function(n){n.stream.getTracks().forEach(function(t){var e=new Event("track");e.track=t,e.receiver={track:t},e.streams=[n.stream],this.dispatchEvent(e)}.bind(this))}.bind(this))}})},shimSourceObject:function(t){"object"==typeof t&&(!t.HTMLMediaElement||"srcObject"in t.HTMLMediaElement.prototype||Object.defineProperty(t.HTMLMediaElement.prototype,"srcObject",{get:function(){return this.mozSrcObject},set:function(t){this.mozSrcObject=t}}))},shimPeerConnection:function(a){var t,o,n,u=i.detectBrowser(a);"object"==typeof a&&(a.RTCPeerConnection||a.mozRTCPeerConnection)&&(a.RTCPeerConnection||(a.RTCPeerConnection=function(t,e){if(u.version<38&&t&&t.iceServers){for(var n=[],i=0;i<t.iceServers.length;i++){var r=t.iceServers[i];if(r.hasOwnProperty("urls"))for(var o=0;o<r.urls.length;o++){var s={url:r.urls[o]};0===r.urls[o].indexOf("turn")&&(s.username=r.username,s.credential=r.credential),n.push(s)}else n.push(t.iceServers[i])}t.iceServers=n}return new a.mozRTCPeerConnection(t,e)},a.RTCPeerConnection.prototype=a.mozRTCPeerConnection.prototype,a.mozRTCPeerConnection.generateCertificate&&Object.defineProperty(a.RTCPeerConnection,"generateCertificate",{get:function(){return a.mozRTCPeerConnection.generateCertificate}}),a.RTCSessionDescription=a.mozRTCSessionDescription,a.RTCIceCandidate=a.mozRTCIceCandidate),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var e=a.RTCPeerConnection.prototype[t];a.RTCPeerConnection.prototype[t]=function(){return arguments[0]=new("addIceCandidate"===t?a.RTCIceCandidate:a.RTCSessionDescription)(arguments[0]),e.apply(this,arguments)}}),t=a.RTCPeerConnection.prototype.addIceCandidate,a.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?t.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())},o={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},n=a.RTCPeerConnection.prototype.getStats,a.RTCPeerConnection.prototype.getStats=function(t,r,e){return n.apply(this,[t||null]).then(function(n){var e,i;if(u.version<48&&(e=n,i=new Map,Object.keys(e).forEach(function(t){i.set(t,e[t]),i[t]=e[t]}),n=i),u.version<53&&!r)try{n.forEach(function(t){t.type=o[t.type]||t.type})}catch(t){if("TypeError"!==t.name)throw t;n.forEach(function(t,e){n.set(e,Object.assign({},t,{type:o[t.type]||t.type}))})}return n}).then(r,e)})}};t.exports={shimOnTrack:r.shimOnTrack,shimSourceObject:r.shimSourceObject,shimPeerConnection:r.shimPeerConnection,shimGetUserMedia:n(58)}},function(t,e,n){"use strict";var f=n(7),d=f.log;t.exports=function(t){function i(t,e,n){function i(i){if("object"!=typeof i||i.require)return i;var r=[];return Object.keys(i).forEach(function(t){var e,n;"require"!==t&&"advanced"!==t&&"mediaSource"!==t&&(void 0===(e=i[t]="object"==typeof i[t]?i[t]:{ideal:i[t]}).min&&void 0===e.max&&void 0===e.exact||r.push(t),void 0!==e.exact&&("number"==typeof e.exact?e.min=e.max=e.exact:i[t]=e.exact,delete e.exact),void 0!==e.ideal&&(i.advanced=i.advanced||[],n={},"number"==typeof e.ideal?n[t]={min:e.ideal,max:e.ideal}:n[t]=e.ideal,i.advanced.push(n),delete e.ideal,Object.keys(e).length||delete i[t]))}),r.length&&(i.require=r),i}return t=JSON.parse(JSON.stringify(t)),c.version<38&&(d("spec: "+JSON.stringify(t)),t.audio&&(t.audio=i(t.audio)),t.video&&(t.video=i(t.video)),d("ff37: "+JSON.stringify(t))),h.mozGetUserMedia(t,e,function(t){n(r(t))})}function r(t){return{name:{InternalError:"NotReadableError",NotSupportedError:"TypeError",PermissionDeniedError:"NotAllowedError",SecurityError:"NotAllowedError"}[t.name]||t.name,message:{"The operation is insecure.":"The request is not allowed by the user agent or the platform in the current context."}[t.message]||t.message,constraint:t.constraint,toString:function(){return this.name+(this.message&&": ")+this.message}}}var e,n,o,s,a,u,c=f.detectBrowser(t),h=t&&t.navigator,t=t&&t.MediaStreamTrack;h.mediaDevices||(h.mediaDevices={getUserMedia:function(n){return new Promise(function(t,e){i(n,t,e)})},addEventListener:function(){},removeEventListener:function(){}}),h.mediaDevices.enumerateDevices=h.mediaDevices.enumerateDevices||function(){return new Promise(function(t){t([{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}])})},c.version<41&&(e=h.mediaDevices.enumerateDevices.bind(h.mediaDevices),h.mediaDevices.enumerateDevices=function(){return e().then(void 0,function(t){if("NotFoundError"===t.name)return[];throw t})}),c.version<49&&(n=h.mediaDevices.getUserMedia.bind(h.mediaDevices),h.mediaDevices.getUserMedia=function(e){return n(e).then(function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach(function(t){t.stop()}),new DOMException("The object can not be found here.","NotFoundError");return t},function(t){return Promise.reject(r(t))})}),55<c.version&&"autoGainControl"in h.mediaDevices.getSupportedConstraints()||(o=function(t,e,n){e in t&&!(n in t)&&(t[n]=t[e],delete t[e])},s=h.mediaDevices.getUserMedia.bind(h.mediaDevices),h.mediaDevices.getUserMedia=function(t){return"object"==typeof t&&"object"==typeof t.audio&&(t=JSON.parse(JSON.stringify(t)),o(t.audio,"autoGainControl","mozAutoGainControl"),o(t.audio,"noiseSuppression","mozNoiseSuppression")),s(t)},t&&t.prototype.getSettings&&(a=t.prototype.getSettings,t.prototype.getSettings=function(){var t=a.apply(this,arguments);return o(t,"mozAutoGainControl","autoGainControl"),o(t,"mozNoiseSuppression","noiseSuppression"),t}),t&&t.prototype.applyConstraints&&(u=t.prototype.applyConstraints,t.prototype.applyConstraints=function(t){return"audio"===this.kind&&"object"==typeof t&&(t=JSON.parse(JSON.stringify(t)),o(t,"autoGainControl","mozAutoGainControl"),o(t,"noiseSuppression","mozNoiseSuppression")),u.apply(this,[t])})),h.getUserMedia=function(t,e,n){if(c.version<44)return i(t,e,n);f.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),h.mediaDevices.getUserMedia(t).then(e,n)}}},function(t,e,n){"use strict";var s=n(7),n={shimLocalStreamsAPI:function(t){var i;"object"==typeof t&&t.RTCPeerConnection&&("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this.mi||(this.mi=[]),this.mi}),"getStreamById"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getStreamById=function(e){var n=null;return this.mi&&this.mi.forEach(function(t){t.id===e&&(n=t)}),this.vi&&this.vi.forEach(function(t){t.id===e&&(n=t)}),n}),"addStream"in t.RTCPeerConnection.prototype||(i=t.RTCPeerConnection.prototype.addTrack,t.RTCPeerConnection.prototype.addStream=function(e){this.mi||(this.mi=[]),-1===this.mi.indexOf(e)&&this.mi.push(e);var n=this;e.getTracks().forEach(function(t){i.call(n,t,e)})},t.RTCPeerConnection.prototype.addTrack=function(t,e){e&&(this.mi?-1===this.mi.indexOf(e)&&this.mi.push(e):this.mi=[e]),i.call(this,t,e)}),"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(t){this.mi||(this.mi=[]);var e,n,i=this.mi.indexOf(t);-1!==i&&(this.mi.splice(i,1),e=this,n=t.getTracks(),this.getSenders().forEach(function(t){-1!==n.indexOf(t.track)&&e.removeTrack(t)}))}))},shimRemoteStreamsAPI:function(t){"object"==typeof t&&t.RTCPeerConnection&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this.vi||[]}),"onaddstream"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this.gi},set:function(t){this.gi&&(this.removeEventListener("addstream",this.gi),this.removeEventListener("track",this.yi)),this.addEventListener("addstream",this.gi=t),this.addEventListener("track",this.yi=function(t){var e=t.streams[0];this.vi||(this.vi=[]),0<=this.vi.indexOf(e)||(this.vi.push(e),(e=new Event("addstream")).stream=t.streams[0],this.dispatchEvent(e))}.bind(this))}}))},shimCallbacksAPI:function(t){var i,r,o,s,a;"object"==typeof t&&t.RTCPeerConnection&&(t=t.RTCPeerConnection.prototype,i=t.createOffer,r=t.createAnswer,o=t.setLocalDescription,s=t.setRemoteDescription,a=t.addIceCandidate,t.createOffer=function(t,e){var n=i.apply(this,[2<=arguments.length?arguments[2]:t]);return e?(n.then(t,e),Promise.resolve()):n},t.createAnswer=function(t,e){var n=r.apply(this,[2<=arguments.length?arguments[2]:t]);return e?(n.then(t,e),Promise.resolve()):n},t.setLocalDescription=function(t,e,n){return t=o.apply(this,[t]),n?(t.then(e,n),Promise.resolve()):t},t.setRemoteDescription=function(t,e,n){return t=s.apply(this,[t]),n?(t.then(e,n),Promise.resolve()):t},t.addIceCandidate=function(t,e,n){return t=a.apply(this,[t]),n?(t.then(e,n),Promise.resolve()):t})},shimGetUserMedia:function(t){var i=t&&t.navigator;i.getUserMedia||(i.webkitGetUserMedia?i.getUserMedia=i.webkitGetUserMedia.bind(i):i.mediaDevices&&i.mediaDevices.getUserMedia&&(i.getUserMedia=function(t,e,n){i.mediaDevices.getUserMedia(t).then(e,n)}.bind(i)))},shimRTCIceServerUrls:function(t){var o=t.RTCPeerConnection;t.RTCPeerConnection=function(t,e){if(t&&t.iceServers){for(var n=[],i=0;i<t.iceServers.length;i++){var r=t.iceServers[i];!r.hasOwnProperty("urls")&&r.hasOwnProperty("url")?(s.deprecated("RTCIceServer.url","RTCIceServer.urls"),(r=JSON.parse(JSON.stringify(r))).urls=r.url,delete r.url,n.push(r)):n.push(t.iceServers[i])}t.iceServers=n}return new o(t,e)},t.RTCPeerConnection.prototype=o.prototype,Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get:function(){return o.generateCertificate}})}};t.exports={shimCallbacksAPI:n.shimCallbacksAPI,shimLocalStreamsAPI:n.shimLocalStreamsAPI,shimRemoteStreamsAPI:n.shimRemoteStreamsAPI,shimGetUserMedia:n.shimGetUserMedia,shimRTCIceServerUrls:n.shimRTCIceServerUrls}},function(t,e,n){n=[n(0),n(1),n(8),n(18)];void 0===(n=function(a,e,t,u){"use strict";var c=t.__phenixPageLoadTime||t.__pageLoadTime||a.now(),n="2022-04-13T15:08:08Z",i="2022.0.2";function r(){this.wi=[],this.bi=null,this.Qe=null,this.ki="production",this.Si=n}function o(t){(this.Qe=t)?this.info("Session started on websdk version [%s] ([%s]), user agent [%s]",n,i,navigator.userAgent):this.info("Websdk version [%s] ([%s]), user agent [%s]",n,i,navigator.userAgent)}function s(e,n){var i=(a.now()-c)/1e3,r=function(t){switch(t){case u.level.TRACE:return"Trace";case u.level.DEBUG:return"Debug";case u.level.INFO:return"Info";case u.level.WARN:return"Warn";case u.level.ERROR:return"Error";case u.level.FATAL:return"Fatal";default:throw new Error("Unsupported Logging Level "+t)}}(n.level),o=n.name||"websdk",s=this;a.forEach(this.wi,function(t){try{t.log(i,r,o,h(Array.prototype.slice.call(e)),s.Qe,s.bi,s.ki,s.Si,n)}catch(t){}})}r.prototype.trace=function(){return s.call(this,arguments,{level:u.level.TRACE})},r.prototype.debug=function(){return s.call(this,arguments,{level:u.level.DEBUG})},r.prototype.info=function(){return s.call(this,arguments,{level:u.level.INFO})},r.prototype.warn=function(){return s.call(this,arguments,{level:u.level.WARN})},r.prototype.error=function(){return s.call(this,arguments,{level:u.level.ERROR})},r.prototype.fatal=function(){return s.call(this,arguments,{level:u.level.FATAL})},r.prototype.addAppender=function(t){e.a(t,"appender"),e.h(t.log,"appender.log"),this.wi.push(t)},r.prototype.getAppenders=function(){return this.wi},r.prototype.getUserId=function(){return this.bi},r.prototype.setUserId=function(t){this.bi=t},r.prototype.getEnvironment=function(){return this.ki},r.prototype.setEnvironment=function(t){this.ki=t},r.prototype.getApplicationVersion=function(){return this.Si},r.prototype.setApplicationVersion=function(t){this.Si=t},r.prototype.getObservableSessionId=function(){return this.vt},r.prototype.setObservableSessionId=function(t){this.vt=t,this.$t&&this.$t.dispose(),t&&(e.a(t,"observableSessionId"),this.$t=this.vt.subscribe(a.bind(o,this),{initial:"notify"}))};var h=function(t){if(0!==t.length){var e=[],n=[];return a.forEach(t,function(t){e.push(a.toString(t)),t instanceof Error&&n.push(t.stack)}),f(e.concat(n))}},f=function(t){for(var e=t[0],n=0;e.indexOf&&1<t.length&&0<=n;)if(0<(n=e.indexOf("%",n)))switch(e.substring(n+1,n+2)){case"%":e=e.substring(0,n)+e.substring(n+1),n++;break;case"s":case"d":t[0]=e=e.substring(0,n)+t[1]+e.substring(n+2),t.splice(1,1);break;default:return t}return t};return r}.apply(e,n))||(t.exports=n)},function(n,i,t){!function(t){var e=function(){"use strict";return function(){return"undefined"!=typeof window?window:void 0!==t?t:"undefined"!=typeof self?self:{}}}.apply(i,[]);void 0===e||(n.exports=e)}.call(this,t(25))},function(t,e,n){n=[n(0),n(1),n(18)];void 0===(n=function(t,e,c){"use strict";function n(){this.Ei=c.level.TRACE}n.prototype.setThreshold=function(t){e.u(t,"level"),this.Ei=t},n.prototype.getThreshold=function(){return this.Ei},n.prototype.log=function(t,e,n,i,r,o,s,a,u){u.level<this.Ei||(i[0]=t+" ["+n+"] "+e+" "+i[0],(u.level>c.level.INFO?f:h)(i))};var h=function(t){console.log.apply(console,t)},f=function(t){console.error.apply(console,t)};return n}.apply(e,n))||(t.exports=n)},function(t,e,n){n=[n(0),n(1),n(27)];void 0===(n=function(r,n,i){"use strict";function t(t,e){n.isArray(t=null==t?[]:t,"valuesToSet"),this.observableArray=new i(t,e)}return t.prototype.getValue=function(){return this.observableArray.getValue()},t.prototype.setValue=function(t){return void 0!==(t=null==t?[]:t)&&n.isArray(t,"values"),this.observableArray.setValue(t)},t.prototype.subscribe=function(t,e){return this.observableArray.subscribe(t,e)},t.prototype.push=function(t){var e=this.observableArray.getValue();e.push(t),this.observableArray.setValue(e)},t.prototype.pop=function(){var t=this.observableArray.getValue(),e=t.pop();return this.observableArray.setValue(t),e},t.prototype.remove=function(e){function t(t){return r.h(e)?e(t):t===e}var n=this.observableArray.getValue(),i=r.filter(n,t);return 0<i.length&&this.observableArray.setValue(r.remove(n,t)),i},t.prototype.removeAll=function(){var t=this.observableArray.getValue();return this.observableArray.setValue([]),t},t.prototype.extend=function(t){return this.observableArray.extend(t),this},t}.apply(e,n))||(t.exports=n)},function(t,e,n){n=[n(0),n(1)];void 0===(n=function(n,e){"use strict";function t(t){e.a(t,"observable"),this.Ri=t,this.Ii=null,this.Ti=!1}return t.prototype.start=function(t,e){this.Ti=!0,this.Ii=this.Ri.subscribe(n.noop,{listenForChanges:{callback:t,timeout:e||500}})},t.prototype.stop=function(){this.Ti=!1,this.Ii&&this.Ii.dispose(),this.Ii=null},t.prototype.isEnabled=function(){return this.Ti},t}.apply(e,n))||(t.exports=n)},function(t,e,n){n=[n(0),n(1),n(12),n(66)];void 0===(n=function(t,e,n,i){function r(){this.Ci={}}return r.prototype.getAppender=function(t){var e=n.getEnvironmentFromUrl(t||""),t=n.getTelemetryServerUri(t);return this.Ci[e]||(this.Ci[e]=function(t){var e=new i(t);return t||e.setEnabled(!1),e}.call(this,t)),this.Ci[e]},new r}.apply(e,n))||(t.exports=n)},function(t,e,n){n=[n(0),n(1),n(3),n(10),n(20),n(31)];void 0===(n=function(c,h,e,n,i,r){function t(t){h.e(t,"uri"),this.Mi="object"==typeof location?location.hostname:e.browser+"-"+e.browserVersion+"-unknown",this.Ei=n.level.TRACE,this.Ti=!0,this.Pi=(e.browser||"Browser")+"/"+(e.browserVersion||"?"),this.Oi=0,this.xi=new i.BatchHttpProto(t+"/logs",[r],"telemetry.StoreLogRecords",{maxAttempts:3,maxBufferedRecords:1e3,maxBatchSize:512}),this.xi.on("capacity",c.bind(o,this))}function o(t){this.xi.addRecordToBeginning({level:"Warn",timestamp:c.isoString(),category:"websdk/telemetryLogger",message:"Deleted "+t+" records",source:this.Pi,fullQualifiedName:this.Mi,sessionId:this.qi,userId:this.Di,environment:this.Ai,version:this.Ui,runtime:this.Oi})}return t.prototype.setThreshold=function(t){h.u(t,"level"),this.Ei=t},t.prototype.getThreshold=function(){return this.Ei},t.prototype.isEnabled=function(){return this.Ti},t.prototype.setEnabled=function(t){h.f(t,"enabled"),this.Ti=t},t.prototype.log=function(t,e,n,i,r,o,s,a,u){u.level<this.Ei||!this.Ti||(h.isArray(i,"messages"),this.Oi=t,this.qi=r,this.Di=o,this.Ui=a,this.Ai=s,function(t,e,n){this.xi.addRecord({level:t,timestamp:c.isoString(),category:e,message:n.join(" "),source:this.Pi,fullQualifiedName:this.Mi,sessionId:this.qi,userId:this.Di,environment:this.Ai,version:this.Ui,runtime:this.Oi})}.call(this,e,n,i))},t}.apply(e,n))||(t.exports=n)},function(t,e,n){n=[n(0),n(1),n(4),n(68),n(29)];void 0===(n=function(r,o,s,a,u){"use strict";function t(t,e,n,i){o.g(t,"uri"),o.a(e,"logger"),o.isArray(n,"protocols"),this.ut=t,this.X=e,this.X.info("Connecting to [%s]",t),this.de=new a(this.ut,this.X),this.ji=new u(this.X,r.bind(m,this),r.bind(p,this),n,i),this.ne=new s.NamedEvents,this.de.onconnected=r.bind(h,this),this.de.onreconnecting=r.bind(c,this),this.de.onreconnected=r.bind(f,this),this.de.ondisconnected=r.bind(d,this),this.de.onerror=r.bind(l,this),this.Ni=!1}function e(t,e){this.ne.fire(t,e,this)}function c(t){e.call(this,"reconnecting")}function h(t){e.call(this,"connected")}function f(t){e.call(this,"reconnected")}function d(t){e.call(this,"disconnected",[t.code,t.reason]),this.Ni&&(this.ne.dispose(),this.ji.dispose())}function l(t){e.call(this,"error",[t.data])}function p(t){this.de.onmessage=t}function m(t){this.de&&this.de.send(t)}return t.prototype.onEvent=function(t,e){return this.ne.listen(t,e),this.ji.onEvent(t,e)},t.prototype.onRequest=function(t,e){return this.ji.onRequest(t,e)},t.prototype.sendRequest=function(t,e,n,i){return this.ji.sendRequest(t,e,n,i)},t.prototype.sendResponse=function(t,e,n,i){return this.ji.sendResponse(t,e,n,i)},t.prototype.disconnect=function(){return this.Ni=!0,this.de.disconnect()},t.prototype.disposeOfPendingRequests=function(){return this.X.info("Disposing of pending MQ WebSocket requests"),this.ji.disposeOfRequests()},t.prototype.getApiVersion=function(){return this.ji.getApiVersion()},t.prototype.toString=function(){return"MQWebSocket["+this.de.toString()+"]"},t}.apply(e,n))||(t.exports=n)},function(t,e,n){n=[n(69)];void 0===(n=function(t){"use strict";return t}.apply(e,n))||(t.exports=n)},function(t,e,n){n=[n(0),n(1),n(28)];void 0===(n=function(o,s,a){"use strict";var u={byebye:{code:1e3,reason:"byebye",desc:"Client closed"},backoffLimitReached:{code:4e3,reason:"backoff-limit-reached",desc:"Reached the limit in terms of the number of reconnects"},networkDisconnect:{code:4001,reason:"network-disconnect",desc:"Network connection monitor determined loss to internet connectivity"},reconnecting:{code:4002,reason:"reconnecting",desc:"Closing WebSocket in order to attempt to establish another connection"}},c={code:1,state:"OPEN",desc:"The connection is open and ready to communicate"},e={code:3,state:"CLOSED",desc:"The connection is closed or could not be opened"};function t(t,e,n,i){s.g(t,"uri"),s.a(e,"logger"),o.isNullOrUndefined(n)?n=4:s.u(n,"maxReconnectAttempts"),this.ut=t,this.X=e,this.Fi=n,this.Li=i||1e3,this.Bi=!1,this.Ut=!1,this._i=[],this.Wi="connecting",this.X.info("Connecting WebSocket to [%s]",t),this.de=h.call(this,l,f);var r=this;this.Vi=null,this.zi=a.listenForNetworkChange(function(t){return t?(o.u(r.Vi)&&(clearTimeout(r.Vi),r.Vi=null),function(){var t=this;setTimeout(function(){return t.Ut?t.X.info("Unable to go back online after network reconnect. Client has stopped WebSocket."):t.de.readyState!==c.code?(t.X.info("Network Reconnected. Attempting to reconnect WebSocket."),t.reconnect()):t.Gi?(t.X.info("Network Reconnected with WebSocket status of [%s].",c.state),l.call(t)):("online"===t.Wi&&"reconnected"===this.Wi||p.call(t),void t.X.info("Network Reconnected."))},1e3)}.call(r)):void(o.u(r.Vi)||(d.call(r),r.Vi=setTimeout(function(){return function(){this.X.warn("Network not reconnected after [%s]. Going Offline and disconnecting WebSocket connection.",15e3),this.Gi=!0,m.call(this,u.networkDisconnect)}.call(r)},15e3)))},0)}function i(t){return this.de.readyState===e.code?f.call(this,t):this.de.close(t.code,t.reason)}function h(t,e){var n=new WebSocket(this.ut);return n.onopen=o.bind(t,this),n.onclose=o.bind(e,this),n.onmessage=o.bind(g,this),n.onerror=o.bind(v,this),n}function r(t){this.de.readyState!==c.code&&this.reconnect(t+1)}function f(t){switch(t.code){case u.reconnecting.code:return;case u.byebye.code:case u.backoffLimitReached.code:case u.networkDisconnect.code:return m.call(this,t);default:return this.Bi?void 0:(d.call(this,t),this.X.info("Attempting to re-establish socket connection after disconnect event with code [%s] and reason [%s]",t.code,t.reason),this.reconnect())}}function d(t){this.X.info("WebSocket is reconnecting"),this.Wi="reconnecting",this.onreconnecting&&this.onreconnecting(t)}function l(t){this.X.info("WebSocket Connected"),function(){var t=this._i.length;if(0!==t)for(this.X.info("Sending [%s] queued messages",t);0<t;){t--;var e=this._i.shift();this.send(e)}}.call(this),this.Wi="connected",this.onconnected&&this.onconnected(t)}function p(t){this.X.info("Successfully reconnected to WebSocket"),this.Wi="reconnected",this.onreconnected&&this.onreconnected(t)}function m(t){this.X.info("WebSocket Disconnected [%s]: [%s]",t.code,t.reason),this.Wi="disconnected",this.ondisconnected&&this.ondisconnected(t)}function v(t){this.X.error("An error occurred on the WebSocket connection [%s]",t.data||t),this.onerror&&this.onerror(t)}function g(t){this.X.debug(">> [%s]",t.data),this.onmessage&&this.onmessage(t)}return t.prototype.onmessage=null,t.prototype.onconnected=null,t.prototype.onreconnecting=null,t.prototype.onreconnected=null,t.prototype.ondisconnected=null,t.prototype.onerror=null,t.prototype.send=function(t){return a.isOnline(),this.de.send(t)},t.prototype.reconnect=function(t){this.de.onclose=null,this.de.onerror=null,this.Bi=!0;var e,n=this;if(o.u(t)||(t=1),this.Ut)return this.X.info("Client has stopped WebSocket after [%s] reconnect attempts",t-1);if(t>this.Fi)return this.X.warn("Unable to reconnect WebSocket after [%s] attempts",this.Fi),i.call(this,u.backoffLimitReached);i.call(this,u.reconnecting);try{this.de=h.call(n,function(){return e&&clearTimeout(e),n.Bi=!1,n.de.onclose=o.bind(f,n),p.call(n)},function(){t+1>n.Fi&&(e&&clearTimeout(e),r.call(n,t))})}catch(t){this.X.warn("Unable to create WebSocket connection [%s]",t)}e=function(t){var e=this;return setTimeout(function(){r.call(e,t)},t*t*this.Li)}.call(this,t)},t.prototype.disconnect=function(){return this.zi.dispose(),this.Ut=!0,o.u(this.Vi)&&(clearTimeout(this.Vi),this.Vi=null),this.de.close(u.byebye.code,u.byebye.reason)},t.prototype.toString=function(){return"ReconnectedWebSocket["+this.ut+","+this.de.readyState+"]"},t}.apply(e,n))||(t.exports=n)},function(t,e,n){n=[n(0),n(8),n(4),n(5),n(2)];void 0===(n=function(r,e,n,i,o){"use strict";function t(){var t="undefined"==typeof navigator||navigator.onLine;this.Ji=new i.Observable(t).extend({timeout:0}),this.ne=new n.NamedEvents,r.addEventListener(e,"online",r.bind(this.ne.fire,this.ne,"online",[])),r.addEventListener(e,"offline",r.bind(this.ne.fire,this.ne,"offline",[])),r.addEventListener(e,"unload",r.bind(this.ne.dispose,this.ne)),this.ne.listen("online",r.bind(this.Ji.setValue,this.Ji,!0)),this.ne.listen("offline",r.bind(this.Ji.setValue,this.Ji,!1))}function s(t,e){var n=this;if(this.Ji.setValue(!1),!r.u(e))return t(!1);n.offlineTimeout=setTimeout(function(){t&&!n.Ji.getValue()&&t(!1)},e)}function a(t){this.Ji.setValue(!0),t&&t(!0)}return t.prototype.listenForNetworkChange=function(t,e){var n=new o.DisposableList,i=r.bind(a,this,t),e=r.bind(s,this,t,e);return n.add(this.ne.listen("online",i)),n.add(this.ne.listen("offline",e)),n},t.prototype.isOnline=function(){return this.Ji.getValue()},new t}.apply(e,n))||(t.exports=n)},function(t,e,n){"use strict";t.exports=r;var i=n(72);function r(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}r.Varint=0,r.Fixed64=1,r.Bytes=2,r.Fixed32=5;var o=4294967296,s=1/o;function a(t){return t.type===r.Bytes?t.readVarint()+t.pos:t.pos+1}function u(t,e,n){return n?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function c(t,e,n){var i=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.ceil(Math.log(e)/(7*Math.LN2));n.realloc(i);for(var r=n.pos-1;t<=r;r--)n.buf[r+i]=n.buf[r]}function h(t,e){for(var n=0;n<t.length;n++)e.writeVarint(t[n])}function f(t,e){for(var n=0;n<t.length;n++)e.writeSVarint(t[n])}function d(t,e){for(var n=0;n<t.length;n++)e.writeFloat(t[n])}function l(t,e){for(var n=0;n<t.length;n++)e.writeDouble(t[n])}function p(t,e){for(var n=0;n<t.length;n++)e.writeBoolean(t[n])}function m(t,e){for(var n=0;n<t.length;n++)e.writeFixed32(t[n])}function v(t,e){for(var n=0;n<t.length;n++)e.writeSFixed32(t[n])}function g(t,e){for(var n=0;n<t.length;n++)e.writeFixed64(t[n])}function y(t,e){for(var n=0;n<t.length;n++)e.writeSFixed64(t[n])}function w(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function b(t,e,n){t[n]=e,t[n+1]=e>>>8,t[n+2]=e>>>16,t[n+3]=e>>>24}function k(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}r.prototype={destroy:function(){this.buf=null},readFields:function(t,e,n){for(n=n||this.length;this.pos<n;){var i=this.readVarint(),r=i>>3,o=this.pos;this.type=7&i,t(r,e,this),this.pos===o&&this.skip(i)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=w(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=k(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=w(this.buf,this.pos)+w(this.buf,this.pos+4)*o;return this.pos+=8,t},readSFixed64:function(){var t=w(this.buf,this.pos)+k(this.buf,this.pos+4)*o;return this.pos+=8,t},readFloat:function(){var t=i.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=i.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e=this.buf,n=e[this.pos++],i=127&n;return n<128?i:(i|=(127&(n=e[this.pos++]))<<7,n<128?i:(i|=(127&(n=e[this.pos++]))<<14,n<128?i:(i|=(127&(n=e[this.pos++]))<<21,n<128?i:function(t,e,n){var i=n.buf,r=i[n.pos++],o=(112&r)>>4;if(r<128)return u(t,o,e);if(o|=(127&(r=i[n.pos++]))<<3,r<128)return u(t,o,e);if(o|=(127&(r=i[n.pos++]))<<10,r<128)return u(t,o,e);if(o|=(127&(r=i[n.pos++]))<<17,r<128)return u(t,o,e);if(o|=(127&(r=i[n.pos++]))<<24,r<128)return u(t,o,e);if(o|=(1&(r=i[n.pos++]))<<31,r<128)return u(t,o,e);throw new Error("Expected varint not more than 10 bytes")}(i|=(15&e[this.pos])<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=function(t,e,n){for(var i,r,o,s="",a=e;a<n;){var u=t[a],c=null,h=239<u?4:223<u?3:191<u?2:1;if(n<a+h)break;1===h?u<128&&(c=u):2===h?128==(192&(i=t[a+1]))&&(c=(31&u)<<6|63&i)<=127&&(c=null):3===h?(i=t[a+1],r=t[a+2],128==(192&i)&&128==(192&r)&&((c=(15&u)<<12|(63&i)<<6|63&r)<=2047||55296<=c&&c<=57343)&&(c=null)):4===h&&(i=t[a+1],r=t[a+2],o=t[a+3],128==(192&i)&&128==(192&r)&&128==(192&o)&&((c=(15&u)<<18|(63&i)<<12|(63&r)<<6|63&o)<=65535||1114112<=c)&&(c=null)),null===c?(c=65533,h=1):65535<c&&(c-=65536,s+=String.fromCharCode(c>>>10&1023|55296),c=56320|1023&c),s+=String.fromCharCode(c),a+=h}return s}(this.buf,this.pos,t);return this.pos=t,e},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){var n=a(this);for(t=t||[];this.pos<n;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){var e=a(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){var e=a(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){var e=a(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){var e=a(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){var e=a(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){var e=a(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){var e=a(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){var e=a(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){if((t&=7)===r.Varint)for(;127<this.buf[this.pos++];);else if(t===r.Bytes)this.pos=this.readVarint()+this.pos;else if(t===r.Fixed32)this.pos+=4;else{if(t!==r.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e,n=this.length||16;n<this.pos+t;)n*=2;n!==this.length&&((e=new Uint8Array(n)).set(this.buf),this.buf=e,this.length=n)},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),b(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),b(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),b(this.buf,-1&t,this.pos),b(this.buf,Math.floor(t*s),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),b(this.buf,-1&t,this.pos),b(this.buf,Math.floor(t*s),this.pos+4),this.pos+=8},writeVarint:function(r){268435455<(r=+r||0)||r<0?function(t){var e,n,i;if(0<=r?(i=r%4294967296|0,e=r/4294967296|0):(e=~(-r/4294967296),4294967295^(i=~(-r%4294967296))?i=i+1|0:e=e+1|(i=0)),0x10000000000000000<=r||r<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),n=i,(i=t).buf[i.pos++]=127&n|128,n>>>=7,i.buf[i.pos++]=127&n|128,n>>>=7,i.buf[i.pos++]=127&n|128,n>>>=7,i.buf[i.pos++]=127&n|128,i.buf[i.pos]=127&(n>>>=7),e=(7&(n=e))<<4,(t=t).buf[t.pos++]|=e|((n>>>=3)?128:0),n&&(t.buf[t.pos++]=127&n|((n>>>=7)?128:0),n&&(t.buf[t.pos++]=127&n|((n>>>=7)?128:0),n&&(t.buf[t.pos++]=127&n|((n>>>=7)?128:0),n&&(t.buf[t.pos++]=127&n|((n>>>=7)?128:0),n&&(t.buf[t.pos++]=127&n)))))}(this):(this.realloc(4),this.buf[this.pos++]=127&r|(127<r?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(127<r?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(127<r?128:0),r<=127||(this.buf[this.pos++]=r>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(t,e,n){for(var i,r,o=0;o<e.length;o++){if(55295<(i=e.charCodeAt(o))&&i<57344){if(!r){56319<i||o+1===e.length?(t[n++]=239,t[n++]=191,t[n++]=189):r=i;continue}if(i<56320){t[n++]=239,t[n++]=191,t[n++]=189,r=i;continue}i=r-55296<<10|i-56320|65536,r=null}else r&&(t[n++]=239,t[n++]=191,t[n++]=189,r=null);i<128?t[n++]=i:(i<2048?t[n++]=i>>6|192:(i<65536?t[n++]=i>>12|224:(t[n++]=i>>18|240,t[n++]=i>>12&63|128),t[n++]=i>>6&63|128),t[n++]=63&i|128)}return n}(this.buf,t,this.pos),128<=(t=this.pos-e)&&c(e,t,this),this.pos=e-1,this.writeVarint(t),this.pos+=t},writeFloat:function(t){this.realloc(4),i.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),i.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var n=0;n<e;n++)this.buf[this.pos++]=t[n]},writeRawMessage:function(t,e){this.pos++;var n=this.pos;t(e,this),128<=(e=this.pos-n)&&c(n,e,this),this.pos=n-1,this.writeVarint(e),this.pos+=e},writeMessage:function(t,e,n){this.writeTag(t,r.Bytes),this.writeRawMessage(e,n)},writePackedVarint:function(t,e){this.writeMessage(t,h,e)},writePackedSVarint:function(t,e){this.writeMessage(t,f,e)},writePackedBoolean:function(t,e){this.writeMessage(t,p,e)},writePackedFloat:function(t,e){this.writeMessage(t,d,e)},writePackedDouble:function(t,e){this.writeMessage(t,l,e)},writePackedFixed32:function(t,e){this.writeMessage(t,m,e)},writePackedSFixed32:function(t,e){this.writeMessage(t,v,e)},writePackedFixed64:function(t,e){this.writeMessage(t,g,e)},writePackedSFixed64:function(t,e){this.writeMessage(t,y,e)},writeBytesField:function(t,e){this.writeTag(t,r.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,r.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,r.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,r.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,r.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,r.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,r.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,r.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,r.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,r.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}}},function(t,e){e.read=function(t,e,n,i,r){var o,s,a=8*r-i-1,u=(1<<a)-1,c=u>>1,h=-7,f=n?r-1:0,d=n?-1:1,n=t[e+f];for(f+=d,o=n&(1<<-h)-1,n>>=-h,h+=a;0<h;o=256*o+t[e+f],f+=d,h-=8);for(s=o&(1<<-h)-1,o>>=-h,h+=i;0<h;s=256*s+t[e+f],f+=d,h-=8);if(0===o)o=1-c;else{if(o===u)return s?NaN:1/0*(n?-1:1);s+=Math.pow(2,i),o-=c}return(n?-1:1)*s*Math.pow(2,o-i)},e.write=function(t,e,n,i,r,o){var s,a,u=8*o-r-1,c=(1<<u)-1,h=c>>1,f=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,d=i?0:o-1,l=i?1:-1,o=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,s=c):(s=Math.floor(Math.log(e)/Math.LN2),e*(i=Math.pow(2,-s))<1&&(s--,i*=2),2<=(e+=1<=s+h?f/i:f*Math.pow(2,1-h))*i&&(s++,i/=2),c<=s+h?(a=0,s=c):1<=s+h?(a=(e*i-1)*Math.pow(2,r),s+=h):(a=e*Math.pow(2,h-1)*Math.pow(2,r),s=0));8<=r;t[n+d]=255&a,d+=l,a/=256,r-=8);for(s=s<<r|a,u+=r;0<u;t[n+d]=255&s,d+=l,s/=256,u-=8);t[n+d-l]|=128*o}},function(t,e,n){n=[n(0)];void 0===(n=function(h){"use strict";function t(t){this.Hi=t,this.Ki={},this.Qi={},o.call(this,this.Hi,this.Ki),i.call(this,this.Hi,this.Ki)}function s(r,o,t,e){var s=this,n=(n=r.messages[o],h.reduce(n.fields,function(t,e){return t[e.name]=h.clone(e.defaultValue),t},{}));return t.readFields(function(t,e,n){var i;r.messages[o].fieldIds[t]&&("repeated"===(i=r.messages[o].fields[t]).rule?e[i.name].push(a.call(s,r.messages[o],o,t,n)):e[i.name]=a.call(s,r.messages[o],o,t,n))},n,e)}function f(e,n,i,r){var o=this,t=e.messages[n];h.forEach(h.keys(t.fields),function(t){return d.call(o,e,n,parseInt(t),i,r)})}function d(n,i,r,o,s,t){var a=this,e=n.messages[i].fields[r],u=o[e.name];if(h.isUndefined(t)||(u=u[t]),e.defaultValue!==u&&!h.isUndefined(u)){if(h.isArray(u)){if("repeated"!==e.rule)throw new Error("Invalid type. Array is not valid with rule ["+e.rule+"]");return h.forEach(u,function(t,e){d.call(a,n,i,r,o,s,e)})}if(h.a(e.schema)&&h.a(u))return s.writeMessage(r,h.bind(f,this,e.schema.parent,e.type),u);var c=h.isUndefined(u)?e.defaultValue:u;if(h.a(e.schema)&&!e.schema.fields)return u=h.u(u)?u:h.get(e.schema,[c,"id"]),s.writeVarintField(r,u);switch(e.type){case"string":return s.writeStringField(r,c);case"float":return s.writeFloatField(r,c);case"double":return s.writeDoubleField(r,c);case"bool":return s.writeBooleanField(r,c);case"enum":case"uint32":case"uint64":case"int32":case"int64":return s.writeVarintField(r,c);case"sint32":case"sint64":return s.writeSVarintField(r,c);case"fixed32":return s.writeFixed32Field(r,c);case"fixed64":return s.writeFixed64Field(r,c);case"sfixed32":return s.writeSFixed32Field(r,c);case"sfixed64":return s.writeSFixed64Field(r,c);case"bytes":return s.writeBytesField(r,c);default:throw new Error("Unexpected type: "+e.type)}}}function o(t,e){0<h.get(t,["messages","length"],0)&&!function(t,i){var r=this;i.messages=h.reduce(t,function(t,e){if(!i[e.name]){var n=h.reduce(e.fields,function(t,e){return t[e.id]=!0,t},{});return t[e.name]={parent:i,type:e.name,fieldIds:n},o.call(r,e,t[e.name]),t}},{})}.call(this,t.messages,e),0<h.get(t,["enums","length"],0)&&function(t,e){e.enums=h.reduce(t,function(t,e){return t[e.name]=h.reduce(e.values,function(t,e){return t[e.name]=e,t},{}),t},{})}.call(this,t.enums,e)}function i(t,e){var n=this;h.forEach(t.messages,function(t){e.messages[t.name].fields=h.reduce(t.fields,h.bind(r,this,e.messages[t.name]),{}),t.messages&&i.call(n,t,e.messages[t.name])})}function r(t,e,n){return e[n.id]={rule:n.rule,type:n.type,name:n.name,schema:function t(e,n){return h.get(n,["messages",e])?n.messages[e]:h.get(n,["enums",e])?n.enums[e]:n.parent?t(e,n.parent):e}.call(this,n.type,t),defaultValue:(t=n.rule,n.type,n=h.get(n,["options","default"]),"repeated"===t?[]:h.isUndefined(n)?null:n)},e}function a(t,e,n,i){var r="int32"===e||"int64"===e?"true":"",o=t.fields[n];if(h.a(o.schema)){if(o.schema.fields)return s.call(this,o.schema.parent,o.type,i,i.readVarint()+i.pos);if(e=i.readVarint(r),n=h.getEnumName(o.schema,e),h.isNullOrUndefined(n))throw new Error("Unsupported enum id ["+e+"] for field ["+o.name+"] on message ["+t.type+"]");return n}switch(o.type){case"string":return i.readString(r);case"float":return i.readFloat(r);case"double":return i.readDouble(r);case"bool":return i.readBoolean(r);case"enum":return i.readVarint(r);case"uint32":case"uint64":case"int32":case"int64":return i.readVarint(r);case"sint32":case"sint64":return i.readSVarint(r);case"fixed32":return i.readFixed32(r);case"fixed64":return i.readFixed64(r);case"sfixed32":return i.readSFixed32(r);case"sfixed64":return i.readSFixed64(r);case"bytes":return i.readBytes(r);default:throw new Error("Unexpected type: "+o.type)}}return t.prototype.read=function(t,e,n){if(!this.Ki.messages[t])throw new Error("Unsupported proto type ["+t+"]");return s.call(this,this.Ki,t,e,n)},t.prototype.write=function(t,e,n){if(!this.Ki.messages[t])throw new Error("Unsupported proto type ["+t+"]");return f.call(this,this.Ki,t,e,n)},t.prototype.getDefaults=function(){},t}.apply(e,n))||(t.exports=n)},function(t,e,n){void 0===(e=function(){"use strict";return{package:"mq",messages:[{name:"Message",fields:[{rule:"optional",type:"MessageType",name:"messageType",id:7,options:{default:"Request"}},{rule:"optional",type:"string",name:"sessionId",id:1},{rule:"optional",type:"string",name:"requestId",id:2},{rule:"required",type:"string",name:"type",id:3},{rule:"optional",type:"string",name:"encoding",id:4},{rule:"required",type:"bytes",name:"payload",id:5},{rule:"repeated",type:"double",name:"wallTime",id:6}],enums:[{name:"MessageType",values:[{name:"Request",id:0},{name:"Response",id:1},{name:"Event",id:2}]}]},{name:"Error",fields:[{rule:"required",type:"string",name:"reason",id:1}]},{name:"PingPong",fields:[{rule:"required",type:"uint64",name:"originTimestamp",id:1},{rule:"optional",type:"uint64",name:"count",id:2}]}]}}.apply(e,[]))||(t.exports=e)},function(t,e,n){n=[n(0),n(1),n(8),n(76)];void 0===(n=function(r,o,s,a){"use strict";function u(){this.Xi=[],this.Zi=""}return u.prototype.push=function(){1024<this.Xi.length+arguments.length&&(this.Zi+=String.fromCharCode.apply(String,this.Xi),this.Xi.length=0),Array.prototype.push.apply(this.Xi,arguments)},u.prototype.build=function(){return this.Zi+String.fromCharCode.apply(String,this.Xi)},{toString:function(t){var e=0,n=t.length,i=new u;return a.encode(function(){return e<n?t[e++]:null},r.bind(i.push,i)),i.build()},toByteArray:function(t){o.e(t,"data");var e,n,i=[];return a.decode((e=t,n=0,function(){return n<e.length?e.charCodeAt(n++):null}),function(t){i.push(t)}),new s.Uint8Array(i)}}}.apply(e,n))||(t.exports=n)},function(t,e,n){t.exports=n(77)},function(i,o,a){var u;!function(){for(var t={},r=[65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,48,49,50,51,52,53,54,55,56,57,43,47],s=[],e=0,n=r.length;e<n;++e)s[r[e]]=e;t.encode=function(t,e){for(var n,i;null!==(n=t());)e(r[n>>2&63]),i=(3&n)<<4,null!==(n=t())?(e(r[63&((i|=n>>4&15)|n>>4&15)]),i=(15&n)<<2,null!==(n=t())?(e(r[63&(i|n>>6&3)]),e(r[63&n])):(e(r[63&i]),e(61))):(e(r[63&i]),e(61),e(61))},t.decode=function(t,e){var n,i,r;function o(t){throw Error("Illegal character code: "+t)}for(;null!==(n=t());)if(void 0===(i=s[n])&&o(n),null!==(n=t())&&(void 0===(r=s[n])&&o(n),e(i<<2>>>0|(48&r)>>4),null!==(n=t()))){if(void 0===(i=s[n])){if(61===n)break;o(n)}if(e((15&r)<<4>>>0|(60&i)>>2),null!==(n=t())){if(void 0===(r=s[n])){if(61===n)break;o(n)}e((3&i)<<6>>>0|r)}}},t.test=function(t){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(t)},i.exports?i.exports=t:void 0===(u=function(){return t}.call(o,a,o,i))||(i.exports=u)}()},function(t,e,n){n=[n(0),n(1),n(79),n(30),n(82)];void 0===(n=function(o,s,a,u,i){"use strict";function c(t,e,n){return i.toString(t.encode(e,n))}function h(t,e,n){return t.decode(e+"Response",i.toByteArray(n))}return function(t,e,n,i,r){return s.g(t,"uri"),s.isArray(e,"protocols"),s.g(n,"type"),s.a(i,"options"),i=o.assign({},i||{},{contentType:"application/protobuf"}),r=new u(e,r),new a(t,i,o.bind(c,this,r,n),o.bind(h,this,r,n))}}.apply(e,n))||(t.exports=n)},function(t,e,n){n=[n(80)];void 0===(n=function(t){"use strict";return t}.apply(e,n))||(t.exports=n)},function(t,e,n){n=[n(0),n(1),n(4),n(8),n(28),n(9),n(5),n(2)];void 0===(n=function(o,s,a,u,c,r,h,f){var n=0,d={capacity:"capacity",error:"error",response:"response"},l=null;function t(t,e,n,i){s.g(t,"uri"),s.a(e=e||{},"options"),e.requestType&&s.g(e.requestType,"options.requestType"),e.maxAttempts&&s.u(e.maxAttempts,"options.maxAttempts"),e.maxBufferedRecords&&s.u(e.maxBufferedRecords,"options.maxBufferedRecords"),e.maxBatchSize&&s.u(e.maxBatchSize,"options.maxBatchSize"),e.contentType&&s.g(e.contentType,"options.maxBatchSize"),n&&s.h(n,"serializeRequest"),i&&s.h(i,"deserializeResponse"),this.$i="__phenixBatchHttpMessages|"+t,this.Yi=e.requestType||"POST",this.tr=e.requestTimeout||3e4,this.er=e.maxAttempts||5,this.nr=e.maxBufferedRecords||1e3,this.ir=e.maxBatchSize||100,this.rr=e.contentType||"application/json",this.or=n,this.sr=i,this.ut=t,this.ar=v.call(this)||[],this.Ti=!0,this.ne=new a.NamedEvents,this.ur=new h.Observable(!0),this.P=new f.DisposableList,this.cr=!1,this.hr=!1,this.fr=null===l?l=w.call(this):l,this.P.add(this.ur.subscribe(o.bind(p,this))),this.P.add(function(){var t=this;return c.listenForNetworkChange(function(){m.call(t,t.cr)})}.call(this)),this.P.add(this.ne),y.call(this,[]),p.call(this);var r=this;o.addEventListener(u,"beforeunload",function(){g.call(r,r.ar),r.hr=!0,r.ar=[]})}function e(){var t;this.ar.length>this.nr&&(t=this.ar.length-this.nr/2,this.ar=this.ar.slice(t),this.ne.fireAsync(d.capacity,[null,{numberOfDeletedRecords:t}]))}function p(){if(this.ur.getValue()&&0!==this.ar.length){m.call(this,!0);var t={records:o.take(this.ar,this.ir)};this.ar=this.ar.slice(this.ir);var e=this;try{!function(t,e,n){var i=this,e=this.or?this.or(o.assign({},e)):e;if("POST"!==this.Yi)throw new Error("Invalid request type");return r.postWithRetry(t,e,{timeout:this.tr,contentType:this.rr,retryOptions:{maxAttempts:this.er,additionalRetryErrorCodes:[0]}},function(t,e){return t?"timeout"!==t.message||function(){return this.ar.length>=this.nr}.call(i)?(m.call(i,!1),i.ne.fire(d.error,[t])):n():(m.call(i,!1),e=i.sr?i.sr(e.data):e.data,i.ne.fire(d.response,[e]))})}.call(this,this.ut,t,function(){setTimeout(function(){e.ar=e.ar.concat(t.records),m.call(e,!1)},n)})}catch(t){setTimeout(function(){return m.call(e,!1),e.ne.fire(d.error,[t])},n)}}}function m(t){this.cr=t,this.ur.setValue(!t&&c.isOnline())}t.prototype.on=function(t,e){return s.g(t,"eventName"),s.h(e,"callback"),this.ne.listen(t,e)},t.prototype.addRecord=function(t){this.hr?g.call(this,[t]):(this.ar.push(t),p.call(this),e.call(this))},t.prototype.addRecordToBeginning=function(t){this.ar.unshift(t),p.call(this),e.call(this)},t.prototype.dispose=function(){this.ar=[],this.P.dispose()};var v=function(){if(!this.fr)return[];try{var t=u.localStorage.getItem(this.$i);if(t)return JSON.parse(t)}catch(t){console.log("Failed to read local storage ["+t.message+"]")}return[]},g=function(t){this.fr&&t&&0!==t.length&&(t=v.call(this).concat(t),y.call(this,t))},y=function(t){if(this.fr&&t)try{var e=JSON.stringify(t);u.localStorage.setItem(this.$i,e)}catch(t){console.log("Failed to store data in local storage ["+t.message+"]")}},w=function(){try{if(!u.localStorage)return console.log("Local storage not available"),!1;var t="__is_local_storage_supported__";u.localStorage.setItem(t,t);var e=u.localStorage.getItem(t);return u.localStorage.removeItem(t),e!==t&&console.log("Local storage is passively blocked"),e===t}catch(t){return console.log("Local storage is blocked"),!1}};return t}.apply(e,n))||(t.exports=n)},function(t,e,n){n=[n(0),n(1),n(2)];void 0===(n=function(d,r,l){"use strict";var p={id:4e3,name:"Aborted by Client"};function t(){}function o(t,e,n,i,r){if(a(i=i||{}),t=c(t,u(i.queryParameters||{},e)),e=d.bind(v,this,d.now(),r),!t)return r(h());i.responseType&&(t.responseType=i.responseType),f(t,i),t.addEventListener("readystatechange",d.bind(m,this,t,i,e)),t.timeout=i.timeout||15e3,t.send(n)}function s(t,e,n,i,r){return t=d.bind(t,this,e,n,i),n={startTime:d.now(),isDisposed:!1},g.call(this,e,i,t,n,r)}function a(t){r.a(t,"settings"),t.queryParameters&&r.a(t.queryParameters,"settings.queryParameters"),t.mimeType&&r.v(t.mimeType,"settings.mimeType"),t.accept&&r.v(t.accept,"settings.accept"),t.contentType&&r.v(t.contentType,"settings.contentType"),t.responseType&&r.v(t.responseType,"settings.responseType"),d.isNullOrUndefined(t.timeout)||r.u(t.timeout,"settings.timeout")}function u(t,e){var n=e.lastIndexOf("#"),i=e.indexOf("?"),r=d.reduce(t,function(t,e,n){return(t+=t?"&":"")+n.toString()+"="+e.toString()},""),t=-1===n?"":e.substring(n+1),r=r+((n=-1===i?"":e.substring(i+1,t?n:e.length))?"&"+n:"");return e=e.replace("?"+n,"").replace("#"+t,""),r&&(e+="?"+r),t&&(e+="#"+t),e}function c(t,e){var n=new XMLHttpRequest;if("withCredentials"in n)n.open(t,e,!0);else{if("undefined"==typeof XDomainRequest)return;(n=new XDomainRequest).open(t,e)}return n}function h(){var t=new Error("unsupported");return t.code="unsupported",t}function f(n,t){var e=t.contentType||"application/json",i=t.accept||e,t=d.assign({},{"Content-Type":e,Accept:i},d.get(t,["headers"],{}));d.forOwn(t,function(t,e){n.setRequestHeader(e,t)})}function m(t,e,n){var i;4===t.readyState&&(200===t.status?(i=(i=t).getAllResponseHeaders(),i=d.reduce(i.trim().split(/[\r\n]+/),function(t,e){var e=(n=e.split(": ")).shift(),n=n.join(": ");return e&&(t[e]=n),t},{}),n(null,{data:t.response||t.responseText,headers:i,rawXhr:t})):(i=new Error(0===t.status?"timeout":"Status=["+t.status+"]"),e=d.get(e,["retryOptions","additionalRetryErrorCodes"],[]),d.forEach(e,function(t){r.u(t,"additionalRetryErrorCode")}),i.code=t.status,(500<=t.status&&t.status<600||d.includes(e,t.status))&&(i.retryable=!0),n(i)))}function v(t,e,n,i){i&&d.set(i,["stats","successResponseTime"],d.now()-t),e(n,i)}function g(n,i,r,o,s,a){a=a||1;var u=this,t=d.get(i,["delay"],null),e=d.get(i,["retryOptions","delay"],1500),c=d.get(i,["retryOptions","backoff"],2),h=d.get(i,["retryOptions","maxAttempts"],1),f=1<a?e*Math.pow(a,c):t,e=function(t,e){return o.isDisposed?s(y(p)):t&&t.retryable&&a<h?g.call(u,n,i,r,o,s,a+1):function(t,e,n,i,r){r&&(d.set(r,["stats","totalResponseTimeForAllAttempts"],d.now()-t),d.set(r,["stats","attempts"],e)),n(i,r)}.call(u,o.startTime,a,s,t,e)},c=new l.Disposable(function(){d.u(o.mostRecentTimeout)&&clearTimeout(o.mostRecentTimeout),o.isDisposed=!0});return!d.u(t)&&1===a||d.get(i,["retryOptions","sync"],!1)?r.call(u,e):function(t,e,n,i,r,o){var s=this;i.mostRecentTimeout=setTimeout(function(){return i.isDisposed?o(y(p)):void n.call(s,o)},r)}.call(u,n,i,r,o,f,e),c}function y(t){var e=new Error(t.name);return e.code=t.id,e}return t.prototype.get=function(t,e,n){a(e=e||{});var t=c("GET",i=u(e.queryParameters||{},t)),i=d.bind(v,this,d.now(),n);if(!t)return n(h());e.mimeType&&t.overrideMimeType(e.mimeType),e.responseType&&(t.responseType=e.responseType),f(t,e),t.addEventListener("readystatechange",d.bind(m,this,t,e,i)),t.timeout=e.timeout||5e3,t.send()},t.prototype.post=function(t,e,n,i){return o.call(this,"POST",t,e,n,i)},t.prototype.put=function(t,e,n,i){return o.call(this,"PUT",t,e,n,i)},t.prototype.delete=function(t,e,n,i){return o.call(this,"DELETE",t,e,n,i)},t.prototype.getWithRetry=function(t,e,n){var i=d.bind(this.get,this,t,e),r={startTime:d.now(),isDisposed:!1};return g.call(this,t,e,i,r,n)},t.prototype.postWithRetry=function(t,e,n,i){return s.call(this,this.post,t,e,n,i)},t.prototype.putWithRetry=function(t,e,n,i){return s.call(this,this.put,t,e,n,i)},t.prototype.deleteWithRetry=function(t,e,n,i){return s.call(this,this.delete,t,e,n,i)},new t}.apply(e,n))||(t.exports=n)},function(t,e,n){n=[n(1),n(8)];void 0===(n=function(r,o){"use strict";return{toString:function(t){var e=0,n=t.length,i=[],r=[];if(e===n)return"";for(;e<n;)i.push(t[e++]),1024<=i.length&&(r.push(String.fromCharCode.apply(String,i)),i=[]);return r.join("")+String.fromCharCode.apply(String,i)},toByteArray:function(t){r.e(t,"data");for(var e,n=0,i=new o.Uint8Array(t.length);n<t.length;){if(255<(e=t.charCodeAt(n)))throw RangeError("illegal char code: "+e);i[n++]=e}return i}}}.apply(e,n))||(t.exports=n)},function(t,e,n){n=[n(0),n(1),n(4),n(2)];void 0===(n=function(r,e,t,o){"use strict";function n(){this.ne=new t.NamedEvents,this.dr=r.now(),this.P=new o.DisposableList,this.lr=!0,this.P.add(this.ne),function(){if(s())return function(){var i;s()&&(i=this,chrome.extension.onRequest.addListener(function(t,e,n){"is_selected"===t&&chrome.tabs.getSelected(null,function(t){t=t.id===e.tab.id,a.call(i,t),n(t)})}))}.call(this);!function(){var e,t,n=this;function i(){var t=!document[e];a.call(n,t)}"object"==typeof document&&(void 0!==document.msHidden?(e="msHidden",t="msvisibilitychange"):void 0!==document.webkitHidden?(e="webkitHidden",t="webkitvisibilitychange"):void 0!==document.hidden&&(e="hidden",t="visibilitychange"),void 0!==document.addEventListener&&void 0!==document[e]?(r.addEventListener(document,t,i,!1),n.P.add(new o.Disposable(function(){r.removeEventListener(document,t,i,!1)}))):function(){var e=this;e.pr=setInterval(function(){var t=document.hasFocus();a.call(e,t)},3e3),e.P.add(new o.Disposable(function(){r.u(e.pr)&&clearInterval(e.pr),e.pr=null}))}.call(n))}.call(this)}.call(this)}function s(){return"undefined"!=typeof chrome&&chrome.extension&&chrome.extension.onRequest}function a(t){if(e.f(t,"isForeground"),this.lr!==t)return t?(this.lr=!0,i.call(this,"foreground")):(this.lr=!1,i.call(this,"background"))}function i(t){var e=r.now(),n=e-this.dr;this.dr=e,this.ne.fire(t,[n])}return n.prototype.isForeground=function(){return this.lr},n.prototype.getTimeSinceLastChange=function(){return r.now()-this.dr},n.prototype.onForeground=function(t){return e.h(t,"callback"),this.ne.listen("foreground",t)},n.prototype.onBackground=function(t){return e.h(t,"callback"),this.ne.listen("background",t)},n}.apply(e,n))||(t.exports=n)},function(t,e,n){n=[n(0),n(1),n(5),n(20),n(3),n(85),n(86)];void 0===(n=function(a,u,r,o,c,s,h){"use strict";function t(t,e,n,i){u.g(t,"uri"),u.e(e,"deviceId"),u.g(n,"version"),u.a(i,"logger"),this.gt=e,this.ot=n,this.X=i,this.mr=new o.MQWebSocket(t,this.X,[s,h],5),this.vt=new r.Observable(null).extend({rateLimit:0})}return t.prototype.onEvent=function(t,e){return this.mr.onEvent(t,e)},t.prototype.disconnect=function(){return this.vt.setValue(null),this.mr.disconnect()},t.prototype.authenticate=function(t,i){u.g(t,"authToken"),u.h(i,"callback"),t={apiVersion:this.mr.getApiVersion(),clientVersion:this.ot,deviceId:this.gt,platform:c.browser,platformVersion:c.browserVersion.toString(),authenticationToken:t},this.getSessionId()&&(t.sessionId=this.getSessionId());var r=this;return this.mr.sendRequest("pcast.Authenticate",t,function(t,e){var n;return e&&((n=r.vt.getValue())&&n!==e.sessionId&&r.mr.disposeOfPendingRequests(),r.vt.setValue(e.sessionId)),i(t,e)})},t.prototype.getSessionId=function(){return this.vt.getValue()},t.prototype.getObservableSessionId=function(){return this.vt},t.prototype.bye=function(t,e){return u.g(t,"reason"),u.h(e,"callback"),t={sessionId:this.getSessionId(),reason:t},this.mr.sendRequest("pcast.Bye",t,e)},t.prototype.setupStream=function(t,e,n,i,r){u.g(t,"streamType"),u.g(e,"streamToken"),u.a(n,"options"),u.h(r,"callback");var o=c.browser||"UnknownBrowser",s=o+"-"+(c.browserVersion||0),i="rtt[http]="+i,i={streamToken:e,createStream:{sessionId:this.getSessionId(),options:["data-quality-notifications",i],connectUri:n.connectUri,connectOptions:n.connectOptions||[],tags:n.tags||[],userAgent:a.get(c,["global","navigator","userAgent"],s)}};return n.originStreamId&&(i.createStream.originStreamId=n.originStreamId),n.negotiate&&(i.createStream.createOfferDescription={streamId:"",options:[t,o,s],apiVersion:this.mr.getApiVersion()},"undefined"!=typeof screen&&i.createStream.createOfferDescription.options.push("screen="+screen.width+"x"+screen.height)),!1===n.receiveAudio&&i.createStream.options.push("no-audio"),!1===n.receiveVideo&&i.createStream.options.push("no-video"),this.mr.sendRequest("pcast.SetupStream",i,r)},t.prototype.setAnswerDescription=function(t,e,n){return u.g(t,"streamId"),u.g(e,"sdp"),u.h(n,"callback"),e={streamId:t,sessionDescription:{type:"Answer",sdp:e},apiVersion:this.mr.getApiVersion()},this.mr.sendRequest("pcast.SetRemoteDescription",e,n)},t.prototype.addIceCandidates=function(t,e,n,i){return u.g(t,"streamId"),u.isArray(e,"candidates"),u.a(n,"options"),u.h(i,"callback"),n={streamId:t,candidates:a.map(e,function(t,e){return u.g(t.candidate,"candidate["+e+"].candidate"),u.u(t.sdpMLineIndex,"candidate["+e+"].sdpMLineIndex"),u.g(t.sdpMid,"candidate["+e+"].sdpMid"),{candidate:t.candidate,sdpMLineIndex:t.sdpMLineIndex,sdpMid:t.sdpMid}}),options:n,apiVersion:this.mr.getApiVersion()},this.mr.sendRequest("pcast.AddIceCandidates",n,i)},t.prototype.updateStreamState=function(t,e,n,i,r){return u.g(t,"streamId"),u.g(e,"signalingState"),u.g(n,"iceGatheringState"),u.g(i,"iceConnectionState"),u.h(r,"callback"),i={streamId:t,signalingState:e,iceGatheringState:n,iceConnectionState:i,apiVersion:this.mr.getApiVersion()},this.mr.sendRequest("pcast.UpdateStreamState",i,r)},t.prototype.destroyStream=function(t,e,n){return u.g(t,"streamId"),u.e(e,"reason"),u.h(n,"callback"),this.mr.sendRequest("pcast.DestroyStream",{streamId:t,reason:e},n)},t.prototype.getRoomInfo=function(t,e,n){return t?u.e(t,"roomId"):u.e(e,"alias"),u.h(n,"callback"),e={roomId:t,alias:e,sessionId:this.getSessionId()},this.mr.sendRequest("chat.GetRoomInfo",e,n)},t.prototype.createRoom=function(t,e){return u.a(t,"room"),u.g(t.name,"room.name"),u.g(t.type,"room.type"),u.g(t.description,"room.description"),u.h(e,"callback"),t={sessionId:this.getSessionId(),room:t},this.mr.sendRequest("chat.CreateRoom",t,e)},t.prototype.enterRoom=function(t,e,n,i,r,o){return t?u.e(t,"roomId"):u.e(e,"alias"),u.a(n,"member"),u.u(r,"timestamp"),u.isArray(i,"options"),u.h(o,"callback"),r={roomId:t,alias:e,sessionId:this.getSessionId(),member:n,options:i,timestamp:r},this.mr.sendRequest("chat.JoinRoom",r,o)},t.prototype.leaveRoom=function(t,e,n){return u.e(t,"roomId"),u.u(e,"timestamp"),u.h(n,"callback"),e={roomId:t,sessionId:this.getSessionId(),timestamp:e},this.mr.sendRequest("chat.LeaveRoom",e,n)},t.prototype.updateMember=function(t,e,n,i){return u.g(t,"roomId"),u.a(e,"member"),u.u(n,"timestamp"),u.h(i,"callback"),e.updateStreams=Object.prototype.hasOwnProperty.call(e,"streams"),n={sessionId:this.getSessionId(),roomId:t,member:e,timestamp:n},this.mr.sendRequest("chat.UpdateMember",n,i)},t.prototype.updateRoom=function(t,e,n){return u.a(t,"room"),u.u(e,"timestamp"),u.h(n,"callback"),e={sessionId:this.getSessionId(),room:t,timestamp:e},this.mr.sendRequest("chat.UpdateRoom",e,n)},t.prototype.sendMessageToRoom=function(t,e,n){return u.g(t,"roomId"),u.a(e,"chatMessage"),this.mr.sendRequest("chat.SendMessageToRoom",{roomId:t,chatMessage:e},n)},t.prototype.subscribeToRoomConversation=function(t,e,n,i){return u.g(t,"sessionId"),u.g(e,"roomId"),u.u(n,"batchSize"),this.mr.sendRequest("chat.FetchRoomConversation",{sessionId:t,roomId:e,limit:n,options:["Subscribe"]},i)},t.prototype.getMessages=function(t,e,n,i,r,o){return u.g(t,"sessionId"),u.g(e,"roomId"),r&&i||u.u(n,"batchSize"),n={sessionId:t,roomId:e,limit:n||0,options:[]},r&&(u.g(r,"beforeMessageId"),n.beforeMessageId=r),i&&(u.g(i,"afterMessageId"),n.afterMessageId=i),this.mr.sendRequest("chat.FetchRoomConversation",n,o)},t.prototype.toString=function(){return"PCastProtocol["+this.mr.toString()+"]"},t}.apply(e,n))||(t.exports=n)},function(t,e,n){void 0===(e=function(){"use strict";return{package:"pcast",options:{optimize_for:"LITE_RUNTIME"},messages:[{name:"Authenticate",fields:[{rule:"optional",type:"uint32",name:"apiVersion",id:9,options:{default:0}},{rule:"required",type:"string",name:"clientVersion",id:1},{rule:"optional",type:"string",name:"device",id:12},{rule:"required",type:"string",name:"deviceId",id:2},{rule:"optional",type:"string",name:"manufacturer",id:13},{rule:"required",type:"string",name:"platform",id:3},{rule:"required",type:"string",name:"platformVersion",id:4},{rule:"required",type:"string",name:"authenticationToken",id:5},{rule:"optional",type:"string",name:"connectionId",id:6},{rule:"optional",type:"string",name:"connectionRouteKey",id:10},{rule:"optional",type:"string",name:"remoteAddress",id:11},{rule:"optional",type:"string",name:"sessionId",id:7},{rule:"optional",type:"string",name:"applicationId",id:8}]},{name:"AuthenticateResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"string",name:"sessionId",id:2},{rule:"optional",type:"string",name:"redirect",id:3},{rule:"repeated",type:"string",name:"roles",id:4}]},{name:"Bye",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"reason",id:2}]},{name:"ByeResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"SessionDescription",fields:[{rule:"required",type:"Type",name:"type",id:1,options:{default:"Offer"}},{rule:"required",type:"string",name:"sdp",id:2}],enums:[{name:"Type",values:[{name:"Offer",id:0},{name:"Answer",id:1}]}]},{name:"CreateStream",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"optional",type:"string",name:"originStreamId",id:2},{rule:"repeated",type:"string",name:"originStreamIds",id:10},{rule:"repeated",type:"string",name:"options",id:3},{rule:"optional",type:"string",name:"connectUri",id:8},{rule:"repeated",type:"string",name:"connectOptions",id:9},{rule:"repeated",type:"string",name:"tags",id:4},{rule:"optional",type:"string",name:"userAgent",id:11},{rule:"optional",type:"SetRemoteDescription",name:"setRemoteDescription",id:5},{rule:"optional",type:"CreateOfferDescription",name:"createOfferDescription",id:6},{rule:"optional",type:"CreateAnswerDescription",name:"createAnswerDescription",id:7}]},{name:"IceServer",fields:[{rule:"repeated",type:"string",name:"urls",id:1},{rule:"optional",type:"string",name:"username",id:2},{rule:"optional",type:"string",name:"credential",id:3}]},{name:"RtcConfiguration",fields:[{rule:"optional",type:"BundlePolicy",name:"bundlePolicy",id:1},{rule:"optional",type:"uint32",name:"iceCandidatePoolSize",id:3},{rule:"repeated",type:"IceServer",name:"iceServers",id:4},{rule:"optional",type:"IceTransportPolicy",name:"iceTransportPolicy",id:5},{rule:"optional",type:"string",name:"peerIdentity",id:6},{rule:"optional",type:"RtcpMuxPolicy",name:"rtcpMuxPolicy",id:7}],enums:[{name:"BundlePolicy",values:[{name:"BundlePolicyBalanced",id:1},{name:"BundlePolicyMaxCompat",id:2},{name:"BundlePolicyMaxBundle",id:3}]},{name:"IceTransportPolicy",values:[{name:"IceTransportPolicyAll",id:1},{name:"IceTransportPolicyPublic",id:2},{name:"IceTransportPolicyRelay",id:3}]},{name:"RtcpMuxPolicy",values:[{name:"RtcpMuxPolicyNegotiate",id:1},{name:"RtcpMuxPolicyRequire",id:2}]}]},{name:"CreateStreamResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"string",name:"streamId",id:2},{rule:"optional",type:"string",name:"instanceRouteKey",id:5},{rule:"repeated",type:"string",name:"streamUris",id:8},{rule:"optional",type:"RtcConfiguration",name:"rtcConfiguration",id:9},{rule:"optional",type:"SetRemoteDescriptionResponse",name:"setRemoteDescriptionResponse",id:3},{rule:"optional",type:"CreateOfferDescriptionResponse",name:"createOfferDescriptionResponse",id:4},{rule:"optional",type:"CreateAnswerDescriptionResponse",name:"createAnswerDescriptionResponse",id:6},{rule:"repeated",type:"string",name:"options",id:7},{rule:"optional",type:"uint64",name:"offset",id:10,options:{default:0}}]},{name:"SetLocalDescription",fields:[{rule:"required",type:"string",name:"streamId",id:1},{rule:"required",type:"SessionDescription",name:"sessionDescription",id:2},{rule:"optional",type:"uint32",name:"apiVersion",id:3,options:{default:0}}]},{name:"SetLocalDescriptionResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"repeated",type:"string",name:"options",id:2}]},{name:"SetRemoteDescription",fields:[{rule:"required",type:"string",name:"streamId",id:1},{rule:"required",type:"SessionDescription",name:"sessionDescription",id:2},{rule:"optional",type:"uint32",name:"apiVersion",id:3,options:{default:0}}]},{name:"SetRemoteDescriptionResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"SessionDescription",name:"sessionDescription",id:2},{rule:"repeated",type:"string",name:"options",id:3}]},{name:"CreateOfferDescription",fields:[{rule:"required",type:"string",name:"streamId",id:1},{rule:"repeated",type:"string",name:"options",id:2},{rule:"optional",type:"uint32",name:"apiVersion",id:3,options:{default:0}}]},{name:"CreateOfferDescriptionResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"SessionDescription",name:"sessionDescription",id:2},{rule:"repeated",type:"string",name:"options",id:3}]},{name:"CreateAnswerDescription",fields:[{rule:"required",type:"string",name:"streamId",id:1},{rule:"repeated",type:"string",name:"options",id:2},{rule:"optional",type:"uint32",name:"apiVersion",id:3,options:{default:0}}]},{name:"CreateAnswerDescriptionResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"SessionDescription",name:"sessionDescription",id:2},{rule:"repeated",type:"string",name:"options",id:3}]},{name:"IceCandidate",fields:[{rule:"required",type:"string",name:"candidate",id:1},{rule:"required",type:"uint32",name:"sdpMLineIndex",id:2},{rule:"required",type:"string",name:"sdpMid",id:3}]},{name:"AddIceCandidates",fields:[{rule:"required",type:"string",name:"streamId",id:1},{rule:"repeated",type:"IceCandidate",name:"candidates",id:2},{rule:"repeated",type:"string",name:"options",id:3},{rule:"optional",type:"uint32",name:"apiVersion",id:4,options:{default:0}}]},{name:"AddIceCandidatesResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"repeated",type:"string",name:"options",id:2}]},{name:"UpdateStreamState",fields:[{rule:"required",type:"string",name:"streamId",id:1},{rule:"required",type:"string",name:"signalingState",id:2},{rule:"required",type:"string",name:"iceGatheringState",id:3},{rule:"required",type:"string",name:"iceConnectionState",id:4},{rule:"optional",type:"uint32",name:"apiVersion",id:5,options:{default:0}}]},{name:"UpdateStreamStateResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"repeated",type:"string",name:"options",id:2}]},{name:"DestroyStream",fields:[{rule:"required",type:"string",name:"streamId",id:1},{rule:"optional",type:"string",name:"reason",id:2},{rule:"repeated",type:"string",name:"options",id:3}]},{name:"DestroyStreamResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"ConnectionDisconnected",fields:[{rule:"required",type:"string",name:"connectionId",id:1},{rule:"required",type:"uint32",name:"reasonCode",id:2},{rule:"optional",type:"string",name:"description",id:3}]},{name:"ConnectionDisconnectedResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"StreamStarted",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"streamId",id:2},{rule:"repeated",type:"string",name:"tags",id:3}]},{name:"SourceStreamStarted",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"streamId",id:2},{rule:"repeated",type:"string",name:"capabilities",id:3},{rule:"repeated",type:"string",name:"tags",id:4}]},{name:"StreamEnded",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"streamId",id:2},{rule:"required",type:"string",name:"reason",id:3},{rule:"repeated",type:"string",name:"tags",id:4},{rule:"optional",type:"string",name:"continuationId",id:5},{rule:"optional",type:"string",name:"routeKey",id:6}]},{name:"SourceStreamEnded",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"streamId",id:2},{rule:"required",type:"string",name:"reason",id:3},{rule:"repeated",type:"string",name:"capabilities",id:4},{rule:"repeated",type:"string",name:"tags",id:5}]},{name:"StreamEndedResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"string",name:"continuationId",id:2},{rule:"optional",type:"string",name:"routeKey",id:3}]},{name:"StreamIdle",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"streamId",id:2},{rule:"repeated",type:"string",name:"options",id:3},{rule:"repeated",type:"string",name:"tags",id:4}]},{name:"StreamArchived",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"streamId",id:2},{rule:"required",type:"uint64",name:"startTime",id:4},{rule:"required",type:"string",name:"uri",id:3}]},{name:"SessionEnded",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"reason",id:2},{rule:"required",type:"float",name:"duration",id:3}]},{name:"ResourceIdle",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"routeKey",id:2}]},{name:"ResourceIdleResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"StreamPlaylist",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"streamId",id:2},{rule:"required",type:"PlaylistType",name:"playlistType",id:3},{rule:"required",type:"string",name:"uri",id:4},{rule:"required",type:"bool",name:"isVariant",id:5,options:{default:!0}}],enums:[{name:"PlaylistType",values:[{name:"Live",id:0},{name:"OnDemand",id:1}]}]},{name:"StreamRtmp",fields:[{rule:"required",type:"string",name:"streamId",id:1},{rule:"required",type:"string",name:"uri",id:2},{rule:"required",type:"uint32",name:"height",id:3},{rule:"required",type:"uint32",name:"bitrate",id:4}]},{name:"SendEventToClient",fields:[{rule:"required",type:"string",name:"connectionId",id:1},{rule:"required",type:"string",name:"type",id:2},{rule:"required",type:"bytes",name:"payload",id:3}]},{name:"SendEventToClientResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"SendRequestToClient",fields:[{rule:"required",type:"string",name:"connectionId",id:1},{rule:"required",type:"string",name:"type",id:2},{rule:"required",type:"bytes",name:"payload",id:3}]},{name:"SendRequestToClientResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"string",name:"type",id:2},{rule:"optional",type:"bytes",name:"payload",id:3}]},{name:"SetupStream",fields:[{rule:"required",type:"string",name:"streamToken",id:1},{rule:"required",type:"CreateStream",name:"createStream",id:2}]},{name:"SetupStreamResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"CreateStreamResponse",name:"createStreamResponse",id:2}]},{name:"SetupPlaylistStream",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"streamToken",id:2},{rule:"repeated",type:"string",name:"options",id:3},{rule:"repeated",type:"string",name:"tags",id:4}]},{name:"PlaylistStreamManifest",fields:[{rule:"required",type:"string",name:"manifest",id:1},{rule:"required",type:"bool",name:"isProtectedContent",id:2},{rule:"optional",type:"string",name:"drmToken",id:3}]},{name:"SetupPlaylistStreamResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"repeated",type:"PlaylistStreamManifest",name:"manifests",id:2},{rule:"optional",type:"uint64",name:"offset",id:3,options:{default:0}}]},{name:"StreamDataQuality",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"streamId",id:2},{rule:"required",type:"uint64",name:"timestamp",id:3},{rule:"required",type:"DataQualityStatus",name:"status",id:4},{rule:"required",type:"DataQualityReason",name:"reason",id:5}],enums:[{name:"DataQualityStatus",values:[{name:"NoData",id:0},{name:"AudioOnly",id:1},{name:"All",id:2}]},{name:"DataQualityReason",values:[{name:"None",id:0},{name:"UploadLimited",id:1},{name:"DownloadLimited",id:2},{name:"PublisherLimited",id:3},{name:"NetworkLimited",id:4}]}]},{name:"StreamDataQualityResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"CallbackEvent",fields:[{rule:"optional",type:"uint32",name:"apiVersion",id:1,options:{default:0}},{rule:"required",type:"string",name:"entity",id:2},{rule:"required",type:"string",name:"what",id:3},{rule:"required",type:"string",name:"data",id:4},{rule:"optional",type:"string",name:"sessionId",id:5}]},{name:"Uri",fields:[{rule:"optional",type:"string",name:"protocol",id:1,options:{default:"http"}},{rule:"required",type:"string",name:"host",id:2},{rule:"optional",type:"uint32",name:"port",id:3,options:{default:80}},{rule:"optional",type:"string",name:"method",id:4,options:{default:"POST"}},{rule:"optional",type:"string",name:"path",id:5,options:{default:"/"}}]},{name:"SetApplicationCallback",fields:[{rule:"required",type:"string",name:"applicationId",id:1},{rule:"required",type:"string",name:"secret",id:2},{rule:"required",type:"Uri",name:"callback",id:3}]},{name:"SetApplicationCallbackResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"string",name:"endpoint",id:2}]},{name:"IssueAuthenticationToken",fields:[{rule:"required",type:"string",name:"applicationId",id:1},{rule:"required",type:"string",name:"secret",id:2},{rule:"repeated",type:"string",name:"capabilities",id:3}]},{name:"IssueAuthenticationTokenResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"string",name:"authenticationToken",id:2}]},{name:"IssueStreamToken",fields:[{rule:"required",type:"string",name:"applicationId",id:1},{rule:"required",type:"string",name:"secret",id:2},{rule:"required",type:"string",name:"sessionId",id:3},{rule:"optional",type:"string",name:"originStreamId",id:4},{rule:"repeated",type:"string",name:"alternateOriginStreamIds",id:6},{rule:"repeated",type:"string",name:"capabilities",id:5},{rule:"optional",type:"bool",name:"permissive",id:7,options:{default:!1}}]},{name:"IssueStreamTokenResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"string",name:"streamToken",id:2}]},{name:"IssueDrmToken",fields:[{rule:"required",type:"string",name:"applicationId",id:1},{rule:"required",type:"string",name:"secret",id:2},{rule:"optional",type:"string",name:"sessionId",id:3},{rule:"required",type:"string",name:"originStreamId",id:4},{rule:"repeated",type:"string",name:"capabilities",id:5}]},{name:"IssueDrmTokenResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"string",name:"drmToken",id:2}]},{name:"TerminateStream",fields:[{rule:"required",type:"string",name:"applicationId",id:1},{rule:"required",type:"string",name:"secret",id:2},{rule:"optional",type:"string",name:"streamId",id:3,oneof:"streamOrToken"},{rule:"optional",type:"string",name:"streamToken",id:5,oneof:"streamOrToken"},{rule:"optional",type:"string",name:"reason",id:4}],oneofs:{streamOrToken:[3,5]}},{name:"TerminateStreamResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"DeleteStream",fields:[{rule:"required",type:"string",name:"applicationId",id:1},{rule:"required",type:"string",name:"secret",id:2},{rule:"optional",type:"string",name:"streamId",id:3,oneof:"streamOrToken"},{rule:"optional",type:"string",name:"streamToken",id:5,oneof:"streamOrToken"},{rule:"optional",type:"string",name:"reason",id:4}],oneofs:{streamOrToken:[3,5]}},{name:"DeleteStreamResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"Stream",fields:[{rule:"required",type:"string",name:"streamId",id:1}]},{name:"ListStreams",fields:[{rule:"required",type:"string",name:"applicationId",id:1},{rule:"required",type:"string",name:"secret",id:2},{rule:"optional",type:"string",name:"start",id:3},{rule:"required",type:"uint32",name:"length",id:4},{rule:"repeated",type:"string",name:"options",id:5}]},{name:"ListStreamsResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"string",name:"start",id:2},{rule:"optional",type:"uint32",name:"length",id:3},{rule:"repeated",type:"Stream",name:"streams",id:4}]},{name:"GetPlaylistUris",fields:[{rule:"required",type:"string",name:"applicationId",id:1},{rule:"required",type:"string",name:"secret",id:2},{rule:"required",type:"string",name:"streamId",id:3},{rule:"repeated",type:"string",name:"options",id:4}]},{name:"GetPlaylistUrisResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"repeated",type:"Playlist",name:"playlists",id:2},{rule:"optional",type:"StreamMetadata",name:"streamInfo",id:3}],messages:[{name:"PlaylistMetadata",fields:[{rule:"optional",type:"uint32",name:"bitrate",id:1},{rule:"optional",type:"uint32",name:"height",id:2},{rule:"optional",type:"float",name:"framesPerSecond",id:3}]},{name:"StreamMetadata",fields:[{rule:"required",type:"string",name:"startTime",id:1},{rule:"optional",type:"string",name:"endTime",id:2}]},{name:"Playlist",fields:[{rule:"required",type:"string",name:"name",id:1},{rule:"required",type:"PlaylistType",name:"type",id:2},{rule:"required",type:"string",name:"uri",id:3},{rule:"required",type:"bool",name:"isVariant",id:4},{rule:"required",type:"bool",name:"isProtected",id:5},{rule:"required",type:"PlaylistMetadata",name:"info",id:6}]}],enums:[{name:"PlaylistType",values:[{name:"Hls",id:0},{name:"Dash",id:1}]}]}]}}.apply(e,[]))||(t.exports=e)},function(t,e,n){void 0===(e=function(){"use strict";return{package:"chat",options:{optimize_for:"LITE_RUNTIME"},messages:[{name:"Room",fields:[{rule:"optional",type:"string",name:"roomId",id:1},{rule:"optional",type:"string",name:"alias",id:2},{rule:"required",type:"string",name:"name",id:3},{rule:"required",type:"string",name:"description",id:4},{rule:"required",type:"RoomType",name:"type",id:5},{rule:"repeated",type:"string",name:"options",id:6},{rule:"optional",type:"string",name:"bridgeId",id:7},{rule:"optional",type:"string",name:"pin",id:8}]},{name:"Stream",fields:[{rule:"required",type:"StreamType",name:"type",id:1},{rule:"required",type:"string",name:"uri",id:2},{rule:"required",type:"TrackState",name:"audioState",id:3},{rule:"required",type:"TrackState",name:"videoState",id:4}]},{name:"Member",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"screenName",id:2},{rule:"required",type:"MemberRole",name:"role",id:3},{rule:"repeated",type:"Stream",name:"streams",id:4},{rule:"required",type:"MemberState",name:"state",id:5},{rule:"required",type:"uint64",name:"lastUpdate",id:6}]},{name:"MemberUpdate",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"optional",type:"string",name:"screenName",id:2},{rule:"optional",type:"MemberRole",name:"role",id:3},{rule:"required",type:"bool",name:"updateStreams",id:7,options:{default:!1}},{rule:"repeated",type:"Stream",name:"streams",id:4},{rule:"optional",type:"MemberState",name:"state",id:5},{rule:"required",type:"uint64",name:"lastUpdate",id:6}]},{name:"ChatUser",fields:[{rule:"optional",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"screenName",id:2},{rule:"required",type:"MemberRole",name:"role",id:3},{rule:"required",type:"uint64",name:"lastUpdate",id:4}]},{name:"ChatMessage",fields:[{rule:"required",type:"string",name:"messageId",id:1},{rule:"required",type:"uint64",name:"timestamp",id:2},{rule:"required",type:"ChatUser",name:"from",id:3},{rule:"required",type:"string",name:"message",id:4}]},{name:"CreateRoom",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"Room",name:"room",id:2}]},{name:"CreateRoomResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"Room",name:"room",id:2}]},{name:"JoinRoom",fields:[{rule:"optional",type:"string",name:"roomId",id:1},{rule:"optional",type:"string",name:"alias",id:2},{rule:"required",type:"string",name:"sessionId",id:3},{rule:"required",type:"Member",name:"member",id:4},{rule:"repeated",type:"string",name:"options",id:5},{rule:"required",type:"uint64",name:"timestamp",id:6}]},{name:"JoinRoomResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"Room",name:"room",id:2},{rule:"repeated",type:"Member",name:"members",id:3},{rule:"optional",type:"Member",name:"self",id:5},{rule:"repeated",type:"string",name:"options",id:4}]},{name:"UpdateRoom",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"Room",name:"room",id:2},{rule:"required",type:"uint64",name:"timestamp",id:3}]},{name:"UpdateRoomResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"UpdateMember",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"optional",type:"string",name:"roomId",id:5},{rule:"required",type:"MemberUpdate",name:"member",id:2},{rule:"repeated",type:"string",name:"options",id:3},{rule:"required",type:"uint64",name:"timestamp",id:4}]},{name:"UpdateMemberResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"uint64",name:"lastUpdate",id:2}]},{name:"LeaveRoom",fields:[{rule:"required",type:"string",name:"roomId",id:1},{rule:"required",type:"string",name:"sessionId",id:2},{rule:"required",type:"uint64",name:"timestamp",id:3}]},{name:"LeaveRoomResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"DestroyRoom",fields:[{rule:"required",type:"string",name:"roomId",id:1}]},{name:"DestroyRoomResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"GetRoomInfo",fields:[{rule:"optional",type:"string",name:"roomId",id:1},{rule:"optional",type:"string",name:"alias",id:2},{rule:"optional",type:"string",name:"sessionId",id:3},{rule:"optional",type:"string",name:"applicationId",id:4},{rule:"optional",type:"string",name:"secret",id:5},{rule:"repeated",type:"string",name:"options",id:6}]},{name:"GetRoomInfoResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"Room",name:"room",id:2},{rule:"repeated",type:"Member",name:"members",id:3},{rule:"repeated",type:"string",name:"options",id:4}]},{name:"RoomEvent",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"roomId",id:2},{rule:"required",type:"RoomEventType",name:"eventType",id:3},{rule:"repeated",type:"Member",name:"members",id:4},{rule:"optional",type:"Room",name:"room",id:5},{rule:"repeated",type:"string",name:"options",id:6},{rule:"required",type:"uint64",name:"timestamp",id:7}]},{name:"SendMessageToRoom",fields:[{rule:"required",type:"string",name:"roomId",id:1},{rule:"required",type:"ChatMessage",name:"chatMessage",id:2}]},{name:"SendMessageToRoomResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"FetchRoomConversation",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"roomId",id:2},{rule:"optional",type:"string",name:"afterMessageId",id:3},{rule:"optional",type:"string",name:"beforeMessageId",id:4},{rule:"required",type:"uint32",name:"limit",id:5},{rule:"repeated",type:"RoomConversationOption",name:"options",id:6}]},{name:"FetchRoomConversationResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"repeated",type:"ChatMessage",name:"chatMessages",id:2}]},{name:"RoomConversationEvent",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"roomId",id:2},{rule:"required",type:"RoomConversationEventType",name:"eventType",id:3},{rule:"repeated",type:"ChatMessage",name:"chatMessages",id:4}]},{name:"RoomBridgeIdle",fields:[{rule:"required",type:"string",name:"roomId",id:1},{rule:"required",type:"string",name:"bridgeId",id:2}]}],enums:[{name:"RoomType",values:[{name:"DirectChat",id:0},{name:"MultiPartyChat",id:1},{name:"ModeratedChat",id:2},{name:"TownHall",id:3},{name:"Channel",id:4}]},{name:"MemberRole",values:[{name:"Participant",id:0},{name:"Moderator",id:1},{name:"Presenter",id:2},{name:"Audience",id:3}]},{name:"MemberState",values:[{name:"Active",id:0},{name:"Passive",id:1},{name:"HandRaised",id:2},{name:"Inactive",id:3},{name:"Offline",id:4}]},{name:"RoomEventType",values:[{name:"MemberJoined",id:0},{name:"MemberLeft",id:1},{name:"MemberUpdated",id:2},{name:"RoomUpdated",id:3},{name:"RoomEnded",id:4}]},{name:"TrackState",values:[{name:"TrackEnabled",id:0},{name:"TrackDisabled",id:1},{name:"TrackEnded",id:2}]},{name:"StreamType",values:[{name:"User",id:0},{name:"Presentation",id:1},{name:"Audio",id:2}]},{name:"RoomConversationOption",values:[{name:"Subscribe",id:0}]},{name:"RoomConversationEventType",values:[{name:"Message",id:0}]}]}}.apply(e,[]))||(t.exports=e)},function(t,e,n){n=[n(88)];void 0===(n=function(t){return t}.apply(e,n))||(t.exports=n)},function(t,e,n){n=[n(0),n(1),n(2)];void 0===(n=function(o,i,r){"use strict";function t(t,e,n){i.a(t,"options"),i.a(t.logger,"options.logger"),i.g(t.version,"options.version"),i.h(e,"onClosestEndpointFound"),n&&i.h(n,"onAnEndpointResolved"),this.X=t.logger,this.ot=t.version,this.vr=e,this.gr=n,this.P=new r.DisposableList,this.yr=!1}function e(t,e){var n;4===t.readyState&&(200===t.status?(n=(n=t).getAllResponseHeaders(),n=o.reduce(n.trim().split(/[\r\n]+/),function(t,e){var e=(n=e.split(": ")).shift(),n=n.join(": ");return e&&(t[e]=n),t},{}),e(null,{data:t.response||t.responseText,headers:n,rawXhr:t})):((n=new Error(0===t.status?"timeout":"Status=["+t.status+"]")).code=t.status,e(n)))}return t.prototype.isResolved=function(){return this.yr},t.prototype.dispose=function(){this.P.dispose()},t.prototype.completeCallback=function(t,e,n){if(!this.isResolved())return this.yr=!0,this.vr(null,{uri:n,roundTripTime:e,endPoint:t})},t.prototype.resolveAll=function(t){for(var e=0;e<t.length;e++)this.resolve(t[e])},t.prototype.resolve=function(i){var r=this;r.X.info("Checking end point [%s]",i);var t=r.ot;(t=function(t){var e=new XMLHttpRequest;if("withCredentials"in e)e.open("GET",t,!0);else{if("undefined"==typeof XDomainRequest)return;(e=new XDomainRequest).open("GET",t)}return e}(i+"?version="+t+"&_="+o.now())).addEventListener("readystatechange",o.bind(e,this,t,function(t,e){var n=o.get(e,["stats","successResponseTime"],0);if(r.gr&&(t?r.gr(t,{endPoint:i}):r.gr(null,{time:n,endPoint:i})),t)503===t.code?r.X.info("End point [%s] is temporarily unavailable",i):r.X.warn("Unable to resolve end point [%s] with [%s]",i,t);else if(!r.isResolved())return r.completeCallback(i,n,e.data)})),t.timeout=15e3,t.send(null)},t}.apply(e,n))||(t.exports=n)},function(t,e,n){n=[n(0),n(1),n(5),n(3)];void 0===(n=function(s,n,i,a){"use strict";var t=52;function e(t,e){n.a(t=t||{},"options"),n.a(e,"logger"),this.X=e,this.wr=t.screenSharingExtensionId||("Chrome"!==a.browser?"":"icngjadgidcmifnehjcielbmiapkhjpn"),this.br=t.eagerlyCheckScreenSharingCapabilities||!1,this.kr=!1,this.Sr=new i.Observable(!1),this.br?c.call(this,s.bind(u,this)):u.call(this,!1)}function u(t){this.Sr.setValue(!0),this.kr=t}function c(e){var n=this;if("Chrome"===a.browser&&n.wr){var i=h.call(this);if(!i)return e(!1);try{i.sendMessage(n.wr,{type:"version"},function(t){return i.lastError||!t||"ok"!==t.status?(n.X.info("Screen sharing NOT available"),void e(!1)):(n.X.info("Screen sharing enabled using version [%s]",t.version),void e(!0))})}catch(t){t.message&&n.X.warn(t.message,t),e(!1)}}else"Firefox"===a.browser&&a.browserVersion>=t||"Firefox"===a.browser&&s.a(a.global.PCastScreenSharing)?e(!0):e(!1)}function r(t){if(this.Sr.getValue())return t();var e=this.Sr.subscribe(function(){return e.dispose(),t()})}function o(r,o){switch(a.browser){case"Chrome":return function(e){var n=this,i=h.call(this);if(!i)return e(new Error("not-available"));try{i.sendMessage(n.wr,{type:"get-desktop-media",sources:["screen","window","tab","audio"]},function(t){return i.lastError||!t?c.call(n,function(t){return u.call(n,t),e(new Error("extension-failure"))}):void("ok"===t.status?e(null,t):e(new Error(t.status),t))})}catch(t){t.message&&n.X.warn(t.message),e(t,{status:"failed"})}}.call(this,function(t,e){return t||e&&"ok"!==e.status?o(t,e):(e.data||e.options||(e.options={canRequestAudioTrack:!0}),void o(null,{status:"ok",constraints:(n=r,i=e.streamId,t=e.options,e={},s.a(n)&&s.a(n.screen)&&(e.video=n.screen),s.a(n)&&s.a(n.screenAudio)&&t.canRequestAudioTrack&&(e.audio=n.screenAudio),n.screen&&s.set(e,["video","mandatory"],{chromeMediaSource:"desktop",chromeMediaSourceId:i}),n.screenAudio&&t.canRequestAudioTrack&&s.set(e,["audio","mandatory"],{chromeMediaSource:"system",chromeMediaSourceId:i}),e)}));var n,i});case"Firefox":o(null,{status:"ok",constraints:(t=r,e={video:{}},s.a(t)&&s.a(t.screen)&&(e.video=t.screen),e.video.mediaSource=e.video.mediaSource||"window",e)});break;default:o(new Error("not-supported"),{status:"not-supported"})}var t,e}function h(){return"Chrome"!==a.browser?null:"undefined"!=typeof chrome&&chrome.runtime&&chrome.runtime.sendMessage?chrome.runtime:(this.X.info("Screen sharing NOT available. Runtime not supported"),null)}return e.prototype.checkForScreenSharingCapability=function(e){return c.call(this,function(t){u.call(this,t),e(t)})},e.prototype.isScreenSharingEnabled=function(e){var n=this;return r.call(this,function(){return n.br||n.kr?e(n.kr):void c.call(n,function(t){n.kr=t,e(t)})})},e.prototype.getScreenSharingConstraints=function(t,e){return r.call(this,s.bind(o,this,t,e))},e.prototype.toString=function(){return"ScreenShareExtensionManager["+a.browser+"]"},e}.apply(e,n))||(t.exports=n)},function(t,e,n){n=[n(0),n(1),n(3)];void 0===(n=function(u,a,c){"use strict";function t(t,e,n){a.a(t,"logger"),a.a(e,"screenShareExtensionManager"),n&&a.h(n,"onScreenShare"),this.X=t,this.yt=e,this.hn=n}function n(n,e,i){function r(t){i(h(t),void 0,t)}function o(t){!function(n){var i={},r={},o=this;setTimeout(function t(){u.reduce(n.getTracks(),function(t,e){return t&&(a.w(e,"track"),"ended"===e.readyState)},!0)||(u.forEach(n.getTracks(),function(t){var e;c.global.Event&&u.hasIndexOrKey(i,t.id)&&i[t.id]!==t.enabled&&(((e=new c.global.Event("trackenabledchange")).data=t).dispatchEvent(e),o.X.info("[%s] Detected track [%s] enabled change to [%s]",n.id,t.id,t.enabled)),c.global.Event&&u.hasIndexOrKey(r,t.id)&&r[t.id]!==t.readyState&&(((e=new c.global.Event("readystatechange")).data=t).dispatchEvent(e),o.X.info("[%s] Detected track [%s] Ready State change to [%s]",n.id,t.id,t.readyState)),i[t.id]=t.enabled,r[t.id]=t.readyState}),setTimeout(t,2e3))},2e3)}.call(s,t),e("ok",t)}var s=this;return function(e,n){var i=this;if(e.screen)return i.yt.isScreenSharingEnabled(function(t){return t?i.yt.getScreenSharingConstraints(e,n):n(new Error("screen-sharing-not-available"))});var t={audio:e.audio||!1,video:e.video||!1};n(null,{status:"ok",constraints:t})}.call(this,n,function(t,e){if("ok"!==u.get(e,["status"]))return r(t);if("cancelled"!==e.status){if(e=e.constraints,s.hn&&(n.screen||n.screenAudio)&&"Chrome"===c.browser&&!(e=s.hn(e)))throw new Error("onScreenShare must return an object of user media constraints");try{c.getUserMedia(e,o,r)}catch(t){r(t)}}else i("cancelled",null)})}t.prototype.getUserMedia=function(t,e){a.a(t,"options"),a.h(e,"callback"),function(i,r){function o(t,e){a.Qt&&a.Qt.push(e),r(a,t,e)}function s(t,e,n){i.screenAudio&&a.X.warn("Screen capture with audio is only supported on Windows or Chrome OS."),r(a,t,e,n)}var a=this,t=i.screen||i.screenAudio,e=i.video||i.audio;return t&&e?n.call(a,{screen:i.screen},function(t,r){return n.call(a,{audio:i.audio,video:i.video},function(t,e){var n=e,i=r.getTracks();n&&u.h(n.addTrack)&&u.forEach(i,function(t){n.addTrack(t)}),o(t,e)},function(t,e,n){!function(t){if(t&&u.h(t.stop)&&t.stop(),t&&u.h(t.getTracks))for(var e=t.getTracks(),n=0;n<e.length;n++)e[n].stop()}(r),s(t,e,n)})},s):n.call(a,i,o,s)}.call(this,t,e)};var h=function(t){return t="unavailable"===t.code?"conflict":"permission-denied"===t.message||"PermissionDeniedError"===t.name?"permission-denied":"InternalError"===t.name&&"Starting video failed"===t.message||"SourceUnavailableError"===t.name?"conflict":"SecurityError"===t.name&&"The operation is insecure."===t.message?"permission-denied":"failed"};return t}.apply(e,n))||(t.exports=n)},function(t,e,n){n=[n(0),n(1),n(12),n(92)];void 0===(n=function(t,e,n,i){function r(){this.Er={}}return r.prototype.createMetricsTransmitter=function(t){var e=n.getEnvironmentFromUrl(t||""),t=n.getTelemetryServerUri(t);return this.Er[e]||(this.Er[e]=function(t,e){return e=new i(t,e),t||e.setEnabled(!1),e}.call(this,t,e)),this.Er[e]},new r}.apply(e,n))||(t.exports=n)},function(t,e,n){n=[n(0),n(1),n(20),n(3),n(31)];void 0===(n=function(s,a,n,i,r){function t(t,e){a.e(t,"uri"),this.Mi="object"==typeof location?location.hostname:i.browser+"-"+i.browserVersion+"-unknown",this.Ti=!0,this.Pi=(i.browser||"Browser")+"/"+(i.browserVersion||"?"),this.xi=new n.BatchHttpProto(t+"/metrics",[r],"telemetry.SubmitMetricRecords",{maxAttempts:3,maxBufferedRecords:1e3,maxBatchSize:512}),this.Ai=e,this.xi.on("capacity",s.bind(o,this))}function o(t){this.xi.addRecordToBeginning({metric:"MetricDropped",value:{uint64:t},timestamp:s.isoString(),sessionId:this.qi,streamId:this.Rr,source:this.Pi,fullQualifiedName:this.Mi,environment:this.Ai,version:this.Ui,runtime:this.Oi})}return t.prototype.isEnabled=function(){return this.Ti},t.prototype.setEnabled=function(t){a.f(t,"enabled"),this.Ti=t},t.prototype.submitMetric=function(t,e,n,i,r,o){this.Ti&&(a.g(t,"metric"),a.a(o,"value"),this.Oi=e,this.qi=n,this.Rr=i,this.Ui=r,function(t,e){t=s.assign({},e,{metric:t,timestamp:s.isoString(),sessionId:this.qi,streamId:this.Rr,source:this.Pi,fullQualifiedName:this.Mi,environment:this.Ai,version:this.Ui,runtime:this.Oi}),this.xi.addRecord(t)}.call(this,t,o))},t}.apply(e,n))||(t.exports=n)},function(t,e,n){n=[n(0),n(1),n(2),n(3)];void 0===(n=function(a,r,u,c){"use strict";var t=c.global.__phenixPageLoadTime||c.global.__pageLoadTime||a.now();function e(t,e,n){r.g(t,"sessionId"),this.ot="2022-04-13T15:08:08Z",this.Qe=t,this.Ir={},this.X=e,this.At=n,this.Tr=a.now(),this.P=new u.DisposableList,this.Cr=[],this.Mr=[],this.Pr=[],this.Or=null,h.call(this,"Stream initializing")}function h(){if(0===(e=Array.prototype.slice.call(arguments)).length)throw new Error("Invalid logging arguments.");var t="[%s] [StreamTelemetry] [%s] "+e[0],e=e.slice(1),e=[t,this.dt,a.now()-this.Tr].concat(e);this.X.debug.apply(this.X,e)}function o(){return(a.now()-t)/1e3}function s(t,e){r.g(t.metric,"record.metric");var n=a.assign({},this.Ir,t);this.At.submitMetric(t.metric,e,this.Qe,this.dt,this.ot,n)}return e.prototype.setProperty=function(t,e){r.g(t,"name"),r.g(e,"value"),this.Ir[t]=e},e.prototype.recordMetric=function(t,e,n,i){r.g(t,"metric"),i=a.assign({},{metric:t,elapsed:this.elapsed(),value:e,previousValue:n},i||{}),s.call(this,i,o())},e.prototype.setStreamId=function(t){if(r.g(t,"streamId"),this.dt)throw new Error("Stream ID can only be set once.");this.dt=t,t=a.now(),s.call(this,{metric:"Initialized",elapsed:this.elapsed()-t+this.Tr},o()-(t-this.Tr)/1e3)},e.prototype.setStartOffset=function(t){if(r.u(t,"startOffset"),this.xr)throw new Error("Start offset can only be set once.");this.xr=t,this.recordMetric("Offset",{uint64:t})},e.prototype.getStartOffset=function(){return this.xr},e.prototype.elapsed=function(){return a.now()-this.Tr},e.prototype.stop=function(){this.P.dispose(),this.recordMetric("Stopped"),h.call(this,"Stream stopped")},e.prototype.recordTimeToFirstFrame=function(t){function e(){n.Or||(n.Or=a.now()-i,n.recordMetric("TimeToFirstFrame",{uint64:n.Or}),h.call(n,"First frame [%s]",n.Or),r.dispose())}var n=this,i=a.now();a.addEventListener(t,"loadeddata",e),a.addEventListener(t,"loadedmetadata",e);var r=new u.Disposable(function(){a.removeEventListener(t,"loadeddata",e),a.removeEventListener(t,"loadedmetadata",e)});return this.P.add(r),r},e.prototype.recordVideoResolutionChanges=function(t,e){var n=this,i={width:e.videoWidth,height:e.videoHeight};return a.find(this.Cr,function(t){return t===e})?new u.Disposable(a.noop):(this.Cr.push(e),t=t.addVideoDisplayDimensionsChangedCallback(function(t,e){i.width===e.width&&i.height===e.height||(n.recordMetric("ResolutionChanged",{string:e.width+"x"+e.height},{string:i.width+"x"+i.height}),i={width:e.width,height:e.height},h.call(n,"Resolution changed: width [%s] height [%s]",e.width,e.height))}),this.P.add(t),t)},e.prototype.recordRebuffering=function(i){var r,o,s=this;if(a.find(this.Mr,function(t){return t===i}))return new u.Disposable(a.noop);function t(){r||(s.recordMetric("Stalled"),r=a.now(),h.call(s,"[buffering] Stream has stalled"))}function e(t){var e=i.buffered.length,n=!("playing"===t.type||0<e)||("progress"===t.type||"timeupdate"===t.type)&&i.buffered.end(e-1)===o;!r||!e&&"Edge"!==c.browser||n||("progress"===t.type&&(o=i.buffered.end(e-1)),e=a.now()-r,s.recordMetric("Buffering",{uint64:e}),h.call(s,"[buffering] Stream has recovered from stall after [%s] milliseconds",e),r=null)}this.Mr.push(i),a.addEventListener(i,"stalled",t),a.addEventListener(i,"pause",t),a.addEventListener(i,"suspend",t),a.addEventListener(i,"play",e),a.addEventListener(i,"playing",e),a.addEventListener(i,"progress",e),a.addEventListener(i,"timeupdate",e);var n=new u.Disposable(function(){a.removeEventListener(i,"stalled",t),a.removeEventListener(i,"pause",t),a.removeEventListener(i,"suspend",t),a.removeEventListener(i,"play",e),a.removeEventListener(i,"playing",e),a.removeEventListener(i,"progress",e),a.removeEventListener(i,"timeupdate",e)});return this.P.add(n),n},e.prototype.recordVideoPlayingAndPausing=function(e){var t=this;if(a.find(this.Pr,function(t){return t===e}))return new u.Disposable(a.noop);function n(){e.paused?t.recordMetric("Playing",{boolean:!1}):t.recordMetric("Playing",{boolean:!0})}this.Pr.push(e),a.addEventListener(e,"pause",n),a.addEventListener(e,"playing",n);var i=new u.Disposable(function(){a.removeEventListener(e,"pause",n),a.removeEventListener(e,"playing",n)});return this.P.add(i),i},e}.apply(e,n))||(t.exports=n)},function(t,e,n){n=[n(0),n(1),n(2),n(13),n(95),n(3)];void 0===(n=function(r,o,n,i,s,a){"use strict";var t=a.global.__phenixPageLoadTime||a.global.__pageLoadTime||r.now();function e(t,e){this.ot="2022-04-13T15:08:08Z",this.Qe=null,this.Ir={resource:"session",kind:"event"},this.X=t,this.At=e,this.qr=new s(this.X),this.Tr=r.now(),this.P=new n.DisposableList,this.ar=[],this.P.add(i.onBackground(r.bind(u,this,!1))),this.P.add(i.onForeground(r.bind(u,this,!0))),this.qr.isSupported()&&(this.P.add(this.qr.onNetworkChange(r.bind(d,this))),this.P.add(this.qr),c.call(this),f.call(this),h.call(this))}function u(t,e){this.recordMetric(t?"ApplicationForeground":"ApplicationBackground",{uint64:e}),l.call(this,"Application has gone into the [%s] after [%s] ms",t?"foreground":"background",e)}function c(){var t=this.qr.getEffectiveType();this.recordMetric("NetworkType",{string:t},null,{resource:a.browser}),l.call(this,"[%s] has started with Network effective type of [%s]",this.Qe?"Session":"Application",t)}function h(t,e){var n=t||this.qr.getRoundTripTime(),t=e||-1;if(this.recordMetric("RoundTripTime",{uint32:n},{uint32:t},{resource:a.browser}),r.isNullOrUndefined(e))return l.call(this,"Network RTT [%s]",n);l.call(this,"Network RTT changed to [%s] from [%s]",n,t)}function f(t,e){var n=t||this.qr.getDownlinkThroughputCapacity(),t=e||-1;if(this.recordMetric("DownlinkThroughputCapacity",{float:n},{float:t},{resource:a.browser}),r.isNullOrUndefined(e))return l.call(this,"Network downlink throughput capacity [%s]",n);l.call(this,"Network downlink throughput capacity changed to [%s] from [%s]",n,t)}function d(t,e){e.downlinkThroughputCapacity!==t.downlinkThroughputCapacity&&f.call(this,t.downlinkThroughputCapacity,e.downlinkThroughputCapacity),e.rtt!==t.rtt&&h.call(this,t.rtt,e.rtt),e.effectiveType!==t.effectiveType&&function(t,e){t=t||this.qr.getEffectiveType(),this.recordMetric("NetworkType",{string:t},{string:e},{resource:a.browser}),l.call(this,"Network effective type has changed to [%s] from [%s]",t,e||"New")}.call(this,t.effectiveType,e.effectiveType)}function l(){if(0===(e=Array.prototype.slice.call(arguments)).length)throw new Error("Invalid logging arguments.");var t="[%s] [SessionTelemetry] [%s] "+e[0],e=e.slice(1),e=[t,this.Qe,r.now()-this.Tr].concat(e);this.X.info.apply(this.X,e)}function p(){return(r.now()-t)/1e3}function m(t,e){if(o.g(t.metric,"record.metric"),!this.Qe)return this.ar.push({record:t,since:e});var n=r.assign({},this.Ir,t);this.At.submitMetric(t.metric,e,this.Qe,null,this.ot,n)}return e.prototype.setSessionId=function(t){!t&&this.Qe&&m.call(this,{metric:"Stopped",elapsed:this.elapsed()},p()),(this.Qe=t)&&(m.call(this,{metric:"Initialized",elapsed:this.elapsed()},p()),function(){if(this.Qe)for(var t=this.ar.length;0<t;){var e=this.ar.splice(t-1,1);1===e.length&&m.call(this,e[0].record,e[0].since),t--}}.call(this),function(){var t=i.isForeground(),e=i.getTimeSinceLastChange();this.recordMetric(t?"ApplicationForeground":"ApplicationBackground",{uint64:e}),l.call(this,"Session has started in the [%s] after [%s] ms",t?"foreground":"background",e)}.call(this),this.qr.isSupported()&&(c.call(this),f.call(this),h.call(this)))},e.prototype.setProperty=function(t,e){o.g(t,"name"),o.g(e,"value"),this.Ir[t]=e},e.prototype.recordMetric=function(t,e,n,i){o.g(t,"metric"),i=r.assign({},{metric:t,elapsed:this.elapsed(),value:e,previousValue:n},i||{}),m.call(this,i,p())},e.prototype.elapsed=function(){return r.now()-this.Tr},e.prototype.dispose=function(){this.P.dispose(),this.recordMetric("Stopped"),l.call(this,"Session telemetry stopped")},e}.apply(e,n))||(t.exports=n)},function(t,e,n){n=[n(0),n(1),n(4),n(2),n(3)];void 0===(n=function(t,e,n,i,r){function o(t){if(e.a(t,"logger"),this.X=t,this.ne=new n.NamedEvents,this.P=new i.DisposableList,this.P.add(this.ne),!this.isSupported())return this.X.info("Network monitor is not supported.");this.Dr=s.call(this),function(){var t=this;navigator.connection.addEventListener("change",function(){t.ne.fireAsync("NetworkChange",[s.call(t),t.Dr]),t.Dr=s.call(t)})}.call(this)}function s(){return{downlinkThroughputCapacity:this.getDownlinkThroughputCapacity(),effectiveType:this.getEffectiveType(),rtt:this.getRoundTripTime()}}return o.prototype.isSupported=function(){return r.global.navigator&&r.global.navigator.connection},o.prototype.getDownlinkThroughputCapacity=function(){return this.isSupported()?r.global.navigator.connection.downlink||r.global.navigator.connection.downlinkMax:-1},o.prototype.getEffectiveType=function(){return this.isSupported()?r.global.navigator.connection.effectiveType||r.global.navigator.connection.type:"Unknown"},o.prototype.getRoundTripTime=function(){return this.isSupported()?r.global.navigator.connection.rtt||r.global.navigator.connection.type:-1},o.prototype.onNetworkChange=function(t){if(this.isSupported())return e.h(t,"callback"),this.ne.listen("NetworkChange",t)},o.prototype.dispose=function(){this.P.dispose()},o}.apply(e,n))||(t.exports=n)},function(t,e,n){n=[n(0),n(1),n(6)];void 0===(n=function(r,o,s){"use strict";function a(t,e,n){o.g(t,"type"),o.a(e,"stream"),o.a(n,"logger"),this.ct=t,this.T=e,this.X=n,this.Ar=null;var i=this;this.T.on(s.streamEvents.playerEnded.name,function(t){return i.X.info("[%s] [%s] player ended.",i.T.getStreamId(),i.ct),i.Ur=!0,i.Ar?i.Ar():void i.streamEndedCallback(a.getStreamEndedStatus(t),t)})}return a.prototype.toString=function(){return"Stream["+(this.T?this.T.getStreamId():"")+"]"},a.prototype.on=function(t,e){return this.T.on(t,e)},a.prototype.streamErrorCallback=function(t,e){r.h(this.T.streamErrorCallback)?(this.X.debug("[%s] [%s] stream error event [%s]",this.T.getStreamId(),this.ct,e),this.T.streamErrorCallback(this.T,t,e)):this.X.error("[%s] [%s] stream error event [%s]",this.T.getStreamId(),this.ct,e)},a.prototype.streamEndedCallback=function(t,e,n){var i=this.T.getRenderer();if(!this.jr){if(n&&!this.Ar&&this.T.isActive()&&i&&!this.Ur)return this.Ar=r.bind(this.streamEndedCallback,this,t,e),this.X.info("[%s] [%s] stream ended. Waiting for end of player.",this.T.getStreamId(),this.ct),void(i&&i.stop(e,n));this.jr=!0,r.h(this.T.streamEndedCallback)&&this.T.streamEndedCallback(this.T,t,e),this.T.stop(e),i&&i.stop(e,n)}},a.prototype.dataQualityChangedCallback=function(t,e){var n=this.T.getRenderer();n&&r.h(n.dataQualityChangedCallback)&&n.dataQualityChangedCallback(n,t,e)},a.prototype.getPhenixMediaStream=function(){return this.T},a.getStreamEndedStatus=function(t){switch(t){case"":case"none":case"ended":return"ended";case"server-error":case"session-error":case"not-ready":case"error":case"died":return"failed";case"censored":return"censored";case"maintenance":return"maintenance";case"capacity":return"capacity";case"app-background":return"app-background";case"egress-failed":return"egress-failed";case"egress-setup-failed":return"egress-setup-failed";case"overload":return"overload";default:return"custom"}},a}.apply(e,n))||(t.exports=n)},function(t,e,n){n=[n(0),n(1),n(4),n(9),n(2),n(3),n(11),n(6)];void 0===(n=function(s,e,a,r,u,c,h,o){"use strict";var f=null;function t(t,e,n,i,r,o){this.X=o,this.dt=t,this.Nr=encodeURI(e).replace(/[#]/g,"%23"),this.Pe=n,this.C=i,this.nt=null,this.W=null,this.De=new h(o),this.Fr={time:0,buffered:null,averageLength:0,count:0},this.ne=new a.NamedEvents,this.P=new u.DisposableList,this.Oe=r,this.Lr=s.bind(l,this),this.Br=s.bind(d,this),this._r=s.bind(p,this)}function d(){if(this.Fr.time=s.now(),0===this.W.buffered.length)return this.X.debug("[%s] Shaka live stream player progress event fired without any buffered content",this.dt);var t,e=this.W.buffered.end(this.W.buffered.length-1);this.Fr.buffered!==e&&(null!==this.Fr.buffered&&(t=this.Fr.averageLength*this.Fr.count+(e-this.Fr.buffered),this.Fr.count+=1,this.Fr.averageLength=t/this.Fr.count),this.Fr.buffered=e)}function l(){var t=this;t.X.info("[%s] Loading Shaka live stream player stream stalled.",t.dt),0!==t.Fr.time&&setTimeout(function(){s.now()-t.Fr.time>n.call(t)&&t.Wr&&t.stop("ended")},n.call(t))}function n(){return 1.5*this.Fr.averageLength<2e3?2e3:1.5*this.Fr.averageLength}function p(){this.X.info("[%s] Shaka live stream player ended.",this.dt)}return t.prototype.on=function(t,e){return this.ne.listen(t,e)},t.prototype.start=function(e){var n=this;n.Vr=new this.Oe.Player(e),this.P.add(this.Pe.recordTimeToFirstFrame(e)),this.P.add(this.Pe.recordRebuffering(e)),this.P.add(this.Pe.recordVideoResolutionChanges(this,e));var t={abr:{defaultBandwidthEstimate:2e6},manifest:{retryParameters:{timeout:1e4}},streaming:{rebufferingGoal:2,bufferingGoal:10,bufferBehind:30,retryParameters:{timeout:1e4,maxAttempts:10,backoffFactor:1.1}}};function i(t){n.Vr.configure(t),!1===n.C.receiveAudio&&(e.muted=!0),s.addEventListener(n.Vr,"error",function(t){n.ne.fire(o.rendererEvents.error.name,["player",t])}),s.addEventListener(e,"stalled",n.Lr,!1),s.addEventListener(e,"pause",n.Lr,!1),s.addEventListener(e,"suspend",n.Lr,!1),s.addEventListener(e,"progress",n.Br,!1),s.addEventListener(e,"ended",n._r,!1),n.Vr.load(n.Nr).then(function(){n.X.info("[%s] DASH live stream has been loaded",n.dt),s.h(e.play)&&e.play()}).catch(function(t){n.X.error("[%s] Error while loading DASH live stream [%s]",n.dt,t.code,t),n.ne.fire(o.rendererEvents.error.name,["shaka",t])}),n.C.capabilities.includes("audio-only")||n.De.start(this,e),n.W=e}return this.C.isDrmProtectedContent?(function(){var t;if(!s.h(Uint8Array))throw this.X.error(t="Uint8Array support required for DRM"),new Error(t);if(!s.h(c.global.atob))throw this.X.error(t="rtc.global.atob support required for DRM"),new Error(t)}.call(n),function(o){var s=this;o.getNetworkingEngine().registerResponseFilter(function(t,e){if(t.toString()===s.Oe.net.NetworkingEngine.RequestType.LICENSE.toString()){var n=new Uint8Array(e.data),t=String.fromCharCode.apply(null,n),t=(n=JSON.parse(t)).license,i=c.global.atob(t);e.data=new Uint8Array(i.length);for(var r=0;r<i.length;++r)e.data[r]=i.charCodeAt(r);n.trackRestrictions&&o.configure({restrictions:n.trackRestrictions})}})}.call(n,n.Vr),function(t,e,n){t.drm||(t.drm={}),t.drm.advanced||(t.drm.advanced={}),t.manifest||(t.manifest={}),t.manifest.dash||(t.manifest.dash={}),function(n,t,i){function e(t,e){t?i(t):(f=e.data,n.drm.advanced["com.widevine.alpha"]={serverCertificate:function(t){for(var e=t.length,n=new Uint8Array(e),i=0;i<e;i++)n[i]=t.charCodeAt(i);return n}(e.data),persistentStateRequired:!0,distinctiveIdentifierRequired:!1},i(null,n))}n.manifest.dash.customScheme=function(t){if("com.phenixrts.widevine"===t.getAttribute("schemeIdUri")||"com.phenixp2p.widevine"===t.getAttribute("schemeIdUri"))return[{keySystem:"com.widevine.alpha",licenseServerUri:decodeURIComponent(t.getAttribute("widevineLicenseServerUrl"))}]},f?e(null,f):r.get(t.widevineServiceCertificateUrl,{mimeType:"text/plain; charset=x-user-defined"},e)}.call(this,t,e,n)}.call(n,t,n.C,function(t,e){if(t)throw n.X.error("Failed to add DRM configuration to shaka player",t),t;i(e)})):i(t),e},t.prototype.stop=function(t,e){var n,i=this;if(!i.zr){if(e)return i.Wr=!0;this.De.stop(),this.P.dispose(),this.Vr&&(n=function(){i.W&&(s.removeEventListener(i.W,"stalled",i.Lr,!1),s.removeEventListener(i.W,"pause",i.Lr,!1),s.removeEventListener(i.W,"suspend",i.Lr,!1),s.removeEventListener(i.W,"progress",i.Br,!1),s.removeEventListener(i.W,"ended",i._r,!1),"Edge"===c.browser&&(i.W.src="")),i.ne.fire(o.rendererEvents.ended.name,[""]),i.Vr=null,i.W=null},i.Vr.destroy().then(function(){i.X.info("[%s] Shaka live stream player has been destroyed",i.dt)}).then(function(){n()}).catch(function(t){i.X.error("[%s] Error while destroying shaka live stream player [%s]",i.dt,t.code,t),n(),i.ne.fire(o.rendererEvents.error.name,["shaka",t])}),i.zr=!0)}},t.prototype.getStats=function(){if(!this.Vr)return{width:0,height:0,currentTime:0,lag:0,networkState:o.networkStates.networkNoSource.id};var t=s.assign(this.Vr.getStats(),{currentTime:0,lag:0}),e=s.get(this.W,["currentTime"],0),n=(s.now()-this.C.originStartTime)/1e3,n=Math.max(0,n-e);return this.W&&(t.currentTime=e,t.lag=n),0<t.estimatedBandwidth?t.networkState=o.networkStates.networkLoading.id:0<t.playTime?t.networkState=o.networkStates.networkIdle.id:t.video?t.networkState=o.networkStates.networkEmpty.id:t.networkState=o.networkStates.networkNoSource.id,t},t.prototype.setDataQualityChangedCallback=function(t){e.h(t,"callback"),this.dataQualityChangedCallback=t},t.prototype.getPlayer=function(){return this.Vr},t.prototype.addVideoDisplayDimensionsChangedCallback=function(t,e){return this.De.addVideoDisplayDimensionsChangedCallback(t,e)},t}.apply(e,n))||(t.exports=n)},function(t,e,n){n=[n(0),n(1),n(10),n(4),n(9),n(2),n(3),n(11),n(6)];void 0===(n=function(s,e,r,a,t,u,i,c,o){"use strict";var h=6e3,n=15e3;function f(t,e,n,i,r,o){this.X=o,this.dt=t,this.Nr=encodeURI(e).replace(/[#]/g,"%23"),this.Pe=n,this.C=i,this.xe=r,this.nt=null,this.W=null,this.De=new c(o),this.Fr={time:0,buffered:null,averageLength:0,count:0,lastCurrentTime:0,lastCurrentTimeOccurenceTimestamp:0},this.ne=new a.NamedEvents,this.P=new u.DisposableList,this.Lr=s.bind(v,this),this.Br=s.bind(m,this),this._r=s.bind(y,this)}function d(t){if(p.call(this)&&t&&(3===t.code||t.severity===this.xe.errors.severity.RECOVERABLE))return this.X.warn("Reloading unhealthy stream after error event [%s]",t),l.call(this);this.ne.fire(o.rendererEvents.error.name,["phenix-player",t])}function l(){p.call(this)&&(this.X.warn("Reloading unhealthy stream that was active for at least [%s] seconds",n/1e3),this.Gr=s.now(),function(){this.Vr.dispose(),this.Vr=null,this.start(this.W)}.call(this))}function p(){var t=!this.Gr||s.now()-this.Gr>n;return this.W&&!this.Wr&&this.Vr&&0!==this.W.buffered.length&&t}function m(){if(this.Fr.time=s.now(),0===this.W.buffered.length)return this.X.debug("[%s] Phenix stream player progress event fired without any buffered content",this.dt);var t,e,n=this.W.buffered.end(this.W.buffered.length-1);this.Fr.buffered!==n&&(null!==this.Fr.buffered&&(e=this.Fr.averageLength*this.Fr.count+(n-this.Fr.buffered),t=this.Fr.lastCurrentTime===this.W.currentTime,this.Fr.count+=1,this.Fr.averageLength=e/this.Fr.count,t||(this.Fr.lastCurrentTimeOccurenceTimestamp=s.now()),e=this.Fr.lastCurrentTimeOccurenceTimestamp&&s.now()-this.Fr.lastCurrentTimeOccurenceTimestamp>h,t&&e&&this.W&&!this.W.paused&&p.call(this)&&(this.X.warn("Reloading stream after current time has not changed for [%s] seconds due to unregistered stall.",h/1e3),l.call(this))),this.Fr.buffered=n,this.Fr.lastCurrentTime=this.W.currentTime)}function v(t){var e,n=this;n.X.info("[%s] Loading Phenix Live stream player stalled caused by [%s] event.",n.dt,t.type),0===n.Fr.time||n.W.paused||(e=n.W.currentTime,setTimeout(function(){s.now()-n.Fr.time>g.call(n)&&n.Wr&&n.stop("ended")},g.call(n)),setTimeout(function(){n.W&&n.W.currentTime===e&&!n.W.paused&&p.call(n)&&(n.X.warn("Reloading stream after being stalled for [%s] seconds",h/1e3),l.call(n))},h))}function g(){return 1.5*this.Fr.averageLength<2e3?2e3:1.5*this.Fr.averageLength}function y(){this.X.info("[%s] Phenix stream player ended.",this.dt)}return f.isSupported=function(){return this.xe&&this.xe.isSupported},f.prototype.on=function(t,e){return this.ne.listen(t,e)},f.prototype.start=function(t){var e,n,i=(e=(i=this.X).getAppenders(),n=new r.Logger,s.forEach(e,function(t){t instanceof r.ConsoleAppender&&(t=new r.ConsoleAppender).setThreshold(r.level.INFO),n.addAppender(t)}),n.setUserId(i.getUserId()),n.setEnvironment(i.getEnvironment()),n.setApplicationVersion(i.getApplicationVersion()),n.setObservableSessionId(i.getObservableSessionId()),n);return this.Jr=i,this.W=t,this.P.add(this.Pe.recordTimeToFirstFrame(t)),this.P.add(this.Pe.recordRebuffering(t)),this.P.add(this.Pe.recordVideoResolutionChanges(this,t)),this.P.add(this.Pe.recordVideoPlayingAndPausing(t)),function(){var t=s.assign({bandwidthToStartAt:3e6},this.C);s.includes(this.Nr,".mpd")&&this.C.isDrmProtectedContent&&(t.drm={"com.widevine.alpha":{serverCertificateUrl:this.C.widevineServiceCertificateUrl,mediaKeySystemConfiguration:{persistentState:"required"}},"com.microsoft.playready":{licenseServerUrl:this.C.playreadyLicenseUrl}}),t=new this.xe.WebPlayer(this.Jr,this.W,t),s.now()-this.C.originStartTime<6e3&&this.C.isDrmProtectedContent&&s.includes(this.Nr,".m3u8")?setTimeout(s.bind(t.start,t,this.Nr),6e3):t.start(this.Nr),this.Vr=t,s.addEventListener(this.Vr,"error",s.bind(d,this))}.call(this),!1===this.C.receiveAudio&&(t.muted=!0),s.addEventListener(t,"stalled",this.Lr,!1),s.addEventListener(t,"pause",this.Lr,!1),s.addEventListener(t,"suspend",this.Lr,!1),s.addEventListener(t,"progress",this.Br,!1),s.addEventListener(t,"ended",this._r,!1),this.C.capabilities.includes("audio-only")||this.De.start(this,t),t},f.prototype.stop=function(t,e){var n=this;if(!n.zr){if(e)return n.Wr=!0;if(this.De.stop(),this.P.dispose(),this.Vr){e=function(){n.W&&(s.removeEventListener(n.W,"stalled",n.Lr,!1),s.removeEventListener(n.W,"pause",n.Lr,!1),s.removeEventListener(n.W,"suspend",n.Lr,!1),s.removeEventListener(n.W,"progress",n.Br,!1),s.removeEventListener(n.W,"ended",n._r,!1),"Edge"===i.browser&&(n.W.src="")),n.ne.fire(o.rendererEvents.ended.name,[""]),n.Vr=null,n.W=null},n.zr=!0;try{n.Vr.dispose(),n.X.info("[%s] Phenix stream has been destroyed",n.dt),e()}catch(t){n.X.error("[%s] Error while destroying Phenix stream player [%s]",n.dt,t.code,t),e(),n.ne.fire(o.rendererEvents.error.name,["phenix-player",t])}}}},f.prototype.getStats=function(){if(!this.Vr)return{width:0,height:0,currentTime:0,lag:0,networkState:o.networkStates.networkNoSource.id};var t=this.Vr.getStats(),e=t.currentTime||this.W.currentTime,n=(s.now()-this.C.originStartTime)/1e3;return t.isNative&&"Hls"===t.deliveryType&&(t.currentTime=n-t.lag),t.isNative||(t.lag=Math.max(0,n-e)),0<t.estimatedBandwidth?t.networkState=o.networkStates.networkLoading.id:0<t.playTime?t.networkState=o.networkStates.networkIdle.id:t.video?t.networkState=o.networkStates.networkEmpty.id:t.networkState=o.networkStates.networkNoSource.id,t},f.prototype.setDataQualityChangedCallback=function(t){e.h(t,"callback"),this.dataQualityChangedCallback=t},f.prototype.getPlayer=function(){return this.Vr},f.prototype.addVideoDisplayDimensionsChangedCallback=function(t,e){return this.De.addVideoDisplayDimensionsChangedCallback(t,e)},f}.apply(e,n))||(t.exports=n)},function(t,e,n){n=[n(0),n(1),n(10),n(4),n(9),n(2),n(3),n(11),n(6)];void 0===(n=function(c,s,t,a,e,u,h,f,i){"use strict";var r=6e3,o=15e3,n="rtmp-flash-renderer-2019.2.18.swf",d={local:"https://local.phenixrts.com/public/rtmp/"+n,staging:"https://stg.phenixrts.com/public/rtmp/"+n,production:"https://phenixrts.com/public/rtmp/"+n};function l(t,e,n,i,r){s.a(i,"options"),i.env&&s.g(i.env,"options.env");var o=d[i.env||"production"];this.X=r,this.dt=t,this.Hr=c.map(e,function(t){return t.uri=encodeURI(t.uri).replace(/[#]/g,"%23"),t}),this.Pe=n,this.C=i,this.nt=null,this.Kr=null,this.Qr=null,this.ne=new a.NamedEvents,this.De=new f(r),this.P=new u.DisposableList,this.Lr=c.bind(v,this),this._r=c.bind(g,this),this.wn=c.bind(p,this),this.F=i.swfSrc||o}function p(t){this.ne.fire(i.rendererEvents.error.name,["flash-player",t])}function m(){var t=!this.Gr||c.now()-this.Gr>o;return this.Qr&&!this.Wr&&this.Vr&&0!==this.Qr.buffered.length&&t}function v(t){var e=this;e.X.info("[%s] Loading flash player stalled caused by [%s] event.",e.dt,t.type);var n=e.Qr.currentTime;setTimeout(function(){e.Qr&&e.Qr.currentTime===n&&!e.Qr.paused&&m.call(e)&&(e.X.warn("Reloading stream after being stalled for [%s] seconds",r/1e3),function(){m.call(this)&&(this.X.warn("Reloading unhealthy stream that was active for at least [%s] seconds",o/1e3),this.Gr=c.now(),function(){this.Kr.destroy(),this.start(this.Xr)}.call(this))}.call(e))},r)}function g(){this.X.info("[%s] Flash player ended.",this.dt)}l.isSupported=function(){var t=[10,0,0],e="Shockwave Flash",n=[0,0,0];if(c.f(y))return y;if(c.get(h.global.navigator,["plugins",e])){var i=h.global.navigator.plugins[e].description;if(i&&c.get(h.global.navigator,["mimeTypes","application/x-shockwave-flash","enabledPlugin"],!1))for(var r=0,o=(n=i.replace(e,"").replace(/^\s+/,"").replace(/\sr/gi,".").split(".")).length;r<o;r++)n[r]=parseInt(n[r].match(/\d+/),10)}else if(h.global.ActiveXObject)try{var s,a,u=new h.global.ActiveXObject("ShockwaveFlash.ShockwaveFlash");u&&(s=u.GetVariable("$version")||"",a=c.get(s.split(" "),[1],n).split(","),n=[parseInt(a[0],10),parseInt(a[1],10),parseInt(a[2],10)])}catch(t){console.error(t)}return y=n[0]>t[0]||n[0]===t[0]&&0<n[1]||n[0]===t[0]&&0===n[1]&&0<=n[2]},l.prototype.on=function(t,e){return this.ne.listen(t,e)},l.prototype.start=function(t){var e={streamId:this.dt,swfSrc:this.F};return this.Xr=t,this.Kr=new h.PhenixFlashVideo(t,this.Hr,e),this.Kr.hookUpEvents(),this.Qr=this.Kr.getElement(),this.P.add(this.Pe.recordTimeToFirstFrame(this.Xr)),this.P.add(this.Pe.recordRebuffering(this.Xr)),this.P.add(this.Pe.recordVideoResolutionChanges(this,this.Xr)),this.P.add(this.Pe.recordVideoPlayingAndPausing(this.Xr)),this.Qr&&this.Qr.play(),c.addEventListener(this.Xr,"stalled",this.Lr,!1),c.addEventListener(this.Xr,"pause",this.Lr,!1),c.addEventListener(this.Xr,"suspend",this.Lr,!1),c.addEventListener(this.Xr,"ended",this._r,!1),c.addEventListener(this.Xr,"error",this.wn,!1),t},l.prototype.stop=function(t){var e=this;if(this.P.dispose(),this.Kr){var n=function(){e.Qr&&(c.removeEventListener(e.Xr,"stalled",e.Lr,!1),c.removeEventListener(e.Xr,"pause",e.Lr,!1),c.removeEventListener(e.Xr,"suspend",e.Lr,!1),c.removeEventListener(e.Xr,"ended",e._r,!1),c.removeEventListener(e.Xr,"error",e.wn,!1)),e.Qr=null,e.Xr=null,e.ne.fire(i.rendererEvents.ended.name,[t])};try{this.Kr.destroy(),this.Kr=null,n(),this.X.info("[%s] Flash player has been destroyed",this.dt)}catch(t){e.X.error("[%s] Error while destroying Flash player [%s]",e.dt,t.code,t),n(),e.ne.fire(i.rendererEvents.error.name,["flash-player",t])}}},l.prototype.getStats=function(){if(!this.Qr)return{width:0,height:0,currentTime:0,lag:0,networkState:i.networkStates.networkNoSource.id};var t={},e=this.Qr.currentTime,n=(c.now()-this.C.originStartTime)/1e3;return t.lag=Math.max(0,n-e),0<t.estimatedBandwidth?t.networkState=i.networkStates.networkLoading.id:0<t.playTime?t.networkState=i.networkStates.networkIdle.id:t.video?t.networkState=i.networkStates.networkEmpty.id:t.networkState=i.networkStates.networkNoSource.id,t},l.prototype.setDataQualityChangedCallback=function(t){s.h(t,"callback"),this.dataQualityChangedCallback=t},l.prototype.getPlayer=function(){return this.Vr},l.prototype.addVideoDisplayDimensionsChangedCallback=function(t,e){return this.De.addVideoDisplayDimensionsChangedCallback(t,e)};var y=null;return l}.apply(e,n))||(t.exports=n)},function(t,e,n){n=[n(0),n(1),n(4),n(3),n(2),n(13),n(22),n(33),n(36),n(101),n(14),n(6)];void 0===(n=function(s,a,u,c,h,f,i,n,r,o,d,l){"use strict";function p(t,e,n,i,r,o){this.dt=t,this.Zr=e,this.ge=n,this.Pe=i,this.C=r,this.X=o,this.qe=[],this.De=null,this.ne=new u.NamedEvents,this.$r=[],this.Yr=0,this.to=null,this.P=new h.DisposableList,this.jt=0,this.eo=s.get(r,["iceConnectionTimeout"],12e3),this.P.add(f.onForeground(s.bind(m,this))),(r=/(b=AS:([0-9]*)[\n\r]*)/gi.exec(n.remoteDescription))&&3<=r.length&&(this.Yr=1e3*r[2]),s.addEventListener(n,"iceconnectionstatechange",s.bind(v,this))}function m(){var t;this.to&&(t=this.to,this.to=null,t())}function v(){var t=this,e=this.ge.iceConnectionState;switch(e){case"checking":case"connecting":if(this.no)return;this.io=s.now(),this.no=setTimeout(function(){t.X.warn("[%s] Stream has not connected within [%s] ms",t.dt,t.eo),t.ne.fire(l.streamEvents.playerError.name,["real-time",new Error("connection-timeout")])},t.eo);break;case"failed":this.no&&(clearTimeout(this.no),this.no=null),this.X.info("[%s] Stream has failed",t.dt),this.ne.fire(l.streamEvents.playerError.name,["real-time",new Error("connection-failed")]);break;case"closed":case"disconnected":this.no&&t.X.warn("[%s] Stream closed before it was connected",t.dt);break;case"connected":this.no&&(clearTimeout(this.no),this.no=null),this.jt++,this.X.info("[%s] Ice Connection completed after [%s] ms for [%s] time",this.dt,s.now()-this.io,this.jt),this.io=null;break;default:this.X.info("[%s] Unsupported Ice Connection state [%s]",this.dt,e)}}return p.prototype.on=function(t,e){this.ne.listen(t,e)},p.prototype.createRenderer=function(){var n=this,t=s.get(this.ge,["remoteDescription","sdp"]),e=Object.assign({},this.C);(!t||this.C.capabilities.includes("audio-only"))&&this.C.capabilities.includes("video-only")||(t.includes("m=audio")||e.capabilities.push("video-only"),t.includes("m=video")||e.capabilities.push("audio-only"),t.split("m=").forEach(function(t){t.startsWith("audio")&&t.includes("a=inactive")&&e.capabilities.push("video-only"),t.startsWith("video")&&t.includes("a=inactive")&&e.capabilities.push("audio-only")}));var i=new o(this.dt,this.Zr,this.Pe,e,this.X);return i.on(l.rendererEvents.error.name,function(t,e){n.ne.fire(l.streamEvents.playerError.name,[t,e])}),i.on(l.rendererEvents.ended.name,function(t){n.qe=s.filter(n.qe,function(t){return t!==i}),0===n.qe.length&&(n.Pe.stop(),n.ne.fire(l.streamEvents.playerEnded.name,[t]))}),this.qe.push(i),i},p.prototype.select=function(t){a.h(t,"trackSelectCallback"),a.h(c.global.MediaStream,"rtc.global.MediaStream");for(var e=this.Zr.getTracks(),n=new c.global.MediaStream,i=0;i<e.length;i++)t(e[i],i)&&n.addTrack(e[i]);if(0===n.getTracks().length)return this.X.warn("No tracks selected");var r=this,o=new p(this.dt,n,this.ge,this.Pe,this.C,this.X);return o.on(l.streamEvents.stopped.name,function(t){var e=r.Zr;s.reduce(e.getTracks(),function(t,e){return t&&(a.a(e,"track"),"ended"===e.readyState)},!0)&&r.ne.fire(l.streamEvents.stopped.name,[t])}),this.$r.push(o),o},p.prototype.setStreamEndedCallback=function(t){a.h(t,"callback"),this.ro=t},p.prototype.setStreamErrorCallback=function(t){a.h(t,"callback"),this.oo=t},p.prototype.streamEndedCallback=function(t,e,n){s.forEach(this.$r,function(t){t.streamEndedCallback(e,n)}),s.h(this.ro)&&this.ro(this,e,n)},p.prototype.streamErrorCallback=function(t,e,n){s.forEach(this.$r,function(t){t.streamErrorCallback(e,n)}),s.h(this.oo)&&this.oo(t,e,n)},p.prototype.stop=function(t){var e;this.isActive()&&(this.P.dispose(),(e=this.Zr)&&s.h(e.stop,"stream.stop")&&e.stop(),s.forEach(e&&e.getTracks?e.getTracks():[],function(t){t.stop()}),this.X.info("[%s] stop [real-time] media stream with reason [%s]",this.dt,t),this.ne.fire(l.streamEvents.stopped.name,[t]),this.Ae=!0)},p.prototype.monitor=function(t,i){a.a(t,"options"),a.h(i,"callback");var r=this,e=new n(r.dt,r.ge,r.X);return t.direction="inbound",e.start(t,function(){return r.isActive()},function t(e,n){return e&&r.X.warn("[%s] Media stream monitor triggered unrecoverable error [%s]",r.dt,e),d.isIOS()&&!f.isForeground()?(r.X.info("[%s] Media stream monitor triggered event while app is in the background. Waiting until foreground to trigger event.",r.dt),r.to=t.bind(null,e,n)):(r.X.warn("[%s] Media stream triggered monitor condition for [%s] [%s]",r.dt,n.type,n.reasons),i(r,"client-side-failure",n))}),this.Ue=e},p.prototype.getMonitor=function(){return this.Ue},p.prototype.addBitRateThreshold=function(t,e){var n=this;return new r("Media Stream",this.Ue,function(){return n.Yr}).addThreshold(t,e)},p.prototype.getStream=function(){return this.Zr},p.prototype.isActive=function(){return!this.Ae},p.prototype.getStreamId=function(){return this.dt},p.prototype.getStats=function(e){a.h(e,"callback"),this.Yt||(this.Yt={});var n=this;return c.getStats(this.ge,null,function(t){e(i.convertPeerConnectionStats(t,n.Yt))})},p.prototype.getRenderer=function(){return s.get(this.qe,[0],null)},p.prototype.toString=function(){return"PhenixRealTimeStream["+this.dt+"]"},p}.apply(e,n))||(t.exports=n)},function(t,e,n){n=[n(0),n(1),n(4),n(9),n(2),n(3),n(13),n(17),n(8),n(11),n(6),n(14)];void 0===(n=function(o,e,s,t,a,r,u,c,h,f,d,i){"use strict";var l=1e3,p=200;function n(t,e,n,i,r){this.X=r,this.dt=t,this.Zr=e,this.Pe=n,this.C=i,this.nt=null,this.W=null,this.De=new f(r),this.ne=new s.NamedEvents,this.P=new a.DisposableList,this.Pi=new c(o.get(h,["navigator","userAgent"],"")).detect(),this.so=!1,this.ao=0,this.uo=0,this.P.add(u.onBackground(o.bind(g,this))),this.P.add(u.onForeground(o.bind(y,this))),this.co=o.bind(m,this),this._r=o.bind(v,this)}function m(t){var e=o.now()-this.ao<l;"pause"===t.type&&e&&(this.so=!0),this.uo=o.now(),this.X.info("[%s] Loading Phenix Real-Time stream player stalling caused by [%s] event.",this.dt,t.type)}function v(){this.X.info("[%s] Phenix Real-Time stream ended.",this.dt)}function g(){var t,e;this.W&&(t=!1,e=o.now()-this.uo<l,o.f(this.W.playing)?t=this.W.playing:o.f(this.W.paused)&&(t=!this.W.paused),this.so=t=!t&&e||t,this.ao=o.now())}function y(){var e,t,n;this.W&&((e=this).ao=0,this.uo=0,this.so?(this.X.info("[%s] Resume playing after entering foreground [%s]",this.dt,this.Pi.browser),"Safari"===this.Pi.browser&&i.isIOS()&&(t=function(){e.X.info("Renderer was paused after entering foreground"),e.ne.fire(d.rendererEvents.failedToPlay.name,["paused-by-background"])},o.addEventListener(e.W,"pause",t),n=setTimeout(function(){o.removeEventListener(e.W,"pause",t)},l),this.P.add(new a.Disposable(function(){clearTimeout(n)})),setTimeout(function(){e.W.play().catch(function(t){e.X.info("[%s] Unable to resume playback after entering foreground",e.dt,t),e.W.src="",e.X.info("[%s] (Re)starting renderer",e.dt),e.start(e.W)})},p))):this.X.info("[%s] Entering foreground with paused renderer [%s]",this.dt,this.Pi.browser))}return n.prototype.on=function(t,e){if("userActionRequired"===t)throw new Error('"userActionRequired is no longer supported. See https://phenixrts.com/docs/web/#view-a-channel and https://phenixrts.com/docs/web/#channel-viewer');return this.ne.listen(t,e)},n.prototype.start=function(e){var n=this,i=!!o.find(this.Zr.getTracks(),function(t){return"audio"===t.kind});return this.C.canPlaybackAudio||(this.C.disableAudioIfNoOutputFound&&this.C.forcedAudioDisabled?this.X.warn("[%s] Missing audio playback device. Audio has been disabled on stream. Try setting up an audio device and re-subscribe in order to receive audio.",this.dt):!this.C.disableAudioIfNoOutputFound&&i&&this.X.warn("[%s] Missing audio playback device. May experience audio and/or video failure. Try setting up an audio device OR pass the [disableAudioIfNoOutputFound] option when subscribing to disable audio playback when no devices are attached.",this.dt)),this.W=r.attachMediaStream(e,this.Zr,function(t){return t?e.muted||!i?(n.X.warn("[%s] Failed to play muted stream.",n.dt,t),n.ne.fire(d.rendererEvents.failedToPlay.name,["failed-to-play"])):n.C.disableAutoMuting?(n.X.warn("[%s] Failed to play unmuted stream.",n.dt,t),n.ne.fire(d.rendererEvents.failedToPlay.name,["failed-to-play-unmuted"])):(n.X.debug("[%s] Failed to start playing stream. Auto muting the playback and trying again.",n.dt),e.muted=!0,void(n.W=r.attachMediaStream(e,n.Zr,function(t){return t?(n.X.warn("[%s] Failed to play even after auto muting.",n.dt,t),e.muted=!1,n.ne.fire(d.rendererEvents.failedToPlay.name,["failed-to-play"])):(n.X.info("[%s] Successfully started playing stream after auto muting. User may manually unmute with user triggered action.",n.dt),void n.ne.fire(d.rendererEvents.autoMuted.name,["retry-play-muted"]))}))):void n.X.debug("[%s] Successfully started playing stream.",n.dt)}),this.P.add(this.Pe.recordTimeToFirstFrame(e)),this.P.add(this.Pe.recordRebuffering(e)),this.P.add(this.Pe.recordVideoResolutionChanges(this,e)),this.P.add(this.Pe.recordVideoPlayingAndPausing(e)),!1===this.C.receiveAudio&&(e.muted=!0),o.addEventListener(e,"stalled",this.co,!1),o.addEventListener(e,"pause",this.co,!1),o.addEventListener(e,"suspend",this.co,!1),o.addEventListener(e,"ended",this._r,!1),this.C.capabilities.includes("audio-only")||this.De.start(this,e),e},n.prototype.stop=function(t){this.De.stop(),this.P.dispose(),this.W&&(o.removeEventListener(this.W,"stalled",this.co,!1),o.removeEventListener(this.W,"pause",this.co,!1),o.removeEventListener(this.W,"suspend",this.co,!1),o.removeEventListener(this.W,"ended",this._r,!1),o.h(this.W.pause)&&this.W.pause(),"Edge"===this.Pi.browser&&(this.W.src=""),this.W.src&&("IE"===this.Pi.browser?this.W.src=null:this.W.src=""),this.W.srcObject&&(this.W.srcObject=null),this.W=null),this.X.info("[%s] Phenix real-time renderer has been destroyed",this.dt),this.ne.fire(d.rendererEvents.ended.name,[t])},n.prototype.getStats=function(){if(!this.W)return{width:0,height:0,currentTime:0,lag:0,networkState:d.networkStates.networkNoSource.id};var t=(o.now()-this.C.originStartTime)/1e3,e=this.C.networkLag/1e3;return{width:this.W.videoWidth||this.W.width,height:this.W.videoHeight||this.W.height,currentTime:t,lag:e,networkState:this.W.networkState}},n.prototype.setDataQualityChangedCallback=function(t){e.h(t,"callback"),this.dataQualityChangedCallback=t},n.prototype.addVideoDisplayDimensionsChangedCallback=function(t,e){return this.De.addVideoDisplayDimensionsChangedCallback(t,e)},n}.apply(e,n))||(t.exports=n)},function(t,e,n){n=[n(0),n(1),n(5),n(39)];void 0===(n=function(n,t,r,c){"use strict";function e(t,e,n,i,r,o,s,a,u){this.init(t,e,n,i,r,o,s,a,u)}function o(){throw new Error("ImmutableRoom is Immutable")}function s(){throw new Error("Unable to subscribe to Immutable [ImmutableRoom]")}function h(t,e){n.isArray(t)?n.forEach(t,function(t){i(t,e)}):n.a(t)&&n.forOwn(t,function(t){n.includes(e,t)||i(t,e)})}function i(t,e){var n,i=e;((n=t)instanceof r.Observable||n instanceof r.ObservableArray)&&(n.setValue=o,n.subscribe=s,h(n.getValue(),i)),h(t,e)}return e.prototype.init=function(t,e,n,i,r,o,s,a,u){this.Hn=new c(t,e,n,i,r,o,s,a,u),h(this.Hn,[t])},e.prototype.getRoomId=function(){return this.Hn.getRoomId()},e.prototype.getObservableAlias=function(){return this.Hn.getObservableAlias()},e.prototype.getObservableName=function(){return this.Hn.getObservableName()},e.prototype.getObservableDescription=function(){return this.Hn.getObservableDescription()},e.prototype.getObservableType=function(){return this.Hn.getObservableType()},e.prototype.getObservableMembers=function(){return this.Hn.getObservableMembers()},e.prototype.getObservableBridgeId=function(){return this.Hn.getObservableBridgeId()},e.prototype.getObservablePin=function(){return this.Hn.getObservablePin()},e.prototype.toString=function(){return this.Hn.toString()},e.prototype.toJson=function(){return this.Hn.toJson()},e.prototype.commitChanges=o,e.prototype.reload=o,e.prototype.lt=o,e.prototype.Ve=o,e.prototype.We=o,e.prototype.ze=o,e}.apply(e,n))||(t.exports=n)},function(t,e,n){n=[n(0),n(1),n(5),n(2),n(104)];void 0===(n=function(o,e,n,i,r){"use strict";var s=100;function t(t){e.a(t,"roomService"),e.a(t.He,"roomService._pcast"),this.in=t,this.ho=new n.ObservableArray([]),this.fo=new n.Observable(null),this.P=new i.DisposableList,this.do=null,this.setPCast(t.He)}function a(t){t&&this.do===t.getRoomId()||(c.call(this),t&&u.call(this))}function u(){c.call(this),this.lo=function(t){var i=this.in.getObservableActiveRoom().getValue().getRoomId();this.do=i;var r=this;return this.ho.setValue([]),this.po.subscribeAndLoadMessages(i,t,function(t,e){if(t)throw t;if("ok"!==e.status)throw new Error("Unable to subscribe to room chat. Status ["+e.status+"]");var n=r.ho.getValue();o.forEach(e.chatMessages,function(t){for(var e=n.length;0<e&&t.messageId<o.get(n,[e-1,"messageId"]);)e--;0===e&&0<n.length?r.X.info("[%] Ignoring message [%s]/[%s] prior to current chat history to prevent gaps.",i,t.messageId,t.timestamp):0<e&&o.get(n,[e-1,"messageId"])===t.messageId?r.X.info("[%] Ignoring duplicate message [%s]/[%s]",i,t.messageId,t.timestamp):(n.splice(e,0,t),r.fo.setValue(t))}),n.length>s&&n.splice(0,n.length-s),r.ho.setValue(n)})}.call(this,this.mo)}function c(){this.lo&&this.lo.dispose&&this.lo.dispose()}return t.prototype.setPCast=function(t){e.a(t,"pcast"),e.h(t.getLogger,"pcast.getLogger"),this.He=t,this.X=t.getLogger(),this.po?this.po.setPCast(t):this.po=new r(t)},t.prototype.getBatchSize=function(){return this.mo},t.prototype.start=function(t){this.mo=t||0,this.po.start(),function(){var t=this.in.getObservableActiveRoom().subscribe(o.bind(a,this));this.P.add(t)}.call(this),u.call(this)},t.prototype.stop=function(){this.po.stop(),c.call(this),this.P&&this.P.dispose()},t.prototype.getObservableChatMessages=function(){return this.ho},t.prototype.getObservableLastChatMessage=function(){return this.fo},t.prototype.getObservableChatEnabled=function(){return this.po.getObservableChatEnabled()},t.prototype.canSendMessage=function(){return this.po.canSendMessage()},t.prototype.sendMessageToRoom=function(t,e){if(!(r=this.in.getObservableActiveRoom().getValue()))return e(new Error("Not in room"),null);var n=r.getRoomId();if(!(o=this.in.Ne.getValue()))return e(new Error("No record for oneself"),null);var i=o.getObservableScreenName().getValue(),r=o.getObservableRole().getValue(),o=o.getLastUpdate();this.po.sendMessageToRoom(n,i,r,o,t,e)},t.prototype.getMessages=function(t,e,n,i){var r=this.in.getObservableActiveRoom().getValue().getRoomId();return this.po.getMessages(r,t,e,n,i)},t.prototype.toString=function(){return"RoomChatService"},t}.apply(e,n))||(t.exports=n)},function(t,e,n){n=[n(0),n(1),n(5),n(2),n(38)];void 0===(n=function(e,a,n,r,i){"use strict";function t(t){a.a(t,"pcast"),a.h(t.getLogger,"pcast.getLogger"),a.h(t.getProtocol,"pcast.getProtocol"),this.He=t,this.X=t.getLogger(),this.Nt=t.getProtocol(),this.q=new n.Observable(!1),a.a(this.X,"this._logger"),a.a(this.Nt,"this._protocol"),this._e=new i(t)}function o(t){var e;a.a(t,"event"),a.g(t.roomId,"event.roomId"),a.g(t.eventType,"event.eventType"),a.isArray(t.chatMessages,"event.chatMessages"),"Message"===t.eventType?(this.X.debug("[%s] Room messages [%s]",t.roomId,t.chatMessages),e=this.vo[t.roomId],c(t.chatMessages),e&&e(null,{status:"ok",chatMessages:t.chatMessages})):this.X.warn("Unsupported room conversation event [%s]",t.eventType)}function s(t){}function u(){if(!this.q.getValue())throw new Error("ChatService not Enabled. Please start before performing actions.")}function c(t){e.forEach(t,function(t){(t=t).timestamp&&(t.timestamp=e.utc(t.timestamp)),t.from&&(t.from.lastUpdate=e.utc(t.from.lastUpdate))})}return t.prototype.setPCast=function(t){a.a(t,"pcast"),a.h(t.getLogger,"pcast.getLogger"),a.h(t.getProtocol,"pcast.getProtocol"),this.He=t,this.X=t.getLogger(),this.Nt=t.getProtocol(),this._e.setPCast(t)},t.prototype.start=function(){var t;this.q.getValue()||(this.P=new r.DisposableList,this.vo={},this.q.setValue(!0),function(){var t=this._e.getObservableStatus().subscribe(e.bind(s,this));this.P.add(t)}.call(this),t=this.Nt.onEvent("chat.RoomConversationEvent",e.bind(o,this)),this.P.add(t))},t.prototype.stop=function(){this.q.getValue()&&(this.q.setValue(!1),this.P&&this.P.dispose())},t.prototype.getObservableChatEnabled=function(){return this.q},t.prototype.canSendMessage=function(){return this._e.checkAuthorized()},t.prototype.sendMessageToRoom=function(t,e,n,i,r,o){!function(t,e,n,i,r,o){a.g(t,"roomId"),a.g(e,"screenName"),a.g(n,"role"),a.u(i,"lastUpdate"),a.g(r,"message"),a.h(o,"callback"),u.call(this),this._e.assertAuthorized(),r={messageId:"",timestamp:0,from:{sessionId:this._e.getPCastSessionId(),screenName:e,role:n,lastUpdate:i},message:r},this.X.info("Send message to room [%s] from [%s]",t,e);var s=this;return this.Nt.sendMessageToRoom(t,r,function(t,e){return t?(s.X.error("Send message to room failed with error [%s]",t),o(t,null)):(t={status:e.status},"ok"!==e.status&&s.X.warn("Send message to room failed with status [%s]",e.status),void o(null,t))})}.call(this,t,e,n,i,r,o)},t.prototype.subscribeAndLoadMessages=function(t,e,n){return n=function(t,e){var n=this;this.vo[t]=e;var i=new r.Disposable(function(){n.vo[t]===e&&delete n.vo[t]});return this.P.add(i),i}.call(this,t,n),function(i,t){a.g(i,"roomId"),a.u(t,"batchSize"),u.call(this),this._e.assertAuthorized();var e=this._e.getPCastSessionId();this.X.info("Subscribe to room [%s] conversation with batch size of [%s]",i,t);var r=this;this.Nt.subscribeToRoomConversation(e,i,t,function(t,e){var n=r.vo[i];return n?t?(r.X.error("Subscribe to room conversation failed with error [%s]",t),n(t,null)):(t={status:e.status},"ok"!==e.status?(delete r.vo[i],r.X.warn("Subscribe to room conversation failed with status [%s]",e.status),n(null,t)):(t.chatMessages=e.chatMessages,c(t.chatMessages),void n(null,t))):r.X.warn("No subscription callback set for room [%s]",i)})}.call(this,t,e),n},t.prototype.getMessages=function(t,e,n,i,r){!function(t,e,n,i,r){a.g(t,"roomId"),a.h(r,"callback"),i&&n||a.u(e,"batchSize"),i&&a.g(i,"beforeMessageId"),n&&a.g(n,"afterMessageId"),u.call(this),this._e.assertAuthorized();var o=this._e.getPCastSessionId();this.X.info("Get messages from room [%s] conversation with batch size of [%s], after [%s], and before [%s]",t,e,n,i);var s=this;this.Nt.getMessages(o,t,e,n,i,function(t,e){return t?(s.X.error("Get messages from room conversation failed with error [%s]",t),r(t,null)):(t={status:e.status},"ok"!==e.status?(s.X.warn("Get messages from room conversation failed with status [%s]",e.status),r(null,t)):(t.chatMessages=e.chatMessages,c(t.chatMessages),void r(null,t)))})}.call(this,t,e,n,i,r)},t.prototype.toString=function(){return"ChatService"},t}.apply(e,n))||(t.exports=n)},function(t,e,n){n=[n(0),n(1),n(19),n(21),n(32),n(106),n(108)];void 0===(n=function(n,i,r,o,s,a,u){"use strict";function t(t,e){i.isArray(t,"userMediaStreams"),this.st=(e=e||{}).uri||o.DefaultPCastUri,this.X=e.logger||r.createPCastLogger(this.st),this.me=e.audioContext||new s,this.go=this.me.getNativeAudioContext(),this.yo=null,this.wo=t,this.bo=!n.a(e.audioContext),this.ko=new a(this.X),n.forEach(this.wo,n.bind(c,this,e))}function c(t,e){i.a(e,"stream"),i.a(t,"options");var n=this.ko.getAudioVolumeMeter(e);n.init(this.go,t.alpha),n.connect(e)}function h(t,e){i.a(e,"stream"),i.a(t,"options");var n=this.ko.getAudioVolumeMeter(e),e=new u(this.X);t.alpha&&n.setAlpha(t.alpha),e.onValue(this.yo),e.startDetection(n,t)}return t.prototype.start=function(t,e){i.h(e,"callback"),this.yo=e,n.forEach(this.wo,n.bind(h,this,t=t||{}))},t.prototype.stop=function(){n.forEach(this.getAudioVolumeMeters(),function(t){t.onValue(function(){})}),this.yo=null},t.prototype.getAudioVolumeMeter=function(t){return i.a(t,"stream"),this.ko.getAudioVolumeMeter(t)},t.prototype.getAudioVolumeMeters=function(){return this.ko.getAudioVolumeMeters()},t.prototype.dispose=function(){this.bo&&this.go.close(),this.ko.stopAllMeters(),this.wo=null},t.prototype.toString=function(){return"AudioSpeakerDetector"},t}.apply(e,n))||(t.exports=n)},function(t,e,n){n=[n(0),n(1),n(107)];void 0===(n=function(t,e,n){"use strict";function i(t){e.a(t,"logger"),this.X=t,this.So={}}return i.prototype.stopAllMeters=function(){t.forOwn(this.So,function(t){t.stop()})},i.prototype.getAudioVolumeMeter=function(t){return e.a(t,"stream"),e.g(t.id,"streamId"),this.So[t.id]||(this.So[t.id]=new n(this.X)),this.So[t.id]},i.prototype.getAudioVolumeMeters=function(){return t.values(this.So)},i.prototype.toString=function(){return"AudioVolumeMeterFactory"},i}.apply(e,n))||(t.exports=n)},function(t,e,n){n=[n(0),n(1)];void 0===(n=function(o,n){"use strict";function t(t){n.a(t,"logger"),this.X=t}function i(t){for(var e=t.inputBuffer.getChannelData(0),n=0,i=0,r=0;r<e.length;r++)n+=e[r]*e[r],.99<Math.abs(e[r])&&i++;this.Eo=Math.sqrt(n/e.length),this.Ro=this.Io*this.Eo+(1-this.Io)*this.Ro,this.To=Math.max(this.Eo,this.Io*this.Eo+(1-this.Io)*this.To),this.Co=i,this.Mo&&this.Mo.call(this,{date:o.now(),value:this.Eo,smoothedValue:this.Ro,smoothedPeakValue:this.To,clipped:this.Co})}return t.prototype.init=function(t,e){n.a(t,"context"),n.h(t.createScriptProcessor,"context.createScriptProcessor"),e=parseFloat(e||1/16),n.u(e,"alpha"),this.Po=t,this.Io=e,this.Eo=0,this.Ro=0,this.To=0,this.Co=0,this.Oo=t.createScriptProcessor(4096,1,1),o.addEventListener(this.Oo,"audioprocess",o.bind(i,this))},t.prototype.onValue=function(t){this.Mo=t},t.prototype.getValue=function(){return this.Eo},t.prototype.getSmoothedValue=function(){return this.Ro},t.prototype.getSmoothedPeakValue=function(){return this.To},t.prototype.setAlpha=function(t){n.u(t,"alpha"),this.Io=parseFloat(t)},t.prototype.connect=function(t){return function(t){n.a(t,"stream"),0<t.getAudioTracks().length?(this.xo=this.Po.createMediaStreamSource(t),this.xo.connect(this.Oo),this.Oo.connect(this.Po.destination)):this.X.info("Stream has no audio tracks")}.call(this,t)},t.prototype.stop=function(){return function(){this.xo&&this.xo.disconnect(),this.Oo.disconnect()}.call(this)},t.prototype.toString=function(){return"AudioVolumeMeter"},t}.apply(e,n))||(t.exports=n)},function(t,e,n){n=[n(0),n(1)];void 0===(n=function(d,l){"use strict";function t(t){l.a(t,"logger"),this.X=t,this.init()}return t.prototype.init=function(){},t.prototype.onValue=function(t){this.Mo=t},t.prototype.startDetection=function(t,e){return function(o,t){l.a(o,"audioVolumeMeter");var s=this,a=(t=t||{}).speakingHysteresisInterval||50,u=t.silenceHysteresisInterval||1500;l.u(a,"options.speakingHysteresisInterval"),l.u(u,"options.silenceHysteresisInterval");var c=!1,h=d.now()+a,f=d.now()+u;o.onValue(function(t){l.a(o,"audioVolumeMeter"),l.u(t.date,"value.date"),l.u(t.value,"value.value"),l.u(t.smoothedValue,"value.smoothedValue"),l.u(t.smoothedPeakValue,"value.smoothedPeakValue"),l.u(t.clipped,"value.clipped");var e=.01<t.value&&t.value>2*t.smoothedValue&&t.value>.25*t.smoothedPeakValue,n=t.value>.8*t.smoothedValue,i=t.value<.5*t.smoothedValue,r=!e;(e||c&&n)&&h<t.date?(f=d.utc(t.date)+u,c||(c=!0,s.X.info("Speaking detected"),s.Mo&&s.Mo("speaking"))):(i||!c&&r)&&f<t.date&&(h=d.utc(t.date)+a,c&&(c=!1,s.X.info("Silence detected"),s.Mo&&s.Mo("silence")))})}.call(this,t,e)},t.prototype.toString=function(){return"AudioSpeakerDetection"},t}.apply(e,n))||(t.exports=n)},function(t,e,n){n=[n(0),n(1),n(19),n(21),n(110)];void 0===(n=function(n,i,r,o,s){"use strict";function t(t,e){i.isArray(t,"userMediaStreams"),this.st=(e=e||{}).uri||o.DefaultPCastUri,this.X=e.logger||r.createPCastLogger(this.st),this.qo=[],this.Wt=t}function a(t,e,n){(n=new s(n)).connect(t,e),this.qo.push(n)}return t.prototype.start=function(t,e){n.forEach(this.Wt,n.bind(a,this,t,e=e||{}))},t.prototype.stop=function(){n.forEach(this.qo,function(t){t.close()}),this.qo=[]},t.prototype.toString=function(){return"BandwidthMonitor"},t}.apply(e,n))||(t.exports=n)},function(t,e,n){n=[n(0),n(1)];void 0===(n=function(n,i){"use strict";function t(t){this.init(t)}function r(t,e){if(this.Do&&this.Do.dispose(),!e)return this.Ao.limitBandwidth(t);e=e.getObservableMembers(),this.Do=e.subscribe(n.bind(o,this,t),{initial:"notify"})}function o(t,e){e.length!==this.Uo&&(this.Uo=e.length,t/=Math.max(1,this.Uo-1),this.Ao.limitBandwidth(t))}return t.prototype.init=function(t){i.a(t,"publisher"),this.Ao=t,this.Uo=0,this.jo=null,this.Do=null},t.prototype.connect=function(t,e){i.a(t,"roomService"),e=e||{},t=t.getObservableActiveRoom(),e=e.roomBandwidthLimit||5e6,this.jo=t.subscribe(n.bind(r,this,e),{initial:"notify"})},t.prototype.close=function(){this.jo&&this.jo.dispose(),this.Do&&this.Do.dispose(),this.jo=null,this.Do=null},t.prototype.toString=function(){return"PublisherBandwidthAdjuster"},t}.apply(e,n))||(t.exports=n)},function(t,e,n){n=[n(0),n(1)];void 0===(n=function(f,i){"use strict";var d=[{"9x16":[{3840:2160},{1920:1080},{1366:768},{1280:720},{1024:576},{854:480},{640:360},{320:180}]},{"3x4":[{1600:1200},{1440:1080},{960:720},{800:600},{768:576},{640:480},{480:360},{352:288},{320:240},{176:144},{160:120}]},{"16x9":[{2160:3840},{1080:1920},{768:1366},{720:1280},{576:1024},{480:854},{360:640},{180:320}]},{"4x3":[{1200:1600},{1080:1440},{720:960},{600:800},{576:768},{480:640},{360:480},{288:352},{240:320},{144:176},{120:160}]}],r={fallbackToLower:{id:0,name:"fallbackToLower"},fallbackToHigher:{id:1,name:"fallbackToHigher"},fallbackToLowerThenHigher:{id:2,name:"fallbackToLowerThenHigher"},exact:{id:3,name:"exact"}};function t(t){i.a(t,"options"),t.resolutionSelectionStrategy&&i.b(t.resolutionSelectionStrategy,r,"options.resolutionSelectionStrategy"),t.aspectRatio&&i.g(t.aspectRatio,"options.aspectRatio"),t.resolution&&i.u(t.resolution,"options.resolution"),t.frameRate&&i.u(t.frameRate,"options.frameRate"),this.No=t.resolutionSelectionStrategy||r.fallbackToLowerThenHigher.name,this.fn=t.aspectRatio||"16x9",this.Fo=parseInt(t.resolution,10)||720,this.Lo=function(t,e){switch(i.g(t,"aspectRatio"),i.u(e,"resolution"),t){case"16x9":case"4x3":return e;case"9x16":return n(16/9*e);case"3x4":return n(4/3*e);default:throw new Error("Aspect Ratio not supported")}}.call(this,this.fn,this.Fo),this.Bo=t.frameRate||15}function n(t){return i.u(t,"value"),2*Math.floor((t+1)/2)}function o(t,e){var n,i,r,o,s=l(e,d),a=p(e,d),u=p(t.toString(),s),c=0===u,e=d.length-1===a;if(u<0){if((u=h(t,s))<0)return null}else{if(c)return e?null:(i=l(n=m(++a,d),d),(u=h(this.Lo,i))<0?null:(r=m(u,s),o=this.calculateLongerDimensionByAspectRatio(r,n),{resolution:Math.min(r,o),aspectRatio:n,height:parseInt(r,10),width:parseInt(o,10)}));u--}return n=m(a,d),r=m(u,i=v(a,d)),o=i[u][r],{resolution:Math.min(r,o),aspectRatio:n,height:parseInt(r,10),width:o}}function s(t,e){var n,i,r,o,s,a=l(e,d),u=p(e,d),c=p(t.toString(),a),h=c===a.length-1,e=d.length-1===u;if(f.u(c)){if(h)return e?null:(n=m(++u,d),i=this.Lo,r=this.calculateLongerDimensionByAspectRatio(i,n),{resolution:Math.min(i,r),aspectRatio:n,height:parseInt(i,10),width:parseInt(r,10)});c++}else if(o=t,s=a,!(c=f.keys(s[s.length-1])[0]>o?null:f.reduce(s,function(t,e,n){if(!t)return n;var i=f.keys(s[t])[0],e=f.keys(e)[0];return!(o<e)&&Math.abs(o-e)<Math.abs(o-i)?n:t})))return;return n=m(u,d),i=m(c,u=v(u,d)),r=u[c][i],{resolution:Math.min(i,r),aspectRatio:n,height:parseInt(i,10),width:parseInt(r,10)}}function l(e,t){return(t=f.find(t,function(t){return Object.prototype.hasOwnProperty.call(t,e)}))?t[e]:null}function p(e,t){return f.findIndex(t,function(t){return Object.prototype.hasOwnProperty.call(t,e)})}function m(t,e){return f.keys(e[t])[0]}function v(t,e){var n=f.keys(e[t]);return e[t][n[0]]}function h(r,o){return f.keys(o[0])[0]<r?-1:f.reduce(o,function(t,e,n){if(!t)return n;var i=f.keys(o[t])[0];return!((e=f.keys(e)[0])<r)&&Math.abs(r-e)<Math.abs(r-i)?n:t})}return t.prototype.getDefaultResolution=function(){var t=this.calculateLongerDimensionByAspectRatio(this.Fo,this.fn);switch(this.fn){case"9x16":case"3x4":return{resolution:this.Fo,aspectRatio:this.fn,height:t,width:this.Fo};default:return{resolution:this.Fo,aspectRatio:this.fn,height:this.Fo,width:t}}},t.prototype.getDefaultFrameRate=function(){return this.Bo},t.prototype.getNextResolution=function(t,e){switch(i.u(t,"height"),i.g(e,"aspectRatio"),this.No){case r.fallbackToLower.name:return s.call(this,t,e);case r.fallbackToHigher.name:return o.call(this,t,e);case r.fallbackToLowerThenHigher.name:var n=null;return t>this.Lo?n=o.call(this,t,e):(n=s.call(this,t,e))&&n.height||(n=o.call(this,this.Fo,this.fn)),n;default:return void r.exact.name}},t.prototype.canResolveNextResolution=function(){return this.No!==r.exact.name},t.prototype.calculateLongerDimensionByAspectRatio=function(t,e){switch(e){case"16x9":case"9x16":return n(16/9*t);case"4x3":case"3x4":return n(4/3*t);default:throw new Error("Aspect Ratio not supported")}},t}.apply(e,n))||(t.exports=n)},function(t,e,n){void 0===(e=function(){"use strict";return{errorSeverity:{recoverable:{id:1,name:"RECOVERABLE"},critical:{id:2,name:"CRITICAL"}}}}.apply(e,[]))||(t.exports=e)},function(t,e,n){n=[n(0),n(1),n(5),n(2),n(45),n(114),n(47),n(46),n(23),n(16),n(15),n(24)];void 0===(n=function(y,i,t,e,n,r,o,s,a,w,b,u){"use strict";var c={reconnectOptions:{maxOfflineTime:864e5,maxReconnectFrequency:6e4}};function h(t){i.a(t,"options"),t.roomExpress&&i.a(t.roomExpress,"options.roomExpress"),this._o=y.assign(y.clone(c),t),this.Wo=t.roomExpress||new n(this._o),this.Vo=!t.roomExpress,this.X=this.Wo.getPCastExpress().getPCast().getLogger()}function k(t,e,n){n&&y.hasIndexOrKey(n,"roomService")&&(n.channelService=n.roomService?new r(n.roomService):null,delete n.roomService),n&&y.hasIndexOrKey(n,"room")&&(n.channel=n.room?new o(n.room):null,delete n.room),t(e,n)}return h.prototype.dispose=function(){this.In&&(this.In.dispose(),this.In=null),this.Vo&&this.Wo.dispose(),this.X.info("Disposed channel express instance")},h.prototype.getRoomExpress=function(){return this.Wo},h.prototype.getPCastExpress=function(){return this.Wo.getPCastExpress()},h.prototype.createChannel=function(t,e){i.a(t,"options"),i.a(t.channel,"options.channel"),(t=y.assign({room:t.channel},t)).room.type=w.types.channel.name,delete t.channel,this.Wo.createRoom(t,y.bind(k,null,e))},h.prototype.joinChannel=function(u,o,c){i.a(u,"options"),i.h(o,"joinChannelCallback"),i.h(c,"subscriberCallback"),u.videoElement&&i.a(u.videoElement,"options.videoElement"),u.streamSelectionStrategy&&i.g(u.streamSelectionStrategy,"options.streamSelectionStrategy");var h,f,d,t=y.assign({type:w.types.channel.name,role:b.roles.audience.name},u),e=y.get(u,["failureCountForBanningAMember"]),n=y.get(u,["banMemberOnCapacityFailureCount"]),l=new s(u.streamSelectionStrategy,this.X,{failureCountForBanningAMember:e,banMemberOnCapacityFailureCount:n}),r=[],p="",m=this,v=null;t.channelId&&(t.roomId=t.channelId),delete t.channelId;function g(){null!==v&&(m.X.info("[%s] Clearing member selection backoff interval",p),clearTimeout(v),v=null);for(var t=0;t<r.length;t++)r[t].dispose();r=[]}m.Wo.joinRoom(t,function(t,e){var n,i,r=!e||y.assign({},e);m.In&&(m.In.dispose(),m.In=null),e&&e.roomService&&(n=e.roomService.leaveRoom,i=e.roomService.getObservableActiveRoom().getValue(),d=e.roomService,p=i?i.getRoomId():"",m.X.info("Joined channel [%s] with [%s] selection strategy",p,l.getStrategy()),r.roomService.leaveRoom=function(t){h&&h.stop("leave-channel"),g(),n(t)}),k(o,t,r)},function i(s,a){g(),m.X.info("[%s] Members changed with status [%s]. Channel has [%s] active members.",p,a,s.length);for(var t=function(){var t=y.filter(s,function(t){return t.getObservableRole().getValue()===b.roles.presenter.name&&0<t.getObservableStreams().getValue().length}),e=(n=l.getNext(t))?n.getObservableStreams().getValue()[0]:null,n=e?e.getPCastStreamId():"";if(!e)return 0===t.length?(l.reset(),c(f=h=null,{status:"no-stream-playing"})):a?(m.X.info("Unable to find a new presenter to replace stream [%s] that ended in channel [%s] with status [%s] and [%s] black-listed members",f,p,a,l.getNumberOfMembersWithFailures()),f&&h&&h.isActive()&&h.stop("presenter-failure"),c(null,{status:a||"unable-to-recover"})):c(null,{status:"no-stream-playing"});if(!n)return m.X.info("Channel [%s] presenter has no stream",p),c(null,{status:"no-stream-playing"});if(f&&h)if(n===f){if(!a)return;m.X.info("[%s] Stream [%s] ended with status [%s], retrying",p,f,a),h.stop("same-presenter-failure")}else m.X.info("[%s] Stream [%s] ended with status [%s], failing over to stream [%s]",p,f,a,n),h.stop("change-presenter");function r(e){return null!==v&&(m.X.warn("[%s] Clearing backoff interval after triggering of another unexpected failure [%s]",p,e),clearTimeout(v),v=null),v=setTimeout(function(){v=null;var t=d?d.getObservableActiveRoom().getValue():null;if(t)return t=t.getObservableMembers().getValue(),i(t,e)},"capacity"===e?5e3:100)}var t=y.assign({},{monitor:{callback:y.bind(function(t,e,n){if(f===t){if(e)return r("unable-to-subscribe");if("app-background"===n.reason)return c(e,n);if(n.retry&&"high-availability"!==l.getStrategy())return m.X.info("Retrying to subscribe to channel [%s] after stream [%s] failed with reason [%s]",p,t,n.status),n.retry();var i=y.get(n,["status"],"");if("ok"!==i){if("custom"===n.reason&&"client-side-failure"!==n.description)return c(e,n);switch(i){case"ended":case"origin-ended":case"origin-stream-ended":l.markDead();break;default:l.markFailed({failedDueToCapacity:"capacity"===i})}return m.X.info("[%s] Monitor subscriber reported status [%s]. Trying next member",t,i),r(i)}}else m.X.info("[%s] Ignore old channel subscriber monitor stream [%s]. Active stream is [%s]",p,t,f)},this,n),options:{conditionCountForNotificationThreshold:8}}},u),o=f?a?"recovered-from-failure":"stream-override":"stream-started";f=n,m.Wo.subscribeToMemberStream(e,t,y.bind(function(t,e,n){if(f===t){var i=y.get(n,["status"],"");if("ok"===i&&(n.reason=o),e||"ok"!==i){switch(m.X.info("[%s] Issue with stream [%s]. Trying next member",t,i,e),i){case"unauthorized":case"not-found":case"ended":case"origin-not-found":case"origin-ended":case"origin-stream-ended":case"unsupported-features":l.markDead();break;default:l.markFailed({failedDueToCapacity:"capacity"===i})}return r(i)}h=n&&n.mediaStream?n.mediaStream:f=null,c(e,n)}else m.X.info("[%s] Ignore old media stream callback for stream [%s]. Active stream is [%s]",p,t,f)},this,n))},e=0;e<s.length;e++)r.push(s[e].getObservableScreenName().subscribe(t)),r.push(s[e].getObservableRole().subscribe(t)),r.push(s[e].getObservableStreams().subscribe(t));t()})},h.prototype.publishToChannel=function(t,e){return i.a(t,"options"),i.h(e,"callback"),t.publishToken&&t.capabilities?(this.X.warn("[%s] Trying to publish with both `publishToken` and `capabilities` set. Only use one of the two options"),void e(new Error("Publishing with both `publishToken` and `capabilities` defined"),{status:"conflicting-options"})):t.streamToken&&t.capabilities?(this.X.warn("[%s] Trying to publish with both `streamToken` and `capabilities` set. Only use one of the two options"),void e(new Error("Publishing with both `streamToken` and `capabilities` defined"),{status:"conflicting-options"})):((t=y.assign({memberRole:b.roles.presenter.name,streamType:u.types.presentation.name,room:t.channel},t)).room.type=w.types.channel.name,delete t.channel,void this.Wo.publishToRoom(t,y.bind(k,null,e)))},h.prototype.publishScreenToChannel=function(t,e){i.a(t,"options"),i.h(e,"callback"),(t=y.assign({memberRole:b.roles.presenter.name,streamType:u.types.presentation.name,room:t.channel},t)).room.type=w.types.channel.name,delete t.channel,this.Wo.publishScreenToRoom(t,y.bind(k,null,e))},h}.apply(e,n))||(t.exports=n)},function(t,e,n){n=[n(0),n(1),n(47)];void 0===(n=function(i,r,o){"use strict";function t(t){r.a(t,"roomService"),this.in=t}function s(t,e,n){return n&&n.room&&(n.channel=new o(n.room),delete n.room),t(e,n)}return t.prototype.start=function(){return this.in.start.apply(this.in,arguments)},t.prototype.getChannelInfo=function(t,e,n){return t?r.g(t,"channelId"):r.g(e,"alias"),r.h(n,"callback"),this.in.getRoomInfo(t,e,i.bind(s,null,n))},t.prototype.createChannel=function(t,e){return r.a(t,"channel"),r.g(t.name,"channel.name"),r.g(t.type,"channel.type"),r.e(t.description,"channel.description"),r.h(e,"callback"),this.in.createRoom(t,i.bind(s,null,e))},t.prototype.enterChannel=function(t,e,n){return t?r.g(t,"roomId"):r.g(e,"alias"),r.h(n,"callback"),this.in.enterRoom(t,e,i.bind(s,null,n))},t.prototype.leaveChannel=function(){return this.in.leaveRoom.apply(this.in,arguments)},t.prototype.getChatService=function(){return this.in.getChatService.apply(this.in,arguments)},t.prototype.getSelf=function(){return this.in.getSelf.apply(this.in,arguments)},t.prototype.getObservableActiveChannel=function(){return this.in.getObservableActiveRoom.apply(this.in,arguments)},t.prototype.updateSelf=function(){return this.in.updateSelf.apply(this.in,arguments)},t.prototype.updateMember=function(){return this.in.updateMember.apply(this.in,arguments)},t.prototype.updateChannel=function(){return this.in.updateRoom.apply(this.in,arguments)},t.prototype.revertChannelChanges=function(){return this.in.revertRoomChanges.apply(this.in,arguments)},t.prototype.revertMemberChanges=function(){return this.in.revertMemberChanges.apply(this.in,arguments)},t.prototype.isInChannel=function(){return this.in.isInRoom.apply(this.in,arguments)},t.prototype.toString=function(){return"ChannelService"},t.prototype.stop=function(){return this.in.stop.apply(this.in,arguments)},t}.apply(e,n))||(t.exports=n)}],i={},r.m=n,r.c=i,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=48);function r(t){if(i[t])return i[t].exports;var e=i[t]={i:t,l:!1,exports:{}};return n[t].call(e.exports,e,e.exports,r),e.l=!0,e.exports}var n,i});