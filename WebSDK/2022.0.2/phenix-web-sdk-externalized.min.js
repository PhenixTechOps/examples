/**
 * Copyright 2022 Phenix Real Time Solutions, Inc. All Rights Reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("phenix-web-lodash-light"),require("phenix-web-assert"),require("phenix-rtc"),require("phenix-web-disposable"),require("phenix-web-observable"),require("phenix-web-event"),require("phenix-web-http"),require("phenix-web-logging"),require("phenix-web-application-activity-detector"),require("phenix-web-proto"),require("phenix-web-detect-browser"),require("phenix-web-global"),require("phenix-web-closest-endpoint-resolver")):"function"==typeof define&&define.amd?define("phenix-web-sdk",["phenix-web-lodash-light","phenix-web-assert","phenix-rtc","phenix-web-disposable","phenix-web-observable","phenix-web-event","phenix-web-http","phenix-web-logging","phenix-web-application-activity-detector","phenix-web-proto","phenix-web-detect-browser","phenix-web-global","phenix-web-closest-endpoint-resolver"],e):"object"==typeof exports?exports["phenix-web-sdk"]=e(require("phenix-web-lodash-light"),require("phenix-web-assert"),require("phenix-rtc"),require("phenix-web-disposable"),require("phenix-web-observable"),require("phenix-web-event"),require("phenix-web-http"),require("phenix-web-logging"),require("phenix-web-application-activity-detector"),require("phenix-web-proto"),require("phenix-web-detect-browser"),require("phenix-web-global"),require("phenix-web-closest-endpoint-resolver")):t["phenix-web-sdk"]=e(t["phenix-web-lodash-light"],t["phenix-web-assert"],t["phenix-rtc"],t["phenix-web-disposable"],t["phenix-web-observable"],t["phenix-web-event"],t["phenix-web-http"],t["phenix-web-logging"],t["phenix-web-application-activity-detector"],t["phenix-web-proto"],t["phenix-web-detect-browser"],t["phenix-web-global"],t["phenix-web-closest-endpoint-resolver"])}(window,function(i,n,r,s,o,a,u,c,h,l,d,f,m){return g=[function(t,e){t.exports=i},function(t,e){t.exports=n},function(t,e){t.exports=r},function(t,e){t.exports=s},function(t,e){t.exports=o},function(t,e){t.exports=a},function(t,e,i){void 0===(e=function(){"use strict";return{networkStates:{networkEmpty:{id:0,name:"NETWORK_EMPTY"},networkIdle:{id:1,name:"NETWORK_IDLE"},networkLoading:{id:2,name:"NETWORK_LOADING"},networkNoSource:{id:3,name:"NETWORK_NO_SOURCE"}},types:{realTime:{id:0,name:"real-time"},dash:{id:1,name:"dash"},hls:{id:2,name:"hls"},rtmp:{id:0,name:"rtmp"}},streamEvents:{playerEnded:{id:0,name:"playerended"},playerError:{id:1,name:"playererror"},stopped:{id:2,name:"stopped"}},rendererEvents:{ended:{id:0,name:"ended"},error:{id:1,name:"error"},autoMuted:{id:2,name:"autoMuted"},failedToPlay:{id:3,name:"failedToPlay"}}}}.apply(e,[]))||(t.exports=e)},function(t,e){t.exports=u},function(t,e){t.exports=c},function(t,e,i){i=[i(0),i(1),i(5)];void 0===(i=function(i,n,r){"use strict";function t(t,e){n.e(t,"logger"),this.a=t,this.u=new r.Event,this.h=null,this.f=!1,this.g=null,this.v={pollFrequency:500,previousWidth:0,previousHeight:0},e&&e.pollFrequency&&(this.v.pollFrequency=15<=e.pollFrequency?e.pollFrequency:15),this.y=null}function s(){var t;this.f&&!this.h&&0!==this.u.size()&&((t=this).v.previousWidth=this.g.videoWidth,this.v.previousHeight=this.g.videoHeight,this.h=setInterval(function(){t.g.videoWidth===t.v.previousWidth&&t.g.videoHeight===t.v.previousHeight||(t.v.previousWidth=t.g.videoWidth,t.v.previousHeight=t.g.videoHeight,t.u.fireAsync([t.y,{width:t.g.videoWidth,height:t.g.videoHeight}]))},t.v.pollFrequency))}return t.prototype.start=function(t,e){!function(t,e){e&&!i.isUndefined(e.videoWidth)||this.a.warn("Attempting to start dimensions changed monitor without providing proper 'video' element."),this.y=t,this.g=e,this.f=!0,s.call(this)}.call(this,t,e)},t.prototype.stop=function(){!function(){this.f=!1,this.h&&(clearInterval(this.h),this.h=null),this.u.dispose()}.call(this)},t.prototype.addVideoDisplayDimensionsChangedCallback=function(t){return n.b(t,"addVideoDisplayDimensionsChangedCallback"),s.call(this),this.u.listen(t)},t.prototype.toString=function(){return"DimensionsChangedMonitor[pollFrequency="+this.v.pollFrequency+", previousHeight="+this.v.previousHeight+", previousWidth="+this.v.previousHeight+", state="+(this.h?"running":"stopped")+"]"},t}.apply(e,i))||(t.exports=i)},function(t,e,i){i=[i(0),i(22)];void 0===(i=function(n,t){"use strict";var e={},r=new t(navigator.userAgent).detect();function s(t){var e=t.match(/^(https?\:)\/\/(([^:\/?#]*)(?:\:([0-9]+))?)([\/]{0,1}[^?#]*)(\?[^#]*|)(#.*|)$/);return e&&{href:t,protocol:e[1],host:e[2],hostname:e[3],port:e[4],pathname:e[5],search:e[6],hash:e[7],origin:e[1]+"//"+e[2]}}return e.getEnvironmentFromUrl=function(t){try{var e=URL&&"IE"!==r.browser?new URL(t):s(t);return e.port?e.protocol+"//"+e.hostname+":"+e.port:e.protocol+"//"+e.hostname}catch(t){return""}},e.parseEnvFromPcastBaseUri=function(t){return t=t.toLowerCase(),n.includes(t,"local")?"local":n.includes(t,"stg")?"staging":"production"},e.getTelemetryServerUri=function(e){if(!e)return"";try{var t=URL&&"IE"!==r.browser?new URL(e):s(e),i=t.hostname.split(".");switch(2===i.length||3===i.length&&i[i.length-2].length<=2&&i[i.length-1].length<=3?i.unshift("telemetry"):n.startsWith(i[0],"stg-")||n.endsWith(i[0],"-stg")||n.includes(i[0],"-stg-")||"stg"===i[0]?i[0]="telemetry-stg":n.startsWith(i[0],"local")||n.endsWith(i[0],"local")||(i[0]="telemetry"),t.hostname=i.join("."),t.protocol){case"ws:":t.protocol="http:";break;case"wss:":t.protocol="https:"}return t.port?t.protocol+"//"+t.hostname+":"+t.port+"/telemetry":t.protocol+"//"+t.hostname+"/telemetry"}catch(t){return e}},e}.apply(e,i))||(t.exports=i)},function(t,e){t.exports=h},function(t,e,i){i=[i(0),i(1),i(2),i(29),i(27),i(6)];void 0===(i=function(s,i,e,n,r,o){"use strict";var a=[o.types.realTime.name,o.types.dash.name,o.types.hls.name];function u(t){i.isArray(t=t||a,"features"),s.forEach(t,function(t,e){i.w(t,o.types,"FeatureType["+e+"]")}),this.k=s.map(t,s.bind(s.getEnumName,s,o.types))}function c(){var t=s.get(n,["navigator","userAgent"],"");return/iPad|iPhone|iPod/.test(t)&&!n.MSStream}function t(){var t=s.get(n,["navigator","userAgent"],"");return/SamsungBrowser/.test(t)}function h(t,e){return s.includes(t,e)||t.push(e),t}return u.isFeatureSupported=function(t){switch(t&&i.S(t,"feature"),s.getEnumName(o.types,t)){case o.types.realTime.name:return e.webrtcSupported;case o.types.dash.name:case o.types.hls.name:case o.types.rtmp.name:return r.canPlaybackType(t);default:return!1}},u.mapFeatureToPCastCapability=function(t){switch(t&&i.S(t,"feature"),s.getEnumName(o.types,t)){case o.types.realTime.name:return"real-time";case o.types.dash.name:case o.types.hls.name:return"streaming";case o.types.rtmp.name:return"rtmp";default:return""}},u.mapPCastCapabilitiesToFeatures=function(t){return i.isArray(t,"capabilities"),s.reduce(t,function(t,e){return t.concat(u.mapPCastCapabilityToFeatures(e))},[])},u.mapPCastCapabilityToFeatures=function(t){return t&&i.S(t,"capability"),"real-time"===t?[o.types.realTime.name]:"streaming"===t?[o.types.dash.name,o.types.dash.name]:"rtmp"===t?[o.types.rtmp.name]:[]},u.prototype.getFeatures=function(){return this.k},u.prototype.getFeaturePCastCapabilities=function(){var t=s.map(this.k,u.mapFeatureToPCastCapability);return s.reduce(t,h,[])},u.prototype.getPreferredFeatureFromPublisherCapabilities=function(n,r){i.isArray(n,"capabilities");var t=s.reduce(this.k,function(t,e){var i=u.mapFeatureToPCastCapability(e),i=u.isFeatureSupported(e)&&(s.includes(n,i)||"real-time"===e&&!r);return t||(i?e:null)},null);return t===o.types.dash.name&&u.shouldUseNativeHls&&s.includes(n,u.mapFeatureToPCastCapability(o.types.hls.name))&&s.includes(this.k,o.types.hls.name)?t=o.types.hls.name:t===o.types.hls.name&&!u.shouldUseNativeHls&&s.includes(n,u.mapFeatureToPCastCapability(o.types.dash.name))&&s.includes(this.k,o.types.dash.name)&&(t=o.types.dash.name),t},u.shouldUseNativeHls=c()||"Safari"===e.browser||t(),u.isIOS=c,u.isSamsungBrowser=t,u.isAndroid=function(){var t=s.get(n,["navigator","userAgent"],"");return/(android)/i.test(t)},u.isMobile=function(){var t=s.get(n,["navigator","userAgent"],"");return c()||/Android|webOS|BlackBerry|IEMobile|Opera Mini|Mobile|mobile|CriOS/i.test(t)},u.getIOSVersion=function(){var t=s.get(n,["navigator","userAgent"],"");if(/iP(hone|od|ad)/.test(t))return t=t.match(/.*OS (\d+)_(\d+)_?(\d+)? like Mac OS X/),{major:parseInt(s.get(t,[1],0),10),minor:parseInt(s.get(t,[2],0),10),patch:parseInt(s.get(t,[3],0),10)}},u}.apply(e,i))||(t.exports=i)},function(t,e,i){void 0===(e=function(){"use strict";return{roles:{participant:{id:0,name:"Participant"},moderator:{id:1,name:"Moderator"},presenter:{id:2,name:"Presenter"},audience:{id:3,name:"Audience"}},states:{active:{id:0,name:"Active"},passive:{id:1,name:"Passive"},handRaised:{id:2,name:"HandRaised"},inactive:{id:3,name:"Inactive"},offline:{id:4,name:"Offline"}}}}.apply(e,[]))||(t.exports=e)},function(t,e,i){void 0===(e=function(){"use strict";return{types:{directChat:{id:0,name:"DirectChat"},multiPartyChat:{id:1,name:"MultiPartyChat"},moderatedChat:{id:2,name:"ModeratedChat"},townHall:{id:3,name:"TownHall"},channel:{id:4,name:"Channel"}},events:{memberJoined:{id:0,name:"MemberJoined"},memberLeft:{id:1,name:"MemberLeft"},memberUpdated:{id:2,name:"MemberUpdated"},roomUpdated:{id:3,name:"RoomUpdated"},roomEnded:{id:4,name:"RoomEnded"}}}}.apply(e,[]))||(t.exports=e)},function(t,e,i){i=[i(0),i(1),i(8),i(10),i(42)];void 0===(i=function(t,s,o,a,u){"use strict";function e(){}return e.prototype.createPCastLogger=function(t,e,i){t&&s.S(t,"baseUri");var n=new o.Logger,r=a.getEnvironmentFromUrl(t),t=u.getAppender(t);return n.setEnvironment(r),i?t.setThreshold(i):t.setThreshold(o.level.INFO),e||n.addAppender(new o.ConsoleAppender),n.addAppender(t),n.isPCastLogger=!0,n},new e}.apply(e,i))||(t.exports=i)},function(t,e){t.exports=l},function(t,e,i){i=[i(1),i(0),i(3),i(47)];void 0===(i=function(r,a,s,u){"use strict";function t(t,e,i,n){r.S(t,"version"),r.S(e,"baseUri"),r.e(i,"logger"),this.I=t,this.R=e,this.a=i,this.T=new s.DisposableList,this.q=n}function c(t,e){var i;4===t.readyState&&(200===t.status?(i=(i=t).getAllResponseHeaders(),i=a.reduce(i.trim().split(/[\r\n]+/),function(t,e){var e=(i=e.split(": ")).shift(),i=i.join(": ");return e&&(t[e]=i),t},{}),e(null,{data:t.response||t.responseText,headers:i,rawXhr:t})):((i=new Error(0===t.status?"timeout":"Status=["+t.status+"]")).code=t.status,e(i)))}return t.DefaultPCastUri="https://pcast.phenixrts.com",t.prototype.getBaseUri=function(){return this.R},t.prototype.resolveUri=function(t){return function(t,i){var n,e=0===t.lastIndexOf("wss:",0),r=0===t.lastIndexOf("ws:",0),s=0===t.lastIndexOf("https:",0),o=0===t.lastIndexOf("http:",0);e||r?i(void 0,{uri:t+"/ws",roundTripTime:0}):s||o?function(t,i){(t=function(t){var e=new XMLHttpRequest;if("withCredentials"in e)e.open("GET",t,!0);else{if("undefined"==typeof XDomainRequest)return;(e=new XDomainRequest).open("GET",t)}return e}(t+"/pcast/endPoints?version=2022-04-13T15:08:08Z&_="+a.now())).addEventListener("readystatechange",a.bind(c,this,t,function(t,e){return t?i(new Error("Failed to resolve an end point",t)):((e=e.data.split(",")).length<1&&i(new Error("Failed to discover end points")),void i(void 0,e))})),t.timeout=15e3,t.send(null)}.call(n=this,t,function(t,e){return t?i(t):((t=new u({logger:n.a,version:n.I},i,function(t,e){t?503===t.code?n.a.debug("The end point [%s] is temporarily disabled",a.get(e,["endPoint"])):n.a.warn("An error occurred in resolving an endpoint [%s]",a.get(e,["endPoint"]),t):(t=0===e.endPoint.lastIndexOf("https:",0),n.q.recordMetric("RoundTripTime",{uint64:e.time},null,{resource:e.endPoint,kind:t?"https":"http"}))})).resolveAll(e),void n.T.add(t))}):i(new Error("Uri not supported ["+t+"]"))}.call(this,this.R,t)},t.prototype.dispose=function(){this.T.dispose()},t.prototype.toString=function(){return"PCastEndPoint["+this.R+"]"},t}.apply(e,i))||(t.exports=i)},function(t,e,i){i=[i(0),i(2)];void 0===(i=function(c,i){"use strict";function t(){}function h(t,e,i,n,r){return c.C(t)?t:c.C(e)?e:c.C(i)?i:c.C(n)?n:r}function l(t,e,i,n,r){return c.x(t)?t:c.x(e)?e:c.x(i)?i:c.C(n)?n:r}function d(t,e){if(e=parseInt(t,e),!isNaN(e))return e}function f(t){if(t=parseFloat(t),!isNaN(t))return t}function m(t){return c.includes(t.id,"send")||c.includes(t.id,"outbound")||"outboundrtp"===t.type||"outbound-rtp"===t.type||"kOutboundRtp"===t.type}function p(t){return c.includes(t.id,"recv")||"inboundrtp"===t.type||"inbound-rtp"===t.type||"kInboundRtp"===t.type}return t.convertPeerConnectionStats=function(t,o){if(!t)return null;var a=[],t=function(e){var n={};switch(i.browser){case"Firefox":return c.forOwn(e,function(i,t){c.includes(t,"rtcp")&&c.forOwn(e,function(t,e){c.includes(e,"rtp")&&i.mediaType===t.mediaType&&(t.jitter=1e3*(i.jitter||t.jitter),t.roundTripTime=i.roundTripTime)})}),e;case"IE":return c.forOwn(e,function(t,e){c.startsWith(e,"ssrc")&&(n[t.id]=t)}),n;case"Edge":return e.forEach(function(t){n[t.id]=t,c.hasIndexOrKey(t,"jitter")&&(t.jitter*=1e3)}),c.forOwn(n,function(e){"track"===e.type&&c.hasIndexOrKey(e,"framesPerSecond")&&c.forOwn(n,function(t){"video"===t.mediaType&&(t.framesPerSecond=parseInt(e.framesPerSecond,10))})}),n;case"Safari":return e.forEach(function(t){n[t.id]=t}),c.forOwn(n,function(e){var t;c.hasIndexOrKey(e,"id")&&p(e)&&(t=parseInt(c.get(e.id.split("_"),[1]),10),e.ssrc=t||e.ssrc),c.hasIndexOrKey(e,"jitter")&&(e.jitter*=1e3),"candidate-pair"===e.type&&c.forOwn(n,function(t){"audio"!==t.mediaType&&"video"!==t.mediaType||(t.currentRoundTripTime=1e3*e.currentRoundTripTime)}),"track"===e.type&&c.forOwn(n,function(t){"audio"===t.mediaType&&p(t)?t.audioOutputLevel=1e5*e.audioLevel:"audio"===t.mediaType&&m(t)&&(t.audioInputLevel=1e5*e.audioLevel)})}),n;case"ReactNative":return(c.x(e)?JSON.parse(e):e).forEach(function(t){var i={id:t.id,type:t.type};t.values.forEach(function(e){c.keys(e).forEach(function(t){i[t]=e[t]})}),i.timestamp=t.timestamp,n[i.id]=i}),n;default:return e.result().forEach(function(e){var i={id:e.id,type:e.type};e.names().forEach(function(t){i[t]=e.stat(t)}),i.timestamp=e.timestamp.getTime(),n[i.id]=i}),n}}(t),u=!1;function e(t){var e,i,n,r,s;u=u||!0,c.hasIndexOrKey(t,"ssrc")&&t.ssrc&&!c.includes(t.id,"rtcp")&&(e=t.id||t.ssrc,c.hasIndexOrKey(o,e)||(o[e]={timestamp:c.now()}),i="?",r=parseFloat(t.timestamp)-o[e].timestamp,n=function(t,e,i){if(!c.isUndefined(e))return t?8*(t-(e||0))/i:0}(parseFloat(t.bytesSent),o[e].bytesSent,r),s=function(t,e,i){if(!c.isUndefined(e))return t?8*(t-(e||0))/i:0}(parseFloat(t.bytesReceived),o[e].bytesReceived,r),r=function(t,e,i){if(!c.isUndefined(e))return(t-e)/(i/1e3)}(h(d(t.framesEncoded),d(t.framesDecoded)),o[e].framesEncoded||o[e].framesDecoded,r),m(t)&&(i="upload"),p(t)&&(i="download"),s={uploadRate:n,downloadRate:s,mediaType:t.mediaType,ssrc:t.ssrc,direction:i,nativeReport:t,rtt:h(d(t.rtt),d(t.googRtt),d(t.roundTripTime),d(t.currentRoundTripTime)),bitrateMean:d(t.bitrateMean,10)||1e3*(m(t)?n:s),targetDelay:d(l(t.targetDelay,t.googTargetDelayMs),10),currentDelay:d(l(t.currentDelay,t.currentDelayMs,t.googCurrentDelayMs),10)},c.assign(o[e],t),"video"===t.mediaType&&(s=c.assign(s,{droppedFrames:d(t.droppedFrames,10)||0,framerateMean:h(t.framerateMean,t.framesPerSecond,r)||0,cpuLimitedResolution:l(t.cpuLimitedResolution,t.googCpuLimitedResolution),avgEncode:d(l(t.avgEncode,t.avgEncodeMs,t.googAvgEncodeMs),10)})),"audio"===t.mediaType&&(s=c.assign(s,{audioInputLevel:l(t.audioInputLevel,t.googAudioInputLevel),audioOutputLevel:l(t.audioOutputLevel,t.googAudioOutputLevel),jitter:d(l(t.jitter,t.jitterReceived,t.googJitterReceived),10),jitterBuffer:d(l(t.jitterBuffer,t.jitterBufferMs,t.googJitterBufferMs),10),totalSamplesDuration:f(t.totalSamplesDuration),totalAudioEnergy:f(t.totalAudioEnergy)})),a.push(s))}return c.forOwn(t,e),!u&&a.length<=0&&t.forEach&&t.forEach(e),a},t}.apply(e,i))||(t.exports=i)},function(t,e,i){i=[i(0),i(1),i(4),i(20),i(34)];void 0===(i=function(n,r,s,t,e){"use strict";var i=t.types,o=e.states,a="pcast://phenixp2p.com/";function u(t,e,i,n){this.init(t,e,i,n)}function c(t){return n.includes(t,a)?a:"pcast://phenixrts.com/"}function h(t){var i={};return 2!==(t=t.split("?")).length||(t=t[1].split("&"),n.forEach(t,function(t){var t=(e=t.split("="))[0],e=decodeURIComponent(e[1]);i[t]=e,"capabilities"===t&&(i[t]=e&&e.split(",")||[])})),i}function l(t){return r.w(t,i,"streamType"),n.getEnumName(i,t)}function d(t){return r.w(t,o,"trackState"),n.getEnumName(o,t)}return u.prototype.init=function(t,e,i,n){r.x(t,"uri"),this.M=new s.Observable(t),this.P=new s.Observable(e,l),this.D=new s.Observable(i||o.trackEnabled.name,d),this.U=new s.Observable(n||o.trackEnabled.name,d),this.A=u.parsePCastStreamIdFromStreamUri(t)},u.prototype.getUri=function(){return this.M.getValue()},u.prototype.getType=function(){return this.P.getValue()},u.prototype.getObservableAudioState=function(){return this.D},u.prototype.getObservableVideoState=function(){return this.U},u.prototype.toJson=function(){return{uri:this.M.getValue(),type:this.P.getValue(),audioState:this.D.getValue(),videoState:this.U.getValue()}},u.prototype.O=function(t){var e,i;n.e(t)&&(Object.prototype.hasOwnProperty.call(t,"uri")&&t.uri!==this.M.getValue()&&(e=t.uri,i=this.M.getValue(),u.parsePCastStreamIdFromStreamUri(e)===u.parsePCastStreamIdFromStreamUri(i))&&(this.M.setValue(t.uri),this.A=u.parsePCastStreamIdFromStreamUri(t.uri)),Object.prototype.hasOwnProperty.call(t,"audioState")&&this.D.setValue(t.audioState),Object.prototype.hasOwnProperty.call(t,"videoState")&&this.U.setValue(t.videoState))},u.prototype.isPCastStream=function(){return!!this.A},u.prototype.getPCastStreamId=function(){return this.A},u.prototype.getInfo=function(){return h(this.M.getValue())},u.getPCastPrefix=function(){return a},u.parsePCastStreamIdFromStreamUri=function(t){return n.includes(t,c(t))?t.replace(c(t),"").split("?")[0]:null},u.getInfoFromStreamUri=h,u}.apply(e,i))||(t.exports=i)},function(t,e,i){void 0===(e=function(){"use strict";return{types:{user:{id:0,name:"User"},presentation:{id:1,name:"Presentation"},audio:{id:2,name:"Audio"}}}}.apply(e,[]))||(t.exports=e)},function(t,e,i){i=[i(0),i(1),i(4),i(3),i(15),i(7),i(11),i(10),i(24),i(44),i(17),i(48),i(49),i(25),i(9),i(50),i(52),i(53),i(18),i(55),i(27),i(59),i(12),i(6),i(28),i(2),i(26)];void 0===(i=function(w,k,r,s,e,t,o,S,i,a,u,c,n,y,h,l,d,f,b,m,p,g,I,R,T,q,v){"use strict";var C=50,E=/^(?:room|channel)Id[:](.*)$/,x=/^(?:room|channel)Alias[:](.*)$/;function M(t){function e(t){t=t?t.error:"Unknown Error",i.a.error("Window Error Event Triggered with pcast in [%s] state [%s]",i.F.getValue(),t,t)}k.e(t=t||{},"options"),t.streamingSourceMapping&&(k.e(t.streamingSourceMapping,"options.streamingSourceMapping"),k.S(t.streamingSourceMapping.replacement,"options.streamingSourceMapping.replacement"),t.streamingSourceMapping.patternToReplace instanceof RegExp||k.S(t.streamingSourceMapping.patternToReplace,"options.streamingSourceMapping.patternToReplace")),w.isNullOrUndefined(t.disableMultiplePCastInstanceWarning)||k.L(t.disableMultiplePCastInstanceWarning,"options.disableMultiplePCastInstanceWarning"),w.isNullOrUndefined(t.disableGlobalErrorListener)||k.L(t.disableGlobalErrorListener,"options.disableGlobalErrorListener"),w.isNullOrUndefined(t.disableBeforeUnload)||k.L(t.disableBeforeUnload,"options.disableBeforeUnload"),w.isNullOrUndefined(t.disableConsoleLogging)||k.L(t.disableConsoleLogging,"options.disableConsoleLogging"),w.isNullOrUndefined(t.loggingLevel)||k.C(t.loggingLevel,"options.loggingLevel"),w.isNullOrUndefined(t.treatBackgroundAsOffline)||k.L(t.treatBackgroundAsOffline,"options.treatBackgroundAsOffline"),w.isNullOrUndefined(t.reAuthenticateOnForeground)||k.L(t.reAuthenticateOnForeground,"options.reAuthenticateOnForeground"),!0===t.treatBackgroundAsOffline&&!1===t.reAuthenticateOnForeground&&this.a.warn('Conflicting options "reAuthenticateOnForeground" can not be false when "treatBackgroundAsOffline" is true. Will reauthenticate upon entering foreground.'),t.shakaLoader&&k.b(t.shakaLoader,"options.shakaLoader"),t.webPlayerLoader&&k.b(t.webPlayerLoader,"options.webPlayerLoader"),this.F=new r.Observable("offline"),this.N=new r.Observable(0),this.B=new r.Observable(null),this.j=t.deviceId||"",this.I="2022-04-13T15:08:08Z",t.authToken?(n=this.parseUriFromToken.call(this,t.authToken))?(this.R=n,P.call(this,t),t.uri&&this.a.warn("Trying to join room with both authToken and uri. Please only use authToken."),this.a.info("Base uri is set to [%s] from authToken [%s]",n,t.authToken)):(this.R=t.uri||u.DefaultPCastUri,P.call(this,t),t.uri&&(this.a.warn("Trying to join room with options uri. Please use authToken."),this.a.info("Base uri is set to [%s] from options uri",t.uri))):(this.R=t.uri||u.DefaultPCastUri,P.call(this,t)),this.V=new c(t,this.a),this.W=t.shakaLoader,this.z=t.webPlayerLoader,this._=t.rtmp||{},this.H=t.streamingSourceMapping,this.T=new s.DisposableList,this.G=t.disableMultiplePCastInstanceWarning,this.J=!0===t.treatBackgroundAsOffline,this.K=!0===t.reAuthenticateOnForeground,this.Q=0,this.X=0,this.$=!0,this.Y=[],this.Z=[],this.tt=new I(t.features),this.et={},this.it={};var i=this,n=w.filter(this.tt.getFeatures(),I.isFeatureSupported);this.a.info("Device supports features [%s], user selected [%s]",n,this.tt.getFeatures()),w.addEventListener(q.global,"unload",function(){return i.a.info("Window Unload Event Triggered"),i.stop("window-unload")}),t.disableGlobalErrorListener||(w.addEventListener(q.global,"error",e),q.global.__phenixGlobalErrorListenerDisposable&&q.global.__phenixGlobalErrorListenerDisposable.dispose(),q.global.__phenixGlobalErrorListenerDisposable=new s.Disposable(function(){w.removeEventListener(q.global,"unload",e)})),t.disableBeforeUnload||w.addEventListener(q.global,"beforeunload",function(){return i.a.info("Window Before Unload Event Triggered"),i.stop("window-beforeunload")}),q.webrtcSupported||"ReactNative"!==q.browser||q.shim(),q.webrtcSupported&&"online"===this.F.getValue()&&(function(){var i=this,n=new q.RTCPeerConnection;"Safari"===q.browser&&10<q.browserVersion&&(n.addTransceiver("audio"),n.addTransceiver("video"));try{var t=function(t){var e=v.getH264ProfileIds(t.sdp);if(i.Z=v.getSupportedCodecs(t.sdp),i.a.info("Supported WebRTC video codecs [%s]",i.Z),0===e.length)return i.a.info("Unable to find local h264 profile level id",t.sdp);i.a.info("Found local h264 profile level ids [%s]",e,t.sdp),i.Y=e,n.close&&n.close()},e=function(t){i.a.error("Unable to create offer to get local h264 profile level id",t),n.close&&n.close()},r={offerToReceiveAudio:!0,offerToReceiveVideo:!0};if("function"==typeof q.global.Promise)return n.createOffer(r).then(t).catch(e);n.createOffer(t,e,r)}catch(t){i.a.error("Failed to set environment defaults. Creating the Offer failed",t),n.close&&n.close()}}.call(this),_.call(this))}function P(t){this.a=t.logger||e.createPCastLogger(this.R,t.disableConsoleLogging,t.loggingLevel),this.nt=t.metricsTransmitter||l.createMetricsTransmitter(this.R)}function D(e){if(!w.startsWith(e,"DIGEST:"))throw this.a.warn("Failed to parse the `streamToken` [%s]",e),new Error("Bad `streamToken`");try{var t=e.split(":")[1],i=q.global.atob(t),n=JSON.parse(i).token;return JSON.parse(n)}catch(t){throw n=this.getProtocol().getSessionId(),this.a.warn("[%s] Failed to parse the `streamToken` [%s]",n,e),new Error(t)}}function U(){var i,n,r=this;r.rt?r.a.warn("[%s] Skip connect due to stopped state",r):(L.call(r)&&"offline"===r.F.getValue()&&(this.a.warn("[PCast] connected after being offline. Reconnecting."),A.call(r)),this.st=!0,i=r.ot,n=++r.Q,i.authenticate(r.at,function(t,e){i===r.ot?n===r.Q?r.ut&&(t?(r.a.error("Failed to authenticate [%s]",t),tt.call(r,"unauthorized"),r.ut.call(r,r,"unauthorized","")):"ok"!==e.status?(r.a.warn("Failed to authenticate, status [%s]",e.status),tt.call(r,"unauthorized"),r.ut.call(r,r,"unauthorized","")):(tt.call(r,"online"),r.ut.call(r,r,e.status,e.sessionId))):r.a.info("Ignoring authentication response as a latter request is already underway"):r.a.info("Ignoring authentication response as reset took place")}))}function A(){tt.call(this,"reconnecting")}function O(t){t&&k.x("reason",t),tt.call(this,"reconnected",t),this.a.info("Attempting to re-authenticate after reconnected event [%s]",t),function(){var n,r,s=this;s.rt?s.a.info("Skip re-authentication due to stopped state"):(n=s.ot,r=++s.X,n.authenticate(s.at,function(t,e){var i=!0===s.st;if(n===s.ot){if(r===s.X)return t?(s.a.error("Unable to authenticate after reconnect to WebSocket [%s]",t),tt.call(s,"reconnect-failed")):"ok"===e.status?(s.st=!0,s.a.info("Successfully authenticated after reconnect to WebSocket"),tt.call(s,"online",null,i)):(s.a.warn("Unable to authenticate after reconnect to WebSocket, status [%s]",e.status),e="capacity"===e.status?e.status:"reconnect-failed",tt.call(s,e));s.a.info("Ignoring re-authentication response as a latter request is already underway")}else s.a.info("Ignoring re-authentication response as reset took place")}))}.call(this)}function F(){if(L.call(this)&&"reconnecting"===this.F.getValue())return this.a.warn("[PCast] disconnected after attempting to reconnect. Going offline."),tt.call(this,"critical-network-issue"),this.stop("critical-network-issue");this.st=!1,tt.call(this,"offline")}function L(){return w.reduce(this.ct,function(t,e){return t&&"closed"===e.iceConnectionState},!0)}function N(t){var e=t.streamId,t=t.reason;return j.call(this,e,t)}function B(t){var e=t.streamId,i=t.status,n=t.reason;(t=this.ht[e])&&t.dataQualityChangedCallback(i,n),(e=this.lt[e])&&w.b(e.dataQualityChangedCallback)&&e.dataQualityChangedCallback(e,i,n)}function j(t,e){this.a.info("[%s] Stream ended with reason [%s]",t,e);var i=this.ht[t];i&&i.streamEndedCallback(m.getStreamEndedStatus(e),e,!0),delete this.ht[t],(i=this.lt[t])&&w.b(i.publisherEndedCallback)&&i.publisherEndedCallback(i,m.getStreamEndedStatus(e),e),delete this.lt[t],(e=this.ct[t])&&et.call(this,t,e,"ended"),delete this.ct[t]}function V(r,s,o,a,u,c){function t(t){if(!s.failed&&!d){var i,e=v.getNumberOfActiveSections(o),t=t.stream||w.get(t,["streams",0]),n="real-time";if(!t)return s.failed=!0,l.a.warn("[%s] No remote stream",r),u.call(l,void 0,"failed");h&&clearTimeout(h),e===t.getTracks().length||"ReactNative"===q.browser?(d=!0,l.a.info("[%s] Got remote stream",r),a.setProperty("kind",n),e=w.assign({networkLag:l.dt},c),e=new g(r,t,o,a,e,l.a),(i=new m(n,e,l.a)).on(R.streamEvents.playerError.name,function(t,e){l.a.info("Phenix Real-Time stream error [%s] [%s]",t,e),i.streamErrorCallback(n,e)}),i.on(R.streamEvents.stopped.name,function(t){!s.stopped&&l.ot&&(l.a.info("[%s] media stream has stopped with reason [%s]",r,t),et.call(l,r,o,"stop"),l.ot.destroyStream(r,t||"",function(t,e){t?l.a.error("[%s] failed to destroy stream [%s]",r,t):"ok"===e.status?l.a.info("[%s] destroyed stream",r):l.a.warn("[%s] failed to destroy stream, status [%s]",r,e.status)}),s.stopped=!0)}),l.ht[r]=i,u.call(l,e)):h=setTimeout(function(){return s.failed=!0,l.a.warn("[%s] Did not receive all tracks within [%s] ms",r,3e3),u.call(l,void 0,"failed")},3e3)}}var h,l=this,d=!1;w.addEventListener(o,"addstream",t),w.addEventListener(o,"track",t)}function W(e,t,i){var n=this;w.addEventListener(t,"icecandidate",function(t){(t=t.candidate)?n.a.info("[%s] ICE candidate: [%s] [%s] [%s]",e,t.sdpMid,t.sdpMLineIndex,t.candidate):n.a.info("[%s] ICE candidate discovery complete",e),i&&i(t)})}function z(e,i){var n=this;w.addEventListener(i,"negotiationneeded",function(t){n.a.info("[%s] Negotiation needed",e)}),w.addEventListener(i,"iceconnectionstatechange",function(t){n.a.info("[%s] ICE connection state changed [%s]",e,i.iceConnectionState)}),w.addEventListener(i,"icegatheringstatechange ",function(t){n.a.info("[%s] ICE gathering state changed [%s]",e,i.iceGatheringState)}),w.addEventListener(i,"signalingstatechange",function(t){n.a.info("[%s] Signaling state changed [%s]",e,i.signalingState)}),w.addEventListener(i,"connectionstatechange",function(t){n.a.info("[%s] Connection state changed [%s]",e,i.connectionState)})}function _(e){var i=this;if("Edge"===q.browser)return q.getDestinations(function(t){0===w.filter(t,function(t){return"audio"===t.kind}).length?(i.$&&i.a.info("Detected no audio devices attached to machine"),i.$=!1):i.$=!0,e&&e()});e&&e()}function H(t,n,e,i,r,s){if("IE"===q.browser)throw new Error("Subscribing in real-time not supported on IE");var o=this,a={failed:!1,stopped:!1},u=e.match(/a=crypto:/i),c=e.match(/m=application /i),h=new q.RTCPeerConnection(t,{optional:[{DtlsSrtpKeyAgreement:!u},{RtpDataChannels:c}]});function l(t){a.failed||(t instanceof Error&&(o.a.info("[%s] Failed to setup peer connection",n,t),t="failed"),a.failed=!0,a.stopped=!0,delete o.ct[n],delete o.ht[n],delete o.ft[n],et.call(o,n,h,"failure"),r.call(o,void 0,t||"failed"))}at(h),o.ct[n]=h,"Firefox"!==q.browser&&"Edge"!==q.browser||(e.match(/(\nm=video)/g)&&e.match(/(\nm=audio)/g)&&(e=e.replace(c=/(a=candidate)((.|\n)*)(?=m=)/g,e.match(c)+"a=end-of-candidates\n")),e=(e+="a=end-of-candidates").replace(/(\na=ice-options:trickle)/g,"")),"ReactNative"===q.browser&&(e=v.setGroupLineOrderToMatchMediaSectionOrder(e)),V.call(o,n,a,h,i,r,s),W.call(o,n,h,function(t){o.ft[n]&&o.ft[n](t)}),z.call(o,n,h);var e=new q.RTCSessionDescription({type:"offer",sdp:e}),d={mandatory:{}};if("Chrome"===q.browser||"ReactNative"===q.browser?(d.mandatory.OfferToReceiveVideo=!1!==s.receiveVideo,d.mandatory.OfferToReceiveAudio=!1!==s.receiveAudio):(d.mandatory.offerToReceiveVideo=!1!==s.receiveVideo,d.mandatory.offerToReceiveAudio=!1!==s.receiveAudio),"function"==typeof q.global.Promise)return h.setRemoteDescription(e).then(w.bind(J,o,h)).then(function(){return h.createAnswer(d)}).then(w.bind(K,o)).then(function(i){return new q.global.Promise(function(t,e){Q.call(o,n,i,t,e)})}).then(function(t){return h.setLocalDescription(t)}).then(w.bind(G,o,h)).then(function(){o.a.info("[%s] Peer connection setup completed",n)}).catch(l);o.a.info("[%s] Using legacy peer connection api to subscribe",n),h.setRemoteDescription(e,function(){J.call(o,h),h.createAnswer(function(t){K.call(o,t),Q.call(o,n,t,function(t){h.setLocalDescription(t,function(){G.call(o,h),o.a.info("[%s] Peer connection setup completed",n)},l)},l)},l,d)},l)}function G(t){this.a.debug("Set local description [%s] [%s]",w.get(t,["localDescription","type"]),w.get(t,["localDescription","sdp"]))}function J(t){this.a.debug("Set remote description [%s] [%s]",w.get(t,["localDescription","type"]),w.get(t,["remoteDescription","sdp"]))}function K(t){return this.a.info("Created answer [%s]",t.sdp),t}function Q(i,t,n,r){var s=this;s.ot.setAnswerDescription(i,t.sdp,function(t,e){return t?(s.a.error("Failed to set answer description [%s]",t),r()):"ok"!==e.status?(s.a.warn("Failed to set answer description, status [%s]",e.status),r(e.status)):(e&&w.includes(e.options,"ice-candidates")&&(s.ft[i]=w.bind(X,s,i)),t=e.sessionDescription.sdp,I.isIOS()&&(e=w.get(I.getIOSVersion(),["major"]),s.a.info("iOS Version is [%s]",e),e<11&&(t=t.replace("BUNDLE audio video","BUNDLE video audio"))),t=new q.RTCSessionDescription({type:"answer",sdp:t}),void n(t))})}function X(t,e){var i=this,n=(n=this.et[t])||(this.et[t]=[]);e&&w.get(e,["candidate"])?n.push(e):(i.it[t]&&(i.a.debug("[%s] Dismissing scheduled batch for adding ICE candidates. Sending candidates immediately because there are no more candidates.",t),clearTimeout(i.it[t])),$.call(i,t,["completed"]),delete this.et[t],delete this.it[t]),this.it[t]?i.a.debug("[%s] Using existing batch for adding ICE candidates",t):(this.it[t]=setTimeout(function(){$.call(i,t,[]),delete i.it[t]},C),this.T.add(new s.Disposable(function(){i.it[t]&&clearTimeout(i.it[t]),delete i.et[t],delete i.it[t]})))}function $(i,t){var n,e=this.et[i]||[];0===e.length&&0===t.length||(delete(n=this).et[i],this.a.info("[%s] Adding [%s] ICE Candidates with Options [%s]",i,e.length,t),this.ot.addIceCandidates(i,e,t,function(t,e){return t?n.a.error("Failed to add ICE candidate [%s]",t):"ok"!==e.status?n.a.warn("Failed to add ICE candidate, status [%s]",e.status):void(w.includes(e.options,"cancel")&&delete n.ft[i])}))}function Y(t,e,i,n,r){var s=this,o=/a=x-rtmp:(rtmp:\/\/[^\n]*)/m,a=e.match(o),u=e.match(/a=x-playlist:([^\n]*[.]mpd\??[^\s]*)/m),c=e.match(/a=x-playlist:([^\n]*[.]m3u8\??[^\s]*)/m),h=w.get(u,[1],""),l=w.get(c,[1],""),d=u&&2===u.length,f=c&&2===c.length,u=!!a,c=[];switch((d||f)&&c.push("streaming"),u&&c.push("rtmp"),u=this.tt.getPreferredFeatureFromPublisherCapabilities(c,!0),this.H&&(h=h.replace(this.H.patternToReplace,this.H.replacement),l=l.replace(this.H.patternToReplace,this.H.replacement)),u){case R.types.rtmp.name:var m=[],p=S.parseEnvFromPcastBaseUri(this.R);for(this.a.info("Selecting flash playback for rtmp.");a;){var g=w.get(a,[1],""),v=w.get(g.match(/(rtmp:\/\/[^\n\s]*)/),[0]),y=w.get(g.match(/bitrate=([^\n\s;]*)/),[1]),b=w.get(g.match(/resolution=([^\n\s;]*)/),[1]);e=e.replace(g,""),v&&m.push({uri:v,bitrate:y,resolution:b}),a=e.match(o)}return Z.call(s,t,m,R.types.rtmp.name,i,n,w.assign({env:p},this._,r));case R.types.dash.name:return this.a.info("Selecting dash playback for live stream."),r.isDrmProtectedContent=/[?&]drmToken=([^&]*)/.test(h)||/x-widevine-service-certificate/.test(e),r.isDrmProtectedContent&&(r.widevineServiceCertificateUrl=e.match(/a=x-widevine-service-certificate:([^\n][^\s]*)/m)[1],r.playreadyLicenseUrl=e.match(/a=x-playready-license-url:([^\n][^\s]*)/m)[1]),Z.call(s,t,h,R.types.dash.name,i,n,r);case R.types.hls.name:return this.a.info("Selecting hls playback for live stream."),r.isDrmProtectedContent=/[?&]drmToken=([^&]*)/.test(l),r.hlsTargetDuration&&(k.C(r.hlsTargetDuration,"options.hlsTargetDuration"),l=l+(-1<l.indexOf("?")?"&":"?")+"targetDuration="+r.hlsTargetDuration),Z.call(s,t,l,R.types.hls.name,i,n,w.assign({preferNative:I.shouldUseNativeHls},r))}return s.a.warn("[%s] Device does not support [%s] playback. Creating live viewer stream failed.",t,I.mapPCastCapabilitiesToFeatures(c)),n.call(s,void 0,"failed")}function Z(n,e,r,s,o,a){var u=this,i=0,c=null,h=null;return this.W||this.z?(this.W&&i++,this.z&&i++,this.W&&this.W(function(t){if(c=t,0==--i)return l()}),this.z&&this.z(function(t){if(h=t,0==--i)return l()}),0===i?l():void 0):(u.a.warn("[%s] No player available for [%s] and uri [%s]. Please provide a loader via options.",n,r,e),u.ot.destroyStream(n,"unsupported-features",function(t,e){t?u.a.error("[%s] failed to destroy stream with unsupported features, [%s]",n,t):"ok"!==e.status&&u.a.warn("[%s] failed to destroy stream with unsupported features, status [%s]",n,e.status)}),o.call(u,void 0,"unsupported-features"));function l(){if(!c&&!h)return u.a.warn("[%s] No player available for [%s] and uri [%s]. Please make sure the loader properly provides the player.",n,r,e),o.call(u,void 0,"unsupported-features");var t=new p(r,n,e,s,a,c,h,u.a),i=new m(r,t,u.a);s.setProperty("kind",r),i.on(R.streamEvents.playerError.name,function(t,e){u.a.warn("Phenix Live Stream Player Error [%s] [%s]",t,e),i.streamErrorCallback(t,e)}),i.on(R.streamEvents.stopped.name,function(t){return u.ot?void u.ot.destroyStream(n,t||"",function(t,e){t?u.a.error("[%s] failed to destroy stream, [%s]",n,t):"ok"!==e.status&&u.a.warn("[%s] failed to destroy stream, status [%s]",n,e.status)}):u.a.warn("Unable to destroy stream [%s]",n)}),u.ht[n]=i,o.call(u,i.getPhenixMediaStream())}}function tt(t,e,i){var n=this.getStatus();if(n!==t&&("critical-network-issue"!==(r=n)&&"offline"!==r||"offline"!==t)){this.F.setValue(t);var r=(r=this.getProtocol())?r.getSessionId():"";if(this.a.debug("[%s] Transition from [%s] to [%s] with reason [%s]",r,n,t,e),!i)switch(t){case"connecting":case"reconnecting":case"reconnected":break;case"critical-network-issue":case"unauthorized":case"reconnect-failed":case"offline":return this.mt.call(this);case"online":return this.pt.call(this)}}}function et(t,e,i){"closed"===e.signalingState||e.__closing?this.a.debug("[%s] Peer connection is already closed [%s]",t,i):(this.a.debug("[%s] close peer connection [%s]",t,i),e.close(),e.__closing=!0)}function it(){(this.J||this.K)&&O.call(this,"entered-foreground")}function nt(){this.J&&tt.call(this,"offline","entered-background")}function rt(t){if(!t)return t;var e=w.isArray(t)?[]:{},i=w.bind(st,null,e);return w.isArray(t)?w.forEach(t,i):w.forOwn(t,i),e}function st(t,e,i){if(null!==e)return w.e(e)||w.isArray(e)?t[i]=rt(e):w.x(e)&&w.x(i)?(e=w.startsWith(e.toLowerCase(),i.toLowerCase())?e.substring(i.length,e.length).toLowerCase():e,void(t[i]=e)):t[i]=e}function ot(t){switch(q.browser){case"Firefox":(e=t)&&w.forEach(e.iceServers,function(t){t.urls=w.filter(t.urls,function(t){return!w.startsWith(t,"turns")})});break;case"Edge":(e=t)&&w.forEach(e.iceServers,function(t){t.urls=w.map(t.urls,function(t){return t.replace("transport=tcp","transport=udp")})})}var e;return t}M.prototype.getBaseUri=function(){return this.R},M.prototype.getStatus=function(){return this.F.getValue()},M.prototype.getObservableStatus=function(){return this.F},M.prototype.getRemoteDescriptionSdp=function(t){if(k.S(t,"streamId"),this.ct)return w.get(this.ct,[t,"remoteDescription","sdp"])},M.prototype.isStarted=function(){return this.gt},M.prototype.reAuthenticate=function(t){if(k.S(t,"authToken"),"online"===this.F.getValue())return this.a.warn("Already authenticated. Denying request to re-authenticate");this.a.info("Attempting to re-authenticate with new auth token [%s]",t),this.at=t,O.call(this)},M.prototype.start=function(t,e,i,n){if(k.S(t,"authToken"),k.b(e,"authenticationCallback"),k.b(i,"onlineCallback"),k.b(n,"offlineCallback"),this.gt)throw new Error('"Already started"');w.C(q.global.__phenixInstantiatedPCastCount)?q.global.__phenixInstantiatedPCastCount++:q.global.__phenixInstantiatedPCastCount=1,1<q.global.__phenixInstantiatedPCastCount&&!this.G&&this.a.warn("Avoid using multiple instances of PCast as this uses unnecessary resources and will reduce performance. This is your [%s] simultaneous instance. Remember to dispose all resources when done with them by calling .stop() or .dispose()",q.global.__phenixInstantiatedPCastCount),this.rt=!1,this.gt=!0,this.at=t,this.ut=e,this.pt=i,this.mt=n,this.q=new f(this.a,this.nt),this.vt=new u(this.I,this.R,this.a,this.q),tt.call(this,"connecting"),this.ct={},this.ht={},this.ft={},this.lt={},this.yt=[],this.T.add(this.vt),this.T.add(this.q),this.T.add(o.onBackground(w.bind(nt,this))),this.T.add(o.onForeground(w.bind(it,this)));var r=this;r.vt.resolveUri(function(t,e){if(t){if(r.a.error("Failed to connect to [%s]",r.R,t),r.ut)switch(t.code){case 0:r.ut.call(r,r,"network-unavailable","");break;case 503:r.ut.call(r,r,"capacity","");break;default:return void r.ut.call(r,r,"critical-network-issue","")}return tt.call(r,"offline"),r.rt=!0,void(r.gt=!1)}r.a.info("Discovered end point [%s] with RTT [%s]",e.uri,e.roundTripTime),r.dt=e.roundTripTime/2,r.bt=e.uri,r.gt&&function(t){this.ot=new a(t,this.j,this.I,this.a),this.ot.onEvent("connected",w.bind(U,this)),this.ot.onEvent("reconnecting",w.bind(A,this)),this.ot.onEvent("reconnected",w.bind(O,this)),this.ot.onEvent("disconnected",w.bind(F,this)),this.ot.onEvent("pcast.StreamEnded",w.bind(N,this)),this.ot.onEvent("pcast.StreamDataQuality",w.bind(B,this)),this.a.setObservableSessionId&&this.a.setObservableSessionId(this.ot.getObservableSessionId()),this.wt&&(this.wt.dispose(),this.q.setSessionId(null)),this.kt&&this.kt.dispose(),this.kt=this.ot.getObservableSessionId().subscribe(w.bind(function(t){this.B.setValue(t)},this)),this.wt=this.ot.getObservableSessionId().subscribe(w.bind(this.q.setSessionId,this.q))}.call(r,e.uri)})},M.prototype.stop=function(i){if(i=i||"",k.x(i,"reason"),this.gt){this.a.info("Stopping pcast instance with reason [%s]",i),this.rt=!0,this.gt=!1,delete this.ut;try{var n=this;w.forOwn(this.ht,function(t,e){j.call(n,e,i)}),w.forOwn(this.lt,function(t,e){j.call(n,e,i),w.includes(t.getOptions(),"detached")||t.stop(i,!0)}),w.forOwn(this.ct,function(t,e){j.call(n,e,i)}),w.forEach(this.yt,function(t){t=t.getTracks(),w.forEach(t,function(t){t.stop()})})}catch(t){n.a.warn("Pcast stop caught an error",t)}finally{if(this.ot){try{this.ot.disconnect()}catch(t){n.a.warn("Failed to disconnect pcast",t)}this.ot=null}this.a.setObservableSessionId&&this.a.setObservableSessionId(null),this.wt&&(this.wt.dispose(),this.q.setSessionId(null)),this.kt&&(this.kt.dispose(),this.B.setValue(null)),q.global.__phenixInstantiatedPCastCount--,this.T.dispose()}}},M.prototype.getUserMedia=function(t,e,i){if("IE"===q.browser)throw new Error("Publishing not supported on IE");return k.e(t,"options"),k.b(e,"callback"),i&&k.b(i,"onScreenShare"),new n(this.a,this.V,i).getUserMedia(t,e)},M.prototype.publish=function(t,o,a,e,u){if("IE"===q.browser)throw new Error("Publishing not supported on IE");if(!this.gt)throw new Error("PCast not started. Unable to publish. Please start pcast first.");if(e=e||[],u=u||{},k.S(t,"streamToken"),k.b(a,"callback"),k.isArray(e,"tags"),k.e(u,"options"),!w.e(o)&&!w.x(o))throw new Error('"streamToPublish" must be an object or URI');var c=this,h=w.assign({},u,{negotiate:!0});w.x(o)?(h.negotiate=!1,h.connectUri=o):h.connectUri=u.connectUri,0<e.length&&(h.tags=e);var l=new d(this.getProtocol().getSessionId(),this.a,this.nt);l.setProperty("resource","upload"),this.ot.setupStream("upload",t,h,2*c.dt,function(t,e){if(t)return c.a.error("Failed to create uploader [%s]",t),a.call(c,c,"failed");if("ok"===e.status){var i=e.createStreamResponse.streamId;if(l.setStreamId(i),l.setStartOffset(e.createStreamResponse.offset),l.recordMetric("Provisioned"),l.recordMetric("RoundTripTime",{uint64:2*c.dt},null,{resource:c.bt,kind:"https"}),!0!==h.negotiate)return function(i,t,e){var n=this,r={stopped:!1},s={getStreamId:function(){return i},getStream:function(){return n.a.debug("[%s] Unable to get stream for remote origin.",i),null},getStats:function(){return n.a.debug("[%s] Unable to get stream stats for remote origin.",i),null},isActive:function(){return!r.stopped},hasEnded:function(){return r.stopped},stop:function(t){r.stopped||(n.a.info("[%s] stopping publisher with reason [%s]",i,t),n.ot.destroyStream(i,t||"",function(t,e){t?n.a.error("[%s] failed to destroy stream [%s]",i,t):"ok"===e.status?n.a.info("[%s] destroyed stream",i):n.a.warn("[%s] failed to destroy stream, status [%s]",i,e.status)}),r.stopped=!0)},setPublisherEndedCallback:function(t){k.b(t,"callback"),this.publisherEndedCallback=t},setDataQualityChangedCallback:function(t){k.b(t,"callback"),this.dataQualityChangedCallback=t},getOptions:function(){return e},monitor:function(t,e){k.e(t,"options"),k.b(e,"callback")},getMonitor:function(){return null}};t(n.lt[i]=s)}.call(c,i,function(t,e){l.recordMetric("SetupCompleted",{string:e?"failed":"ok"}),e?a.call(c,c,"failed",null):a.call(c,c,"ok",t)},e.createStreamResponse.options);var n,r=e.createStreamResponse.createOfferDescriptionResponse.sessionDescription.sdp,s=ot(rt(e.createStreamResponse.rtcConfiguration));return"Opera"===q.browser&&0<c.Y.length&&(n=w.get(v.getH264ProfileIds(r),[0]),(t=v.getH264ProfileIdWithSameProfileAndEqualToOrHigherLevel(c.Y,n))?n!==t&&(c.a.info("[%s] Replacing publisher h264 profile level id [%s] with new value [%s] in offer sdp",i,n,t),r=v.replaceH264ProfileId(r,n,t)):c.a.warn("[%s] Unable to find h264 profile level id to replace [%s]. Rejected environment defaults of [%s]",i,n,c.Y)),function(t,o,a,e,i,u,n,c){var h=this,l={failed:!1,stopped:!1},r=e.match(/a=crypto:/i),s=e.match(/m=application /i),d=new q.RTCPeerConnection(t,{optional:[{DtlsSrtpKeyAgreement:!r},{RtpDataChannels:s}]}),f=null,m=null;function p(t){l.failed||(t instanceof Error&&(h.a.info("[%s] Failed to setup peer connection",a,t),t="failed"),l.failed=!0,l.stopped=!0,delete h.ct[a],delete h.lt[a],delete h.ft[a],et.call(h,a,d,"failure"),u.call(h,void 0,t||"failed"))}function g(){var i=/(b=AS:([0-9]*)[\n\r]*)/gi,n=/(mid:video)([\n\r]*)/gi,r=0,t=i.exec(e);t&&3<=t.length&&(r=1e3*t[2]);var s={getStreamId:function(){return a},getStream:function(){return o},isActive:function(){return!l.stopped},hasEnded:function(){switch(d.iceConnectionState){case"new":case"checking":case"connected":case"completed":return!1;default:return!0}},stop:function(t){!l.stopped&&h.ot&&(h.a.info("[%s] stopping publisher with reason [%s]",a,t||"client-action"),et.call(h,a,d,"closed"),h.ot.destroyStream(a,t||"",function(t,e){t?h.a.error("[%s] failed to destroy stream [%s]",a,t):"ok"===e.status?h.a.info("[%s] destroyed stream",a):h.a.warn("[%s] failed to destroy stream, status [%s]",a,e.status)}),l.stopped=!0)},setPublisherEndedCallback:function(t){k.b(t,"callback"),this.publisherEndedCallback=t},setDataQualityChangedCallback:function(t){k.b(t,"callback"),this.dataQualityChangedCallback=t},limitBandwidth:function(t){if("Edge"===q.browser)return h.a.warn("Limit bandwidth not support on [%s]",q.browser);k.C(t,"bandwidthLimit");var s=r?Math.min(t,r):t,e=d.remoteDescription;return h.a.info("Changing bandwidth limit to [%s]",s),t=(t=e.sdp.replace(i,"")).replace(n,function(t,e,i,n,r){return[e,i,"b=AS:",Math.ceil(s/1e3),i].join("")}),t=new q.RTCSessionDescription({type:e.type,sdp:t}),d.setRemoteDescription(t),{dispose:function(){d.setRemoteDescription(e)}}},getMonitor:function(){return m},monitor:function(t,i){k.e(t,"options"),k.b(i,"callback");var e=new y(a,d,h.a);return t.direction="outbound",t.setNetworkRTT=function(t){h.N.setValue(t)},e.start(t,function(){return h.lt[a]===s&&!l.stopped},function(t,e){return t&&h.a.warn("[%s] Publisher monitor triggered unrecoverable error [%s]",t),h.a.warn("[%s] Publisher triggered monitor condition for [%s]",a,e.reasons),i(s,"client-side-failure",e)}),w.forEach(o.getTracks(),function(t){w.addEventListener(t,"readystatechange",function(){if("ended"===t.readyState)return h.a.warn("[%s] Publisher track has failed [%s]",a,t),i(s,"camera-track-failure",{type:t.kind+"-track-ended",message:"Publisher "+t.kind+" track has ended in an unrecoverable way. This may require reconfiguring your camera or microphone."})})}),m=e},addBitRateThreshold:function(t,e){return new T("Publisher",m,function(){return r}).addThreshold(t,e)},setRemoteMediaStreamCallback:function(t){k.b(t,"callback"),this.remoteMediaStreamCallback=t,f&&t(s,f)},getOptions:function(){return c},getStats:function(e){k.b(e,"callback"),this.St||(this.St={});var i=this;return q.getStats(d,null,function(t){e(b.convertPeerConnectionStats(t,i.St))})},networkRTT:h.N};h.lt[a]=s,u.call(h,s)}at(d),(h.ct[a]=d).addStream(o),"Firefox"!==q.browser&&"Edge"!==q.browser||(e.match(/(\nm=video)/g)&&e.match(/(\nm=audio)/g)&&(e=e.replace(s=/(a=candidate)((.|\n)*)(?=m=)/g,e.match(s)+"a=end-of-candidates\n")),e=(e+="a=end-of-candidates").replace(/(\na=ice-options:trickle)/g,"")),V.call(h,a,l,d,i,function(t){var e=h.lt[a];f=t,e&&e.remoteMediaStreamCallback&&e.remoteMediaStreamCallback(e,t)},n),W.call(h,a,d,function(t){h.ft[a]&&h.ft[a](t)}),z.call(h,a,d);var i=new q.RTCSessionDescription({type:"offer",sdp:e}),v={mandatory:{}};if("Chrome"===q.browser||"ReactNative"===q.browser?(v.mandatory.OfferToReceiveVideo=!0===n.receiveVideo,v.mandatory.OfferToReceiveAudio=!0===n.receiveAudio):(v.mandatory.offerToReceiveVideo=!0===n.receiveVideo,v.mandatory.offerToReceiveAudio=!0===n.receiveAudio),"function"==typeof q.global.Promise)return d.setRemoteDescription(i).then(w.bind(J,h,d)).then(function(){return d.createAnswer(v)}).then(w.bind(K,h)).then(function(i){return new q.global.Promise(function(t,e){Q.call(h,a,i,t,e)})}).then(function(t){return d.setLocalDescription(t)}).then(w.bind(G,h,d)).then(function(){h.a.info("[%s] Peer connection setup completed",a)}).then(g).catch(p);h.a.info("[%s] Using legacy peer connection api to publish",a),d.setRemoteDescription(i,function(){J.call(h,d),d.createAnswer(function(t){K.call(h,t),Q.call(h,a,t,function(t){d.setLocalDescription(t,function(){G.call(h,d),h.a.info("[%s] Peer connection setup completed",a),g()},p)},p)},p,v)},p)}.call(c,s,o,i,r,l,function(t,e){l.recordMetric("SetupCompleted",{string:e?"failed":"ok"}),e?a.call(c,c,"failed",null):a.call(c,c,"ok",t)},u,e.createStreamResponse.options)}switch(c.a.warn("Failed to create uploader, status [%s]",e.status),e.status){case"timeout":case"capacity":case"unauthorized":return a.call(c,c,e.status);default:return a.call(c,c,"failed")}})},M.prototype.subscribe=function(i,a,n){if(!this.gt)throw new Error("PCast not started. Unable to subscribe. Please start pcast first.");n=n||{},k.S(i,"streamToken"),k.b(a,"callback"),k.e(n,"options");var u=this;_.call(u,function(){var t="download",e=w.assign({},n,{negotiate:!1!==n.negotiate}),s=new d(u.getProtocol().getSessionId(),u.a,u.nt),o=w.assign({},n);o.canPlaybackAudio=u.$,o.capabilities=u.parseCapabilitiesFromToken(i),!u.$&&n.disableAudioIfNoOutputFound&&!1!==n.receiveAudio&&(e.receiveAudio=!1,o.receiveAudio=!1,o.forcedAudioDisabled=!0),n.originStreamId&&(e.originStreamId=n.originStreamId),s.setProperty("resource",t),u.ot.setupStream(t,i,e,2*u.dt,function(t,e){if(t)return u.a.error("Failed to create downloader [%s]",t),a.call(u,u,"failed");if("ok"!==e.status)return u.a.warn("Failed to create downloader, status [%s]",e.status),a.call(u,u,e.status);var i=e.createStreamResponse.streamId,n=e.createStreamResponse.createOfferDescriptionResponse.sessionDescription.sdp,r=ot(rt(e.createStreamResponse.rtcConfiguration)),t=w.bind(H,u,r);return(r=!(n.match(/m=audio /)||n.match(/m=video /))&&(n.match(/a=x-playlist:/)||n.match(/a=x-rtmp:/)))&&(t=Y),s.setStreamId(i),s.setStartOffset(e.createStreamResponse.offset),s.recordMetric("Provisioned"),s.recordMetric("RoundTripTime",{uint64:2*u.dt},null,{resource:u.getBaseUri(),kind:"https"}),o.originStartTime=w.now()-e.createStreamResponse.offset+u.dt,!r&&("Chrome"===q.browser&&62<=q.browserVersion&&I.isMobile()||"Opera"===q.browser)&&0<u.Y.length&&(e=w.get(v.getH264ProfileIds(n),[0]),(r=v.getH264ProfileIdWithSameOrHigherProfileAndEqualToOrHigherLevel(u.Y,e))?e!==r&&(u.a.info("[%s] Replacing subscriber h264 profile level id [%s] with new value [%s] in offer sdp",i,e,r),n=v.replaceH264ProfileId(n,e,r)):u.a.warn("[%s] Unable to find new subscriber h264 profile level id to replace [%s]. Rejected environment defaults of [%s]",i,e,u.Y)),t.call(u,i,n,s,function(t,e){s.recordMetric("SetupCompleted",{string:e?"failed":"ok"}),e?a.call(u,u,"failed",null):a.call(u,u,"ok",t)},o)})})},M.prototype.getProtocol=function(){return this.ot},M.prototype.getLogger=function(){return this.a},M.prototype.getObservableSessionId=function(){return this.B},M.prototype.toString=function(){var t=this.getProtocol();return"PCast["+(t?t.getSessionId():"")||!1},M.prototype.parseCapabilitiesFromToken=function(t){return w.get(D.call(this,t),["capabilities"],[])},M.prototype.parseUriFromToken=function(t){return w.get(D.call(this,t),["uri"],"")},M.prototype.parseRoomOrChannelIdFromToken=function(t){return(t=w.get(D.call(this,t),["requiredTag"],"").match(E))?t[1]:null},M.prototype.parseRoomOrChannelAliasFromToken=function(t){return(t=w.get(D.call(this,t),["requiredTag"],"").match(x))?t[1]:null};var at=function(i){var e,t;w.isUndefined(i.onaddstream)&&(e=[],t=[],w.addEventListener(i,"track",function(t){w.forEach(t.streams,function(t){w.includes(e,t)||e.push(t)})}),i.getRemoteStreams=function(){return e},i.getLocalStreams=function(){return t},i.addStream=function(e){w.includes(t,e)||t.push(e),w.forEach(e.getTracks(),function(t){i.addTrack(t,e)})})};return M}.apply(e,i))||(t.exports=i)},function(t,e){t.exports=d},function(t,e,i){void 0===(e=function(){"use strict";return{package:"telemetry",messages:[{name:"LogData",fields:[{rule:"required",type:"LogLevel",name:"level",id:1},{rule:"required",type:"string",name:"timestamp",id:2},{rule:"required",type:"string",name:"category",id:3},{rule:"required",type:"string",name:"message",id:4},{rule:"optional",type:"string",name:"source",id:5},{rule:"optional",type:"string",name:"fullQualifiedName",id:11},{rule:"optional",type:"string",name:"sessionId",id:6},{rule:"optional",type:"string",name:"userId",id:7},{rule:"optional",type:"string",name:"environment",id:8},{rule:"optional",type:"string",name:"version",id:9},{rule:"optional",type:"float",name:"runtime",id:10}]},{name:"StoreLogRecords",fields:[{rule:"repeated",type:"LogData",name:"records",id:1}]},{name:"StoreLogRecordsResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"required",type:"uint64",name:"storedRecords",id:2}]},{name:"MetricValue",fields:[{rule:"optional",type:"string",name:"string",id:1},{rule:"optional",type:"float",name:"float",id:2},{rule:"optional",type:"uint64",name:"uint64",id:3},{rule:"optional",type:"int64",name:"int64",id:4},{rule:"optional",type:"bool",name:"boolean",id:5},{rule:"optional",type:"string",name:"timestamp",id:6}]},{name:"MetricData",fields:[{rule:"required",type:"string",name:"timestamp",id:1},{rule:"optional",type:"string",name:"sessionId",id:2},{rule:"optional",type:"string",name:"streamId",id:3},{rule:"optional",type:"string",name:"source",id:4},{rule:"optional",type:"string",name:"resource",id:5},{rule:"optional",type:"string",name:"kind",id:6},{rule:"required",type:"Metric",name:"metric",id:7},{rule:"optional",type:"MetricValue",name:"value",id:8},{rule:"optional",type:"MetricValue",name:"previousValue",id:9},{rule:"optional",type:"uint64",name:"elapsed",id:10},{rule:"optional",type:"string",name:"fullQualifiedName",id:11},{rule:"optional",type:"string",name:"environment",id:12},{rule:"optional",type:"string",name:"version",id:13},{rule:"optional",type:"string",name:"tool",id:14},{rule:"optional",type:"string",name:"toolVersion",id:15},{rule:"required",type:"float",name:"runtime",id:16}]},{name:"SubmitMetricRecords",fields:[{rule:"repeated",type:"MetricData",name:"records",id:1}]},{name:"SubmitMetricRecordsResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"required",type:"uint64",name:"storedRecords",id:2}]}],enums:[{name:"LogLevel",values:[{name:"Trace",id:0},{name:"Debug",id:1},{name:"Info",id:2},{name:"Warn",id:3},{name:"Error",id:4},{name:"Fatal",id:5}]},{name:"Metric",values:[{name:"RoundTripTime",id:0},{name:"DownlinkThroughputCapacity",id:26},{name:"Initialized",id:1},{name:"Provisioned",id:2},{name:"SetupCompleted",id:3},{name:"Offset",id:4},{name:"TimeToFirstFrame",id:5},{name:"Playing",id:6},{name:"Stalled",id:7},{name:"Buffering",id:8},{name:"Seeking",id:22},{name:"Stopped",id:9},{name:"BitRateAdaptation",id:10},{name:"ResolutionChanged",id:11},{name:"DisplayResolutionChanged",id:23},{name:"VideoBitRate",id:28},{name:"AudioBitRate",id:29},{name:"FrameRateChanged",id:12},{name:"FramesDropped",id:13},{name:"PacketsLost",id:14},{name:"PictureLost",id:15},{name:"PlayoutDelayChanged",id:16},{name:"CodecChanged",id:17},{name:"PlayerEvent",id:21},{name:"MetricDropped",id:18},{name:"NetworkOffline",id:19},{name:"NetworkOnline",id:20},{name:"NetworkType",id:27},{name:"ApplicationForeground",id:24},{name:"ApplicationBackground",id:25}]}]}}.apply(e,[]))||(t.exports=e)},function(t,e,i){i=[i(2)];void 0===(i=function(t){"use strict";function e(){this.init()}return e.prototype.init=function(){if(!t.global.AudioContext&&!t.global.webkitAudioContext)throw new Error("Browser does not support AudioContext");this.It=new(t.global.AudioContext||t.global.webkitAudioContext)},e.prototype.getNativeAudioContext=function(){return this.It},e.prototype.toString=function(){return"AudioContext"},e}.apply(e,i))||(t.exports=i)},function(t,e,i){i=[i(0),i(1),i(5),i(2),i(26),i(18)];void 0===(i=function(w,r,s,k,S,a){"use strict";function t(t,e,i){r.x(t,"name"),r.e(e,"peerConnection"),r.e(i,"logger"),this.Rt=t,this.Tt=e,this.a=i,this.St={}}function I(t){var e=R(t),t=T(t);if(0===e.length||0===t.length)return 0!==e.length?e:0!==t.length?t:[];var i=[];return w.forEach(e,function(t){i.push(t)}),w.forEach(t,function(t){i.push(t)}),i}function R(t){var e=t.getSenders?w.map(t.getSenders(),function(t){return t.track}):[];return 0!==(e=w.filter(e,function(t){return!w.isNullOrUndefined(t)})).length?e:(t=t.getLocalStreams?t.getLocalStreams():[],w.reduce(t,function(t,e){return t.concat(e.getTracks())},[]))}function T(t){var e=t.getReceivers?w.map(t.getReceivers(),function(t){return t.track}):[];return 0!==(e=w.filter(e,function(t){return!w.isNullOrUndefined(t)})).length?e:(t=t.getRemoteStreams?t.getRemoteStreams():[],w.reduce(t,function(t,e){return t.concat(e.getTracks())},[]))}function q(e,t){var t=w.filter(t,function(t){return t.kind===e}),i=w.filter(this.qt,function(t){return t.kind===e});return w.reduce(t,function(t,e){return t&&(t=!!w.find(i,function(t){return t.id===e.id}),!e.enabled||t)},!0)}return t.prototype.start=function(t,e,i){if(r.e(t,"options"),r.b(e,"activeCallback"),r.b(i,"monitorCallback"),"inbound"!==t.direction&&"outbound"!==t.direction)throw new Error("Invalid monitoring direction");var n;if(n=!Object.prototype.hasOwnProperty.call(t,"monitoringInterval")||0<t.monitoringInterval)return this.Ct=t.frameRateThreshold||2,this.Et=t.videoBitRateThreshold||1e3,this.xt=t.audioBitRateThreshold||5e3,this.Mt=t.conditionCountForNotificationThreshold||3,this.Pt=Math.max(500,t.monitoringInterval||4e3),this.Dt=Math.max(500,t.conditionMonitoringInterval||1500),this.Ut=!Object.prototype.hasOwnProperty.call(t,"monitorFrameRate")||t.monitorFrameRate,this.At=!Object.prototype.hasOwnProperty.call(t,"monitorBitRate")||t.monitorBitRate,this.Ot=!Object.prototype.hasOwnProperty.call(t,"monitorState")||t.monitorState,this.qt=[],this.Ft=new s.Event,"Edge"===k.browser&&(n=this.Dt*this.Mt,this.Pt=Math.max(this.Pt,6e3),this.Dt=Math.max(this.Dt,6e3),this.Mt=Math.max(Math.ceil(n/this.Pt),2),this.a.info("Using modified options for optimal monitoring of PeerConnection on [Edge]. Monitor Interval [%s], Condition Monitor Interval [%s], Condition Count For Notification [%s]",this.Pt,this.Dt,this.Mt)),function(h,l,d,f,m){var p=this,g=0,v=void 0,y=void 0,b=void 0;setTimeout(function c(){!function(t,e,i,n,r,s){if(!n())return this.a.info("[%s] Finished monitoring of peer connection",this.Rt);var o=this;k.getStats(t,null,function(t){t=a.convertPeerConnectionStats(t,o.St),t=w.filter(t,function(t){return"inbound"===e.direction&&"download"===t.direction||"outbound"===e.direction&&"upload"===t.direction}),r(t)},function(t){s(t)})}.call(p,l,d,null,f,function(t){var e=!1,i=!1,n=!1;if(!f())return p.a.info("[%s] Finished monitoring of peer connection",h);if(!t)throw new Error("Report must be a valid PeerConnection.getStats Report");if(w.forEach(t,function(t){if("outbound"===d.direction&&"upload"===t.direction)switch(t.mediaType){case"video":p.a.debug("[%s] [%s] [%s] [%s] with RTT [%s], bitrate [%s], dropped frames [%s], frame rate [%s] and average encoding time [%s] ms (CPU limited=[%s])",h,d.direction,t.mediaType,t.ssrc,t.rtt,t.bitrateMean,t.droppedFrames,t.framerateMean,t.avgEncode,t.cpuLimitedResolution),v=t.framerateMean,y=t.uploadRate&&1e3*t.uploadRate,i=e=!0,d.setNetworkRTT&&d.setNetworkRTT(t.rtt),"Edge"===k.browser&&(e=!1);break;case"audio":p.a.debug("[%s] [%s] [%s] [%s] with RTT [%s], jitter [%s] and audio input level [%s]",h,d.direction,t.mediaType,t.ssrc,t.rtt,t.jitter,t.audioInputLevel),n=!0,b=t.uploadRate&&1e3*t.uploadRate,d.setNetworkRTT&&d.setNetworkRTT(t.rtt)}if("inbound"===d.direction&&"download"===t.direction)switch(t.mediaType){case"video":p.a.debug("[%s] [%s] [%s] [%s] with framerate [%s], current delay [%s] ms and target delay [%s] ms",h,d.direction,t.mediaType,t.ssrc,t.framerateMean,t.currentDelay,t.targetDelay),e=!0,v=t.framerateMean||0,i=!0,y=t.downloadRate&&1e3*t.downloadRate,"Edge"===k.browser&&(e=!1);break;case"audio":p.a.debug("[%s] [%s] [%s] [%s] with jitter [%s], jitter buffer [%s] ms, audio output level [%s], total audio energy [%s] and total samples duration [%s]",h,d.direction,t.mediaType,t.ssrc,t.jitter,t.jitterBuffer,t.audioOutputLevel,t.totalAudioEnergy,t.totalSamplesDuration),n=!0,b=t.downloadRate&&1e3*t.downloadRate}}),w.isUndefined(b)&&w.isUndefined(y))return setTimeout(c,p.Pt);var r=S.hasActiveAudio(l),s=S.hasActiveVideo(l);(i&&0===y||n&&0===b||e&&0===v)&&(i=i&&s,n=n&&r,e=e&&s),(n||i||e)&&(p.a.debug("[%s] [%s] Current bit rate is [%s] bps for audio and [%s] bps for video with [%s] FPS",h,d.direction,Math.ceil(b||0),Math.ceil(y||0),v||"?"),0<w.values(p.St).length&&p.Ft.fire([{videoBitRate:y,audioBitRate:b,frameRate:v}]));var o=[];if(p.Ot&&("closed"===l.connectionState||"disconnected"===l.connectionState||"failed"===l.connectionState||"disconnected"===l.iceConnectionState||"failed"===l.iceConnectionState)){var a=r&&s,u=I.call(p,l);if(!a&&S.hasMediaSectionsInLocalSdp(l))return void p.a.info("[%s] [%s] Finished monitoring of peer connection with [%s] inactive tracks",h,d.direction,u.length);o.push("connection")}u=("outbound"===d.direction?R:T).call(this,l),p.Ut&&e&&v<=p.Ct&&!q.call(p,"video",u)&&o.push("frameRate"),p.At&&n&&b<=p.xt&&!q.call(p,"audio",u)&&o.push("audioBitRate"),p.At&&i&&y<=p.Et&&!q.call(p,"video",u)&&o.push("videoBitRate"),0===y&&s&&!q.call(p,"video",u)&&o.push("noVideoData"),0===b&&r&&!q.call(p,"audio",u)&&o.push("noAudioData"),r=function(){p.a.info("[%s] [%s] Failure has been acknowledged",h,d.direction),g=Number.MIN_VALUE,setTimeout(c,p.Pt)},0<o.length?g++:g=0,g>=p.Mt?(u="["+h+"] ["+d.direction+"] Failure detected with frame rate ["+v+"] FPS, audio bit rate ["+b+"] bps, video bit rate ["+y+"] bps, connection state ["+l.connectionState+"], and ice connection state ["+l.iceConnectionState+"] after ["+g+"] checks",m(null,{type:"condition",reasons:o,message:u,report:t,frameRate:v,videoBitRate:y,audioBitRate:b,acknowledgeFailure:r})?r():p.a.info(u+": [%s]",t)):setTimeout(c,0<g?p.Dt:p.Pt)},function(t){m(t,{type:"error",message:"Unable to get Connection statistics. Connection may have failed."})})},p.Pt)}.call(this,this.Rt,this.Tt,t,e,i);this.a.info("[%s] Monitoring is disabled",name)},t.prototype.setMonitorTrackState=function(e,t){r.e(e,"track"),r.L(t,"state");try{var i=I.call(this,this.Tt);if(!w.find(i,function(t){return t.id===e.id}))return this.a.warn("[%s] Unable to find track [%s] [%s] in peer connection",this.Rt,e.kind,e.id)}catch(t){"Firefox"===k.browser&&"InvalidStateError: Peer connection is closed"===t.message?this.a.debug("Failed to verify monitor track due to closed peer connection"):this.a.warn("Failed to verify monitor track due to [%s]",t.message)}if(!t)return this.a.info("[%s] Pausing monitoring of track [%s] [%s]",this.Rt,e.kind,e.id),this.qt.push(e);t=this.qt.length,this.qt=w.filter(this.qt,function(t){return t.id!==e.id}),t!==this.qt.length&&this.a.info("[%s] Starting monitoring of track [%s] [%s] after it was paused",this.Rt,e.kind,e.id)},t.prototype.on=function(t,e){if(r.S(t,"eventName"),r.b(e,"listener"),"calculatedmetrics"!==t)throw new Error("Unsupported event "+t);return this.Ft.listen(e)},t.prototype.toString=function(){return"PeerConnectionMonitor["+this.Rt+"]"},t}.apply(e,i))||(t.exports=i)},function(t,e,i){i=[i(0),i(1)];void 0===(i=function(s,o){"use strict";var a=/profile-level-id=[^;\n]*/,i=/vp8/i,n=/vp9/i,r=/h264/i,u=/h265/i;function t(){}return t.prototype.getH264ProfileIds=function(t){o.S(t,"offerSdp");for(var e=[],i=t.match(a),n=t;i;){var r=s.get(i,"0","");e.push(r.split("=")[1]),i=(n=n.substring(i.index+r.length,t.length)).match(a)}return e},t.prototype.replaceH264ProfileId=function(t,e,i){o.S(t,"offerSdp"),o.S(i,"newProfileId");var n=this.getH264ProfileIds(t);return s.includes(n,e)?t.replace("profile-level-id="+e,"profile-level-id="+i):t},t.prototype.getH264ProfileIdWithSameProfileAndEqualToOrHigherLevel=function(t,e){return s.includes(t,e)?e:(t=s.reduce(t,function(t,e){var i=parseInt(t.substring(0,2),16),n=parseInt(t.substring(4,6),16),r=parseInt(e.substring(0,2),16),s=parseInt(e.substring(4,6),16);return i!==r||s<=n?t:e},e))===e?null:t},t.prototype.getH264ProfileIdWithSameOrHigherProfileAndEqualToOrHigherLevel=function(t,e){var i=this.getH264ProfileIdWithSameProfileAndEqualToOrHigherLevel(t,e);return i||((t=s.reduce(t,function(t,e){var i=parseInt(t.substring(0,2),16),n=parseInt(t.substring(4,6),16),r=parseInt(e.substring(0,2),16),s=parseInt(e.substring(4,6),16);return i<r||!(r<i||s<n)?e:t},e))===e?null:t)},t.prototype.getSupportedCodecs=function(t){o.S(t,"offerSdp");var e=[];return i.test(t)&&e.push("VP8"),n.test(t)&&e.push("VP9"),r.test(t)&&e.push("H264"),u.test(t)&&e.push("H265"),e},t.prototype.hasMediaSectionsInLocalSdp=function(t){return this.findInSdpSections(t,function(t){return s.startsWith(t,"video")||s.startsWith(t,"audio")})<0},t.prototype.hasActiveAudio=function(t){return this.findInSdpSections(t,function(t,e,i){return!!s.startsWith(t,"audio")&&!s.includes(t,"a=inactive")&&!s.includes(i[e],"a=inactive")})<0},t.prototype.hasActiveVideo=function(t){return this.findInSdpSections(t,function(t,e,i){return!!s.startsWith(t,"video")&&!s.includes(t,"a=inactive")&&!s.includes(i[e],"a=inactive")})<0},t.prototype.findInSdpSections=function(t,i){var e=this.getLocalSdp(t).split("m="),n=this.getRemoteSdp(t).split("m=");return e.length===n.length&&s.findIndex(e,function(t,e){return i(t,e,n)})},t.prototype.getNumberOfActiveSections=function(t){return t=(this.getLocalSdp(t)||this.getRemoteSdp(t)).split("m="),s.filter(t,function(t){return!s.includes(t,"a=inactive")&&(s.startsWith(t,"audio")||s.startsWith(t,"video"))}).length},t.prototype.getLocalSdp=function(t){return s.get(t,["localDescription","sdp"],"")},t.prototype.getRemoteSdp=function(t){return s.get(t,["remoteDescription","sdp"],"")},t.prototype.setGroupLineOrderToMatchMediaSectionOrder=function(i){var t=i.match(/(?=a=group:BUNDLE).*/),e=s.get(s.get(t,[0],"").split("a=group:BUNDLE "),[1],"");return i=0<(t=e.split(" ").sort(function(t,e){return i.indexOf("m="+t)-i.indexOf("m="+e)})).length?i.replace(e,t.join(" ")):i},new t}.apply(e,i))||(t.exports=i)},function(t,e,i){i=[i(0),i(1),i(5),i(2),i(56),i(57),i(58),i(6)];void 0===(i=function(n,i,u,r,t,s,o,a){"use strict";function e(t,e,i,n,r,s,o,a){this.P=t,this.A=e,this.M=i,this.Lt=n,this.Nt=r,this.Bt=s,this.jt=o,this.a=a,this.Vt=[],this.Wt=null,this.zt=new u.NamedEvents}return e.prototype.on=function(t,e){this.zt.listen(t,e)},e.prototype.createRenderer=function(){var e=null;switch(this.P){case a.types.dash.name:if(this.jt)e=new s(this.A,this.M,this.Lt,this.Nt,this.jt,this.a);else if(this.Bt){if(!this.Bt.Player.isBrowserSupported())throw this.a.warn("[%s] Shaka does not support this browser",this.A),new Error("Shaka does not support this browser");e=new t(this.A,this.M,this.Lt,this.Nt,this.Bt,this.a)}break;case a.types.hls.name:e=new s(this.A,this.M,this.Lt,this.Nt,this.jt,this.a);break;case a.types.rtmp.name:e=new o(this.A,this.M,this.Lt,this.Nt,this.a);break;default:throw new Error("Unsupported Live stream Type "+this.P)}var i=this;return e.on(a.rendererEvents.error.name,function(t,e){i.zt.fire(a.streamEvents.playerError.name,[t,e])}),e.on(a.rendererEvents.ended.name,function(t){i.Vt=n.filter(i.Vt,function(t){return t!==e}),0===i.Vt.length&&(i.Lt.stop(),i.zt.fire(a.streamEvents.playerEnded.name,[t]))}),this.Vt.push(e),e},e.prototype.select=function(t){return this.a.warn("[%s] selection of tracks not supported for [%s] live streams",this.A,this.P),this},e.prototype.setStreamEndedCallback=function(t){i.b(t,"callback"),this.streamEndedCallback=t},e.prototype.setStreamErrorCallback=function(t){i.b(t,"callback"),this.streamErrorCallback=t},e.prototype.stop=function(t){this.isActive()&&(this.a.info("[%s] stop [live] media stream with reason [%s]",this.A,t),this.zt.fire(a.streamEvents.stopped.name,[t]),this._t=!0)},e.prototype.monitor=function(t,e){i.e(t,"options"),i.b(e,"callback")},e.prototype.getMonitor=function(){return null},e.prototype.addBitRateThreshold=function(t,e){i.b(e,"callback")},e.prototype.getStream=function(){return this.a.debug("[%s] [%s] This type of stream has no internal stream object",this.A,this.P),null},e.prototype.isActive=function(){return!this._t},e.prototype.getStreamId=function(){return this.A},e.prototype.getStats=function(){return this.a.debug("[%s] [%s] This type of stream has no stats",this.A,this.P),null},e.prototype.getRenderer=function(){return n.get(this.Vt,[0],null)},e.canPlaybackType=function(t){var e=!!r.global.MediaSource,i=e||"object"==typeof document&&"maybe"===document.createElement("video").canPlayType("application/vnd.apple.mpegURL");switch(t){case a.types.dash.name:return e;case a.types.hls.name:return i;case a.types.rtmp.name:return o.isSupported();default:return!1}},e}.apply(e,i))||(t.exports=i)},function(t,e,i){i=[i(0),i(1)];void 0===(i=function(f,n){"use strict";function t(t,e,i){n.S(t,"name"),n.e(e,"monitor"),n.b(i,"getLimit"),this.Rt=t,this.Ht=e,this.Gt=i||f.noop}return t.prototype.addThreshold=function(t,c){var h=function(t){var e=[];if(f.isArray(t))f.forEach(t,function(t){n.C(t,"threshold")}),e=t.sort();else if(f.e(t)){n.C(t.levels,"threshold.levels");for(var i=0;i<t.levels;i++)e.push(i/t.levels)}else n.C(t,"threshold"),e.push(t);return e.push(3),e}(t),l=null,d=this;return d.Ht.on("calculatedmetrics",function(t){var n,r,e=d.Gt(),i=t.videoBitRate+t.audioBitRate,s=(r=i/e,f.reduce(n=h,function(t,e,i){return null===t&&r<=e||e<n[t]&&r<=e?i:t},null)),o=f.get(h,[s]),a=o*e,u=f.get(h,[l],1),t=u*e;if(0!==e)return null===l?l=s:void(s!==l&&(s<l?c({isIncreasing:!1,bitRate:i,currentThreshold:a,targetBitRate:e,index:s,lastIndex:l,message:d.Rt+" bit rate is below "+o+" * "+e+" threshold of "+a+" with a bit rate of "+i}):l<s&&c({isIncreasing:!0,bitRate:i,currentThreshold:t,targetBitRate:e,index:s,lastIndex:l,message:d.Rt+" bit rate is above "+u+" * "+e+" threshold of "+t+" with a bit rate of "+i}),l=s))})},t}.apply(e,i))||(t.exports=i)},function(t,e){t.exports=f},function(t,e,i){i=[i(0),i(1),i(4),i(3),i(31),i(32),i(61),i(33),i(62),i(14),i(13)];void 0===(i=function(h,s,o,a,e,r,i,u,t,n,c){"use strict";var l=h.freeze({status:"not-in-room"}),d=h.freeze({status:"already-in-room"}),f=h.freeze({status:"in-another-room"});function m(t){this.Jt=new o.Observable(null),this.Kt=new o.Observable(null),this.Qt=new o.Observable(null),this.Xt=null,this.$t=new e(t),this.setPCast(t)}function p(){this.Jt.setValue(null),this.Kt.setValue(null),this.Qt.setValue(null),this.Xt=null,this.T&&this.T.dispose(),this.T=null}function g(t){s.e(t,"event"),s.x(t.roomId,"event.roomId"),s.x(t.eventType,"event.eventType"),s.isArray(t.members,"event.members"),h.forEach(t.members,function(t){s.e(t,"member")});var e=this;switch(t.eventType){case n.events.memberJoined.name:return e.a.debug("[%s] Member joined [%s]",t.roomId,t.members),function(t,e){var i,n=this.Kt.getValue(),r=this.Qt.getValue();n&&n.getRoomId()===t&&(n.Yt(e),n.Zt(e),r.Yt(e),r.Zt(e),i=this,r=h.find(e,function(t){return t.sessionId===i.getSelf().getSessionId()}),e=!1,r&&(e=C.call(i,n),n.te([r])),this.a.info("[%s] Room has now [%d] members (Self is present in room [%s])",t,n.getObservableMembers().getValue().length,e))}.call(e,t.roomId,t.members);case n.events.memberLeft.name:return e.a.debug("[%s] Member left [%s]",t.roomId,t.members),function(t,e){var i,n,r,s=this.Kt.getValue(),o=this.Qt.getValue();s&&s.getRoomId()===t&&(i=this,n=h.find(e,function(t){return t.sessionId===i.getSelf().getSessionId()}),(r=this.getSelf())&&n&&r.getObservableLastUpdate().setValue(n.lastUpdate),s.Yt(e),o.Yt(e),this.a.info("[%s] Room has now [%d] members",t,s.getObservableMembers().getValue().length))}.call(e,t.roomId,t.members);case n.events.memberUpdated.name:return e.a.debug("[%s] Member updated [%s]",t.roomId,t.members),function(t,e){var i,n=this.Kt.getValue(),r=this.Qt.getValue();n&&n.getRoomId()===t&&(i=function(t){var i=this;return h.map(t,function(t){var e=b(t.sessionId,i.Qt);return(e=S(new u(i,t.state,t.sessionId,t.screenName,t.role,t.streams,t.lastUpdate),e)).lastUpdate=t.lastUpdate,e})}.call(this,e),n.te(i),r.te(i),this.a.info("[%s] Room has [%d] updated members",t,e.length))}.call(e,t.roomId,t.members);case n.events.roomUpdated.name:return e.a.debug("[%s] Room updated [%s]",t.roomId,t.room),function(t,e){var i=this.Kt.getValue(),n=this.Qt.getValue();i&&i.getRoomId()===t&&(n.O(e),i.O(e))}.call(e,t.roomId,t.room);case n.events.roomEnded.name:e.a.info("[%s] Room ended",t.roomId);break;default:e.a.warn("Unsupported room event [%s]",t.eventType)}}function v(t){this.getSelf()&&this.getSelf().getSessionId()===(t||"")?this.a.info("[%s] Skip session ID change since it is the same as in self model",t):function(t){var e=this.Jt.getValue().toJson();this.a.info("Resetting self after sessionId changed to [%s]",t),this.Jt.setValue(new u(this,e.state,t||"",e.screenName,e.role,e.streams,e.lastUpdate))}.call(this,t)}function y(t){var i,n=this;t&&(!t.getSessionId()||(i=n.Kt.getValue())&&(n.a.info("[%s] Updating self in room after update",i.getRoomId()),R.call(this,this.getSelf(),function(t,e){"ok"===h.get(e,["status"])?n.a.info("[%s] Updated self in room after update",i.getRoomId()):n.a.info("[%s] Self was not updated in room after update",i.getRoomId())})))}function b(t,e){var e=e.getValue().getObservableMembers().getValue(),i=t;return h.find(e,function(t){return i===t.getSessionId()})}function w(t){this.a.info("PCast status changed from [%s] to [%s]",this.ee,t),"online"===(this.ee=t)&&function(){var t,e,i,n=this,r=n.Kt.getValue();!h.e(r)||(t=n.Jt.getValue())&&t.getSessionId()&&(e=r.getRoomId(),i=r.getObservableAlias().getValue(),n.a.info("[%s] Re-entering room [%s]",e,i),n.Xt&&(n.a.info("Performing soft reset on room chat service for room [%s]",e),n.Xt.stop()),I.call(n,e,i,function(){n.Xt&&(n.a.info("[%s] Refreshing room chat service after re-entering room [%s]",e,i),n.Xt.start(n.Xt.getBatchSize())),n.a.info("[%s] Room [%s] completed reset",e,i)},{reenter:!0}))}.call(this)}function k(){var t=this.ot.onEvent("chat.RoomEvent",h.bind(g,this)),e=this.Jt.subscribe(h.bind(y,this)),i=this.$t.getObservableStatus().subscribe(h.bind(w,this)),n=this.$t.getObservableSessionId().subscribe(h.bind(v,this));this.T.add(t),this.T.add(e),this.T.add(i),this.T.add(n)}function S(t,e){var i=function(t,e){if(!e)return t.toJson();var i={},n=t.toJson(),e=e.toJson(),e=h.findDifferences(n,e,!0);return h.forEach(e,function(t){i[t]=n[t]}),i}(t,e);return i.sessionId=t.getSessionId(),i.lastUpdate=e?e.getLastUpdate():h.now(),i}function I(i,n,r,t){var e=!0===h.get(t,"reenter"),s=this.Kt.getValue();if(s&&((a=i===s.getRoomId()||n===s.getObservableAlias().getValue())&&!e))return this.a.info("Unable to join room. Already in [%s]/[%s] room.",s.getRoomId(),s.getObservableAlias().getValue()),r(null,h.assign({room:s},a?d:f));this.$t.assertAuthorized();var o=(u=this.Jt.getValue()).getObservableScreenName().getValue(),t=u.getObservableRole().getValue(),s=S.call(this,u,null),a=[],u=h.now();e&&a.push("reenter"),this.a.info("Enter room [%s]/[%s] with screen name [%s] and role [%s]",i,n,o,t);var c=this;c.ie?c.a.info("[%s] We are already entering the room [%s], skipping",i,n):(c.ie=!0,this.ot.enterRoom(i,n,s,a,u,function(t,e){return c.ie=!1,t?(c.a.error("Joining of room failed with error [%s]",t),r(t,null)):(t={status:e.status},"ok"!==e.status?(c.a.warn("Joining of room failed with status [%s]",e.status),r(null,t)):(t.room=function(t){var e=this.Kt.getValue(),i=this.Qt.getValue(),n=q.call(this,t),r=q.call(this,t);return C.call(this,n),e&&i?(this.a.debug("[%s] Updating existing room model.",e.getRoomId()),e.O(t.room),i.O(t.room),e.getObservableMembers().setValue(n.getObservableMembers().getValue()),i.getObservableMembers().setValue(r.getObservableMembers().getValue()),e):(this.Kt.setValue(n),this.Qt.setValue(r),n)}.call(c,e),"ok"===e.status&&e.self&&c.getSelf().O(e.self),c.a.info("Successfully entered room [%s]/[%s]",i,n),void r(null,t)))}))}function R(t,i){if(!this.Kt.getValue())return this.a.warn("Not in a room. Please Enter a room before updating member."),i(null,l);this.$t.assertAuthorized();var e=this.Kt.getValue().getRoomId(),n=t.getSessionId()===this.getSelf().getSessionId(),r=b(t.getSessionId(),this.Qt),s=S.call(this,t,r),o=h.now(),a=n&&s.role===c.roles.audience.name;n&&!r&&(s.lastUpdate=t.getObservableLastUpdate().getValue()),this.a.info("Updating member info [%s] for active room [%s]",s,e);var u=this;this.ot.updateMember(e,s,o,function(t,e){return t?(u.a.error("Update of member failed with error [%s]",t),i(t,null)):(t={status:e.status,lastUpdate:e.lastUpdate},"ok"!==e.status&&u.a.info("Update of member failed with status [%s]",e.status),"ok"===e.status&&a&&h.C(e.lastUpdate)&&u.getSelf().getObservableLastUpdate().setValue(e.lastUpdate),void i(null,t))})}function T(t){var e=t.room,t=t.members||[];return new i(this,e.roomId,e.alias,e.name,e.description,e.type,t,e.bridgeId,e.pin)}function q(t){var e=t.room,t=t.members;return new r(this,e.roomId,e.alias,e.name,e.description,e.type,t,e.bridgeId,e.pin)}function C(t){var e=this.Jt.getValue(),i=t.getObservableMembers().getValue(),n=h.findIndex(i,function(t){return e.getSessionId()===t.getSessionId()});return n<0?(this.a.debug("Self not in server room model."),!1):(e.O(i[n].toJson()),i[n]=e,t.getObservableMembers().setValue(i),!0)}return m.prototype.setPCast=function(t){s.e(t,"pcast"),s.b(t.getLogger,"pcast.getLogger"),s.b(t.getProtocol,"pcast.getProtocol"),this.ne&&this.a.info("Resetting pcast instance for room service"),this.ne=t,this.a=t.getLogger(),this.ot=t.getProtocol(),s.e(this.a,"this._logger"),s.e(this.ot,"this._protocol"),this.$t.setPCast(t),this.Xt&&this.Xt.setPCast(t),this.gt&&(this.T.dispose(),k.call(this))},m.prototype.start=function(t,e){if(!this.gt){s.S(t,"role"),s.S(e,"screenName");var i=c.states.passive.name,n=this.$t.getPCastSessionId(),r=e,e=h.now(),e=new u(this,i,n,r,t,[],e);return this.Jt=new o.Observable(e),this.T=new a.DisposableList,k.call(this),this.gt=!0,e}this.a.warn("RoomService already started.")},m.prototype.getRoomInfo=function(t,e,i){t?s.S(t,"roomId"):s.S(e,"alias"),s.b(i,"callback"),function(t,e,i){this.$t.assertAuthorized();var n=this;this.ot.getRoomInfo(t,e,function(t,e){return t?(n.a.error("Request to get room info failed with error [%s]",t),i(t,null)):(t={status:e.status},"ok"!==e.status?(n.a.warn("Request to get room info failed with status [%s]",e.status),i(null,t)):(t.room=h.freeze(T.call(n,e)),void i(null,t)))})}.call(this,t,e,i)},m.prototype.createRoom=function(t,e){s.e(t,"room"),s.S(t.name,"room.name"),s.S(t.type,"room.type"),s.x(t.description,"room.description"),s.b(e,"callback"),function(t,i){this.$t.assertAuthorized();var n=this,t=function(t){return new r(this,"",t.alias,t.name,t.description,t.type,[],t.bridgeId,t.pin).toJson()}.call(n,t);this.ot.createRoom(t,function(t,e){return t?(n.a.error("Creating room failed with error [%s]",t),i(t,null)):(t={status:e.status},"ok"!==e.status&&"already-exists"!==e.status?(n.a.warn("Creating room failed with status [%s]",e.status),i(null,t)):(t.room=h.freeze(T.call(n,e)),void i(null,t)))})}.call(this,t,e)},m.prototype.enterRoom=function(t,e,i){t?s.S(t,"roomId"):s.S(e,"alias"),s.b(i,"callback"),I.call(this,t,e,i)},m.prototype.leaveRoom=function(t,e){return function(i,n){var t,r,e=this.Kt.getValue();if(h.L(n)||(n=!0),!e)return this.a.info("Not currently in a room."),i(null,l);""!==this.$t.getPCastSessionId()&&null!==this.$t.getPCastSessionId()?this.re||(this.$t.assertAuthorized(),t=e.getRoomId(),e=h.now(),this.a.info("Leave room [%s]",t),(r=this).re=!0,setTimeout(function(){r.Kt.setValue(null),r.Qt.setValue(null),n&&(r.re=!1,i(null,{status:"ok"}))}),this.ot.leaveRoom(t,e,function(t,e){return r.re=!1,t?(r.a.error("Leaving room failed with error [%s]",t),n?void 0:i(t,null)):("ok"!==e.status&&r.a.warn("Leaving room failed with status [%s]",e.status),n?void 0:i(null,{status:e.status}))})):this.a.warn("Unable to leave room. We are currently not connected. Status [%s]",this.ee)}.call(this,t,e)},m.prototype.getChatService=function(){return!this.Xt&&this.Kt.getValue()&&(this.Xt=new t(this)),this.Xt},m.prototype.getSelf=function(){return this.Jt.getValue()},m.prototype.getObservableActiveRoom=function(){return this.Kt},m.prototype.updateSelf=function(t){s.b(t,"callback"),R.call(this,this.getSelf(),t)},m.prototype.updateMember=function(t,e){s.b(e,"callback"),s.e(t,"member"),R.call(this,t,e)},m.prototype.updateRoom=function(t){s.b(t,"callback"),function(i){if(!this.Kt.getValue())return this.a.warn("Not in a room. Please Enter a room before updating member."),i(null,l);this.$t.assertAuthorized();var t=this.Kt.getValue(),e=h.now(),n=this;this.ot.updateRoom(t.toJson(),e,function(t,e){return t?(n.a.error("Update of room failed with error [%s]",t),i(t,null)):(t={status:e.status},"ok"!==e.status&&n.a.warn("Update of room failed with status [%s]",e.status),void i(null,t))})}.call(this,t)},m.prototype.revertRoomChanges=function(){var t=this.Kt.getValue(),e=this.Qt.getValue();if(!t||!e)return this.a.warn("Unable to revert changes to room. Not currently in a room.");t.O(e.toJson())},m.prototype.revertMemberChanges=function(t){s.e(t,"member");var e=b(t.getSessionId(),this.Qt),t=b(t.getSessionId(),this.Kt);if(!e||!t)return this.a.warn("Unable to revert changes to member. Member is currently not in room.");t.O(e.toJson())},m.prototype.isInRoom=function(){return!!this.Kt.getValue()},m.prototype.toString=function(){return"RoomService"},m.prototype.stop=function(t){var e=this.Kt.getValue(),i=this;if(this.a.info("Stopping room service with reason [%s]",t),e)return this.leaveRoom(function(t,e){t&&i.a.warn("Failure to stop room service. Unable to leave room",t),e&&"ok"!==e.status&&i.a.warn("Failure to stop room service. Unable to leave room. Status: [%s]",e.status),e&&"ok"===e.status&&(p.call(i),i.gt=!1)});p.call(this),i.gt=!1},m}.apply(e,i))||(t.exports=i)},function(t,e,i){i=[i(0),i(1)];void 0===(i=function(t,e){"use strict";function i(t){this.setPCast(t)}function n(t){return null!=t&&""!==t}function r(t){return null!=t&&""!==t&&"offline"!==t.toLowerCase()}return i.prototype.setPCast=function(t){e.e(t,"pcast"),e.b(t.getObservableStatus,"pcast.getObservableStatus"),e.b(t.getLogger,"pcast.getLogger"),e.b(t.getProtocol,"pcast.getProtocol"),t!==this.ne&&(this.ne=t,this.a=t.getLogger(),this.ot=t.getProtocol(),e.e(this.a,"this._logger"),e.e(this.ot,"this._protocol"),e.b(this.ot.getObservableSessionId,"this._protocol.getObservableSessionId"),e.b(this.ne.getObservableStatus,"this._pcast.getObservableStatus"),this.se=this.ot.getObservableSessionId(),this.oe=this.ne.getObservableStatus())},i.prototype.checkAuthorized=function(){return!!r(this.getPCastStatus())&&!!n(this.getPCastSessionId())},i.prototype.assertAuthorized=function(){if(!r(this.getPCastStatus()))throw new Error("Unable to perform action. Status ["+this.getPCastStatus()+"]. Please wait to reconnect.");if(!n(this.getPCastSessionId()))throw new Error("Unable to perform action. Invalid sessionId ["+this.getPCastSessionId()+"] with status ["+this.getPCastStatus()+"]")},i.prototype.getObservableSessionId=function(){return this.se},i.prototype.getObservableStatus=function(){return this.oe},i.prototype.getPCastSessionId=function(){return this.se.getValue()},i.prototype.getPCastStatus=function(){return this.oe.getValue()},i}.apply(e,i))||(t.exports=i)},function(t,e,i){i=[i(0),i(1),i(4),i(33),i(14)];void 0===(i=function(n,c,h,i,t){"use strict";var e=t.types;function r(t,e,i,n,r,s,o,a,u){this.init(t,e,i,n,r,s,o,a,u)}function l(t,e){return n.map(t,function(t){return new i(e,t.state,t.sessionId,t.screenName,t.role,t.streams,t.lastUpdate)})}function d(t){if(!(t=n.getEnumName(e,t)))throw new Error('"type" must be a valid room type');return t}return r.prototype.init=function(t,e,i,n,r,s,o,a,u){c.e(t,"roomService"),c.S(n,"name"),c.x(r,"description"),c.isArray(o,"members"),e&&c.S(e,"id"),i&&c.S(i,"alias"),a&&c.S(a,"bridgeId"),u&&c.S(u,"pin"),this.ae=new h.Observable(e),this.ue=new h.Observable(i),this.Rt=new h.Observable(n),this.ce=new h.Observable(r),this.P=new h.Observable(s,d),this.he=new h.ObservableArray([]).extend({method:"notifyWhenChangesStop",timeout:400}),this.Nt=new h.ObservableArray,this.le=new h.Observable(a),this.de=new h.Observable(u),this.fe=t,function(t){t=l(t,this.fe),this.he.setValue(t)}.call(this,o)},r.prototype.getRoomId=function(){return this.ae.getValue()},r.prototype.getObservableAlias=function(){return this.ue},r.prototype.getObservableName=function(){return this.Rt},r.prototype.getObservableDescription=function(){return this.ce},r.prototype.getObservableType=function(){return this.P},r.prototype.getObservableMembers=function(){return this.he},r.prototype.getObservableBridgeId=function(){return this.le},r.prototype.getObservablePin=function(){return this.de},r.prototype.toString=function(){return this.P.getValue()+"["+this.ae.getValue()+"]"},r.prototype.toJson=function(){return{roomId:this.ae.getValue(),alias:this.ue.getValue(),name:this.Rt.getValue(),description:this.ce.getValue(),type:this.P.getValue(),pin:this.de.getValue(),bridgeId:this.le.getValue()}},r.prototype.commitChanges=function(t){c.e(this.fe,"this._roomService"),this.fe.updateRoom(this,t)},r.prototype.reload=function(){c.e(this.fe,"this._roomService"),this.fe.revertRoomChanges(this)},r.prototype.O=function(t){n.e(t)&&(t.roomId&&this.ae.setValue(t.roomId),t.alias&&this.ue.setValue(t.alias),t.name&&this.Rt.setValue(t.name),t.description&&this.ce.setValue(t.description),t.type&&this.P.setValue(t.type),t.options&&this.Nt.setValue(t.options),t.bridgeId&&this.le.setValue(t.bridgeId),t.pin&&this.de.setValue(t.pin),t.members)},r.prototype.Zt=function(t){var e=this,t=l(t,this.fe);n.forEach(t,function(t){e.he.push(t)})},r.prototype.Yt=function(t){var i=this;n.forEach(t,function(e){i.he.remove(function(t){return e.sessionId===t.getSessionId()&&e.lastUpdate>=t.getObservableLastUpdate().getValue()})})},r.prototype.te=function(i){n.forEach(this.he.getValue(),function(e){var t=n.find(i,function(t){return e.getSessionId()===t.sessionId&&t.lastUpdate>e.getObservableLastUpdate().getValue()});t&&e.O(t)})},r}.apply(e,i))||(t.exports=i)},function(t,e,i){i=[i(0),i(1),i(4),i(19),i(13)];void 0===(i=function(a,u,c,s,t){"use strict";var e=t.roles,i=t.states;function n(t,e,i,n,r,s,o){this.init(t,e,i,n,r,s,o)}function o(t){return new s(t.uri,t.type,t.audioState,t.videoState)}function h(t){return u.w(t,e,"memberRole"),a.getEnumName(e,t)}function l(t){return u.w(t,i,"memberState"),a.getEnumName(i,t)}return n.prototype.init=function(t,e,i,n,r,s,o){u.e(t,"roomService"),u.x(i,"sessionId"),u.x(n,"screenName"),u.isArray(s,"streams"),u.C(a.utc(o),"lastUpdate"),this.se=new c.Observable(i),this.me=new c.Observable(n),this.pe=new c.ObservableArray([]),this.ge=new c.Observable(e,l).extend({rateLimit:500}),this.ve=new c.Observable(r,h),this.ye=new c.Observable(o,a.utc),this.fe=t,this.setStreams(s)},n.prototype.getObservableState=function(){return this.ge},n.prototype.getSessionId=function(){return this.se.getValue()},n.prototype.getObservableScreenName=function(){return this.me},n.prototype.getObservableRole=function(){return this.ve},n.prototype.getObservableStreams=function(){return this.pe},n.prototype.getObservableLastUpdate=function(){return this.ye},n.prototype.getLastUpdate=function(){return this.ye.getValue()},n.prototype.getStreams=function(){return a.map(this.pe.getValue(),function(t){return t.toJson()})},n.prototype.getRoomService=function(){return this.fe},n.prototype.commitChanges=function(t){u.e(this.fe,"this._roomService"),this.fe.updateMember(this,t)},n.prototype.reload=function(){u.e(this.fe,"this._roomService"),this.fe.revertMemberChanges(this)},n.prototype.setStreams=function(t){t=a.map(t,o),this.pe.setValue(t)},n.prototype.toString=function(){return this.getObservableRole().getValue()+"["+this.getObservableScreenName().getValue()+","+this.getSessionId()+"]"},n.prototype.toJson=function(){var e={sessionId:this.se.getValue(),screenName:this.me.getValue(),role:this.ve.getValue(),state:this.ge.getValue(),streams:[],lastUpdate:this.ye.getValue()};return a.forEach(this.pe.getValue(),function(t){e.streams.push(t.toJson())}),e},n.prototype.O=function(t){a.e(t)&&(Object.prototype.hasOwnProperty.call(t,"state")&&this.ge.setValue(t.state),Object.prototype.hasOwnProperty.call(t,"screenName")&&this.me.setValue(t.screenName),Object.prototype.hasOwnProperty.call(t,"role")&&this.ve.setValue(t.role),Object.prototype.hasOwnProperty.call(t,"lastUpdate")&&this.ye.setValue(t.lastUpdate),Object.prototype.hasOwnProperty.call(t,"streams")&&function(t){var e=this.pe.getValue(),i=[];a.forEach(t,function(n){var r=s.parsePCastStreamIdFromStreamUri(n.uri),t=a.find(e,function(t){var e=t.getUri()===n.uri,i=t.isPCastStream()&&t.getPCastStreamId()===r,i=e||i;return t.getType()===n.type&&i});t?t.O(n):t=o(n),i.push(t)}),this.pe.setValue(i)}.call(this,t.streams))},n}.apply(e,i))||(t.exports=i)},function(t,e,i){void 0===(e=function(){"use strict";return{states:{trackEnabled:{id:0,name:"TrackEnabled"},trackDisabled:{id:1,name:"TrackDisabled"},trackEnded:{id:2,name:"TrackEnded"}}}}.apply(e,[]))||(t.exports=e)},function(t,e,i){i=[i(0),i(1),i(2),i(70)];void 0===(i=function(p,s,g,o){"use strict";function t(t,e){s.e(t,"pcast"),e&&s.e(e,"options"),e&&e.screenShare&&s.b(e.screenShare,"options.screenShare"),this.ne=t,this.a=t.getLogger(),this.Nt=e||{},this.be=p.get(e,["onScreenShare"])}function v(a,u,c,h,l){var d=this.getVendorSpecificConstraints(a,u||{},c),f=!!d.video,m=this;this.ne.getUserMedia(d,function(t,e,i,n){if("ok"===e)return m.a.info("Acquired user media with constraints [%s]",d),l(null,{userMedia:i,options:{frameRate:f?c:null,resolution:f?p.get(u,["resolution"],null):null,aspectRatio:f?p.get(u,["aspectRatio"],null):null}});m.a.info("Failed to acquire user media with constraints [%s]",d);var r=u,s=c,o=(i=n).constraintName||i.constraint||"";if(n&&("ConstraintNotSatisfiedError"===n.name||"OverconstrainedError"===n.name||"OverconstrainedError"===n.constructor.name||"unavailable"===n.code&&"Edge"===g.browser))switch(o.toLowerCase()){case"width":case"height":if(!u||!h.canResolveNextResolution())break;return m.a.warn("Unable to get user media with constraint [%s] with height [%s] and width [%s]. Retrying with next closest resolution.",o,r.height,r.width),r=h.getNextResolution(u.height,u.aspectRatio),v.call(m,a,r,s,h,l);default:if(c)return m.a.warn("Unable to get user media with constraint [%s] and frame rate [%s]. Retrying without frame rate constraint.",o,c),v.call(m,a,r,s=null,h,l);if(!u||!h.canResolveNextResolution())break;return m.a.warn("Unable to get user media with constraint [%s] with height [%s] and width [%s]. Retrying with next closest resolution.",o,r.height,r.width),r=h.getNextResolution(u.height,u.aspectRatio),v.call(m,a,r,s,h,l)}return m.a.error("Unable to get user media with status [%s]",e,n),l(n)},function(t){var e,i,n,r,s,o=t;if(m.be&&"Chrome"===g.browser){var a,t=(e=t,i=p.get(e,["video","mandatory","chromeMediaSource"]),n=p.get(e,["audio","mandatory","chromeMediaSource"]),r=p.get(e,["video","mandatory","chromeMediaSourceId"]),s=p.get(e,["audio","mandatory","chromeMediaSourceId"]),e={},(i||s)&&(p.set(e,["screen","mediaSource"],i),p.set(e,["screen","mediaSourceId"],r)),(n||s)&&(p.set(e,["screenAudio","mediaSource"],n),p.set(e,["screenAudio","mediaSourceId"],s)),e);if((o=m.be(t)).resolution&&o.aspectRatio)switch(this.we){case"9x16":case"3x4":a={width:o.resolution,height:h.calculateLongerDimensionByAspectRatio(o.resolution,o.aspectRatio)};break;default:a={width:h.calculateLongerDimensionByAspectRatio(o.resolution,o.aspectRatio),height:o.resolution}}o=function(t,e,i){var n=this.getVendorSpecificConstraints(t,e,i);n.screen&&(n.video=n.screen,delete n.screen),n.screenAudio&&(n.audio=n.screenAudio,delete n.screenAudio);var r=p.get(n,["video","mandatory","mediaSource"]),t=p.get(n,["audio","mandatory","mediaSource"]),e=p.get(n,["video","mandatory","mediaSourceId"]),i=p.get(n,["audio","mandatory","mediaSourceId"]);return(r||e)&&(p.set(n,["video","mandatory","chromeMediaSource"],r),p.set(n,["video","mandatory","chromeMediaSourceId"],e),delete n.video.mandatory.mediaSource,delete n.video.mandatory.mediaSourceId),(t||i)&&(p.set(n,["audio","mandatory","chromeMediaSource"],t),p.set(n,["audio","mandatory","chromeMediaSourceId"],i),delete n.audio.mandatory.mediaSource,delete n.audio.mandatory.mediaSourceId),n}.call(m,t,a,o.frameRate)}return o})}return t.prototype.getUserMedia=function(t,e){s.e(t,"deviceOptions");var i=new o(this.Nt),n=i.getDefaultResolution(),r=i.getDefaultFrameRate();v.call(this,t,n,r,i,e)},t.prototype.getVendorSpecificConstraints=function(t,e,i){if(e=e||{},!t||!t.audio&&!t.video&&!t.screen&&!t.screenAudio)throw new Error("Invalid device options. Must pass in at least one device option.");return("Firefox"===g.browser&&38<g.browserVersion||"Chrome"===g.browser&&52<g.browserVersion&&!t.screen&&!t.screenAudio||"Safari"===g.browser&&10<g.browserVersion||"Opera"===g.browser&&40<g.browserVersion?function(t,e,i){var n=t.video,r=t.audio,s=t.screen,o=t.screenAudio,a=e.width,t=e.height,e={};return n&&(e.video={height:{min:t,ideal:t,max:t},width:{min:a,ideal:a,max:a},frameRate:{ideal:i,max:i}},n.deviceId&&(e.video.deviceId={exact:n.deviceId}),n.facingMode&&(e.video.facingMode=n.facingMode),a||delete e.video.width,t||delete e.video.height,i||delete e.video.frameRate,a||t||i||n.deviceId||n.facingMode||(e.video=!0)),r&&(e.audio={},r.deviceId&&(e.audio.deviceId={exact:r.deviceId}),r.mediaSource&&(e.audio.mediaSource=r.mediaSource),r.mediaSourceId&&(e.audio.mediaSourceId=r.mediaSourceId),r.deviceId||r.mediaSource||r.mediaSourceId||(e.audio=!0)),o&&(e.screenAudio={},o.deviceId&&(e.screenAudio.deviceId={exact:o.deviceId}),o.mediaSource&&(e.screenAudio.mediaSource=o.mediaSource),o.mediaSourceId&&(e.screenAudio.mediaSourceId=o.mediaSourceId),o.deviceId||o.mediaSource||o.mediaSourceId||(e.screenAudio=!0)),s&&(e.screen={height:{min:t,ideal:t,max:t},width:{min:a,ideal:a,max:a},frameRate:{ideal:i,max:i}},a||delete e.screen.width,t||delete e.screen.height,i||delete e.screen.frameRate,s.mediaSource&&(e.screen.mediaSource=s.mediaSource),a||t||i||s.mediaSource||(e.screen=!0)),s&&n&&(e.screen=!0),e}:"Edge"===g.browser?function(t,e,i){var n=t.video,r=t.audio,s=t.screen,o=e.width,t=e.height,e={};return n&&(e.video={height:{min:t,max:t,exact:t},width:{min:o,max:o,exact:o},frameRate:i},n.deviceId&&(e.video.deviceId=n.deviceId),n.facingMode&&(e.video.facingMode=n.facingMode),o||delete e.video.width,t||delete e.video.height,i||delete e.video.frameRate,o||t||i||n.deviceId||n.facingMode||(e.video=!0)),r&&(e.audio=!0,r.deviceId&&(e.audio={deviceId:r.deviceId})),s&&(e.screen=!0),e}:function(t,e,i){var n=t.video,r=t.audio,s=t.screen,o=t.screenAudio,a=e.width,t=e.height,e={};return n&&(e.video={mandatory:{minHeight:t,maxHeight:t,minWidth:a,maxWidth:a,maxFrameRate:i}},n.deviceId&&(e.video.mandatory.sourceId=n.deviceId),n.facingMode&&(e.video.facingMode=n.facingMode),n.mediaSource&&(e.video.mandatory.mediaSource=n.mediaSource),n.mediaSourceId&&(e.video.mandatory.mediaSourceId=n.mediaSourceId),a||(delete e.video.mandatory.minWidth,delete e.video.mandatory.maxWidth),t||(delete e.video.mandatory.minHeight,delete e.video.mandatory.maxHeight),i||delete e.video.mandatory.maxFrameRate,a||t||i||n.deviceId||n.facingMode||n.mediaSource||n.mediaSourceId||(e.video=!0)),r&&(e.audio={mandatory:{}},r.deviceId&&(e.audio.mandatory.sourceId=r.deviceId),r.mediaSource&&(e.audio.mandatory.mediaSource=r.mediaSource),r.mediaSourceId&&(e.audio.mandatory.mediaSourceId=r.mediaSourceId),r.deviceId||r.mediaSource||r.mediaSourceId||(e.audio=!0)),o&&(e.screenAudio={mandatory:{}},o.deviceId&&(e.screenAudio.mandatory.sourceId=o.deviceId),o.mediaSource&&(e.screenAudio.mandatory.mediaSource=o.mediaSource),o.mediaSourceId&&(e.screenAudio.mandatory.mediaSourceId=o.mediaSourceId),o.deviceId||o.mediaSource||o.mediaSourceId||(e.screenAudio=!0)),s&&(e.screen={mandatory:{minHeight:t,maxHeight:t,minWidth:a,maxWidth:a,maxFrameRate:i}},a||(delete e.screen.mandatory.minWidth,delete e.screen.mandatory.maxWidth),t||(delete e.screen.mandatory.minHeight,delete e.screen.mandatory.maxHeight),i||delete e.screen.mandatory.maxFrameRate,s.mediaSource&&(e.screen.mandatory.mediaSource=s.mediaSource),s.mediaSourceId&&(e.screen.mandatory.mediaSourceId=s.mediaSourceId),a||t||i||s.mediaSource||(e.screen=!0)),s&&n&&(e.screen=!0),e})(t,e,i)},t}.apply(e,i))||(t.exports=i)},function(t,e,i){i=[i(0),i(1),i(4),i(37),i(35),i(21),i(2),i(71)];void 0===(i=function(f,m,e,t,r,n,p,d){"use strict";var i=0,g="unauthorized",u=1e3,s=500,o={maxOfflineTime:18e4,maxReconnectFrequency:6e4};function a(t){if(m.e(t,"options"),t.authToken&&m.S(t.authToken,"options.authToken"),t.authToken&&t.adminApiProxyClient)throw new Error('Do not pass "options.adminApiProxyClient" if you are using "options.authToken"');if(t.onError&&m.b(t.onError,"options.onError"),!f.isNullOrUndefined(t.onlineTimeout)&&(m.C(t.onlineTimeout,"options.onlineTimeout"),t.onlineTimeout<0))throw new Error('"options.onlineTimeout" must be a positive number');t.reconnectOptions&&(m.e(t.reconnectOptions,"options.reconnectOptions"),m.C(t.reconnectOptions.maxOfflineTime,"options.reconnectOptions.maxOfflineTime"),m.C(t.reconnectOptions.maxReconnectFrequency,"options.reconnectOptions.maxReconnectFrequency")),t.adminApiProxyClient&&(m.e(t.adminApiProxyClient,"options.adminApiProxyClient"),m.b(t.adminApiProxyClient.createAuthenticationToken,"options.adminApiProxyClient.createAuthenticationToken")),this.ke=++i,this.Se=new e.Observable(null).extend({rateLimit:0}),this.Ie=new e.Observable(null).extend({rateLimit:0}),this.lt={},this.Re=t.adminApiProxyClient,this.Te=!1,this.qe=0,this.Ce=0,this.Ee=!1,this.at=t.authToken,this.xe=t.onError,this.Nt=t,this.Me=f.C(t.onlineTimeout)?t.onlineTimeout:2e4,this.Pe=t.reconnectOptions||o,this.a=null,this.De={},h.call(this),t.adminApiProxyClient||((t.backendUri||f.x(t.backendUri))&&this.a.warn("Passing options.backendUri is deprecated. Please create an instance of the sdk.net.AdminApiProxyClient and pass that instead"),t.authenticationData&&this.a.warn("Passing options.authenticationData is deprecated. Please create an instance of the sdk.net.AdminApiProxyClient and pass that instead"))}a.prototype.toString=function(){return"PCastExpress["+this.ke+"]"},a.prototype.dispose=function(){this.Ue&&(this.Ue.dispose(),this.Ue=null),this.Se.getValue()&&(this.Se.getValue().stop(),this.Se.setValue(null)),this.Ie.getValue()&&this.Ie.setValue(null),f.C(this.Ae)&&(clearTimeout(this.Ae),this.Ae=null),this.Re&&this.Re.dispose(),this.sessionIdSubscription&&this.sessionIdSubscription.dispose(),this.Ie&&this.Ie.dispose&&this.Ie.dispose(),this.qe=0,this.Ce=0,this.Ee=!0,this.a.info("[%s] Disposed PCast Express instance",this)},a.prototype.getPCast=function(){return this.Se.getValue()},a.prototype.getPCastObservable=function(){return this.Se},a.prototype.getSessionIdObservable=function(){return this.Ie},a.prototype.getAdminAPI=function(){return this.Re},a.prototype.getUserMedia=function(e,i){var n=this;if(m.e(e.mediaConstraints,"options.mediaConstraints"),m.b(i,"callback"),e.resolution&&m.C(e.resolution,"options.resolution"),e.frameRate&&m.C(e.frameRate,"options.frameRate"),e.aspectRatio&&m.S(e.aspectRatio,"options.aspectRatio"),e.onResolveMedia&&m.b(e.onResolveMedia,"options.onResolveMedia"),e.onScreenShare&&m.b(e.onScreenShare,"options.onScreenShare"),n.Se.getValue())return w.call(n,n.Se.getValue(),e,i);var r=n.Se.subscribe(function(t){t&&(r.dispose(),w.call(n,t,e,i))})},a.prototype.publish=function(i,n){if(m.e(i,"options"),m.b(n,"callback"),i.capabilities&&m.isArray(i.capabilities,"options.capabilities"),i.connectOptions&&m.isArray(i.connectOptions,"options.connectOptions"),i.mediaConstraints?m.e(i.mediaConstraints,"options.mediaConstraints"):m.e(i.userMediaStream,"options.userMediaStream"),i.videoElement&&m.e(i.videoElement,"options.videoElement"),i.monitor&&(m.e(i.monitor,"options.monitor"),m.b(i.monitor.callback,"options.monitor.callback"),i.monitor.options&&m.e(i.monitor.options,"options.monitor.options")),i.publishToken&&m.S(i.publishToken,"options.publishToken"),i.streamToken&&m.S(i.streamToken,"options.streamToken"),i.publishToken&&i.streamToken)throw new Error("Do not pass streamToken with publishToken. Please use publishToken.");var r=this;this.waitForOnline(function(t){return t?n(t):i.userMediaStream?k.call(r,i.userMediaStream,i,!1,n):void r.getUserMedia(i,function(t,e){return t?n(t):"ok"!==e.status?n(null,e):void k.call(r,e.userMedia,i,!0,n)})},i.isContinuation)};var c=["streaming","low-latency","on-demand","uld","vvld","vld","ld","sd","hd","fhd","uhd"];function h(){var t,i=this;if(this.Se.getValue()||(t=f.assign({logger:this.a},this.Nt),this.Se.setValue(new n(t))),this.a||(this.a=this.Se.getValue().getLogger()),this.Oe||(this.Oe=this.Se.getValue().getObservableStatus().subscribe(f.bind(l,this))),this.sessionIdSubscription&&this.sessionIdSubscription.dispose(),this.sessionIdSubscription=this.Se.getValue().getObservableSessionId().subscribe(f.bind(function(t){this.Ie.setValue(t)},this)),this.at)return this.Se.getValue().start(this.at,function(t,e){if("critical-network-issue"===e)return l.call(i,e)},f.noop,f.noop);if(!this.at&&!i.Re)throw new Error("Use auth token, or set adminApiProxyClient");this.Re.createAuthenticationToken(function(t,e){return t&&"timeout"===t.message?l.call(i,t.message):t?b.call(i,t):"ok"!==e.status?l.call(i,e.status):void(i.Se.getValue()?i.Se.getValue().start(e.authenticationToken,f.noop,f.noop,f.noop):i.a.warn("[%s] Unable to authenticate. PCast not instantiated.",this))})}function l(t){switch(t){case"timeout":case"critical-network-issue":return this.Se.getValue()&&(this.Se.getValue().stop("recovery"),this.Se.setValue(null)),this.Ie.getValue()&&this.Ie.setValue(null),this.Oe&&(this.Oe.dispose(),this.Oe=null),this.qe++,v.call(this);case"reconnect-failed":case"unauthorized":return delete this.at,this.Re?(this.Ce++,1<this.Ce?b.call(this,new Error(t)):(this.a.info("[%s] Attempting to create new authToken and re-connect after [%s] response",this,g),y.call(this))):b.call(this,new Error(t));case"capacity":case"network-unavailable":return this.qe++,v.call(this);case"online":return this.Te?this.a.info("[%s] Successfully reconnected (reconnectCount=[%s],reauthCount=[%s])",this,this.qe,this.Ce):this.a.info("[%s] Successfully instantiated",this),this.Ce=0,this.qe=0,void(this.Te=!0);case"reconnecting":case"reconnected":case"connecting":break;case"offline":return;default:return b.call(this,new Error(t))}}function v(){var t=this,e=Math.min(u*t.qe*t.qe,this.Pe.maxReconnectFrequency),i=Math.min(e/1e4,5),i=e+Math.random()*i*1e3;this.a.info("[%s] Waiting for [%s] ms before continuing to attempt to reconnect to PCast",this,i),this.Ae=setTimeout(function(){return(t.Se.getValue()&&t.Se.getValue().isStarted()?y:h).call(t)},i)}function y(){var i=this;this.Re.createAuthenticationToken(function(t,e){return t&&"timeout"===t.message?l.call(i,t.message):t?b.call(i,t):"ok"!==e.status?l.call(i,e.status):void(i.Se.getValue()?i.Se.getValue().reAuthenticate(e.authenticationToken):i.a.warn("[%s] Unable to authenticate. PCast not instantiated.",this))})}function b(t){if(!this.xe)throw t;this.xe(t)}function w(t,i,n){new r(t,{aspectRatio:i.aspectRatio,resolution:i.resolution,frameRate:i.frameRate,resolutionSelectionStrategy:i.resolutionSelectionStrategy,onScreenShare:function(t){return(t=i.onScreenShare?i.onScreenShare(t):t).resolution&&m.C(t.resolution,"clientOptions.resolution"),t.frameRate&&m.C(t.frameRate,"screenOptions.frameRate"),t.aspectRatio&&m.S(t.aspectRatio,"screenOptions.aspectRatio"),f.assign({resolution:t.resolution},t)}}).getUserMedia(i.mediaConstraints,function(t,e){return t?n(t):(i.onResolveMedia&&i.onResolveMedia(e.options),void n(null,f.assign({status:"ok"},e)))})}function k(n,r,s,o){var a=this;if(r.publishToken){try{var t=a.parseCapabilitiesFromToken(r.publishToken);r.capabilities=t}catch(t){return o(new Error("Bad `publishToken`",t),{status:"bad-token"})}return S.call(a,r.publishToken,n,r,s,o)}if(r.streamToken){try{var e=a.parseCapabilitiesFromToken(r.streamToken);r.capabilities=e}catch(t){return o(new Error("Bad `streamToken`",t),{status:"bad-token"})}return S.call(a,r.streamToken,n,r,s,o)}r.capabilities&&m.isArray(r.capabilities,"options.capabilities"),a.waitForOnline(function(t){if(t)return a.a.error("[%s] Failed to create stream token for publishing after waiting for online status",this,t),o(t);var i=a.Se.getValue().getProtocol().getSessionId(),e=f.includes(r.capabilities,"egress"),t=f.bind(a.Re.createStreamTokenForPublishing,a.Re,i,r.capabilities);e&&(t=f.bind(a.Re.createStreamTokenForPublishingToExternal,a.Re,i,r.capabilities,r.streamId)),a.a.info("[%s] [%s] Creating stream token for publishing",this,i),t(function(t,e){return t?(a.a.error("[%s] [%s] Failed to create stream token for publishing",this,i,t),o(t)):"ok"!==e.status?(a.a.warn("[%s] [%s] Failed to create stream token for publishing with status [%s]",this,i,e.status),o(null,e)):void S.call(a,e.streamToken,n,r,s,o)})},r.isContinuation)}function S(s,o,a,u,c){var h=this,l=!1,d=null;function e(t,e,i){function n(t){var e=f.assign({streamToken:s,isContinuation:!0},a);h.a.warn("[%s] Retrying publisher after failure with reason [%s]",this,t),h.De[i.getStreamId()]=!0,"camera-track-failure"===t?(i.stop(t,!1),h.publish(a,c)):(i.stop(t,!0),k.call(h,o,e,u,c))}if(e===g&&(a.streamToken||a.publishToken||!a.authFailure)||"timeout"===e){h.a.info("[%s] Attempting to create new streamToken and re-publish after [%s] response",this,g);var r=f.assign({isContinuation:!0,authFailure:!0},a);return delete r.streamToken,delete r.publishToken,k.call(h,o,r,u,c)}if("ok"!==e)return h.a.warn("[%s] Failure to publish with status [%s]",this,e),d&&(h.De[d.getStreamId()]=!0),c(null,{status:e});delete a.authFailure,h.lt[i.getStreamId()]=i,d=i,r=f.bind(E,h,function(){},n,!0),a.monitor&&(e=f.bind(C,h,a.monitor.callback,n),i.monitor(a.monitor.options||{},e),r=f.bind(E,h,a.monitor.callback,n,!0)),i.setPublisherEndedCallback(r),r=function(i,n,r){var s=this,o=f.bind(i.stop,i);return i.stop=function(t,e){s.a.info("[%s] [%s] Stopping publisher with reason [%s]",s,i.getStreamId(),t),o(t),n&&(n.src="",n.srcObject=null),!r||!i.getStream()||e||(e=i.getStream())&&e.getTracks().forEach(function(t){t.stop()})},i.enableAudio=function(){return R.call(s,i,!0)},i.disableAudio=function(){return R.call(s,i,!1)},i.enableVideo=function(){return T.call(s,i,!0)},i.disableVideo=function(){return T.call(s,i,!1)},i.setPublisherEndedCallback=function(){},i}.call(h,i,a.videoElement,u),a.videoElement&&!l&&(p.attachMediaStream(a.videoElement,o,function(t){t&&h.a.warn("[%s] [%s] Failed to attach publish media stream to video element.",this,i.getStreamId(),t)}),l=!0),c(null,{status:"ok",publisher:r})}a.tags&&m.isArray(a.tags,"options.tags"),a.connectOptions&&m.isArray(a.connectOptions,"options.connectOptions"),h.waitForOnline(function(t){return t?c(t):void h.Se.getValue().publish(s,o,e,a.tags,{connectOptions:a.connectOptions})},a.isContinuation)}function I(a,u,c){function e(t,e,i){function n(t){var e=f.assign({isContinuation:!0},u);h.De[i.getStreamId()]=!0,i.stop(t),h.a.warn("[%s] [%s] Stream failure occurred with reason [%s]. Attempting to recover from failure.",this,u.streamId,t),I.call(h,a,e,c)}var r;if((!u.skipRetryOnUnauthorized&&e===g&&(u.streamToken||!u.authFailure)||"timeout"===e)&&h.Re){h.a.info("[%s] [%s] Attempting to create new streamToken and re-subscribe after [%s] response",this,u.streamId,g);var s=f.assign({isContinuation:!0,authFailure:!0},u);return delete s.streamToken,h.subscribe(s,c)}if("streaming-not-ready"===e)return h.a.warn("[%s] Failure to subscribe with status [%s]. Try again in a few seconds.",this,e),c(null,{status:e,retry:f.bind(n,h,e)});if("ok"!==e)return h.a.warn("[%s] Failure to subscribe with status [%s]",this,e),l&&(h.De[l.getStreamId()]=!0),c(null,{status:e});delete u.authFailure,l=i,u.videoElement&&(r=i.createRenderer()).start(u.videoElement),s=f.noop,e=f.bind(E,h,s,n,!1),u.monitor&&(s=f.bind(C,h,u.monitor.callback,n),i.monitor(u.monitor.options||{},s),e=f.bind(E,h,u.monitor.callback,n,!1)),i.setStreamEndedCallback(e);var o=function(e,i){var n=this,r=f.bind(e.stop,e);return e.stop=function(t){n.a.info("[%s] [%s] Stopping subscriber with reason [%s]",n,e,t),i&&i.stop(t),r(t)},e.enableAudio=function(){return R(e.getStream(),!0)},e.disableAudio=function(){return R(e.getStream(),!1)},e.enableVideo=function(){return T(e.getStream(),!0)},e.disableVideo=function(){return T(e.getStream(),!1)},e.setStreamEndedCallback=function(){},e}.call(h,i,r),e={status:"ok",mediaStream:o};i.setStreamErrorCallback(function(t,e,i){return"real-time"===e&&"connection-timeout"===i.message?n.call(h,i.message):"shaka"!==e||i.severity===d.errorSeverity.critical.id?"phenix-player"!==e||1!==i.severity?(h.a.warn("[%s] [%s] Error occurred while playing stream with Express API. Stopping stream.",this,o.getStreamId(),i),o.stop(),c(i)):(h.a.warn("[%s] [%s] Recoverable error occurred while playing stream with Express API. Attempting to subscribe again.",this,o.getStreamId(),i),delete(i=f.assign({isContinuation:!0},u)).streamToken,h.subscribe(i,c)):void 0}),r&&(e.renderer=r),c(null,e)}var h=this,l=null;h.waitForOnline(function(t){return t?c(t):(t=f.clone(u.subscriberOptions||{}),u.streamId&&(t.originStreamId=u.streamId),void h.Se.getValue().subscribe(a,e,t))},u.isContinuation)}function R(t,e){var i=this.getPCast();if(i){var n=t.getStreamId(),r=i.getRemoteDescriptionSdp(n);if(r&&(i=t.getStream(),!((n=r.lastIndexOf("m=audio"))<0)&&((t=r.lastIndexOf("m=video"))<n&&(t=r.length),!(t=r.substring(n,t)).includes("a=inactive")&&i)))return q(i.getAudioTracks(),e),e}}function T(t,e){var i=this.getPCast();if(i){var n=t.getStreamId(),r=i.getRemoteDescriptionSdp(n);if(r&&(i=t.getStream(),!((n=r.lastIndexOf("m=video"))<0)&&((t=r.lastIndexOf("m=audio"))<n&&(t=r.length),!(t=r.substring(n,t)).includes("a=inactive")&&i)))return q(i.getVideoTracks(),e),e}}function q(t,e){m.isArray(t,"tracks"),f.forEach(t,function(t){t.updateState(e)})}function C(t,e,i,n,r){switch(n){case"camera-track-failure":case"client-side-failure":t(null,f.assign({status:n,retry:f.bind(e,null,n)},r))}}function E(t,e,i,n,r,s){var o={status:"stream-ended",reason:r,description:s};if(this.De[n.getStreamId()])this.a.info("[%s] Ignoring stream end due to recovery in progress [%s]",this,n.getStreamId());else switch(r){case"egress-setup-failed":case"ended":case"censored":var a={status:r,reason:r,description:s};return i?a.publisher=n:a.mediaStream=n,t(null,a);case"custom":return t(null,o);case"egress-failed":case"capacity":return void setTimeout(function(){if(!this.Ee)return e(r)},u);case"failed":case"maintenance":case"overload":return e(r);default:return o.retry=e,t(null,o)}}return a.prototype.publishRemote=function(i,n){if(m.e(i,"options"),m.b(n,"callback"),m.S(i.streamUri,"options.streamUri"),i.capabilities&&m.isArray(i.capabilities,"options.capabilities"),i.connectOptions&&m.isArray(i.connectOptions,"options.connectOptions"),i.mediaConstraints)throw new Error("Invalid argument: mediaConstraints, passed on publishRemote. Local media not allowed when publishing remote content.");if(i.videoElement)throw new Error("May not preview remote stream. Please subscribe to view.");if(i.prerollSkipDuration&&m.C(i.prerollSkipDuration,"options.prerollSkipDuration"),i.monitor&&(m.e(i.monitor,"options.monitor"),m.b(i.monitor.callback,"options.monitor.callback"),i.monitor.options&&m.e(i.monitor.options,"options.monitor.options")),i.frameRate&&(m.e(i.frameRate,"options.frameRate"),i.frameRate.exact&&m.C(i.frameRate.exact,"options.frameRate.exact"),i.frameRate.max&&m.C(i.frameRate.max,"options.frameRate.max")),i.publishToken&&m.S(i.publishToken,"options.publishToken"),i.streamToken&&m.S(i.streamToken,"options.streamToken"),i.publishToken&&i.streamToken)throw new Error("Do not pass streamToken with publishToken. Please use publishToken.");var r=this;this.waitForOnline(function(t){if(t)return n(t);var e=f.assign({connectOptions:[],capabilities:[]},i);f.includes(e.capabilities,"publish-uri")||e.capabilities.push("publish-uri"),f.forEach(c,function(t){f.includes(e.capabilities,t)&&e.connectOptions.push("publisher-capability="+t)}),i.frameRate&&i.frameRate.exact&&e.connectOptions.push("source-uri-video-fps="+i.frameRate.exact),i.frameRate&&i.frameRate.max&&e.connectOptions.push("source-uri-video-fps-max="+i.frameRate.max),e.connectOptions.push("source-uri-preroll-skip-duration="+(f.C(i.prerollSkipDuration)?i.prerollSkipDuration:s).toString()),k.call(r,e.streamUri,e,!1,n)})},a.prototype.publishStreamToExternal=function(e,i){if(m.e(e,"options"),m.b(i,"callback"),m.S(e.streamId,"options.streamId"),m.S(e.externalUri,"options.externalUri"),e.capabilities&&m.isArray(e.capabilities,"options.capabilities"),e.connectOptions&&m.isArray(e.connectOptions,"options.connectOptions"),e.mediaConstraints)throw new Error("Invalid argument: mediaConstraints, passed on publishStreamToExternal. Local media not allowed when publishing remote content.");if(e.videoElement)throw new Error("May not preview external stream. Please subscribe to view.");e.monitor&&(m.e(e.monitor,"options.monitor"),m.b(e.monitor.callback,"options.monitor.callback"),e.monitor.options&&m.e(e.monitor.options,"options.monitor.options")),e.streamToken&&m.S(e.streamToken,"options.streamToken");var n=this;this.waitForOnline(function(t){return t?i(t):(t=f.assign({connectOptions:[],capabilities:[]},e),f.includes(t.capabilities,"egress")||t.capabilities.push("egress"),f.includes(t.capabilities,"egress-own-stream")||t.capabilities.push("egress-own-stream"),void k.call(n,t.externalUri,t,!1,i))})},a.prototype.publishScreen=function(t,e){return t=f.assign({mediaConstraints:{screen:!0}},t),f.set(t,["monitor","options"],f.assign({},{monitorFrameRate:!1,videoBitRateThreshold:100,conditionCountForNotificationThreshold:8},f.get(t,["monitor","options"],{}))),this.publish(t,e)},a.prototype.subscribe=function(i,n){m.e(i,"options"),m.b(n,"callback"),m.S(i.streamId,"options.streamId"),i.videoElement&&m.e(i.videoElement,"options.videoElement"),i.monitor&&(m.e(i.monitor,"options.monitor"),m.b(i.monitor.callback,"options.monitor.callback"),i.monitor.options&&m.e(i.monitor.options,"options.monitor.options")),i.streamToken?m.S(i.streamToken,"options.streamToken"):m.e(i.capabilities,"options.capabilities"),i.subscriberOptions&&m.e(i.subscriberOptions,"options.subscriberOptions");var r=this;this.waitForOnline(function(t){if(t)return r.a.error("[%s] Failed to subscribe after error waiting for online status",this,t),n(t);if(i.streamToken)return I.call(r,i.streamToken,i,n);if(!i.streamToken&&!r.Re)throw new Error("Use stream token, or set adminApiProxyClient");r.a.info("[%s] [%s] Generating stream token for subscribing to origin [%s]",this,r.Se.getValue().getProtocol().getSessionId(),i.streamId),r.Re.createStreamTokenForSubscribing(r.Se.getValue().getProtocol().getSessionId(),i.capabilities,i.streamId,null,function(t,e){return t?(r.a.error("[%s] Failed to create stream token for subscribing",this,t),n(t)):"ok"!==e.status?(r.a.warn("[%s] Failed to create stream token for subscribing with status [%s]",this,e.status),n(null,e)):void I.call(r,e.streamToken,i,n)})},i.isContinuation)},a.prototype.subscribeToScreen=function(t,e){return t=f.assign({},t),f.set(t,["monitor","options"],f.assign({},{monitorFrameRate:!1,videoBitRateThreshold:100,conditionCountForNotificationThreshold:8},f.get(t,["monitor","options"],{}))),this.subscribe(t,e)},a.prototype.waitForOnline=function(e,t){if(m.b(e,"callback"),this.Se.getValue()&&"online"===this.Se.getValue().getStatus())return e();var i=this,n=t?f.get(i.Pe,["maxOfflineTime"]):this.Me,r=null,s=null,o=setTimeout(function(){i.a.info("[%s] Disposing of online listener after [%s] ms",this,n),r&&r.dispose(),s&&s.dispose(),i.Ee?i.a.info("[%s] Instance was disposed while waiting for online, ignoring callback",this):e(new Error("timeout"))},n);this.a.info("[%s] Waiting for online status before continuing. Timeout set to [%s]",this,n),r=this.Se.subscribe(function(t){s&&s.dispose(),t&&(s=t.getObservableStatus().subscribe(function(t){return i.Ee?(i.a.info("[%s] Instance was disposed while waiting for online, canceling waiting and skip triggering callback",this),clearTimeout(o),s.dispose(),void r.dispose()):"online"===t?(clearTimeout(o),s.dispose(),r.dispose(),e()):void i.a.info("[%s] Still waiting for online status before continuing. Current status is [%s]",this,t)},{initial:"notify"}))},{initial:"notify"})},a.prototype.parseCapabilitiesFromToken=function(t){return this.Se.getValue().parseCapabilitiesFromToken(t)},a.prototype.parseRoomOrChannelIdFromToken=function(t){return this.Se.getValue().parseRoomOrChannelIdFromToken(t)},a.prototype.parseRoomOrChannelAliasFromToken=function(t){return this.Se.getValue().parseRoomOrChannelAliasFromToken(t)},a}.apply(e,i))||(t.exports=i)},function(t,e,i){i=[i(0),i(1),i(7),i(3)];void 0===(i=function(s,o,a,r){"use strict";var u={timeout:2e4,retryOptions:{backoff:1.5,delay:1e3,maxAttempts:3,additionalRetryErrorCodes:[0]}},c={body:{id:1,name:"body"},header:{id:2,name:"header"}},e={createStreamTokenPath:"/stream",createAuthTokenPath:"/auth"},h="auth",l="stream";function t(){this.Fe=null,this.Le="",this.Ne=e,this.Be={},this.je=c.body.name,this.T=new r.DisposableList}function d(t,i){var n=null,e=t(s.bind(m,this,function(t,e){switch(clearTimeout(n),s.get(t,["code"])){case 401:return i(null,{status:"unauthorized"});case 404:return i(null,{status:"origin-not-found"});case 410:return i(null,{status:"origin-ended"});default:return i(t,e)}})),n=setTimeout(function(){e.dispose(),i(new Error("timeout"))},2e4);return this.T.add(e),this.T.add(new r.Disposable(function(){clearTimeout(n)})),e}function f(t,e,i,n,r){switch(this.je){case c.body.name:n=function(t){return s.assign({},t,this.Be)}.call(this,n);break;case c.header.name:r=function(t){return t.headers?(t.headers=s.assign({},this.Be,t.headers),t):s.assign({},{headers:this.Be},t)}.call(this,r);break;default:throw new Error("Unsupported Authentication Mode "+this.je)}return s.bind(t,e,i,JSON.stringify(n),r)}function m(t,e,i){return e?t(e,{}):"ok"!==(i=JSON.parse(i.data)).status?t(null,{status:i.status||"status-code-missing"}):t(null,i)}function p(t,e,i,n){if(!n||i)return e(i,{status:"failed"});var r={status:"ok"};switch(t){case h:r.authenticationToken=n;break;case l:r.streamToken=n;break;default:throw new Error("Unsupported request type "+t)}return e(i,r)}return t.prototype.dispose=function(){return this.T.dispose()},t.prototype.toString=function(){return"AdminApiProxyClient[customRequestHandler="+(!!this.Fe).toString()+",backendUri="+this.Le+",authenticationDataLocationInPayload="+this.je+",customEndpointPaths="+(this.Ne===e).toString()+",customAuthenticationData="+(0<s.keys(this.Be).length).toString()+"]"},t.prototype.getBackendUri=function(){return this.Le},t.prototype.setBackendUri=function(t){o.x(t,"backendUri"),this.Le=t},t.prototype.getEndpointPaths=function(){return s.assign({},this.Ne)},t.prototype.setEndpointPaths=function(t){o.e(t,"endpointPaths"),t.createStreamTokenPath&&o.S(t.createStreamTokenPath,"endpointPaths.createStreamTokenPath"),t.createAuthTokenPath&&o.S(t.createAuthTokenPath,"endpointPaths.createAuthTokenPath"),this.Ne=s.assign({},e,t)},t.prototype.getAuthenticationData=function(){return s.assign({},this.Be)},t.prototype.setAuthenticationData=function(t){o.e(t,"authenticationData"),this.Be=t},t.prototype.getAuthenticationDataLocationInPayload=function(){return this.je},t.prototype.setAuthenticationDataLocationInPayload=function(t){o.w(t,c,"authenticationDataLocationInPayload"),this.je=t},t.prototype.getRequestHandler=function(){return this.Fe},t.prototype.setRequestHandler=function(t){if(o.b(t,"callback"),this.Le)throw new Error("Conflicting parameter [backendUri]");if(0<s.keys(this.Be).length)throw new Error("Conflicting parameter [authenticationData]");if(this.je!==c.body.name)throw new Error("Conflicting parameter [authenticationDataLocationInPayload]");if(this.Ne!==e)throw new Error("Conflicting parameter [endpointPaths]");this.Fe=t},t.prototype.createAuthenticationToken=function(t){if(this.Fe)return this.Fe(h,{},s.bind(p,this,h,t));if(this.Le){var e=f.call(this,a.postWithRetry,a,this.Le+this.Ne.createAuthTokenPath,{},u);return d.call(this,e,t)}t(null,{status:"unauthorized"})},t.prototype.createStreamTokenForPublishing=function(t,e,i){return o.S(t,"sessionId"),o.e(e,"capabilities"),e={sessionId:t,capabilities:e},this.Fe?this.Fe(l,e,s.bind(p,this,l,i)):this.Le?(e=f.call(this,a.postWithRetry,a,this.Le+this.Ne.createStreamTokenPath,e,u),d.call(this,e,i)):void i(null,{status:"unauthorized"})},t.prototype.createStreamTokenForPublishingToExternal=function(t,e,i,n){this.createStreamTokenForSubscribing(t,e,i,null,n)},t.prototype.createStreamTokenForSubscribing=function(t,e,i,n,r){return o.S(t,"sessionId"),o.e(e,"capabilities"),s.isNullOrUndefined(n)||(o.isArray(n,"additionalStreamIds"),s.forEach(n,function(t){o.S(t,"alternateOriginStreamId")})),i={sessionId:t,capabilities:e,originStreamId:i},n&&0<n.length&&(i.alternateOriginStreamIds=n),this.Fe?this.Fe(l,i,s.bind(p,this,l,r)):this.Le?(i=f.call(this,a.postWithRetry,a,this.Le+this.Ne.createStreamTokenPath,i,u),d.call(this,i,r)):void r(null,{status:"unauthorized"})},t}.apply(e,i))||(t.exports=i)},function(t,e,i){i=[i(0),i(1),i(4),i(3),i(36),i(30),i(39),i(19),i(14),i(13),i(20),i(34),i(12)];void 0===(i=function(v,y,t,b,e,o,f,w,m,d,c,k,S){"use strict";var p=["streaming","rtmp"];function i(t){y.e(t,"options"),t.pcastExpress&&y.e(t.pcastExpress,"options.pcastExpress"),this.Ve=t.pcastExpress||new e(t),this.We=!t.pcastExpress,this.ze={},this._e=[],this.He={},this.Ge=[],this.Je={},this.a=this.Ve.getPCast().getLogger(),this.T=new b.DisposableList,this.Ee=!1,this.tt=new S(t.features),this.Ke=!1,this.Qe=null;var i=this;this.Ve.getPCastObservable().subscribe(function(e){e&&(i.a.info("Resetting Room Express after change in pcast."),i.Ve.waitForOnline(function(){i.Ve.getPCastObservable().getValue()===e&&v.forOwn(i.ze,function(t){t.setPCast(e)})}))})}function I(t){try{return this.Ve.parseCapabilitiesFromToken(t)}catch(t){return}}function g(e,i,n){var r=this,s=v.uniqueId();this.Ve.waitForOnline(function(t){return t?n(t):(t=R.call(r,e,i))?(r.a.info("Reusing room service for room [%s]/[%s]",e,i),n(null,{status:"ok",roomService:t})):(r.ze[s]=new o(r.Ve.getPCast()),t=function(r,t){var s=this,e=r.stop,o=r.leaveRoom;return r.stop=function(){e.apply(r,arguments),delete s.ze[t]},r.leaveRoom=function(i,t){var n=r.getObservableActiveRoom().getValue();o.call(r,function(t,e){return t?(r.stop("leave-room-failure"),i(t)):("ok"!==e.status&&"not-in-room"!==e.status||(s.a.info("Successfully disposed Express Room Service [%s]",n?n.getRoomId():"Uninitialized"),r.stop("leave-room")),i(null,e))},t)},r}.call(r,r.ze[s],s),r.a.info("Creating room service for room [%s]/[%s]",e,i),void n(null,{status:"ok",roomService:t}))})}function R(e,i){return v.find(this.Ge,function(t){return(t=t.getObservableActiveRoom().getValue())&&(t.getRoomId()===e||t.getObservableAlias().getValue()===i)})}function h(o,a,u){var c=this,h=o.role,l=o.screenName||v.uniqueId();g.call(c,o.roomId,o.alias,function(t,e){if(t)return a(t);if("ok"!==e.status)return a(null,e);function i(){var t=r.getValue();t?(c.a.info("Setup member subscription for room [%s]",t.getRoomId()),s=t.getObservableMembers().subscribe(u,{initial:"notify"}),c.T.add(r.subscribe(function(t){s&&(u([]),s.dispose(),s=null),t&&(s=t.getObservableMembers().subscribe(u,{initial:"notify"}))}))):c.a.warn("Unable to setup members subscription. Not in room.")}var n=e.roomService,r=n.getObservableActiveRoom(),t=r.getValue(),s=null;if(t||n.start(h,l),o.streams&&0<o.streams.length){if(e=o.streams[0],o.streamsWildcardTokenCapabilities&&!v.includes(o.streams[0].uri,w.getPCastPrefix())&&(o.streams[0].uri=w.getPCastPrefix()+o.streams[0].uri,c._e.push(o.streams[0].uri)),o.streamsWildcardTokenCapabilities&&t&&!v.includes(e.uri,"streamToken"))return q.call(c,o,e,t,function(t,e){if(a(t,v.assign({roomService:n},e)),u)return i()});e=!o.streamsWildcardTokenCapabilities||t||v.includes(e.uri,"streamToken")?o.role:d.roles.audience.name,function(t,e,i,n){var r=i?i.getObservableActiveRoom().getValue():null;if(t&&i&&i.getSelf().setStreams(t),e&&i&&i.getSelf().getObservableRole().setValue(0===t.length?d.roles.audience.name:e),r&&i.getSelf())return D.call(this,i.getSelf(),n)}.call(c,o.streams,e,n,function(t){if(t)return a(t)})}if(t)return a(null,{status:"ok",roomService:n}),void(u&&i());n.enterRoom(o.roomId,o.alias,function(t,e){return t?(n.stop("enter-room-failure"),a(t)):"not-found"===e.status?(n.stop("enter-room-failure"),a(null,{status:"room-not-found"})):"ok"!==e.status&&"already-in-room"!==e.status?(n.stop("enter-room-failure"),a(null,e)):(t=e.room,e=v.get(o,["streams",0]),c.Ge.push(n),o.streamsWildcardTokenCapabilities&&e&&!v.includes(e.uri,"streamToken")?q.call(c,o,e,t,function(t,e){if(a(t,v.assign({roomService:n},e)),u)return i()}):(a(null,{status:"ok",roomService:n}),u?i():void 0))})})}function l(e,t){this.He[t.getRoomId()]&&e&&(this.He[t.getRoomId()]=v.filter(this.He[t.getRoomId()],function(t){return t.getStreamId()!==e.getStreamId()}))}function T(t,e,i,n){var r,s,o,a=t.streamType,u=t.streamInfo,c=[];if(t.streamToken){var h=I.call(this,t.streamToken);if(!h)return n(new Error("Bad `streamToken`"),{status:"bad-token"});c=h}else c=t.capabilities;return r=a,s=u,o=c,e=(a=(h=e).getStream())?a.getAudioTracks():null,a=a?a.getVideoTracks():null,e=0<e.length&&e[0].enabled,a=0<a.length&&a[0].enabled,o.includes("audio-only")&&(a=!1),o.includes("video-only")&&(e=!1),a={uri:w.getPCastPrefix()+h.getStreamId(),type:r,audioState:(e?k.states.trackEnabled:k.states.trackDisabled).name,videoState:(a?k.states.trackEnabled:k.states.trackDisabled).name},delete(s=v.assign({},s,{streamToken:void 0,streamTokenForBroadcastStream:void 0,streamTokenForLiveStream:void 0})).streamToken,delete s.streamTokenForBroadcastStream,delete s.streamTokenForLiveStream,0<(s=v.reduce(s,function(t,e,i){return t+(t?"&":"?")+i+"="+e},"")).length&&(a.uri=a.uri+s),u=E(a,"capabilities",o.join(",")),t.enableWildcardCapability?q.call(this,t,u,i,n):(c=R.call(this,i.getRoomId(),i.getObservableAlias().getValue()),u=v.assign({},t,{streams:M.call(this,u,i)}),P.call(this,u.streams,u.memberRole,c,i,u,n))}function q(s,o,i,a){var u,c=this,t="high-availability"===s.viewerStreamSelectionStrategy&&i.getObservableType().getValue()===m.types.channel.name,h=[],n=a,l=w.parsePCastStreamIdFromStreamUri(v.get(o,"uri","")),e=c.getPCastExpress().getPCast().getProtocol(),r=e?e.getSessionId():"",d=c.Je[l];if(!v.includes(o,"capabilities"))if(s.streamToken){if(!(e=I.call(c,s.streamToken)))return a(new Error("Bad `streamToken`"),{status:"bad-token"});o=E(o,"capabilities",e.join(","))}else o=E(o,"capabilities",s.capabilities.join(","));return t&&(h=x(f.getSimilarMembers(s.screenName,r,i.getObservableMembers().getValue())),n=function(t,e){a(t,e);var n,r=v.get(e,"roomService",R.call(c,i.getRoomId(),i.getObservableAlias().getValue()));t||"ok"!==e.status||u||!r||(n=r.getObservableActiveRoom().getValue(),u=n.getObservableMembers().subscribe(function(t){var e=(i=r.getSelf())?i.getSessionId():"",t=(t=x(f.getSimilarMembers(s.screenName,e,t))).length===h.length&&v.reduce(t,function(t,e){return t&&v.includes(h,e)},!0),i=i?i.getObservableStreams().getValue():[];if(!v.find(i,function(t){return t.getPCastStreamId()===l}))return u.dispose(),void(u=null);t||(c.a.debug("Members with similar content to stream [%s] have changed. Generating new wildcard viewer token",l),u.dispose(),u=null,q.call(c,s,o,n,function(t,e){!t&&"ok"===e.status||a(t,e)}))}),d&&d.add(u))}),function(t,e,i,n,r){function s(t,e){if(!u){if(t||"ok"!==e.status)return c(),u=!0,r(t,e);++a===o.length&&r(null,{status:"ok"})}}var o=[],a=0,u=!1,c=function(){v.forEach(o,function(t){t.dispose()})};this.a.debug("Creating [real-time] and [broadcast] viewer wildcard stream token for published stream [%s] with [%s] additional streams",e,i.length),o.push(C.call(this,[],e,i,n,"streamToken",s)),o.push(C.call(this,["broadcast"],e,i,n,"streamTokenForBroadcastStream",s));var h=v.filter(t,v.bind(v.includes,null,p));return 0<h.length&&(this.a.debug("Creating [%s] viewer wildcard stream token for published stream [%s] with [%s] additional streams",h,e,i.length),o.push(C.call(this,h,e,i,n,"streamTokenForLiveStream",s))),v.includes(t,"drm")&&(this.a.debug("Creating [drm-open-access] and [drm-hollywood] viewer wildcard stream token for published stream [%s] with [%s] additional streams",e,i.length),o.push(C.call(this,["streaming","drm-open-access"],e,i,n,"streamTokenForLiveStreamWithDrmOpenAccess",s)),o.push(C.call(this,["streaming","drm-hollywood"],e,i,n,"streamTokenForLiveStreamWithDrmHollywood",s))),c}.call(this,s.capabilities,l,h,o,function(t,e){return t?a(t):"ok"!==e.status?a(null,e):(t=R.call(c,i.getRoomId(),i.getObservableAlias().getValue()),e=v.assign({},s,{streams:M.call(c,o,i)}),P.call(c,e.streams,e.memberRole,t,i,e,n))})}function C(t,e,i,n,r,s){if(!this.Ve.getAdminAPI())throw new Error('Set "options.enableWildcardCapability" to "false", or set adminApiProxyClient on initiating room express');return this.Ve.getAdminAPI().createStreamTokenForSubscribing("*",t,e,i,function(t,e){return t?s(t):"ok"!==e.status?s(null,e):(n=E(n,r,e.streamToken),void s(null,e))})}function E(t,e,i){var n=-1<(r=t.uri.indexOf("?"))?"&":"?",r=-1===(s=t.uri.indexOf("#",-1===r?t.uri.length:r))?t.uri:t.uri.substring(0,s),s=-1===s?"":t.uri.substring(s);return t.uri=r+n+e+"="+i+s,t}function x(t){return v.reduce(t,function(t,e){return(e=(e=v.get(e.getObservableStreams().getValue(),"0"))?e.getPCastStreamId():"")&&t.push(e),t},[])}function M(r,t){var e=this,i=R.call(this,t.getRoomId(),t.getObservableAlias().getValue()),n=r?[r]:[];if(!i)return n;if(!(i=i.getSelf()))return n;var i=v.map(i.getObservableStreams().getValue(),function(t){return t.toJson()}),t=this.He[t.getRoomId()]||[],s=v.map(t,function(t){return t.getStreamId()});return i&&0!==i.length?(r&&(i=v.filter(i,function(t){var e=t.uri===r.uri,i=!!(n=w.parsePCastStreamIdFromStreamUri(t.uri))&&n===w.parsePCastStreamIdFromStreamUri(r.uri),n=r.uri.split("?")[0]===t.uri.split("?")[0],t=t.type===r.type;return!e&&!i&&!n||!t})).push(r),v.filter(i,function(t){return!w.parsePCastStreamIdFromStreamUri(t.uri)||v.includes(s,w.parsePCastStreamIdFromStreamUri(t.uri)||t.uri)||v.includes(e._e,t.uri.split("?")[0])})):n}function P(t,e,i,n,r,s){var o=R.call(this,n.getRoomId(),n.getObservableAlias().getValue()),a=i?i.getObservableActiveRoom().getValue():null,u=!a&&!o;return(i=this).Ee?i.a.warn("Unable to update self after express room service disposal."):(t&&o&&(i.a.debug("Preparing member streams for update in room [%s].",n.getRoomId()),o.getSelf().setStreams(t)),e&&o&&o.getSelf().getObservableRole().getValue()!==e&&(i.a.debug("Preparing member role for update in room [%s].",n.getRoomId()),o.getSelf().getObservableRole().setValue(e)),a&&o.getSelf()?D.call(this,o.getSelf(),s):void(u&&(i.a.info("Joining room with member [%s].",n.getRoomId()),r=v.assign({role:e,alias:v.get(r,["room","alias"]),roomId:v.get(r,["room","roomId"])},r),h.call(i,r,function(t,e){return t?s(t):"ok"!==e.status&&"already-in-room"!==e.status?s(null,e):void s(t,e)}))))}function D(n,r){var s=0,o=this;try{n.commitChanges(function t(e,i){return!e&&i||s++,e=(e=n.getRoomService())?e.getObservableActiveRoom().getValue():null,i&&"ok"===i.status||!e&&"not-found"===i.status?(s=0,o.Ke=!1,!r||r(null,i)):(i&&"ok"!==i.status&&s++,5<=s?(o.a.warn("Unable to update self after [%s] attempts.",5),v.C(i.lastUpdate)&&(o.a.warn("Updating self last update from [%s] to [%s] to prevent permanent failure state. Our awareness of self does not match up with the server anymore.",n.getObservableLastUpdate().getValue(),i.lastUpdate),n.getObservableLastUpdate().setValue(i.lastUpdate)),o.Ke=!1,r(new Error("Unable to update self"))):0<s&&s<5?(o.a.info("Unable to update self after [%s] attempts. Retrying.",s),n.commitChanges(t)):void 0)})}catch(t){r(t)}}function U(t,e,i){return e?t(e):i.retry?i.retry():void t(e,i)}return i.prototype.dispose=function(){this.Ee=!0,function(){v.forOwn(this.He,function(t){v.forEach(t,function(t){t.stop("dispose")})}),v.forOwn(this.ze,function(t){t.stop("dispose")}),this.He={},this._e=[],this.ze={},this.Ge=[]}.call(this),this.We&&this.Ve.dispose(),this.T.dispose(),this.a.info("Disposed Room Express Instance")},i.prototype.getPCastExpress=function(){return this.Ve},i.prototype.createRoom=function(n,r){y.b(r,"callback"),y.e(n.room,"options.room"),y.S(n.room.name,"options.room.name"),y.S(n.room.type,"options.room.type"),n.room.description&&y.S(n.room.description,"options.room.description");var s=n.room.description||function(){switch(n.room.type){case m.types.channel.name:return"Room Channel";case m.types.moderatedChat.name:return"Moderated Chat";case m.types.multiPartyChat.name:return"Multi Party Chat";case m.types.townHall.name:return"Town Hall";case m.types.directChat.name:return"Direct Chat";default:throw new Error("Unsupported Room Type")}}();g.call(this,null,null,function(t,e){if(t)return r(t);if("ok"!==e.status)return r(null,e);var i=e.roomService;(e=v.assign({},n.room)).description||(e.description=s),i.createRoom(e,function(t,e){return t?r(t):(i.stop("create"),r(null,e))})})},i.prototype.joinRoom=function(t,s,e){var i;y.e(t,"options"),y.b(s,"joinRoomCallback"),y.S(t.role,"options.role"),e&&y.b(e,"membersChangedCallback"),t.screenName&&y.S(t.screenName,"options.screenName"),t.roomId&&y.S(t.roomId,"options.roomId"),t.alias&&y.S(t.alias,"options.alias"),t.streams&&y.isArray(t.streams,"options.streams"),t.streamToken&&(y.S(t.streamToken,"options.streamToken"),t.roomId&&this.a.warn("Trying to join room with both streamToken and roomId. Please only use streamToken."),t.alias&&this.a.warn("Trying to join room with both streamToken and alias. Please only use streamToken."),i=this.Ve.parseRoomOrChannelIdFromToken(t.streamToken),r=this.Ve.parseRoomOrChannelAliasFromToken(t.streamToken),i&&(t.roomId=i,this.a.info("Room ID is set to [%s] from streamToken [%s]",i,t.streamToken)),r&&(t.alias=r,this.a.info("Alias is set to [%s] from streamToken [%s]",r,t.streamToken)));var n=this,r=function(r){r&&h.call(n,t,function(t,e){var i,n=e;n&&n.roomService&&(i=n.roomService.leaveRoom,n.roomService.leaveRoom=function(t,e){o&&"offline"!==r.getObservableStatus()&&o.dispose(),i(t,e)}),s(t,e)},e)};if(this.Ve.getPCastObservable())return r(this.Ve.getPCastObservable());var o=this.Ve.getPCastObservable().subscribe(r)},i.prototype.publishToRoom=function(r,s){y.e(r,"options"),y.b(s,"callback"),y.e(r.room,"options.room");var t=this.Ve.getAdminAPI();if(r.streamUri?y.S(r.streamUri,"options.streamUri"):r.mediaConstraints?y.e(r.mediaConstraints,"options.mediaConstraints"):y.e(r.userMediaStream,"options.userMediaStream"),r.videoElement&&y.e(r.videoElement,"options.videoElement"),r.screenName&&y.S(r.screenName,"options.screenName"),r.tags&&y.isArray(r.tags,"options.tags"),r.streamInfo&&y.e(r.streamInfo,"options.streamInfo"),r.streamToken&&(y.S(r.streamToken,"options.streamToken"),this.a.warn("`options.streamToken` is deprecated please use `options.publishToken`.")),r.publishToken&&r.capabilities)throw new Error("Do not pass `options.capabilities` with `options.publishToken`. `options.publishToken` should include capabilities in the token.");if(r.publishToken&&r.streamToken)throw new Error("Do not pass `options.streamToken` with `options.publishToken`. Please use `options.publishToken`.");if(r.streamToken&&r.capabilities)throw new Error("Do not pass `options.capabilities` with `options.streamToken`. `options.streamToken` should include capabilities in the token.");if(!r.streamToken&&!r.publishToken&&!t)throw new Error("Pass `options.publishToken`, or set adminApiProxyClient on initiating room express");r.viewerStreamSelectionStrategy&&y.S(r.viewerStreamSelectionStrategy,"options.viewerStreamSelectionStrategy"),r.capabilities&&y.isArray(r.capabilities,"options.capabilities"),v.isUndefined(r.enableWildcardCapability)&&(r.enableWildcardCapability=!(r.publishToken||r.streamToken)),y.w(r.streamType,c.types,"options.streamType"),y.w(r.memberRole,d.roles,"options.memberRole"),y.L(r.enableWildcardCapability,"options.enableWildcardCapability");var o=this,a=r.screenName||v.uniqueId(),e=r.room.roomId,i=r.room.alias;function n(t,i){var e=v.assign({monitor:{callback:v.bind(U,o,s),options:{conditionCountForNotificationThreshold:8}},streamInfo:{}},r);if(t.getObservableType().getValue()===m.types.channel.name?e.tags=["channelId:"+t.getRoomId(),"channelAlias:"+t.getObservableAlias().getValue()].concat(e.tags||[]):e.tags=["roomId:"+t.getRoomId(),"roomAlias:"+t.getObservableAlias().getValue()].concat(e.tags||[]),r.streamUri){var n=v.assign({connectOptions:[]},e);return v.find(n.connectOptions,function(t){return v.startsWith(t,"room-id")})||(n.connectOptions=n.connectOptions.concat(["room-id="+t.getRoomId(),"member-role="+r.memberRole,"member-stream-type="+r.streamType,"screen-name="+a])),r.enableWildcardCapability&&n.connectOptions.concat(["member-stream-token-type=Wildcard","member-stream-token-refresh-interval="+3e5]),o.Ve.publishRemote(n,function(t,e){s(t,e&&v.assign({roomService:null},e))})}!function(r,s,i){function t(t,e){if(a&&o&&clearInterval(a),t)return c(t);if("ok"!==e.status)return c(null,e);!function(t,e){this.He[e.getRoomId()]||(this.He[e.getRoomId()]=[]),this.He[e.getRoomId()].push(t)}.call(u,e.publisher,s),l.call(u,o,s),o=e.publisher,u.Je[o.getStreamId()]=new b.DisposableList;var n=v.bind(o.stop,o);o.stop=function(){clearInterval(a),l.call(u,o,s);var t=M.call(u,null,s),e=R.call(u,s.getRoomId()),i=u.Je[o.getStreamId()];i&&(i.dispose(),delete u.Je[o.getStreamId()]),n.apply(o,arguments),e&&P.call(u,t,0===t.length?d.roles.audience.name:r.memberRole,e,s,r,function(t){if(t)return c(t)})},function(r,s,o){var t,a=this,u=r.getStream();u&&(t=u.getTracks(),v.forEach(t,function(n){var e=function(){a.Ke=!0;var t=(n.enabled?k.states.trackEnabled:k.states.trackDisabled).name;if((i=R.call(a,s.getRoomId()))&&i.getSelf()){var e=i.getSelf().getObservableStreams().getValue(),i=v.find(e,function(t){return t.getPCastStreamId()===r.getStreamId()}),e=function(e){var t=v.find(this.Ge,function(t){return t=(t=t.getSelf())?t.getObservableStreams().getValue():[],v.find(t,function(t){return e===t})});return t?t.getSelf():null}.call(a,i);if(!i)return a.a.warn("[%s] [%s] Unable to update member state change after track state change [%s]. Member stream no longer exists on member model.",u.id,n.id,n.enabled);a.a.info("[%s] [%s] Track state changed to [%s], updating room member stream state [%s]",u.id,n.id,n.enabled,t),("video"===n.kind?i.getObservableVideoState():i.getObservableAudioState()).setValue(t),e&&D.call(a,e,o)}};n.updateState=function(t){this.enabled=t,function t(){a.Qe&&(clearTimeout(a.Qe),a.Qe=null),a.Ke?a.Qe=setTimeout(function(){t()}):e()}()}}))}.call(u,o,s,c),r.enableWildcardCapability&&(a=setInterval(function(){u.a.info("Refresh wildcard viewer stream token for [%s] interval of [%s] has expired. Creating new token.",o.getStreamId(),3e5);var t=(t=R.call(u,s.getRoomId(),s.getObservableAlias().getValue()))?t.getObservableActiveRoom().getValue():s;T.call(u,r,o,t,function(t,e){!t&&"ok"===e.status||c(t,e)})},3e5),u.T.add(new b.Disposable(function(){clearInterval(a)}))),T.call(u,r,e.publisher,s,c)}var o,a,u=this,c=function(t,e){i(t,e&&v.assign({publisher:o},e))};if(v.get(r,["mediaConstraints","screen"],!1))return v.set(r,["streamInfo","isScreen"],!0),this.Ve.publishScreen(r,t);this.Ve.publish(r,t)}.call(o,e,t,function(t,e){s(t,e&&v.assign({roomService:i.roomService},e))})}(r.publishToken||r.streamToken)&&(e=this.Ve.parseRoomOrChannelIdFromToken(r.publishToken||r.streamToken),i=this.Ve.parseRoomOrChannelAliasFromToken(r.publishToken||r.streamToken),this.a.info("[%s] [%s] RoomId and Alias read from token [%s]",e,i,r.publishToken||r.streamToken));var u=R.call(o,e,i);u?n(t=u.getObservableActiveRoom().getValue(),{roomService:u}):(i=v.assign({},r,{role:d.roles.audience.name,roomId:e,alias:i}),h.call(this,i,function(t,e){return t?s(t):"ok"!==e.status?s(null,e):void n(t=e.roomService.getObservableActiveRoom().getValue(),e)},function(){return null}))},i.prototype.publishScreenToRoom=function(t,e){t=v.assign({mediaConstraints:{screen:!0}},t),this.publishToRoom(t,e)},i.prototype.subscribeToMemberStream=function(i,r,s,o){var a=this;if(y.e(i,"memberStream"),y.e(r,"options"),y.b(s,"callback"),o=v.C(o)?o:0,r.capabilities)throw new Error("subscribeToMemberStream options.capabilities is deprecated. Please use the constructor features option");if(r.streamToken&&!(f=I.call(a,r.streamToken)))return a.a.warn("Failed to parse the `streamToken` [%s]",r.streamToken),s(new Error("Bad `streamToken`"),{status:"bad-token"});var t,e,u=i.getUri(),c=i.getPCastStreamId(),n=i.getInfo(),h=v.get(n,["isScreen"],!1),l=null,d=n.capabilities||(t=u,e=w.getInfoFromStreamUri(t),t=[],e.streamTokenForLiveStream&&t.push("streaming"),t)||[],e=this.tt.getPreferredFeatureFromPublisherCapabilities(f||d),t=S.mapFeatureToPCastCapability(e),f=t?[t]:[],m=this.tt.getFeaturePCastCapabilities(),p=!1;if(!c)throw this.a.error("Invalid Member Stream. Unable to parse streamId from uri"),new Error("Invalid Member Stream. Unable to parse streamId from uri");if(v.hasIndexOrKey(n,"capabilities")){if(!e)return this.a.warn("Unable to find supported feature. Publisher capabilities [%s]. Requested feature capabilities [%s]",n.capabilities,m),s(null,{status:"unsupported-features"});l=function(t){var e=w.getInfoFromStreamUri(u);switch(t){case"rtmp":case"hls":case"dash":return e.streamTokenForLiveStream;case"real-time":return e.streamToken;default:return}}(e)}else{if(!e){if(!(d=v.get(m,[o]))&&o>=m.length)return s(null,{status:"no-supported-features"});f=d?[d]:[],e=d?v.get(S.mapPCastCapabilityToFeatures(d),[0]):null}if(!n.streamTokenForLiveStream&&"streaming"===t)return this.a.warn("Streaming is not available for stream [%].",c),s(null,{status:"streaming-not-available"});l=function(t,e){var i=w.getInfoFromStreamUri(u),n=i.streamTokenForLiveStream&&v.includes(e,"streaming"),t=i.streamTokenForLiveStream&&v.includes(e,"rtmp");if(!v.includes(e,"drm-open-access")||!v.includes(e,"drm-hollywood"))return n&&i.streamTokenForLiveStreamWithDrmOpenAccess&&(v.includes(e,"drm-open-access")||S.isAndroid())?i.streamTokenForLiveStreamWithDrmOpenAccess:n&&i.streamTokenForLiveStreamWithDrmHollywood&&v.includes(e,"drm-hollywood")?i.streamTokenForLiveStreamWithDrmHollywood:n||t?i.streamTokenForLiveStream:i.streamTokenForBroadcastStream&&v.includes(e,"broadcast")?i.streamTokenForBroadcastStream:v.includes(e,"streaming")||v.includes(e,"broadcast")||v.includes(e,"rtmp")?void 0:i.streamToken}(0,f),p=!0}this.a.info("Subscribing to member stream with feature [%s] and pre-generated token [%s]",e,!!l);var f=v.assign({},{streamId:c,streamToken:l,capabilities:f},r),g=new b.DisposableList;!function(t,e,n){function i(t,e){if(t)return n(t);if("ok"!==e.status&&"streaming-not-ready"!==e.status)return n(null,e);if(s++,!("streaming-not-ready"===e.status&&s<3))return"streaming-not-ready"===e.status&&3<=s?n(null,{status:e.status}):(e=v.assign({},e,{status:"ok"}),1<s?(e.reason="stream-failure-recovered",n(null,e)):void n(null,e));t=s*s*1e3,r.a.info("Waiting for [%s] ms before retrying after [streaming-not-ready] status.",t);var i=setTimeout(e.retry,t);r.T.add(new b.Disposable(function(){clearTimeout(i)}))}var r=this,s=0;return e?r.Ve.subscribeToScreen(t,i):r.Ve.subscribe(t,i)}.call(this,f,h,function(t,n){if(g.dispose(),n&&"ok"===n.status&&n.mediaStream&&n.mediaStream.getStream()&&(g.add(i.getObservableAudioState().subscribe(function(t){var e=n.mediaStream.getMonitor(),i=n.mediaStream.getStream().getAudioTracks();e&&1===i.length&&e.setMonitorTrackState(i[0],t===k.states.trackEnabled.name)},{initial:"notify"})),g.add(i.getObservableVideoState().subscribe(function(t){var e=n.mediaStream.getMonitor(),i=n.mediaStream.getStream().getVideoTracks();e&&1===i.length&&e.setMonitorTrackState(i[0],t===k.states.trackEnabled.name)},{initial:"notify"}))),t&&6===parseInt(t.category))return s(t,{status:"device-insecure"});if(n&&("failed"===n.status||"streaming-not-available"===n.status)&&p&&o<m.length)return a.a.info("Attempting to subscribe to member stream with next available feature after failure"),a.subscribeToMemberStream(i,r,s,o+1);var e=v.assign({originStreamId:c},n);s(t,e)})},i}.apply(e,i))||(t.exports=i)},function(t,e,i){i=[i(0),i(1)];void 0===(i=function(s,n){"use strict";var o="most-recent";function t(t,e,i){t&&n.S(t,"selectionStrategy"),n.e(e,"logger"),this.Xe=t||o,this.a=e,this.$e=s.get(i,["failureCountForBanningAMember"],100),this.Ye=s.get(i,["banMemberOnCapacityFailureCount"],5),this.reset()}function a(t){return t?t.getSessionId()+t.getObservableScreenName().getValue():""}function u(t){return h(t.getObservableScreenName().getValue())}function c(t){return l(t.getObservableScreenName().getValue())}function h(t){return/primary/i.test(t)}function l(t){return/alternate/i.test(t)}return t.prototype.getNext=function(t){this.a.info("Select member from [%s]",t);var e=function(t){var e,n=this;switch(this.Xe){case o:return e=s.reduce(t,function(t,e){var i=a(e);return s.get(n.Ze,[i],!1)||t.push(e),t},[]),s.reduce(e,function(t,e){return t&&t.getLastUpdate()>e.getLastUpdate()?t:e});case"high-availability":if(this.ti&&s.includes(t,this.ti))return this.ti;var i=void 0,r=Number.MAX_VALUE;return s.forEach(t,function(t){var e=a(t);s.get(n.Ze,[e],!1)||((e=s.get(n.ei,[t],0))<r?(r=e,i=t):e===r&&(i?u(t)?u(i)||(i=t):c(t)&&(u(i)||c(i)||(i=t)):i=t))}),i;default:throw new Error("Invalid Selection Strategy")}}.call(this,t);return e?this.a.info("Selecting new member [%s]/[%s]",e.getSessionId(),e.getObservableScreenName().getValue()):this.a.info("Unable to select new member from [%s]",t),this.ti=e},t.prototype.getStrategy=function(){return this.Xe},t.prototype.markFailed=function(t){if(this.ti){var e=a(this.ti);if(s.get(t,["failedDueToCapacity"],!1)){var i=s.get(this.ii,[e],0);if(s.set(this.ii,[e],++i),i>=this.Ye)return this.a.info("Disabling member [%s] that has exceeded threshold due to [%s] capacity failures",e,i),this.markDead()}if(i=s.get(this.ei,[e],0),this.a.info("Failure count for member [%s] is now [%s]",e,++i),s.set(this.ei,[e],i),i>=this.$e)return this.a.info("Disabling member [%s] that has exceeded threshold due to [%s] failures",e,i),this.markDead();this.ti=null}else this.a.warn("Marking failed member but there was no recent selected member")},t.prototype.markDead=function(){var t;this.ti?(t=a(this.ti),this.a.info("Member [%s] is now permanently removed",t),s.set(this.Ze,[t],!0),this.ti=null):this.a.warn("Marking dead member but there was no recent selected member")},t.prototype.getNumberOfMembersWithFailures=function(){return s.keys(this.ei).length},t.prototype.reset=function(){this.ti=null,this.ei={},this.ii={},this.Ze={}},t.prototype.dispose=function(){this.reset()},t.getSimilarMembers=function(e,i,t){var n=s.filter(t,function(t){return t.getObservableScreenName().getValue()!==e&&(!i||t.getSessionId()!==i)}),r=s.filter(n,u),t=s.filter(n,c);return h(e)?r||t||n:l(e)?t||r||n:n||r||t},t}.apply(e,i))||(t.exports=i)},function(t,e,i){i=[i(0),i(1)];void 0===(i=function(t,e){"use strict";function i(t){e.e(t,"room"),this.ni=t}return i.prototype.getChannelId=function(){return this.ni.getRoomId.apply(this.ni,arguments)},i.prototype.getObservableAlias=function(){return this.ni.getObservableAlias.apply(this.ni,arguments)},i.prototype.getObservableName=function(){return this.ni.getObservableName.apply(this.ni,arguments)},i.prototype.getObservableDescription=function(){return this.ni.getObservableDescription.apply(this.ni,arguments)},i.prototype.getObservableType=function(){return this.ni.getObservableType.apply(this.ni,arguments)},i.prototype.getObservableMembers=function(){return this.ni.getObservableMembers.apply(this.ni,arguments)},i.prototype.getObservableBridgeId=function(){return this.ni.getObservableBridgeId.apply(this.ni,arguments)},i.prototype.getObservablePin=function(){return this.ni.getObservablePin.apply(this.ni,arguments)},i.prototype.toString=function(){return this.ni.toString.apply(this.ni,arguments)},i.prototype.toJson=function(){return{channelId:this.ni.getRoomId(),alias:this.ni.getObservableAlias().getValue(),name:this.ni.getObservableName().getValue(),description:this.ni.getObservableDescription().getValue(),type:this.ni.getObservableType().getValue(),pin:this.ni.getObservablePin().getValue(),bridgeId:this.ni.getObservableBridgeId().getValue()}},i.prototype.commitChanges=function(){return this.ni.commitChanges.apply(this.ni,arguments)},i.prototype.reload=function(){return this.ni.reload.apply(this.ni,arguments)},i.prototype.O=function(){return this.ni.O.apply(this.ni,arguments)},i.prototype.Zt=function(){return this.ni.Zt.apply(this.ni,arguments)},i.prototype.Yt=function(){return this.ni.Yt.apply(this.ni,arguments)},i.prototype.te=function(){return this.ni.te.apply(this.ni,arguments)},i}.apply(e,i))||(t.exports=i)},function(t,e,i){i=[i(2),i(8),i(21),i(30),i(64),i(68),i(35),i(36),i(38),i(72),i(37)];void 0===(i=function(t,e,i,n,r,s,o,a,u,c,h){"use strict";return{express:{PCastExpress:a,RoomExpress:u,ChannelExpress:c},lowLevel:{PCast:t.global.PhenixPCast=i,RoomService:n},media:{AudioSpeakerDetector:r,UserMediaResolver:o},net:{AdminApiProxyClient:h},utils:{BandwidthMonitor:s,logging:e,rtc:t},AudioSpeakerDetector:r,BandwidthMonitor:s,logging:e,PCast:i,RoomService:n,RTC:t,UserMediaResolver:o}}.apply(e,i))||(t.exports=i)},function(t,e,i){i=[i(0),i(1),i(10),i(43)];void 0===(i=function(t,e,i,n){function r(){this.ri={}}return r.prototype.getAppender=function(t){var e=i.getEnvironmentFromUrl(t||""),t=i.getTelemetryServerUri(t);return this.ri[e]||(this.ri[e]=function(t){var e=new n(t);return t||e.setEnabled(!1),e}.call(this,t)),this.ri[e]},new r}.apply(e,i))||(t.exports=i)},function(t,e,i){i=[i(0),i(1),i(2),i(8),i(16),i(23)];void 0===(i=function(c,h,e,i,n,r){function t(t){h.x(t,"uri"),this.si="object"==typeof location?location.hostname:e.browser+"-"+e.browserVersion+"-unknown",this.oi=i.level.TRACE,this.ai=!0,this.ui=(e.browser||"Browser")+"/"+(e.browserVersion||"?"),this.ci=0,this.hi=new n.BatchHttpProto(t+"/logs",[r],"telemetry.StoreLogRecords",{maxAttempts:3,maxBufferedRecords:1e3,maxBatchSize:512}),this.hi.on("capacity",c.bind(s,this))}function s(t){this.hi.addRecordToBeginning({level:"Warn",timestamp:c.isoString(),category:"websdk/telemetryLogger",message:"Deleted "+t+" records",source:this.ui,fullQualifiedName:this.si,sessionId:this.li,userId:this.di,environment:this.fi,version:this.mi,runtime:this.ci})}return t.prototype.setThreshold=function(t){h.C(t,"level"),this.oi=t},t.prototype.getThreshold=function(){return this.oi},t.prototype.isEnabled=function(){return this.ai},t.prototype.setEnabled=function(t){h.L(t,"enabled"),this.ai=t},t.prototype.log=function(t,e,i,n,r,s,o,a,u){u.level<this.oi||!this.ai||(h.isArray(n,"messages"),this.ci=t,this.li=r,this.di=s,this.mi=a,this.fi=o,function(t,e,i){this.hi.addRecord({level:t,timestamp:c.isoString(),category:e,message:i.join(" "),source:this.ui,fullQualifiedName:this.si,sessionId:this.li,userId:this.di,environment:this.fi,version:this.mi,runtime:this.ci})}.call(this,e,i,n))},t}.apply(e,i))||(t.exports=i)},function(t,e,i){i=[i(0),i(1),i(4),i(16),i(2),i(45),i(46)];void 0===(i=function(a,u,r,s,c,o,h){"use strict";function t(t,e,i,n){u.S(t,"uri"),u.x(e,"deviceId"),u.S(i,"version"),u.e(n,"logger"),this.j=e,this.I=i,this.a=n,this.pi=new s.MQWebSocket(t,this.a,[o,h],5),this.B=new r.Observable(null).extend({rateLimit:0})}return t.prototype.onEvent=function(t,e){return this.pi.onEvent(t,e)},t.prototype.disconnect=function(){return this.B.setValue(null),this.pi.disconnect()},t.prototype.authenticate=function(t,n){u.S(t,"authToken"),u.b(n,"callback"),t={apiVersion:this.pi.getApiVersion(),clientVersion:this.I,deviceId:this.j,platform:c.browser,platformVersion:c.browserVersion.toString(),authenticationToken:t},this.getSessionId()&&(t.sessionId=this.getSessionId());var r=this;return this.pi.sendRequest("pcast.Authenticate",t,function(t,e){var i;return e&&((i=r.B.getValue())&&i!==e.sessionId&&r.pi.disposeOfPendingRequests(),r.B.setValue(e.sessionId)),n(t,e)})},t.prototype.getSessionId=function(){return this.B.getValue()},t.prototype.getObservableSessionId=function(){return this.B},t.prototype.bye=function(t,e){return u.S(t,"reason"),u.b(e,"callback"),t={sessionId:this.getSessionId(),reason:t},this.pi.sendRequest("pcast.Bye",t,e)},t.prototype.setupStream=function(t,e,i,n,r){u.S(t,"streamType"),u.S(e,"streamToken"),u.e(i,"options"),u.b(r,"callback");var s=c.browser||"UnknownBrowser",o=s+"-"+(c.browserVersion||0),n="rtt[http]="+n,n={streamToken:e,createStream:{sessionId:this.getSessionId(),options:["data-quality-notifications",n],connectUri:i.connectUri,connectOptions:i.connectOptions||[],tags:i.tags||[],userAgent:a.get(c,["global","navigator","userAgent"],o)}};return i.originStreamId&&(n.createStream.originStreamId=i.originStreamId),i.negotiate&&(n.createStream.createOfferDescription={streamId:"",options:[t,s,o],apiVersion:this.pi.getApiVersion()},"undefined"!=typeof screen&&n.createStream.createOfferDescription.options.push("screen="+screen.width+"x"+screen.height)),!1===i.receiveAudio&&n.createStream.options.push("no-audio"),!1===i.receiveVideo&&n.createStream.options.push("no-video"),this.pi.sendRequest("pcast.SetupStream",n,r)},t.prototype.setAnswerDescription=function(t,e,i){return u.S(t,"streamId"),u.S(e,"sdp"),u.b(i,"callback"),e={streamId:t,sessionDescription:{type:"Answer",sdp:e},apiVersion:this.pi.getApiVersion()},this.pi.sendRequest("pcast.SetRemoteDescription",e,i)},t.prototype.addIceCandidates=function(t,e,i,n){return u.S(t,"streamId"),u.isArray(e,"candidates"),u.e(i,"options"),u.b(n,"callback"),i={streamId:t,candidates:a.map(e,function(t,e){return u.S(t.candidate,"candidate["+e+"].candidate"),u.C(t.sdpMLineIndex,"candidate["+e+"].sdpMLineIndex"),u.S(t.sdpMid,"candidate["+e+"].sdpMid"),{candidate:t.candidate,sdpMLineIndex:t.sdpMLineIndex,sdpMid:t.sdpMid}}),options:i,apiVersion:this.pi.getApiVersion()},this.pi.sendRequest("pcast.AddIceCandidates",i,n)},t.prototype.updateStreamState=function(t,e,i,n,r){return u.S(t,"streamId"),u.S(e,"signalingState"),u.S(i,"iceGatheringState"),u.S(n,"iceConnectionState"),u.b(r,"callback"),n={streamId:t,signalingState:e,iceGatheringState:i,iceConnectionState:n,apiVersion:this.pi.getApiVersion()},this.pi.sendRequest("pcast.UpdateStreamState",n,r)},t.prototype.destroyStream=function(t,e,i){return u.S(t,"streamId"),u.x(e,"reason"),u.b(i,"callback"),this.pi.sendRequest("pcast.DestroyStream",{streamId:t,reason:e},i)},t.prototype.getRoomInfo=function(t,e,i){return t?u.x(t,"roomId"):u.x(e,"alias"),u.b(i,"callback"),e={roomId:t,alias:e,sessionId:this.getSessionId()},this.pi.sendRequest("chat.GetRoomInfo",e,i)},t.prototype.createRoom=function(t,e){return u.e(t,"room"),u.S(t.name,"room.name"),u.S(t.type,"room.type"),u.S(t.description,"room.description"),u.b(e,"callback"),t={sessionId:this.getSessionId(),room:t},this.pi.sendRequest("chat.CreateRoom",t,e)},t.prototype.enterRoom=function(t,e,i,n,r,s){return t?u.x(t,"roomId"):u.x(e,"alias"),u.e(i,"member"),u.C(r,"timestamp"),u.isArray(n,"options"),u.b(s,"callback"),r={roomId:t,alias:e,sessionId:this.getSessionId(),member:i,options:n,timestamp:r},this.pi.sendRequest("chat.JoinRoom",r,s)},t.prototype.leaveRoom=function(t,e,i){return u.x(t,"roomId"),u.C(e,"timestamp"),u.b(i,"callback"),e={roomId:t,sessionId:this.getSessionId(),timestamp:e},this.pi.sendRequest("chat.LeaveRoom",e,i)},t.prototype.updateMember=function(t,e,i,n){return u.S(t,"roomId"),u.e(e,"member"),u.C(i,"timestamp"),u.b(n,"callback"),e.updateStreams=Object.prototype.hasOwnProperty.call(e,"streams"),i={sessionId:this.getSessionId(),roomId:t,member:e,timestamp:i},this.pi.sendRequest("chat.UpdateMember",i,n)},t.prototype.updateRoom=function(t,e,i){return u.e(t,"room"),u.C(e,"timestamp"),u.b(i,"callback"),e={sessionId:this.getSessionId(),room:t,timestamp:e},this.pi.sendRequest("chat.UpdateRoom",e,i)},t.prototype.sendMessageToRoom=function(t,e,i){return u.S(t,"roomId"),u.e(e,"chatMessage"),this.pi.sendRequest("chat.SendMessageToRoom",{roomId:t,chatMessage:e},i)},t.prototype.subscribeToRoomConversation=function(t,e,i,n){return u.S(t,"sessionId"),u.S(e,"roomId"),u.C(i,"batchSize"),this.pi.sendRequest("chat.FetchRoomConversation",{sessionId:t,roomId:e,limit:i,options:["Subscribe"]},n)},t.prototype.getMessages=function(t,e,i,n,r,s){return u.S(t,"sessionId"),u.S(e,"roomId"),r&&n||u.C(i,"batchSize"),i={sessionId:t,roomId:e,limit:i||0,options:[]},r&&(u.S(r,"beforeMessageId"),i.beforeMessageId=r),n&&(u.S(n,"afterMessageId"),i.afterMessageId=n),this.pi.sendRequest("chat.FetchRoomConversation",i,s)},t.prototype.toString=function(){return"PCastProtocol["+this.pi.toString()+"]"},t}.apply(e,i))||(t.exports=i)},function(t,e,i){void 0===(e=function(){"use strict";return{package:"pcast",options:{optimize_for:"LITE_RUNTIME"},messages:[{name:"Authenticate",fields:[{rule:"optional",type:"uint32",name:"apiVersion",id:9,options:{default:0}},{rule:"required",type:"string",name:"clientVersion",id:1},{rule:"optional",type:"string",name:"device",id:12},{rule:"required",type:"string",name:"deviceId",id:2},{rule:"optional",type:"string",name:"manufacturer",id:13},{rule:"required",type:"string",name:"platform",id:3},{rule:"required",type:"string",name:"platformVersion",id:4},{rule:"required",type:"string",name:"authenticationToken",id:5},{rule:"optional",type:"string",name:"connectionId",id:6},{rule:"optional",type:"string",name:"connectionRouteKey",id:10},{rule:"optional",type:"string",name:"remoteAddress",id:11},{rule:"optional",type:"string",name:"sessionId",id:7},{rule:"optional",type:"string",name:"applicationId",id:8}]},{name:"AuthenticateResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"string",name:"sessionId",id:2},{rule:"optional",type:"string",name:"redirect",id:3},{rule:"repeated",type:"string",name:"roles",id:4}]},{name:"Bye",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"reason",id:2}]},{name:"ByeResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"SessionDescription",fields:[{rule:"required",type:"Type",name:"type",id:1,options:{default:"Offer"}},{rule:"required",type:"string",name:"sdp",id:2}],enums:[{name:"Type",values:[{name:"Offer",id:0},{name:"Answer",id:1}]}]},{name:"CreateStream",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"optional",type:"string",name:"originStreamId",id:2},{rule:"repeated",type:"string",name:"originStreamIds",id:10},{rule:"repeated",type:"string",name:"options",id:3},{rule:"optional",type:"string",name:"connectUri",id:8},{rule:"repeated",type:"string",name:"connectOptions",id:9},{rule:"repeated",type:"string",name:"tags",id:4},{rule:"optional",type:"string",name:"userAgent",id:11},{rule:"optional",type:"SetRemoteDescription",name:"setRemoteDescription",id:5},{rule:"optional",type:"CreateOfferDescription",name:"createOfferDescription",id:6},{rule:"optional",type:"CreateAnswerDescription",name:"createAnswerDescription",id:7}]},{name:"IceServer",fields:[{rule:"repeated",type:"string",name:"urls",id:1},{rule:"optional",type:"string",name:"username",id:2},{rule:"optional",type:"string",name:"credential",id:3}]},{name:"RtcConfiguration",fields:[{rule:"optional",type:"BundlePolicy",name:"bundlePolicy",id:1},{rule:"optional",type:"uint32",name:"iceCandidatePoolSize",id:3},{rule:"repeated",type:"IceServer",name:"iceServers",id:4},{rule:"optional",type:"IceTransportPolicy",name:"iceTransportPolicy",id:5},{rule:"optional",type:"string",name:"peerIdentity",id:6},{rule:"optional",type:"RtcpMuxPolicy",name:"rtcpMuxPolicy",id:7}],enums:[{name:"BundlePolicy",values:[{name:"BundlePolicyBalanced",id:1},{name:"BundlePolicyMaxCompat",id:2},{name:"BundlePolicyMaxBundle",id:3}]},{name:"IceTransportPolicy",values:[{name:"IceTransportPolicyAll",id:1},{name:"IceTransportPolicyPublic",id:2},{name:"IceTransportPolicyRelay",id:3}]},{name:"RtcpMuxPolicy",values:[{name:"RtcpMuxPolicyNegotiate",id:1},{name:"RtcpMuxPolicyRequire",id:2}]}]},{name:"CreateStreamResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"string",name:"streamId",id:2},{rule:"optional",type:"string",name:"instanceRouteKey",id:5},{rule:"repeated",type:"string",name:"streamUris",id:8},{rule:"optional",type:"RtcConfiguration",name:"rtcConfiguration",id:9},{rule:"optional",type:"SetRemoteDescriptionResponse",name:"setRemoteDescriptionResponse",id:3},{rule:"optional",type:"CreateOfferDescriptionResponse",name:"createOfferDescriptionResponse",id:4},{rule:"optional",type:"CreateAnswerDescriptionResponse",name:"createAnswerDescriptionResponse",id:6},{rule:"repeated",type:"string",name:"options",id:7},{rule:"optional",type:"uint64",name:"offset",id:10,options:{default:0}}]},{name:"SetLocalDescription",fields:[{rule:"required",type:"string",name:"streamId",id:1},{rule:"required",type:"SessionDescription",name:"sessionDescription",id:2},{rule:"optional",type:"uint32",name:"apiVersion",id:3,options:{default:0}}]},{name:"SetLocalDescriptionResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"repeated",type:"string",name:"options",id:2}]},{name:"SetRemoteDescription",fields:[{rule:"required",type:"string",name:"streamId",id:1},{rule:"required",type:"SessionDescription",name:"sessionDescription",id:2},{rule:"optional",type:"uint32",name:"apiVersion",id:3,options:{default:0}}]},{name:"SetRemoteDescriptionResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"SessionDescription",name:"sessionDescription",id:2},{rule:"repeated",type:"string",name:"options",id:3}]},{name:"CreateOfferDescription",fields:[{rule:"required",type:"string",name:"streamId",id:1},{rule:"repeated",type:"string",name:"options",id:2},{rule:"optional",type:"uint32",name:"apiVersion",id:3,options:{default:0}}]},{name:"CreateOfferDescriptionResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"SessionDescription",name:"sessionDescription",id:2},{rule:"repeated",type:"string",name:"options",id:3}]},{name:"CreateAnswerDescription",fields:[{rule:"required",type:"string",name:"streamId",id:1},{rule:"repeated",type:"string",name:"options",id:2},{rule:"optional",type:"uint32",name:"apiVersion",id:3,options:{default:0}}]},{name:"CreateAnswerDescriptionResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"SessionDescription",name:"sessionDescription",id:2},{rule:"repeated",type:"string",name:"options",id:3}]},{name:"IceCandidate",fields:[{rule:"required",type:"string",name:"candidate",id:1},{rule:"required",type:"uint32",name:"sdpMLineIndex",id:2},{rule:"required",type:"string",name:"sdpMid",id:3}]},{name:"AddIceCandidates",fields:[{rule:"required",type:"string",name:"streamId",id:1},{rule:"repeated",type:"IceCandidate",name:"candidates",id:2},{rule:"repeated",type:"string",name:"options",id:3},{rule:"optional",type:"uint32",name:"apiVersion",id:4,options:{default:0}}]},{name:"AddIceCandidatesResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"repeated",type:"string",name:"options",id:2}]},{name:"UpdateStreamState",fields:[{rule:"required",type:"string",name:"streamId",id:1},{rule:"required",type:"string",name:"signalingState",id:2},{rule:"required",type:"string",name:"iceGatheringState",id:3},{rule:"required",type:"string",name:"iceConnectionState",id:4},{rule:"optional",type:"uint32",name:"apiVersion",id:5,options:{default:0}}]},{name:"UpdateStreamStateResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"repeated",type:"string",name:"options",id:2}]},{name:"DestroyStream",fields:[{rule:"required",type:"string",name:"streamId",id:1},{rule:"optional",type:"string",name:"reason",id:2},{rule:"repeated",type:"string",name:"options",id:3}]},{name:"DestroyStreamResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"ConnectionDisconnected",fields:[{rule:"required",type:"string",name:"connectionId",id:1},{rule:"required",type:"uint32",name:"reasonCode",id:2},{rule:"optional",type:"string",name:"description",id:3}]},{name:"ConnectionDisconnectedResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"StreamStarted",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"streamId",id:2},{rule:"repeated",type:"string",name:"tags",id:3}]},{name:"SourceStreamStarted",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"streamId",id:2},{rule:"repeated",type:"string",name:"capabilities",id:3},{rule:"repeated",type:"string",name:"tags",id:4}]},{name:"StreamEnded",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"streamId",id:2},{rule:"required",type:"string",name:"reason",id:3},{rule:"repeated",type:"string",name:"tags",id:4},{rule:"optional",type:"string",name:"continuationId",id:5},{rule:"optional",type:"string",name:"routeKey",id:6}]},{name:"SourceStreamEnded",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"streamId",id:2},{rule:"required",type:"string",name:"reason",id:3},{rule:"repeated",type:"string",name:"capabilities",id:4},{rule:"repeated",type:"string",name:"tags",id:5}]},{name:"StreamEndedResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"string",name:"continuationId",id:2},{rule:"optional",type:"string",name:"routeKey",id:3}]},{name:"StreamIdle",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"streamId",id:2},{rule:"repeated",type:"string",name:"options",id:3},{rule:"repeated",type:"string",name:"tags",id:4}]},{name:"StreamArchived",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"streamId",id:2},{rule:"required",type:"uint64",name:"startTime",id:4},{rule:"required",type:"string",name:"uri",id:3}]},{name:"SessionEnded",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"reason",id:2},{rule:"required",type:"float",name:"duration",id:3}]},{name:"ResourceIdle",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"routeKey",id:2}]},{name:"ResourceIdleResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"StreamPlaylist",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"streamId",id:2},{rule:"required",type:"PlaylistType",name:"playlistType",id:3},{rule:"required",type:"string",name:"uri",id:4},{rule:"required",type:"bool",name:"isVariant",id:5,options:{default:!0}}],enums:[{name:"PlaylistType",values:[{name:"Live",id:0},{name:"OnDemand",id:1}]}]},{name:"StreamRtmp",fields:[{rule:"required",type:"string",name:"streamId",id:1},{rule:"required",type:"string",name:"uri",id:2},{rule:"required",type:"uint32",name:"height",id:3},{rule:"required",type:"uint32",name:"bitrate",id:4}]},{name:"SendEventToClient",fields:[{rule:"required",type:"string",name:"connectionId",id:1},{rule:"required",type:"string",name:"type",id:2},{rule:"required",type:"bytes",name:"payload",id:3}]},{name:"SendEventToClientResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"SendRequestToClient",fields:[{rule:"required",type:"string",name:"connectionId",id:1},{rule:"required",type:"string",name:"type",id:2},{rule:"required",type:"bytes",name:"payload",id:3}]},{name:"SendRequestToClientResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"string",name:"type",id:2},{rule:"optional",type:"bytes",name:"payload",id:3}]},{name:"SetupStream",fields:[{rule:"required",type:"string",name:"streamToken",id:1},{rule:"required",type:"CreateStream",name:"createStream",id:2}]},{name:"SetupStreamResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"CreateStreamResponse",name:"createStreamResponse",id:2}]},{name:"SetupPlaylistStream",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"streamToken",id:2},{rule:"repeated",type:"string",name:"options",id:3},{rule:"repeated",type:"string",name:"tags",id:4}]},{name:"PlaylistStreamManifest",fields:[{rule:"required",type:"string",name:"manifest",id:1},{rule:"required",type:"bool",name:"isProtectedContent",id:2},{rule:"optional",type:"string",name:"drmToken",id:3}]},{name:"SetupPlaylistStreamResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"repeated",type:"PlaylistStreamManifest",name:"manifests",id:2},{rule:"optional",type:"uint64",name:"offset",id:3,options:{default:0}}]},{name:"StreamDataQuality",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"streamId",id:2},{rule:"required",type:"uint64",name:"timestamp",id:3},{rule:"required",type:"DataQualityStatus",name:"status",id:4},{rule:"required",type:"DataQualityReason",name:"reason",id:5}],enums:[{name:"DataQualityStatus",values:[{name:"NoData",id:0},{name:"AudioOnly",id:1},{name:"All",id:2}]},{name:"DataQualityReason",values:[{name:"None",id:0},{name:"UploadLimited",id:1},{name:"DownloadLimited",id:2},{name:"PublisherLimited",id:3},{name:"NetworkLimited",id:4}]}]},{name:"StreamDataQualityResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"CallbackEvent",fields:[{rule:"optional",type:"uint32",name:"apiVersion",id:1,options:{default:0}},{rule:"required",type:"string",name:"entity",id:2},{rule:"required",type:"string",name:"what",id:3},{rule:"required",type:"string",name:"data",id:4},{rule:"optional",type:"string",name:"sessionId",id:5}]},{name:"Uri",fields:[{rule:"optional",type:"string",name:"protocol",id:1,options:{default:"http"}},{rule:"required",type:"string",name:"host",id:2},{rule:"optional",type:"uint32",name:"port",id:3,options:{default:80}},{rule:"optional",type:"string",name:"method",id:4,options:{default:"POST"}},{rule:"optional",type:"string",name:"path",id:5,options:{default:"/"}}]},{name:"SetApplicationCallback",fields:[{rule:"required",type:"string",name:"applicationId",id:1},{rule:"required",type:"string",name:"secret",id:2},{rule:"required",type:"Uri",name:"callback",id:3}]},{name:"SetApplicationCallbackResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"string",name:"endpoint",id:2}]},{name:"IssueAuthenticationToken",fields:[{rule:"required",type:"string",name:"applicationId",id:1},{rule:"required",type:"string",name:"secret",id:2},{rule:"repeated",type:"string",name:"capabilities",id:3}]},{name:"IssueAuthenticationTokenResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"string",name:"authenticationToken",id:2}]},{name:"IssueStreamToken",fields:[{rule:"required",type:"string",name:"applicationId",id:1},{rule:"required",type:"string",name:"secret",id:2},{rule:"required",type:"string",name:"sessionId",id:3},{rule:"optional",type:"string",name:"originStreamId",id:4},{rule:"repeated",type:"string",name:"alternateOriginStreamIds",id:6},{rule:"repeated",type:"string",name:"capabilities",id:5},{rule:"optional",type:"bool",name:"permissive",id:7,options:{default:!1}}]},{name:"IssueStreamTokenResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"string",name:"streamToken",id:2}]},{name:"IssueDrmToken",fields:[{rule:"required",type:"string",name:"applicationId",id:1},{rule:"required",type:"string",name:"secret",id:2},{rule:"optional",type:"string",name:"sessionId",id:3},{rule:"required",type:"string",name:"originStreamId",id:4},{rule:"repeated",type:"string",name:"capabilities",id:5}]},{name:"IssueDrmTokenResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"string",name:"drmToken",id:2}]},{name:"TerminateStream",fields:[{rule:"required",type:"string",name:"applicationId",id:1},{rule:"required",type:"string",name:"secret",id:2},{rule:"optional",type:"string",name:"streamId",id:3,oneof:"streamOrToken"},{rule:"optional",type:"string",name:"streamToken",id:5,oneof:"streamOrToken"},{rule:"optional",type:"string",name:"reason",id:4}],oneofs:{streamOrToken:[3,5]}},{name:"TerminateStreamResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"DeleteStream",fields:[{rule:"required",type:"string",name:"applicationId",id:1},{rule:"required",type:"string",name:"secret",id:2},{rule:"optional",type:"string",name:"streamId",id:3,oneof:"streamOrToken"},{rule:"optional",type:"string",name:"streamToken",id:5,oneof:"streamOrToken"},{rule:"optional",type:"string",name:"reason",id:4}],oneofs:{streamOrToken:[3,5]}},{name:"DeleteStreamResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"Stream",fields:[{rule:"required",type:"string",name:"streamId",id:1}]},{name:"ListStreams",fields:[{rule:"required",type:"string",name:"applicationId",id:1},{rule:"required",type:"string",name:"secret",id:2},{rule:"optional",type:"string",name:"start",id:3},{rule:"required",type:"uint32",name:"length",id:4},{rule:"repeated",type:"string",name:"options",id:5}]},{name:"ListStreamsResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"string",name:"start",id:2},{rule:"optional",type:"uint32",name:"length",id:3},{rule:"repeated",type:"Stream",name:"streams",id:4}]},{name:"GetPlaylistUris",fields:[{rule:"required",type:"string",name:"applicationId",id:1},{rule:"required",type:"string",name:"secret",id:2},{rule:"required",type:"string",name:"streamId",id:3},{rule:"repeated",type:"string",name:"options",id:4}]},{name:"GetPlaylistUrisResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"repeated",type:"Playlist",name:"playlists",id:2},{rule:"optional",type:"StreamMetadata",name:"streamInfo",id:3}],messages:[{name:"PlaylistMetadata",fields:[{rule:"optional",type:"uint32",name:"bitrate",id:1},{rule:"optional",type:"uint32",name:"height",id:2},{rule:"optional",type:"float",name:"framesPerSecond",id:3}]},{name:"StreamMetadata",fields:[{rule:"required",type:"string",name:"startTime",id:1},{rule:"optional",type:"string",name:"endTime",id:2}]},{name:"Playlist",fields:[{rule:"required",type:"string",name:"name",id:1},{rule:"required",type:"PlaylistType",name:"type",id:2},{rule:"required",type:"string",name:"uri",id:3},{rule:"required",type:"bool",name:"isVariant",id:4},{rule:"required",type:"bool",name:"isProtected",id:5},{rule:"required",type:"PlaylistMetadata",name:"info",id:6}]}],enums:[{name:"PlaylistType",values:[{name:"Hls",id:0},{name:"Dash",id:1}]}]}]}}.apply(e,[]))||(t.exports=e)},function(t,e,i){void 0===(e=function(){"use strict";return{package:"chat",options:{optimize_for:"LITE_RUNTIME"},messages:[{name:"Room",fields:[{rule:"optional",type:"string",name:"roomId",id:1},{rule:"optional",type:"string",name:"alias",id:2},{rule:"required",type:"string",name:"name",id:3},{rule:"required",type:"string",name:"description",id:4},{rule:"required",type:"RoomType",name:"type",id:5},{rule:"repeated",type:"string",name:"options",id:6},{rule:"optional",type:"string",name:"bridgeId",id:7},{rule:"optional",type:"string",name:"pin",id:8}]},{name:"Stream",fields:[{rule:"required",type:"StreamType",name:"type",id:1},{rule:"required",type:"string",name:"uri",id:2},{rule:"required",type:"TrackState",name:"audioState",id:3},{rule:"required",type:"TrackState",name:"videoState",id:4}]},{name:"Member",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"screenName",id:2},{rule:"required",type:"MemberRole",name:"role",id:3},{rule:"repeated",type:"Stream",name:"streams",id:4},{rule:"required",type:"MemberState",name:"state",id:5},{rule:"required",type:"uint64",name:"lastUpdate",id:6}]},{name:"MemberUpdate",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"optional",type:"string",name:"screenName",id:2},{rule:"optional",type:"MemberRole",name:"role",id:3},{rule:"required",type:"bool",name:"updateStreams",id:7,options:{default:!1}},{rule:"repeated",type:"Stream",name:"streams",id:4},{rule:"optional",type:"MemberState",name:"state",id:5},{rule:"required",type:"uint64",name:"lastUpdate",id:6}]},{name:"ChatUser",fields:[{rule:"optional",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"screenName",id:2},{rule:"required",type:"MemberRole",name:"role",id:3},{rule:"required",type:"uint64",name:"lastUpdate",id:4}]},{name:"ChatMessage",fields:[{rule:"required",type:"string",name:"messageId",id:1},{rule:"required",type:"uint64",name:"timestamp",id:2},{rule:"required",type:"ChatUser",name:"from",id:3},{rule:"required",type:"string",name:"message",id:4}]},{name:"CreateRoom",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"Room",name:"room",id:2}]},{name:"CreateRoomResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"Room",name:"room",id:2}]},{name:"JoinRoom",fields:[{rule:"optional",type:"string",name:"roomId",id:1},{rule:"optional",type:"string",name:"alias",id:2},{rule:"required",type:"string",name:"sessionId",id:3},{rule:"required",type:"Member",name:"member",id:4},{rule:"repeated",type:"string",name:"options",id:5},{rule:"required",type:"uint64",name:"timestamp",id:6}]},{name:"JoinRoomResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"Room",name:"room",id:2},{rule:"repeated",type:"Member",name:"members",id:3},{rule:"optional",type:"Member",name:"self",id:5},{rule:"repeated",type:"string",name:"options",id:4}]},{name:"UpdateRoom",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"Room",name:"room",id:2},{rule:"required",type:"uint64",name:"timestamp",id:3}]},{name:"UpdateRoomResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"UpdateMember",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"optional",type:"string",name:"roomId",id:5},{rule:"required",type:"MemberUpdate",name:"member",id:2},{rule:"repeated",type:"string",name:"options",id:3},{rule:"required",type:"uint64",name:"timestamp",id:4}]},{name:"UpdateMemberResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"uint64",name:"lastUpdate",id:2}]},{name:"LeaveRoom",fields:[{rule:"required",type:"string",name:"roomId",id:1},{rule:"required",type:"string",name:"sessionId",id:2},{rule:"required",type:"uint64",name:"timestamp",id:3}]},{name:"LeaveRoomResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"DestroyRoom",fields:[{rule:"required",type:"string",name:"roomId",id:1}]},{name:"DestroyRoomResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"GetRoomInfo",fields:[{rule:"optional",type:"string",name:"roomId",id:1},{rule:"optional",type:"string",name:"alias",id:2},{rule:"optional",type:"string",name:"sessionId",id:3},{rule:"optional",type:"string",name:"applicationId",id:4},{rule:"optional",type:"string",name:"secret",id:5},{rule:"repeated",type:"string",name:"options",id:6}]},{name:"GetRoomInfoResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"optional",type:"Room",name:"room",id:2},{rule:"repeated",type:"Member",name:"members",id:3},{rule:"repeated",type:"string",name:"options",id:4}]},{name:"RoomEvent",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"roomId",id:2},{rule:"required",type:"RoomEventType",name:"eventType",id:3},{rule:"repeated",type:"Member",name:"members",id:4},{rule:"optional",type:"Room",name:"room",id:5},{rule:"repeated",type:"string",name:"options",id:6},{rule:"required",type:"uint64",name:"timestamp",id:7}]},{name:"SendMessageToRoom",fields:[{rule:"required",type:"string",name:"roomId",id:1},{rule:"required",type:"ChatMessage",name:"chatMessage",id:2}]},{name:"SendMessageToRoomResponse",fields:[{rule:"required",type:"string",name:"status",id:1}]},{name:"FetchRoomConversation",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"roomId",id:2},{rule:"optional",type:"string",name:"afterMessageId",id:3},{rule:"optional",type:"string",name:"beforeMessageId",id:4},{rule:"required",type:"uint32",name:"limit",id:5},{rule:"repeated",type:"RoomConversationOption",name:"options",id:6}]},{name:"FetchRoomConversationResponse",fields:[{rule:"required",type:"string",name:"status",id:1},{rule:"repeated",type:"ChatMessage",name:"chatMessages",id:2}]},{name:"RoomConversationEvent",fields:[{rule:"required",type:"string",name:"sessionId",id:1},{rule:"required",type:"string",name:"roomId",id:2},{rule:"required",type:"RoomConversationEventType",name:"eventType",id:3},{rule:"repeated",type:"ChatMessage",name:"chatMessages",id:4}]},{name:"RoomBridgeIdle",fields:[{rule:"required",type:"string",name:"roomId",id:1},{rule:"required",type:"string",name:"bridgeId",id:2}]}],enums:[{name:"RoomType",values:[{name:"DirectChat",id:0},{name:"MultiPartyChat",id:1},{name:"ModeratedChat",id:2},{name:"TownHall",id:3},{name:"Channel",id:4}]},{name:"MemberRole",values:[{name:"Participant",id:0},{name:"Moderator",id:1},{name:"Presenter",id:2},{name:"Audience",id:3}]},{name:"MemberState",values:[{name:"Active",id:0},{name:"Passive",id:1},{name:"HandRaised",id:2},{name:"Inactive",id:3},{name:"Offline",id:4}]},{name:"RoomEventType",values:[{name:"MemberJoined",id:0},{name:"MemberLeft",id:1},{name:"MemberUpdated",id:2},{name:"RoomUpdated",id:3},{name:"RoomEnded",id:4}]},{name:"TrackState",values:[{name:"TrackEnabled",id:0},{name:"TrackDisabled",id:1},{name:"TrackEnded",id:2}]},{name:"StreamType",values:[{name:"User",id:0},{name:"Presentation",id:1},{name:"Audio",id:2}]},{name:"RoomConversationOption",values:[{name:"Subscribe",id:0}]},{name:"RoomConversationEventType",values:[{name:"Message",id:0}]}]}}.apply(e,[]))||(t.exports=e)},function(t,e){t.exports=m},function(t,e,i){i=[i(0),i(1),i(4),i(2)];void 0===(i=function(o,i,n,a){"use strict";var t=52;function e(t,e){i.e(t=t||{},"options"),i.e(e,"logger"),this.a=e,this.gi=t.screenSharingExtensionId||("Chrome"!==a.browser?"":"icngjadgidcmifnehjcielbmiapkhjpn"),this.vi=t.eagerlyCheckScreenSharingCapabilities||!1,this.yi=!1,this.bi=new n.Observable(!1),this.vi?c.call(this,o.bind(u,this)):u.call(this,!1)}function u(t){this.bi.setValue(!0),this.yi=t}function c(e){var i=this;if("Chrome"===a.browser&&i.gi){var n=h.call(this);if(!n)return e(!1);try{n.sendMessage(i.gi,{type:"version"},function(t){return n.lastError||!t||"ok"!==t.status?(i.a.info("Screen sharing NOT available"),void e(!1)):(i.a.info("Screen sharing enabled using version [%s]",t.version),void e(!0))})}catch(t){t.message&&i.a.warn(t.message,t),e(!1)}}else"Firefox"===a.browser&&a.browserVersion>=t||"Firefox"===a.browser&&o.e(a.global.PCastScreenSharing)?e(!0):e(!1)}function r(t){if(this.bi.getValue())return t();var e=this.bi.subscribe(function(){return e.dispose(),t()})}function s(r,s){switch(a.browser){case"Chrome":return function(e){var i=this,n=h.call(this);if(!n)return e(new Error("not-available"));try{n.sendMessage(i.gi,{type:"get-desktop-media",sources:["screen","window","tab","audio"]},function(t){return n.lastError||!t?c.call(i,function(t){return u.call(i,t),e(new Error("extension-failure"))}):void("ok"===t.status?e(null,t):e(new Error(t.status),t))})}catch(t){t.message&&i.a.warn(t.message),e(t,{status:"failed"})}}.call(this,function(t,e){return t||e&&"ok"!==e.status?s(t,e):(e.data||e.options||(e.options={canRequestAudioTrack:!0}),void s(null,{status:"ok",constraints:(i=r,n=e.streamId,t=e.options,e={},o.e(i)&&o.e(i.screen)&&(e.video=i.screen),o.e(i)&&o.e(i.screenAudio)&&t.canRequestAudioTrack&&(e.audio=i.screenAudio),i.screen&&o.set(e,["video","mandatory"],{chromeMediaSource:"desktop",chromeMediaSourceId:n}),i.screenAudio&&t.canRequestAudioTrack&&o.set(e,["audio","mandatory"],{chromeMediaSource:"system",chromeMediaSourceId:n}),e)}));var i,n});case"Firefox":s(null,{status:"ok",constraints:(t=r,e={video:{}},o.e(t)&&o.e(t.screen)&&(e.video=t.screen),e.video.mediaSource=e.video.mediaSource||"window",e)});break;default:s(new Error("not-supported"),{status:"not-supported"})}var t,e}function h(){return"Chrome"!==a.browser?null:"undefined"!=typeof chrome&&chrome.runtime&&chrome.runtime.sendMessage?chrome.runtime:(this.a.info("Screen sharing NOT available. Runtime not supported"),null)}return e.prototype.checkForScreenSharingCapability=function(e){return c.call(this,function(t){u.call(this,t),e(t)})},e.prototype.isScreenSharingEnabled=function(e){var i=this;return r.call(this,function(){return i.vi||i.yi?e(i.yi):void c.call(i,function(t){i.yi=t,e(t)})})},e.prototype.getScreenSharingConstraints=function(t,e){return r.call(this,o.bind(s,this,t,e))},e.prototype.toString=function(){return"ScreenShareExtensionManager["+a.browser+"]"},e}.apply(e,i))||(t.exports=i)},function(t,e,i){i=[i(0),i(1),i(2)];void 0===(i=function(u,a,c){"use strict";function t(t,e,i){a.e(t,"logger"),a.e(e,"screenShareExtensionManager"),i&&a.b(i,"onScreenShare"),this.a=t,this.V=e,this.be=i}function i(i,e,n){function r(t){n(h(t),void 0,t)}function s(t){!function(i){var n={},r={},s=this;setTimeout(function t(){u.reduce(i.getTracks(),function(t,e){return t&&(a.wi(e,"track"),"ended"===e.readyState)},!0)||(u.forEach(i.getTracks(),function(t){var e;c.global.Event&&u.hasIndexOrKey(n,t.id)&&n[t.id]!==t.enabled&&(((e=new c.global.Event("trackenabledchange")).data=t).dispatchEvent(e),s.a.info("[%s] Detected track [%s] enabled change to [%s]",i.id,t.id,t.enabled)),c.global.Event&&u.hasIndexOrKey(r,t.id)&&r[t.id]!==t.readyState&&(((e=new c.global.Event("readystatechange")).data=t).dispatchEvent(e),s.a.info("[%s] Detected track [%s] Ready State change to [%s]",i.id,t.id,t.readyState)),n[t.id]=t.enabled,r[t.id]=t.readyState}),setTimeout(t,2e3))},2e3)}.call(o,t),e("ok",t)}var o=this;return function(e,i){var n=this;if(e.screen)return n.V.isScreenSharingEnabled(function(t){return t?n.V.getScreenSharingConstraints(e,i):i(new Error("screen-sharing-not-available"))});var t={audio:e.audio||!1,video:e.video||!1};i(null,{status:"ok",constraints:t})}.call(this,i,function(t,e){if("ok"!==u.get(e,["status"]))return r(t);if("cancelled"!==e.status){if(e=e.constraints,o.be&&(i.screen||i.screenAudio)&&"Chrome"===c.browser&&!(e=o.be(e)))throw new Error("onScreenShare must return an object of user media constraints");try{c.getUserMedia(e,s,r)}catch(t){r(t)}}else n("cancelled",null)})}t.prototype.getUserMedia=function(t,e){a.e(t,"options"),a.b(e,"callback"),function(n,r){function s(t,e){a.yt&&a.yt.push(e),r(a,t,e)}function o(t,e,i){n.screenAudio&&a.a.warn("Screen capture with audio is only supported on Windows or Chrome OS."),r(a,t,e,i)}var a=this,t=n.screen||n.screenAudio,e=n.video||n.audio;return t&&e?i.call(a,{screen:n.screen},function(t,r){return i.call(a,{audio:n.audio,video:n.video},function(t,e){var i=e,n=r.getTracks();i&&u.b(i.addTrack)&&u.forEach(n,function(t){i.addTrack(t)}),s(t,e)},function(t,e,i){!function(t){if(t&&u.b(t.stop)&&t.stop(),t&&u.b(t.getTracks))for(var e=t.getTracks(),i=0;i<e.length;i++)e[i].stop()}(r),o(t,e,i)})},o):i.call(a,n,s,o)}.call(this,t,e)};var h=function(t){return t="unavailable"===t.code?"conflict":"permission-denied"===t.message||"PermissionDeniedError"===t.name?"permission-denied":"InternalError"===t.name&&"Starting video failed"===t.message||"SourceUnavailableError"===t.name?"conflict":"SecurityError"===t.name&&"The operation is insecure."===t.message?"permission-denied":"failed"};return t}.apply(e,i))||(t.exports=i)},function(t,e,i){i=[i(0),i(1),i(10),i(51)];void 0===(i=function(t,e,i,n){function r(){this.ki={}}return r.prototype.createMetricsTransmitter=function(t){var e=i.getEnvironmentFromUrl(t||""),t=i.getTelemetryServerUri(t);return this.ki[e]||(this.ki[e]=function(t,e){return e=new n(t,e),t||e.setEnabled(!1),e}.call(this,t,e)),this.ki[e]},new r}.apply(e,i))||(t.exports=i)},function(t,e,i){i=[i(0),i(1),i(16),i(2),i(23)];void 0===(i=function(o,a,i,n,r){function t(t,e){a.x(t,"uri"),this.si="object"==typeof location?location.hostname:n.browser+"-"+n.browserVersion+"-unknown",this.ai=!0,this.ui=(n.browser||"Browser")+"/"+(n.browserVersion||"?"),this.hi=new i.BatchHttpProto(t+"/metrics",[r],"telemetry.SubmitMetricRecords",{maxAttempts:3,maxBufferedRecords:1e3,maxBatchSize:512}),this.fi=e,this.hi.on("capacity",o.bind(s,this))}function s(t){this.hi.addRecordToBeginning({metric:"MetricDropped",value:{uint64:t},timestamp:o.isoString(),sessionId:this.li,streamId:this.Si,source:this.ui,fullQualifiedName:this.si,environment:this.fi,version:this.mi,runtime:this.ci})}return t.prototype.isEnabled=function(){return this.ai},t.prototype.setEnabled=function(t){a.L(t,"enabled"),this.ai=t},t.prototype.submitMetric=function(t,e,i,n,r,s){this.ai&&(a.S(t,"metric"),a.e(s,"value"),this.ci=e,this.li=i,this.Si=n,this.mi=r,function(t,e){t=o.assign({},e,{metric:t,timestamp:o.isoString(),sessionId:this.li,streamId:this.Si,source:this.ui,fullQualifiedName:this.si,environment:this.fi,version:this.mi,runtime:this.ci}),this.hi.addRecord(t)}.call(this,t,s))},t}.apply(e,i))||(t.exports=i)},function(t,e,i){i=[i(0),i(1),i(3),i(2)];void 0===(i=function(a,r,u,c){"use strict";var t=c.global.__phenixPageLoadTime||c.global.__pageLoadTime||a.now();function e(t,e,i){r.S(t,"sessionId"),this.I="2022-04-13T15:08:08Z",this.se=t,this.Ii={},this.a=e,this.nt=i,this.Ri=a.now(),this.T=new u.DisposableList,this.Ti=[],this.qi=[],this.Ci=[],this.Ei=null,h.call(this,"Stream initializing")}function h(){if(0===(e=Array.prototype.slice.call(arguments)).length)throw new Error("Invalid logging arguments.");var t="[%s] [StreamTelemetry] [%s] "+e[0],e=e.slice(1),e=[t,this.A,a.now()-this.Ri].concat(e);this.a.debug.apply(this.a,e)}function s(){return(a.now()-t)/1e3}function o(t,e){r.S(t.metric,"record.metric");var i=a.assign({},this.Ii,t);this.nt.submitMetric(t.metric,e,this.se,this.A,this.I,i)}return e.prototype.setProperty=function(t,e){r.S(t,"name"),r.S(e,"value"),this.Ii[t]=e},e.prototype.recordMetric=function(t,e,i,n){r.S(t,"metric"),n=a.assign({},{metric:t,elapsed:this.elapsed(),value:e,previousValue:i},n||{}),o.call(this,n,s())},e.prototype.setStreamId=function(t){if(r.S(t,"streamId"),this.A)throw new Error("Stream ID can only be set once.");this.A=t,t=a.now(),o.call(this,{metric:"Initialized",elapsed:this.elapsed()-t+this.Ri},s()-(t-this.Ri)/1e3)},e.prototype.setStartOffset=function(t){if(r.C(t,"startOffset"),this.xi)throw new Error("Start offset can only be set once.");this.xi=t,this.recordMetric("Offset",{uint64:t})},e.prototype.getStartOffset=function(){return this.xi},e.prototype.elapsed=function(){return a.now()-this.Ri},e.prototype.stop=function(){this.T.dispose(),this.recordMetric("Stopped"),h.call(this,"Stream stopped")},e.prototype.recordTimeToFirstFrame=function(t){function e(){i.Ei||(i.Ei=a.now()-n,i.recordMetric("TimeToFirstFrame",{uint64:i.Ei}),h.call(i,"First frame [%s]",i.Ei),r.dispose())}var i=this,n=a.now();a.addEventListener(t,"loadeddata",e),a.addEventListener(t,"loadedmetadata",e);var r=new u.Disposable(function(){a.removeEventListener(t,"loadeddata",e),a.removeEventListener(t,"loadedmetadata",e)});return this.T.add(r),r},e.prototype.recordVideoResolutionChanges=function(t,e){var i=this,n={width:e.videoWidth,height:e.videoHeight};return a.find(this.Ti,function(t){return t===e})?new u.Disposable(a.noop):(this.Ti.push(e),t=t.addVideoDisplayDimensionsChangedCallback(function(t,e){n.width===e.width&&n.height===e.height||(i.recordMetric("ResolutionChanged",{string:e.width+"x"+e.height},{string:n.width+"x"+n.height}),n={width:e.width,height:e.height},h.call(i,"Resolution changed: width [%s] height [%s]",e.width,e.height))}),this.T.add(t),t)},e.prototype.recordRebuffering=function(n){var r,s,o=this;if(a.find(this.qi,function(t){return t===n}))return new u.Disposable(a.noop);function t(){r||(o.recordMetric("Stalled"),r=a.now(),h.call(o,"[buffering] Stream has stalled"))}function e(t){var e=n.buffered.length,i=!("playing"===t.type||0<e)||("progress"===t.type||"timeupdate"===t.type)&&n.buffered.end(e-1)===s;!r||!e&&"Edge"!==c.browser||i||("progress"===t.type&&(s=n.buffered.end(e-1)),e=a.now()-r,o.recordMetric("Buffering",{uint64:e}),h.call(o,"[buffering] Stream has recovered from stall after [%s] milliseconds",e),r=null)}this.qi.push(n),a.addEventListener(n,"stalled",t),a.addEventListener(n,"pause",t),a.addEventListener(n,"suspend",t),a.addEventListener(n,"play",e),a.addEventListener(n,"playing",e),a.addEventListener(n,"progress",e),a.addEventListener(n,"timeupdate",e);var i=new u.Disposable(function(){a.removeEventListener(n,"stalled",t),a.removeEventListener(n,"pause",t),a.removeEventListener(n,"suspend",t),a.removeEventListener(n,"play",e),a.removeEventListener(n,"playing",e),a.removeEventListener(n,"progress",e),a.removeEventListener(n,"timeupdate",e)});return this.T.add(i),i},e.prototype.recordVideoPlayingAndPausing=function(e){var t=this;if(a.find(this.Ci,function(t){return t===e}))return new u.Disposable(a.noop);function i(){e.paused?t.recordMetric("Playing",{boolean:!1}):t.recordMetric("Playing",{boolean:!0})}this.Ci.push(e),a.addEventListener(e,"pause",i),a.addEventListener(e,"playing",i);var n=new u.Disposable(function(){a.removeEventListener(e,"pause",i),a.removeEventListener(e,"playing",i)});return this.T.add(n),n},e}.apply(e,i))||(t.exports=i)},function(t,e,i){i=[i(0),i(1),i(3),i(11),i(54),i(2)];void 0===(i=function(r,s,i,n,o,a){"use strict";var t=a.global.__phenixPageLoadTime||a.global.__pageLoadTime||r.now();function e(t,e){this.I="2022-04-13T15:08:08Z",this.se=null,this.Ii={resource:"session",kind:"event"},this.a=t,this.nt=e,this.Mi=new o(this.a),this.Ri=r.now(),this.T=new i.DisposableList,this.Pi=[],this.T.add(n.onBackground(r.bind(u,this,!1))),this.T.add(n.onForeground(r.bind(u,this,!0))),this.Mi.isSupported()&&(this.T.add(this.Mi.onNetworkChange(r.bind(d,this))),this.T.add(this.Mi),c.call(this),l.call(this),h.call(this))}function u(t,e){this.recordMetric(t?"ApplicationForeground":"ApplicationBackground",{uint64:e}),f.call(this,"Application has gone into the [%s] after [%s] ms",t?"foreground":"background",e)}function c(){var t=this.Mi.getEffectiveType();this.recordMetric("NetworkType",{string:t},null,{resource:a.browser}),f.call(this,"[%s] has started with Network effective type of [%s]",this.se?"Session":"Application",t)}function h(t,e){var i=t||this.Mi.getRoundTripTime(),t=e||-1;if(this.recordMetric("RoundTripTime",{uint32:i},{uint32:t},{resource:a.browser}),r.isNullOrUndefined(e))return f.call(this,"Network RTT [%s]",i);f.call(this,"Network RTT changed to [%s] from [%s]",i,t)}function l(t,e){var i=t||this.Mi.getDownlinkThroughputCapacity(),t=e||-1;if(this.recordMetric("DownlinkThroughputCapacity",{float:i},{float:t},{resource:a.browser}),r.isNullOrUndefined(e))return f.call(this,"Network downlink throughput capacity [%s]",i);f.call(this,"Network downlink throughput capacity changed to [%s] from [%s]",i,t)}function d(t,e){e.downlinkThroughputCapacity!==t.downlinkThroughputCapacity&&l.call(this,t.downlinkThroughputCapacity,e.downlinkThroughputCapacity),e.rtt!==t.rtt&&h.call(this,t.rtt,e.rtt),e.effectiveType!==t.effectiveType&&function(t,e){t=t||this.Mi.getEffectiveType(),this.recordMetric("NetworkType",{string:t},{string:e},{resource:a.browser}),f.call(this,"Network effective type has changed to [%s] from [%s]",t,e||"New")}.call(this,t.effectiveType,e.effectiveType)}function f(){if(0===(e=Array.prototype.slice.call(arguments)).length)throw new Error("Invalid logging arguments.");var t="[%s] [SessionTelemetry] [%s] "+e[0],e=e.slice(1),e=[t,this.se,r.now()-this.Ri].concat(e);this.a.info.apply(this.a,e)}function m(){return(r.now()-t)/1e3}function p(t,e){if(s.S(t.metric,"record.metric"),!this.se)return this.Pi.push({record:t,since:e});var i=r.assign({},this.Ii,t);this.nt.submitMetric(t.metric,e,this.se,null,this.I,i)}return e.prototype.setSessionId=function(t){!t&&this.se&&p.call(this,{metric:"Stopped",elapsed:this.elapsed()},m()),(this.se=t)&&(p.call(this,{metric:"Initialized",elapsed:this.elapsed()},m()),function(){if(this.se)for(var t=this.Pi.length;0<t;){var e=this.Pi.splice(t-1,1);1===e.length&&p.call(this,e[0].record,e[0].since),t--}}.call(this),function(){var t=n.isForeground(),e=n.getTimeSinceLastChange();this.recordMetric(t?"ApplicationForeground":"ApplicationBackground",{uint64:e}),f.call(this,"Session has started in the [%s] after [%s] ms",t?"foreground":"background",e)}.call(this),this.Mi.isSupported()&&(c.call(this),l.call(this),h.call(this)))},e.prototype.setProperty=function(t,e){s.S(t,"name"),s.S(e,"value"),this.Ii[t]=e},e.prototype.recordMetric=function(t,e,i,n){s.S(t,"metric"),n=r.assign({},{metric:t,elapsed:this.elapsed(),value:e,previousValue:i},n||{}),p.call(this,n,m())},e.prototype.elapsed=function(){return r.now()-this.Ri},e.prototype.dispose=function(){this.T.dispose(),this.recordMetric("Stopped"),f.call(this,"Session telemetry stopped")},e}.apply(e,i))||(t.exports=i)},function(t,e,i){i=[i(0),i(1),i(5),i(3),i(2)];void 0===(i=function(t,e,i,n,r){function s(t){if(e.e(t,"logger"),this.a=t,this.zt=new i.NamedEvents,this.T=new n.DisposableList,this.T.add(this.zt),!this.isSupported())return this.a.info("Network monitor is not supported.");this.Di=o.call(this),function(){var t=this;navigator.connection.addEventListener("change",function(){t.zt.fireAsync("NetworkChange",[o.call(t),t.Di]),t.Di=o.call(t)})}.call(this)}function o(){return{downlinkThroughputCapacity:this.getDownlinkThroughputCapacity(),effectiveType:this.getEffectiveType(),rtt:this.getRoundTripTime()}}return s.prototype.isSupported=function(){return r.global.navigator&&r.global.navigator.connection},s.prototype.getDownlinkThroughputCapacity=function(){return this.isSupported()?r.global.navigator.connection.downlink||r.global.navigator.connection.downlinkMax:-1},s.prototype.getEffectiveType=function(){return this.isSupported()?r.global.navigator.connection.effectiveType||r.global.navigator.connection.type:"Unknown"},s.prototype.getRoundTripTime=function(){return this.isSupported()?r.global.navigator.connection.rtt||r.global.navigator.connection.type:-1},s.prototype.onNetworkChange=function(t){if(this.isSupported())return e.b(t,"callback"),this.zt.listen("NetworkChange",t)},s.prototype.dispose=function(){this.T.dispose()},s}.apply(e,i))||(t.exports=i)},function(t,e,i){i=[i(0),i(1),i(6)];void 0===(i=function(r,s,o){"use strict";function a(t,e,i){s.S(t,"type"),s.e(e,"stream"),s.e(i,"logger"),this.P=t,this.Ui=e,this.a=i,this.Ai=null;var n=this;this.Ui.on(o.streamEvents.playerEnded.name,function(t){return n.a.info("[%s] [%s] player ended.",n.Ui.getStreamId(),n.P),n.Oi=!0,n.Ai?n.Ai():void n.streamEndedCallback(a.getStreamEndedStatus(t),t)})}return a.prototype.toString=function(){return"Stream["+(this.Ui?this.Ui.getStreamId():"")+"]"},a.prototype.on=function(t,e){return this.Ui.on(t,e)},a.prototype.streamErrorCallback=function(t,e){r.b(this.Ui.streamErrorCallback)?(this.a.debug("[%s] [%s] stream error event [%s]",this.Ui.getStreamId(),this.P,e),this.Ui.streamErrorCallback(this.Ui,t,e)):this.a.error("[%s] [%s] stream error event [%s]",this.Ui.getStreamId(),this.P,e)},a.prototype.streamEndedCallback=function(t,e,i){var n=this.Ui.getRenderer();if(!this.Fi){if(i&&!this.Ai&&this.Ui.isActive()&&n&&!this.Oi)return this.Ai=r.bind(this.streamEndedCallback,this,t,e),this.a.info("[%s] [%s] stream ended. Waiting for end of player.",this.Ui.getStreamId(),this.P),void(n&&n.stop(e,i));this.Fi=!0,r.b(this.Ui.streamEndedCallback)&&this.Ui.streamEndedCallback(this.Ui,t,e),this.Ui.stop(e),n&&n.stop(e,i)}},a.prototype.dataQualityChangedCallback=function(t,e){var i=this.Ui.getRenderer();i&&r.b(i.dataQualityChangedCallback)&&i.dataQualityChangedCallback(i,t,e)},a.prototype.getPhenixMediaStream=function(){return this.Ui},a.getStreamEndedStatus=function(t){switch(t){case"":case"none":case"ended":return"ended";case"server-error":case"session-error":case"not-ready":case"error":case"died":return"failed";case"censored":return"censored";case"maintenance":return"maintenance";case"capacity":return"capacity";case"app-background":return"app-background";case"egress-failed":return"egress-failed";case"egress-setup-failed":return"egress-setup-failed";case"overload":return"overload";default:return"custom"}},a}.apply(e,i))||(t.exports=i)},function(t,e,i){i=[i(0),i(1),i(5),i(7),i(3),i(2),i(9),i(6)];void 0===(i=function(o,e,a,r,u,c,h,s){"use strict";var l=null;function t(t,e,i,n,r,s){this.a=s,this.A=t,this.Li=encodeURI(e).replace(/[#]/g,"%23"),this.Lt=i,this.Nt=n,this.y=null,this.Ni=null,this.Wt=new h(s),this.Bi={time:0,buffered:null,averageLength:0,count:0},this.zt=new a.NamedEvents,this.T=new u.DisposableList,this.Bt=r,this.ji=o.bind(f,this),this.Vi=o.bind(d,this),this.Wi=o.bind(m,this)}function d(){if(this.Bi.time=o.now(),0===this.Ni.buffered.length)return this.a.debug("[%s] Shaka live stream player progress event fired without any buffered content",this.A);var t,e=this.Ni.buffered.end(this.Ni.buffered.length-1);this.Bi.buffered!==e&&(null!==this.Bi.buffered&&(t=this.Bi.averageLength*this.Bi.count+(e-this.Bi.buffered),this.Bi.count+=1,this.Bi.averageLength=t/this.Bi.count),this.Bi.buffered=e)}function f(){var t=this;t.a.info("[%s] Loading Shaka live stream player stream stalled.",t.A),0!==t.Bi.time&&setTimeout(function(){o.now()-t.Bi.time>i.call(t)&&t.zi&&t.stop("ended")},i.call(t))}function i(){return 1.5*this.Bi.averageLength<2e3?2e3:1.5*this.Bi.averageLength}function m(){this.a.info("[%s] Shaka live stream player ended.",this.A)}return t.prototype.on=function(t,e){return this.zt.listen(t,e)},t.prototype.start=function(e){var i=this;i._i=new this.Bt.Player(e),this.T.add(this.Lt.recordTimeToFirstFrame(e)),this.T.add(this.Lt.recordRebuffering(e)),this.T.add(this.Lt.recordVideoResolutionChanges(this,e));var t={abr:{defaultBandwidthEstimate:2e6},manifest:{retryParameters:{timeout:1e4}},streaming:{rebufferingGoal:2,bufferingGoal:10,bufferBehind:30,retryParameters:{timeout:1e4,maxAttempts:10,backoffFactor:1.1}}};function n(t){i._i.configure(t),!1===i.Nt.receiveAudio&&(e.muted=!0),o.addEventListener(i._i,"error",function(t){i.zt.fire(s.rendererEvents.error.name,["player",t])}),o.addEventListener(e,"stalled",i.ji,!1),o.addEventListener(e,"pause",i.ji,!1),o.addEventListener(e,"suspend",i.ji,!1),o.addEventListener(e,"progress",i.Vi,!1),o.addEventListener(e,"ended",i.Wi,!1),i._i.load(i.Li).then(function(){i.a.info("[%s] DASH live stream has been loaded",i.A),o.b(e.play)&&e.play()}).catch(function(t){i.a.error("[%s] Error while loading DASH live stream [%s]",i.A,t.code,t),i.zt.fire(s.rendererEvents.error.name,["shaka",t])}),i.Nt.capabilities.includes("audio-only")||i.Wt.start(this,e),i.Ni=e}return this.Nt.isDrmProtectedContent?(function(){var t;if(!o.b(Uint8Array))throw this.a.error(t="Uint8Array support required for DRM"),new Error(t);if(!o.b(c.global.atob))throw this.a.error(t="rtc.global.atob support required for DRM"),new Error(t)}.call(i),function(s){var o=this;s.getNetworkingEngine().registerResponseFilter(function(t,e){if(t.toString()===o.Bt.net.NetworkingEngine.RequestType.LICENSE.toString()){var i=new Uint8Array(e.data),t=String.fromCharCode.apply(null,i),t=(i=JSON.parse(t)).license,n=c.global.atob(t);e.data=new Uint8Array(n.length);for(var r=0;r<n.length;++r)e.data[r]=n.charCodeAt(r);i.trackRestrictions&&s.configure({restrictions:i.trackRestrictions})}})}.call(i,i._i),function(t,e,i){t.drm||(t.drm={}),t.drm.advanced||(t.drm.advanced={}),t.manifest||(t.manifest={}),t.manifest.dash||(t.manifest.dash={}),function(i,t,n){function e(t,e){t?n(t):(l=e.data,i.drm.advanced["com.widevine.alpha"]={serverCertificate:function(t){for(var e=t.length,i=new Uint8Array(e),n=0;n<e;n++)i[n]=t.charCodeAt(n);return i}(e.data),persistentStateRequired:!0,distinctiveIdentifierRequired:!1},n(null,i))}i.manifest.dash.customScheme=function(t){if("com.phenixrts.widevine"===t.getAttribute("schemeIdUri")||"com.phenixp2p.widevine"===t.getAttribute("schemeIdUri"))return[{keySystem:"com.widevine.alpha",licenseServerUri:decodeURIComponent(t.getAttribute("widevineLicenseServerUrl"))}]},l?e(null,l):r.get(t.widevineServiceCertificateUrl,{mimeType:"text/plain; charset=x-user-defined"},e)}.call(this,t,e,i)}.call(i,t,i.Nt,function(t,e){if(t)throw i.a.error("Failed to add DRM configuration to shaka player",t),t;n(e)})):n(t),e},t.prototype.stop=function(t,e){var i,n=this;if(!n.Hi){if(e)return n.zi=!0;this.Wt.stop(),this.T.dispose(),this._i&&(i=function(){n.Ni&&(o.removeEventListener(n.Ni,"stalled",n.ji,!1),o.removeEventListener(n.Ni,"pause",n.ji,!1),o.removeEventListener(n.Ni,"suspend",n.ji,!1),o.removeEventListener(n.Ni,"progress",n.Vi,!1),o.removeEventListener(n.Ni,"ended",n.Wi,!1),"Edge"===c.browser&&(n.Ni.src="")),n.zt.fire(s.rendererEvents.ended.name,[""]),n._i=null,n.Ni=null},n._i.destroy().then(function(){n.a.info("[%s] Shaka live stream player has been destroyed",n.A)}).then(function(){i()}).catch(function(t){n.a.error("[%s] Error while destroying shaka live stream player [%s]",n.A,t.code,t),i(),n.zt.fire(s.rendererEvents.error.name,["shaka",t])}),n.Hi=!0)}},t.prototype.getStats=function(){if(!this._i)return{width:0,height:0,currentTime:0,lag:0,networkState:s.networkStates.networkNoSource.id};var t=o.assign(this._i.getStats(),{currentTime:0,lag:0}),e=o.get(this.Ni,["currentTime"],0),i=(o.now()-this.Nt.originStartTime)/1e3,i=Math.max(0,i-e);return this.Ni&&(t.currentTime=e,t.lag=i),0<t.estimatedBandwidth?t.networkState=s.networkStates.networkLoading.id:0<t.playTime?t.networkState=s.networkStates.networkIdle.id:t.video?t.networkState=s.networkStates.networkEmpty.id:t.networkState=s.networkStates.networkNoSource.id,t},t.prototype.setDataQualityChangedCallback=function(t){e.b(t,"callback"),this.dataQualityChangedCallback=t},t.prototype.getPlayer=function(){return this._i},t.prototype.addVideoDisplayDimensionsChangedCallback=function(t,e){return this.Wt.addVideoDisplayDimensionsChangedCallback(t,e)},t}.apply(e,i))||(t.exports=i)},function(t,e,i){i=[i(0),i(1),i(8),i(5),i(7),i(3),i(2),i(9),i(6)];void 0===(i=function(o,e,s,a,t,u,n,c,r){"use strict";var h=6e3,i=15e3;function l(t,e,i,n,r,s){this.a=s,this.A=t,this.Li=encodeURI(e).replace(/[#]/g,"%23"),this.Lt=i,this.Nt=n,this.jt=r,this.y=null,this.Ni=null,this.Wt=new c(s),this.Bi={time:0,buffered:null,averageLength:0,count:0,lastCurrentTime:0,lastCurrentTimeOccurenceTimestamp:0},this.zt=new a.NamedEvents,this.T=new u.DisposableList,this.ji=o.bind(g,this),this.Vi=o.bind(p,this),this.Wi=o.bind(y,this)}function d(t){if(m.call(this)&&t&&(3===t.code||t.severity===this.jt.errors.severity.RECOVERABLE))return this.a.warn("Reloading unhealthy stream after error event [%s]",t),f.call(this);this.zt.fire(r.rendererEvents.error.name,["phenix-player",t])}function f(){m.call(this)&&(this.a.warn("Reloading unhealthy stream that was active for at least [%s] seconds",i/1e3),this.Gi=o.now(),function(){this._i.dispose(),this._i=null,this.start(this.Ni)}.call(this))}function m(){var t=!this.Gi||o.now()-this.Gi>i;return this.Ni&&!this.zi&&this._i&&0!==this.Ni.buffered.length&&t}function p(){if(this.Bi.time=o.now(),0===this.Ni.buffered.length)return this.a.debug("[%s] Phenix stream player progress event fired without any buffered content",this.A);var t,e,i=this.Ni.buffered.end(this.Ni.buffered.length-1);this.Bi.buffered!==i&&(null!==this.Bi.buffered&&(e=this.Bi.averageLength*this.Bi.count+(i-this.Bi.buffered),t=this.Bi.lastCurrentTime===this.Ni.currentTime,this.Bi.count+=1,this.Bi.averageLength=e/this.Bi.count,t||(this.Bi.lastCurrentTimeOccurenceTimestamp=o.now()),e=this.Bi.lastCurrentTimeOccurenceTimestamp&&o.now()-this.Bi.lastCurrentTimeOccurenceTimestamp>h,t&&e&&this.Ni&&!this.Ni.paused&&m.call(this)&&(this.a.warn("Reloading stream after current time has not changed for [%s] seconds due to unregistered stall.",h/1e3),f.call(this))),this.Bi.buffered=i,this.Bi.lastCurrentTime=this.Ni.currentTime)}function g(t){var e,i=this;i.a.info("[%s] Loading Phenix Live stream player stalled caused by [%s] event.",i.A,t.type),0===i.Bi.time||i.Ni.paused||(e=i.Ni.currentTime,setTimeout(function(){o.now()-i.Bi.time>v.call(i)&&i.zi&&i.stop("ended")},v.call(i)),setTimeout(function(){i.Ni&&i.Ni.currentTime===e&&!i.Ni.paused&&m.call(i)&&(i.a.warn("Reloading stream after being stalled for [%s] seconds",h/1e3),f.call(i))},h))}function v(){return 1.5*this.Bi.averageLength<2e3?2e3:1.5*this.Bi.averageLength}function y(){this.a.info("[%s] Phenix stream player ended.",this.A)}return l.isSupported=function(){return this.jt&&this.jt.isSupported},l.prototype.on=function(t,e){return this.zt.listen(t,e)},l.prototype.start=function(t){var e,i,n=this,r=(e=(r=this.a).getAppenders(),i=new s.Logger,o.forEach(e,function(t){t instanceof s.ConsoleAppender&&(t=new s.ConsoleAppender).setThreshold(s.level.INFO),i.addAppender(t)}),i.setUserId(r.getUserId()),i.setEnvironment(r.getEnvironment()),i.setApplicationVersion(r.getApplicationVersion()),i.setObservableSessionId(r.getObservableSessionId()),i);return this.Ji=r,this.Ni=t,this.T.add(this.Lt.recordTimeToFirstFrame(t)),this.T.add(this.Lt.recordRebuffering(t)),this.T.add(this.Lt.recordVideoResolutionChanges(this,t)),this.T.add(this.Lt.recordVideoPlayingAndPausing(t)),function(){var t=this,e=o.assign({bandwidthToStartAt:3e6},t.Nt);o.includes(this.Li,".mpd")&&t.Nt.isDrmProtectedContent&&(e.drm={"com.widevine.alpha":{serverCertificateUrl:t.Nt.widevineServiceCertificateUrl,mediaKeySystemConfiguration:{persistentState:"required"}},"com.microsoft.playready":{licenseServerUrl:t.Nt.playreadyLicenseUrl}}),e=new this.jt.WebPlayer(this.Ji,this.Ni,e),o.now()-this.Nt.originStartTime<6e3&&this.Nt.isDrmProtectedContent&&o.includes(this.Li,".m3u8")?setTimeout(o.bind(e.start,e,t.Li),6e3):e.start(t.Li),t._i=e,o.addEventListener(t._i,"error",o.bind(d,t))}.call(n),!1===n.Nt.receiveAudio&&(t.muted=!0),o.addEventListener(t,"stalled",n.ji,!1),o.addEventListener(t,"pause",n.ji,!1),o.addEventListener(t,"suspend",n.ji,!1),o.addEventListener(t,"progress",n.Vi,!1),o.addEventListener(t,"ended",n.Wi,!1),this.Nt.capabilities.includes("audio-only")||this.Wt.start(this,t),t},l.prototype.stop=function(t,e){var i=this;if(!i.Hi){if(e)return i.zi=!0;if(this.Wt.stop(),this.T.dispose(),this._i){e=function(){i.Ni&&(o.removeEventListener(i.Ni,"stalled",i.ji,!1),o.removeEventListener(i.Ni,"pause",i.ji,!1),o.removeEventListener(i.Ni,"suspend",i.ji,!1),o.removeEventListener(i.Ni,"progress",i.Vi,!1),o.removeEventListener(i.Ni,"ended",i.Wi,!1),"Edge"===n.browser&&(i.Ni.src="")),i.zt.fire(r.rendererEvents.ended.name,[""]),i._i=null,i.Ni=null},i.Hi=!0;try{i._i.dispose(),i.a.info("[%s] Phenix stream has been destroyed",i.A),e()}catch(t){i.a.error("[%s] Error while destroying Phenix stream player [%s]",i.A,t.code,t),e(),i.zt.fire(r.rendererEvents.error.name,["phenix-player",t])}}}},l.prototype.getStats=function(){if(!this._i)return{width:0,height:0,currentTime:0,lag:0,networkState:r.networkStates.networkNoSource.id};var t=this._i.getStats(),e=t.currentTime||this.Ni.currentTime,i=(o.now()-this.Nt.originStartTime)/1e3;return t.isNative&&"Hls"===t.deliveryType&&(t.currentTime=i-t.lag),t.isNative||(t.lag=Math.max(0,i-e)),0<t.estimatedBandwidth?t.networkState=r.networkStates.networkLoading.id:0<t.playTime?t.networkState=r.networkStates.networkIdle.id:t.video?t.networkState=r.networkStates.networkEmpty.id:t.networkState=r.networkStates.networkNoSource.id,t},l.prototype.setDataQualityChangedCallback=function(t){e.b(t,"callback"),this.dataQualityChangedCallback=t},l.prototype.getPlayer=function(){return this._i},l.prototype.addVideoDisplayDimensionsChangedCallback=function(t,e){return this.Wt.addVideoDisplayDimensionsChangedCallback(t,e)},l}.apply(e,i))||(t.exports=i)},function(t,e,i){i=[i(0),i(1),i(8),i(5),i(7),i(3),i(2),i(9),i(6)];void 0===(i=function(c,o,t,a,e,u,h,l,n){"use strict";var r=6e3,s=15e3,i="rtmp-flash-renderer-2019.2.18.swf",d={local:"https://local.phenixrts.com/public/rtmp/"+i,staging:"https://stg.phenixrts.com/public/rtmp/"+i,production:"https://phenixrts.com/public/rtmp/"+i};function f(t,e,i,n,r){o.e(n,"options"),n.env&&o.S(n.env,"options.env");var s=d[n.env||"production"];this.a=r,this.A=t,this.Ki=c.map(e,function(t){return t.uri=encodeURI(t.uri).replace(/[#]/g,"%23"),t}),this.Lt=i,this.Nt=n,this.y=null,this.Qi=null,this.Xi=null,this.zt=new a.NamedEvents,this.Wt=new l(r),this.T=new u.DisposableList,this.ji=c.bind(g,this),this.Wi=c.bind(v,this),this.xe=c.bind(m,this),this.$i=n.swfSrc||s}function m(t){this.zt.fire(n.rendererEvents.error.name,["flash-player",t])}function p(){var t=!this.Gi||c.now()-this.Gi>s;return this.Xi&&!this.zi&&this._i&&0!==this.Xi.buffered.length&&t}function g(t){var e=this;e.a.info("[%s] Loading flash player stalled caused by [%s] event.",e.A,t.type);var i=e.Xi.currentTime;setTimeout(function(){e.Xi&&e.Xi.currentTime===i&&!e.Xi.paused&&p.call(e)&&(e.a.warn("Reloading stream after being stalled for [%s] seconds",r/1e3),function(){p.call(this)&&(this.a.warn("Reloading unhealthy stream that was active for at least [%s] seconds",s/1e3),this.Gi=c.now(),function(){this.Qi.destroy(),this.start(this.Yi)}.call(this))}.call(e))},r)}function v(){this.a.info("[%s] Flash player ended.",this.A)}f.isSupported=function(){var t=[10,0,0],e="Shockwave Flash",i=[0,0,0];if(c.L(y))return y;if(c.get(h.global.navigator,["plugins",e])){var n=h.global.navigator.plugins[e].description;if(n&&c.get(h.global.navigator,["mimeTypes","application/x-shockwave-flash","enabledPlugin"],!1))for(var r=0,s=(i=n.replace(e,"").replace(/^\s+/,"").replace(/\sr/gi,".").split(".")).length;r<s;r++)i[r]=parseInt(i[r].match(/\d+/),10)}else if(h.global.ActiveXObject)try{var o,a,u=new h.global.ActiveXObject("ShockwaveFlash.ShockwaveFlash");u&&(o=u.GetVariable("$version")||"",a=c.get(o.split(" "),[1],i).split(","),i=[parseInt(a[0],10),parseInt(a[1],10),parseInt(a[2],10)])}catch(t){console.error(t)}return y=i[0]>t[0]||i[0]===t[0]&&0<i[1]||i[0]===t[0]&&0===i[1]&&0<=i[2]},f.prototype.on=function(t,e){return this.zt.listen(t,e)},f.prototype.start=function(t){var e=this,i={streamId:this.A,swfSrc:this.$i};return this.Yi=t,this.Qi=new h.PhenixFlashVideo(t,this.Ki,i),this.Qi.hookUpEvents(),this.Xi=this.Qi.getElement(),this.T.add(this.Lt.recordTimeToFirstFrame(this.Yi)),this.T.add(this.Lt.recordRebuffering(this.Yi)),this.T.add(this.Lt.recordVideoResolutionChanges(this,this.Yi)),this.T.add(this.Lt.recordVideoPlayingAndPausing(this.Yi)),this.Xi&&this.Xi.play(),c.addEventListener(this.Yi,"stalled",e.ji,!1),c.addEventListener(this.Yi,"pause",e.ji,!1),c.addEventListener(this.Yi,"suspend",e.ji,!1),c.addEventListener(this.Yi,"ended",e.Wi,!1),c.addEventListener(this.Yi,"error",e.xe,!1),t},f.prototype.stop=function(t){var e=this;if(this.T.dispose(),this.Qi){var i=function(){e.Xi&&(c.removeEventListener(e.Yi,"stalled",e.ji,!1),c.removeEventListener(e.Yi,"pause",e.ji,!1),c.removeEventListener(e.Yi,"suspend",e.ji,!1),c.removeEventListener(e.Yi,"ended",e.Wi,!1),c.removeEventListener(e.Yi,"error",e.xe,!1)),e.Xi=null,e.Yi=null,e.zt.fire(n.rendererEvents.ended.name,[t])};try{this.Qi.destroy(),this.Qi=null,i(),this.a.info("[%s] Flash player has been destroyed",this.A)}catch(t){e.a.error("[%s] Error while destroying Flash player [%s]",e.A,t.code,t),i(),e.zt.fire(n.rendererEvents.error.name,["flash-player",t])}}},f.prototype.getStats=function(){if(!this.Xi)return{width:0,height:0,currentTime:0,lag:0,networkState:n.networkStates.networkNoSource.id};var t={},e=this.Xi.currentTime,i=(c.now()-this.Nt.originStartTime)/1e3;return t.lag=Math.max(0,i-e),0<t.estimatedBandwidth?t.networkState=n.networkStates.networkLoading.id:0<t.playTime?t.networkState=n.networkStates.networkIdle.id:t.video?t.networkState=n.networkStates.networkEmpty.id:t.networkState=n.networkStates.networkNoSource.id,t},f.prototype.setDataQualityChangedCallback=function(t){o.b(t,"callback"),this.dataQualityChangedCallback=t},f.prototype.getPlayer=function(){return this._i},f.prototype.addVideoDisplayDimensionsChangedCallback=function(t,e){return this.Wt.addVideoDisplayDimensionsChangedCallback(t,e)};var y=null;return f}.apply(e,i))||(t.exports=i)},function(t,e,i){i=[i(0),i(1),i(5),i(2),i(3),i(11),i(18),i(25),i(28),i(60),i(12),i(6)];void 0===(i=function(o,a,u,c,h,l,n,i,r,s,d,f){"use strict";function m(t,e,i,n,r,s){this.A=t,this.Zi=e,this.Tt=i,this.Lt=n,this.Nt=r,this.a=s,this.Vt=[],this.Wt=null,this.zt=new u.NamedEvents,this.tn=[],this.en=0,this.in=null,this.T=new h.DisposableList,this.st=0,this.nn=o.get(r,["iceConnectionTimeout"],12e3),this.T.add(l.onForeground(o.bind(p,this))),(r=/(b=AS:([0-9]*)[\n\r]*)/gi.exec(i.remoteDescription))&&3<=r.length&&(this.en=1e3*r[2]),o.addEventListener(i,"iceconnectionstatechange",o.bind(g,this))}function p(){var t;this.in&&(t=this.in,this.in=null,t())}function g(){var t=this,e=this.Tt.iceConnectionState;switch(e){case"checking":case"connecting":if(this.rn)return;this.sn=o.now(),this.rn=setTimeout(function(){t.a.warn("[%s] Stream has not connected within [%s] ms",t.A,t.nn),t.zt.fire(f.streamEvents.playerError.name,["real-time",new Error("connection-timeout")])},t.nn);break;case"failed":this.rn&&(clearTimeout(this.rn),this.rn=null),this.a.info("[%s] Stream has failed",t.A),this.zt.fire(f.streamEvents.playerError.name,["real-time",new Error("connection-failed")]);break;case"closed":case"disconnected":this.rn&&t.a.warn("[%s] Stream closed before it was connected",t.A);break;case"connected":this.rn&&(clearTimeout(this.rn),this.rn=null),this.st++,this.a.info("[%s] Ice Connection completed after [%s] ms for [%s] time",this.A,o.now()-this.sn,this.st),this.sn=null;break;default:this.a.info("[%s] Unsupported Ice Connection state [%s]",this.A,e)}}return m.prototype.on=function(t,e){this.zt.listen(t,e)},m.prototype.createRenderer=function(){var i=this,t=o.get(this.Tt,["remoteDescription","sdp"]),e=Object.assign({},this.Nt);(!t||this.Nt.capabilities.includes("audio-only"))&&this.Nt.capabilities.includes("video-only")||(t.includes("m=audio")||e.capabilities.push("video-only"),t.includes("m=video")||e.capabilities.push("audio-only"),t.split("m=").forEach(function(t){t.startsWith("audio")&&t.includes("a=inactive")&&e.capabilities.push("video-only"),t.startsWith("video")&&t.includes("a=inactive")&&e.capabilities.push("audio-only")}));var n=new s(this.A,this.Zi,this.Lt,e,this.a);return n.on(f.rendererEvents.error.name,function(t,e){i.zt.fire(f.streamEvents.playerError.name,[t,e])}),n.on(f.rendererEvents.ended.name,function(t){i.Vt=o.filter(i.Vt,function(t){return t!==n}),0===i.Vt.length&&(i.Lt.stop(),i.zt.fire(f.streamEvents.playerEnded.name,[t]))}),this.Vt.push(n),n},m.prototype.select=function(t){a.b(t,"trackSelectCallback"),a.b(c.global.MediaStream,"rtc.global.MediaStream");for(var e=this.Zi.getTracks(),i=new c.global.MediaStream,n=0;n<e.length;n++)t(e[n],n)&&i.addTrack(e[n]);if(0===i.getTracks().length)return this.a.warn("No tracks selected");var r=this,s=new m(this.A,i,this.Tt,this.Lt,this.Nt,this.a);return s.on(f.streamEvents.stopped.name,function(t){var e=r.Zi;o.reduce(e.getTracks(),function(t,e){return t&&(a.e(e,"track"),"ended"===e.readyState)},!0)&&r.zt.fire(f.streamEvents.stopped.name,[t])}),this.tn.push(s),s},m.prototype.setStreamEndedCallback=function(t){a.b(t,"callback"),this.an=t},m.prototype.setStreamErrorCallback=function(t){a.b(t,"callback"),this.un=t},m.prototype.streamEndedCallback=function(t,e,i){o.forEach(this.tn,function(t){t.streamEndedCallback(e,i)}),o.b(this.an)&&this.an(this,e,i)},m.prototype.streamErrorCallback=function(t,e,i){o.forEach(this.tn,function(t){t.streamErrorCallback(e,i)}),o.b(this.un)&&this.un(t,e,i)},m.prototype.stop=function(t){var e;this.isActive()&&(this.T.dispose(),(e=this.Zi)&&o.b(e.stop,"stream.stop")&&e.stop(),o.forEach(e&&e.getTracks?e.getTracks():[],function(t){t.stop()}),this.a.info("[%s] stop [real-time] media stream with reason [%s]",this.A,t),this.zt.fire(f.streamEvents.stopped.name,[t]),this._t=!0)},m.prototype.monitor=function(t,n){a.e(t,"options"),a.b(n,"callback");var r=this,e=new i(r.A,r.Tt,r.a);return t.direction="inbound",e.start(t,function(){return r.isActive()},function t(e,i){return e&&r.a.warn("[%s] Media stream monitor triggered unrecoverable error [%s]",r.A,e),d.isIOS()&&!l.isForeground()?(r.a.info("[%s] Media stream monitor triggered event while app is in the background. Waiting until foreground to trigger event.",r.A),r.in=t.bind(null,e,i)):(r.a.warn("[%s] Media stream triggered monitor condition for [%s] [%s]",r.A,i.type,i.reasons),n(r,"client-side-failure",i))}),this.Ht=e},m.prototype.getMonitor=function(){return this.Ht},m.prototype.addBitRateThreshold=function(t,e){var i=this;return new r("Media Stream",this.Ht,function(){return i.en}).addThreshold(t,e)},m.prototype.getStream=function(){return this.Zi},m.prototype.isActive=function(){return!this._t},m.prototype.getStreamId=function(){return this.A},m.prototype.getStats=function(e){a.b(e,"callback"),this.St||(this.St={});var i=this;return c.getStats(this.Tt,null,function(t){e(n.convertPeerConnectionStats(t,i.St))})},m.prototype.getRenderer=function(){return o.get(this.Vt,[0],null)},m.prototype.toString=function(){return"PhenixRealTimeStream["+this.A+"]"},m}.apply(e,i))||(t.exports=i)},function(t,e,i){i=[i(0),i(1),i(5),i(7),i(3),i(2),i(11),i(22),i(29),i(9),i(6),i(12)];void 0===(i=function(s,e,o,t,a,r,u,c,h,l,d,n){"use strict";var f=1e3,m=200;function i(t,e,i,n,r){this.a=r,this.A=t,this.Zi=e,this.Lt=i,this.Nt=n,this.y=null,this.Ni=null,this.Wt=new l(r),this.zt=new o.NamedEvents,this.T=new a.DisposableList,this.ui=new c(s.get(h,["navigator","userAgent"],"")).detect(),this.cn=!1,this.hn=0,this.ln=0,this.T.add(u.onBackground(s.bind(v,this))),this.T.add(u.onForeground(s.bind(y,this))),this.dn=s.bind(p,this),this.Wi=s.bind(g,this)}function p(t){var e=s.now()-this.hn<f;"pause"===t.type&&e&&(this.cn=!0),this.ln=s.now(),this.a.info("[%s] Loading Phenix Real-Time stream player stalling caused by [%s] event.",this.A,t.type)}function g(){this.a.info("[%s] Phenix Real-Time stream ended.",this.A)}function v(){var t,e;this.Ni&&(t=!1,e=s.now()-this.ln<f,s.L(this.Ni.playing)?t=this.Ni.playing:s.L(this.Ni.paused)&&(t=!this.Ni.paused),this.cn=t=!t&&e||t,this.hn=s.now())}function y(){var e,t,i;this.Ni&&((e=this).hn=0,this.ln=0,this.cn?(this.a.info("[%s] Resume playing after entering foreground [%s]",this.A,this.ui.browser),"Safari"===this.ui.browser&&n.isIOS()&&(t=function(){e.a.info("Renderer was paused after entering foreground"),e.zt.fire(d.rendererEvents.failedToPlay.name,["paused-by-background"])},s.addEventListener(e.Ni,"pause",t),i=setTimeout(function(){s.removeEventListener(e.Ni,"pause",t)},f),this.T.add(new a.Disposable(function(){clearTimeout(i)})),setTimeout(function(){e.Ni.play().catch(function(t){e.a.info("[%s] Unable to resume playback after entering foreground",e.A,t),e.Ni.src="",e.a.info("[%s] (Re)starting renderer",e.A),e.start(e.Ni)})},m))):this.a.info("[%s] Entering foreground with paused renderer [%s]",this.A,this.ui.browser))}return i.prototype.on=function(t,e){if("userActionRequired"===t)throw new Error('"userActionRequired is no longer supported. See https://phenixrts.com/docs/web/#view-a-channel and https://phenixrts.com/docs/web/#channel-viewer');return this.zt.listen(t,e)},i.prototype.start=function(e){var i=this,n=!!s.find(this.Zi.getTracks(),function(t){return"audio"===t.kind});return this.Nt.canPlaybackAudio||(this.Nt.disableAudioIfNoOutputFound&&this.Nt.forcedAudioDisabled?this.a.warn("[%s] Missing audio playback device. Audio has been disabled on stream. Try setting up an audio device and re-subscribe in order to receive audio.",this.A):!this.Nt.disableAudioIfNoOutputFound&&n&&this.a.warn("[%s] Missing audio playback device. May experience audio and/or video failure. Try setting up an audio device OR pass the [disableAudioIfNoOutputFound] option when subscribing to disable audio playback when no devices are attached.",this.A)),this.Ni=r.attachMediaStream(e,this.Zi,function(t){return t?e.muted||!n?(i.a.warn("[%s] Failed to play muted stream.",i.A,t),i.zt.fire(d.rendererEvents.failedToPlay.name,["failed-to-play"])):i.Nt.disableAutoMuting?(i.a.warn("[%s] Failed to play unmuted stream.",i.A,t),i.zt.fire(d.rendererEvents.failedToPlay.name,["failed-to-play-unmuted"])):(i.a.debug("[%s] Failed to start playing stream. Auto muting the playback and trying again.",i.A),e.muted=!0,void(i.Ni=r.attachMediaStream(e,i.Zi,function(t){return t?(i.a.warn("[%s] Failed to play even after auto muting.",i.A,t),e.muted=!1,i.zt.fire(d.rendererEvents.failedToPlay.name,["failed-to-play"])):(i.a.info("[%s] Successfully started playing stream after auto muting. User may manually unmute with user triggered action.",i.A),void i.zt.fire(d.rendererEvents.autoMuted.name,["retry-play-muted"]))}))):void i.a.debug("[%s] Successfully started playing stream.",i.A)}),this.T.add(this.Lt.recordTimeToFirstFrame(e)),this.T.add(this.Lt.recordRebuffering(e)),this.T.add(this.Lt.recordVideoResolutionChanges(this,e)),this.T.add(this.Lt.recordVideoPlayingAndPausing(e)),!1===this.Nt.receiveAudio&&(e.muted=!0),s.addEventListener(e,"stalled",this.dn,!1),s.addEventListener(e,"pause",this.dn,!1),s.addEventListener(e,"suspend",this.dn,!1),s.addEventListener(e,"ended",this.Wi,!1),this.Nt.capabilities.includes("audio-only")||this.Wt.start(this,e),e},i.prototype.stop=function(t){this.Wt.stop(),this.T.dispose(),this.Ni&&(s.removeEventListener(this.Ni,"stalled",this.dn,!1),s.removeEventListener(this.Ni,"pause",this.dn,!1),s.removeEventListener(this.Ni,"suspend",this.dn,!1),s.removeEventListener(this.Ni,"ended",this.Wi,!1),s.b(this.Ni.pause)&&this.Ni.pause(),"Edge"===this.ui.browser&&(this.Ni.src=""),this.Ni.src&&("IE"===this.ui.browser?this.Ni.src=null:this.Ni.src=""),this.Ni.srcObject&&(this.Ni.srcObject=null),this.Ni=null),this.a.info("[%s] Phenix real-time renderer has been destroyed",this.A),this.zt.fire(d.rendererEvents.ended.name,[t])},i.prototype.getStats=function(){if(!this.Ni)return{width:0,height:0,currentTime:0,lag:0,networkState:d.networkStates.networkNoSource.id};var t=(s.now()-this.Nt.originStartTime)/1e3,e=this.Nt.networkLag/1e3;return{width:this.Ni.videoWidth||this.Ni.width,height:this.Ni.videoHeight||this.Ni.height,currentTime:t,lag:e,networkState:this.Ni.networkState}},i.prototype.setDataQualityChangedCallback=function(t){e.b(t,"callback"),this.dataQualityChangedCallback=t},i.prototype.addVideoDisplayDimensionsChangedCallback=function(t,e){return this.Wt.addVideoDisplayDimensionsChangedCallback(t,e)},i}.apply(e,i))||(t.exports=i)},function(t,e,i){i=[i(0),i(1),i(4),i(32)];void 0===(i=function(i,t,r,c){"use strict";function e(t,e,i,n,r,s,o,a,u){this.init(t,e,i,n,r,s,o,a,u)}function s(){throw new Error("ImmutableRoom is Immutable")}function o(){throw new Error("Unable to subscribe to Immutable [ImmutableRoom]")}function h(t,e){i.isArray(t)?i.forEach(t,function(t){n(t,e)}):i.e(t)&&i.forOwn(t,function(t){i.includes(e,t)||n(t,e)})}function n(t,e){var i,n=e;((i=t)instanceof r.Observable||i instanceof r.ObservableArray)&&(i.setValue=s,i.subscribe=o,h(i.getValue(),n)),h(t,e)}return e.prototype.init=function(t,e,i,n,r,s,o,a,u){this.ni=new c(t,e,i,n,r,s,o,a,u),h(this.ni,[t])},e.prototype.getRoomId=function(){return this.ni.getRoomId()},e.prototype.getObservableAlias=function(){return this.ni.getObservableAlias()},e.prototype.getObservableName=function(){return this.ni.getObservableName()},e.prototype.getObservableDescription=function(){return this.ni.getObservableDescription()},e.prototype.getObservableType=function(){return this.ni.getObservableType()},e.prototype.getObservableMembers=function(){return this.ni.getObservableMembers()},e.prototype.getObservableBridgeId=function(){return this.ni.getObservableBridgeId()},e.prototype.getObservablePin=function(){return this.ni.getObservablePin()},e.prototype.toString=function(){return this.ni.toString()},e.prototype.toJson=function(){return this.ni.toJson()},e.prototype.commitChanges=s,e.prototype.reload=s,e.prototype.O=s,e.prototype.Zt=s,e.prototype.Yt=s,e.prototype.te=s,e}.apply(e,i))||(t.exports=i)},function(t,e,i){i=[i(0),i(1),i(4),i(3),i(63)];void 0===(i=function(s,e,i,n,r){"use strict";var o=100;function t(t){e.e(t,"roomService"),e.e(t.ne,"roomService._pcast"),this.fe=t,this.fn=new i.ObservableArray([]),this.mn=new i.Observable(null),this.T=new n.DisposableList,this.pn=null,this.setPCast(t.ne)}function a(t){t&&this.pn===t.getRoomId()||(c.call(this),t&&u.call(this))}function u(){c.call(this),this.gn=function(t){var n=this.fe.getObservableActiveRoom().getValue().getRoomId();this.pn=n;var r=this;return this.fn.setValue([]),this.vn.subscribeAndLoadMessages(n,t,function(t,e){if(t)throw t;if("ok"!==e.status)throw new Error("Unable to subscribe to room chat. Status ["+e.status+"]");var i=r.fn.getValue();s.forEach(e.chatMessages,function(t){for(var e=i.length;0<e&&t.messageId<s.get(i,[e-1,"messageId"]);)e--;0===e&&0<i.length?r.a.info("[%] Ignoring message [%s]/[%s] prior to current chat history to prevent gaps.",n,t.messageId,t.timestamp):0<e&&s.get(i,[e-1,"messageId"])===t.messageId?r.a.info("[%] Ignoring duplicate message [%s]/[%s]",n,t.messageId,t.timestamp):(i.splice(e,0,t),r.mn.setValue(t))}),i.length>o&&i.splice(0,i.length-o),r.fn.setValue(i)})}.call(this,this.yn)}function c(){this.gn&&this.gn.dispose&&this.gn.dispose()}return t.prototype.setPCast=function(t){e.e(t,"pcast"),e.b(t.getLogger,"pcast.getLogger"),this.ne=t,this.a=t.getLogger(),this.vn?this.vn.setPCast(t):this.vn=new r(t)},t.prototype.getBatchSize=function(){return this.yn},t.prototype.start=function(t){this.yn=t||0,this.vn.start(),function(){var t=this.fe.getObservableActiveRoom().subscribe(s.bind(a,this));this.T.add(t)}.call(this),u.call(this)},t.prototype.stop=function(){this.vn.stop(),c.call(this),this.T&&this.T.dispose()},t.prototype.getObservableChatMessages=function(){return this.fn},t.prototype.getObservableLastChatMessage=function(){return this.mn},t.prototype.getObservableChatEnabled=function(){return this.vn.getObservableChatEnabled()},t.prototype.canSendMessage=function(){return this.vn.canSendMessage()},t.prototype.sendMessageToRoom=function(t,e){if(!(r=this.fe.getObservableActiveRoom().getValue()))return e(new Error("Not in room"),null);var i=r.getRoomId();if(!(s=this.fe.Jt.getValue()))return e(new Error("No record for oneself"),null);var n=s.getObservableScreenName().getValue(),r=s.getObservableRole().getValue(),s=s.getLastUpdate();this.vn.sendMessageToRoom(i,n,r,s,t,e)},t.prototype.getMessages=function(t,e,i,n){var r=this.fe.getObservableActiveRoom().getValue().getRoomId();return this.vn.getMessages(r,t,e,i,n)},t.prototype.toString=function(){return"RoomChatService"},t}.apply(e,i))||(t.exports=i)},function(t,e,i){i=[i(0),i(1),i(4),i(3),i(31)];void 0===(i=function(e,a,i,r,n){"use strict";function t(t){a.e(t,"pcast"),a.b(t.getLogger,"pcast.getLogger"),a.b(t.getProtocol,"pcast.getProtocol"),this.ne=t,this.a=t.getLogger(),this.ot=t.getProtocol(),this.bn=new i.Observable(!1),a.e(this.a,"this._logger"),a.e(this.ot,"this._protocol"),this.$t=new n(t)}function s(t){var e;a.e(t,"event"),a.S(t.roomId,"event.roomId"),a.S(t.eventType,"event.eventType"),a.isArray(t.chatMessages,"event.chatMessages"),"Message"===t.eventType?(this.a.debug("[%s] Room messages [%s]",t.roomId,t.chatMessages),e=this.wn[t.roomId],c(t.chatMessages),e&&e(null,{status:"ok",chatMessages:t.chatMessages})):this.a.warn("Unsupported room conversation event [%s]",t.eventType)}function o(t){}function u(){if(!this.bn.getValue())throw new Error("ChatService not Enabled. Please start before performing actions.")}function c(t){e.forEach(t,function(t){(t=t).timestamp&&(t.timestamp=e.utc(t.timestamp)),t.from&&(t.from.lastUpdate=e.utc(t.from.lastUpdate))})}return t.prototype.setPCast=function(t){a.e(t,"pcast"),a.b(t.getLogger,"pcast.getLogger"),a.b(t.getProtocol,"pcast.getProtocol"),this.ne=t,this.a=t.getLogger(),this.ot=t.getProtocol(),this.$t.setPCast(t)},t.prototype.start=function(){var t;this.bn.getValue()||(this.T=new r.DisposableList,this.wn={},this.bn.setValue(!0),function(){var t=this.$t.getObservableStatus().subscribe(e.bind(o,this));this.T.add(t)}.call(this),t=this.ot.onEvent("chat.RoomConversationEvent",e.bind(s,this)),this.T.add(t))},t.prototype.stop=function(){this.bn.getValue()&&(this.bn.setValue(!1),this.T&&this.T.dispose())},t.prototype.getObservableChatEnabled=function(){return this.bn},t.prototype.canSendMessage=function(){return this.$t.checkAuthorized()},t.prototype.sendMessageToRoom=function(t,e,i,n,r,s){!function(t,e,i,n,r,s){a.S(t,"roomId"),a.S(e,"screenName"),a.S(i,"role"),a.C(n,"lastUpdate"),a.S(r,"message"),a.b(s,"callback"),u.call(this),this.$t.assertAuthorized(),r={messageId:"",timestamp:0,from:{sessionId:this.$t.getPCastSessionId(),screenName:e,role:i,lastUpdate:n},message:r},this.a.info("Send message to room [%s] from [%s]",t,e);var o=this;return this.ot.sendMessageToRoom(t,r,function(t,e){return t?(o.a.error("Send message to room failed with error [%s]",t),s(t,null)):(t={status:e.status},"ok"!==e.status&&o.a.warn("Send message to room failed with status [%s]",e.status),void s(null,t))})}.call(this,t,e,i,n,r,s)},t.prototype.subscribeAndLoadMessages=function(t,e,i){return i=function(t,e){var i=this;this.wn[t]=e;var n=new r.Disposable(function(){i.wn[t]===e&&delete i.wn[t]});return this.T.add(n),n}.call(this,t,i),function(n,t){a.S(n,"roomId"),a.C(t,"batchSize"),u.call(this),this.$t.assertAuthorized();var e=this.$t.getPCastSessionId();this.a.info("Subscribe to room [%s] conversation with batch size of [%s]",n,t);var r=this;this.ot.subscribeToRoomConversation(e,n,t,function(t,e){var i=r.wn[n];return i?t?(r.a.error("Subscribe to room conversation failed with error [%s]",t),i(t,null)):(t={status:e.status},"ok"!==e.status?(delete r.wn[n],r.a.warn("Subscribe to room conversation failed with status [%s]",e.status),i(null,t)):(t.chatMessages=e.chatMessages,c(t.chatMessages),void i(null,t))):r.a.warn("No subscription callback set for room [%s]",n)})}.call(this,t,e),i},t.prototype.getMessages=function(t,e,i,n,r){!function(t,e,i,n,r){a.S(t,"roomId"),a.b(r,"callback"),n&&i||a.C(e,"batchSize"),n&&a.S(n,"beforeMessageId"),i&&a.S(i,"afterMessageId"),u.call(this),this.$t.assertAuthorized();var s=this.$t.getPCastSessionId();this.a.info("Get messages from room [%s] conversation with batch size of [%s], after [%s], and before [%s]",t,e,i,n);var o=this;this.ot.getMessages(s,t,e,i,n,function(t,e){return t?(o.a.error("Get messages from room conversation failed with error [%s]",t),r(t,null)):(t={status:e.status},"ok"!==e.status?(o.a.warn("Get messages from room conversation failed with status [%s]",e.status),r(null,t)):(t.chatMessages=e.chatMessages,c(t.chatMessages),void r(null,t)))})}.call(this,t,e,i,n,r)},t.prototype.toString=function(){return"ChatService"},t}.apply(e,i))||(t.exports=i)},function(t,e,i){i=[i(0),i(1),i(15),i(17),i(24),i(65),i(67)];void 0===(i=function(i,n,r,s,o,a,u){"use strict";function t(t,e){n.isArray(t,"userMediaStreams"),this.R=(e=e||{}).uri||s.DefaultPCastUri,this.a=e.logger||r.createPCastLogger(this.R),this.It=e.audioContext||new o,this.kn=this.It.getNativeAudioContext(),this.Sn=null,this.In=t,this.Rn=!i.e(e.audioContext),this.Tn=new a(this.a),i.forEach(this.In,i.bind(c,this,e))}function c(t,e){n.e(e,"stream"),n.e(t,"options");var i=this.Tn.getAudioVolumeMeter(e);i.init(this.kn,t.alpha),i.connect(e)}function h(t,e){n.e(e,"stream"),n.e(t,"options");var i=this.Tn.getAudioVolumeMeter(e),e=new u(this.a);t.alpha&&i.setAlpha(t.alpha),e.onValue(this.Sn),e.startDetection(i,t)}return t.prototype.start=function(t,e){n.b(e,"callback"),this.Sn=e,i.forEach(this.In,i.bind(h,this,t=t||{}))},t.prototype.stop=function(){i.forEach(this.getAudioVolumeMeters(),function(t){t.onValue(function(){})}),this.Sn=null},t.prototype.getAudioVolumeMeter=function(t){return n.e(t,"stream"),this.Tn.getAudioVolumeMeter(t)},t.prototype.getAudioVolumeMeters=function(){return this.Tn.getAudioVolumeMeters()},t.prototype.dispose=function(){this.Rn&&this.kn.close(),this.Tn.stopAllMeters(),this.In=null},t.prototype.toString=function(){return"AudioSpeakerDetector"},t}.apply(e,i))||(t.exports=i)},function(t,e,i){i=[i(0),i(1),i(66)];void 0===(i=function(t,e,i){"use strict";function n(t){e.e(t,"logger"),this.a=t,this.qn={}}return n.prototype.stopAllMeters=function(){t.forOwn(this.qn,function(t){t.stop()})},n.prototype.getAudioVolumeMeter=function(t){return e.e(t,"stream"),e.S(t.id,"streamId"),this.qn[t.id]||(this.qn[t.id]=new i(this.a)),this.qn[t.id]},n.prototype.getAudioVolumeMeters=function(){return t.values(this.qn)},n.prototype.toString=function(){return"AudioVolumeMeterFactory"},n}.apply(e,i))||(t.exports=i)},function(t,e,i){i=[i(0),i(1)];void 0===(i=function(s,i){"use strict";function t(t){i.e(t,"logger"),this.a=t}function n(t){for(var e=t.inputBuffer.getChannelData(0),i=0,n=0,r=0;r<e.length;r++)i+=e[r]*e[r],.99<Math.abs(e[r])&&n++;this.Cn=Math.sqrt(i/e.length),this.En=this.xn*this.Cn+(1-this.xn)*this.En,this.Mn=Math.max(this.Cn,this.xn*this.Cn+(1-this.xn)*this.Mn),this.Pn=n,this.Dn&&this.Dn.call(this,{date:s.now(),value:this.Cn,smoothedValue:this.En,smoothedPeakValue:this.Mn,clipped:this.Pn})}return t.prototype.init=function(t,e){i.e(t,"context"),i.b(t.createScriptProcessor,"context.createScriptProcessor"),e=parseFloat(e||1/16),i.C(e,"alpha"),this.Un=t,this.xn=e,this.Cn=0,this.En=0,this.Mn=0,this.Pn=0,this.An=t.createScriptProcessor(4096,1,1),s.addEventListener(this.An,"audioprocess",s.bind(n,this))},t.prototype.onValue=function(t){this.Dn=t},t.prototype.getValue=function(){return this.Cn},t.prototype.getSmoothedValue=function(){return this.En},t.prototype.getSmoothedPeakValue=function(){return this.Mn},t.prototype.setAlpha=function(t){i.C(t,"alpha"),this.xn=parseFloat(t)},t.prototype.connect=function(t){return function(t){i.e(t,"stream"),0<t.getAudioTracks().length?(this.On=this.Un.createMediaStreamSource(t),this.On.connect(this.An),this.An.connect(this.Un.destination)):this.a.info("Stream has no audio tracks")}.call(this,t)},t.prototype.stop=function(){return function(){this.On&&this.On.disconnect(),this.An.disconnect()}.call(this)},t.prototype.toString=function(){return"AudioVolumeMeter"},t}.apply(e,i))||(t.exports=i)},function(t,e,i){i=[i(0),i(1)];void 0===(i=function(d,f){"use strict";function t(t){f.e(t,"logger"),this.a=t,this.init()}return t.prototype.init=function(){},t.prototype.onValue=function(t){this.Dn=t},t.prototype.startDetection=function(t,e){return function(s,t){f.e(s,"audioVolumeMeter");var o=this,a=(t=t||{}).speakingHysteresisInterval||50,u=t.silenceHysteresisInterval||1500;f.C(a,"options.speakingHysteresisInterval"),f.C(u,"options.silenceHysteresisInterval");var c=!1,h=d.now()+a,l=d.now()+u;s.onValue(function(t){f.e(s,"audioVolumeMeter"),f.C(t.date,"value.date"),f.C(t.value,"value.value"),f.C(t.smoothedValue,"value.smoothedValue"),f.C(t.smoothedPeakValue,"value.smoothedPeakValue"),f.C(t.clipped,"value.clipped");var e=.01<t.value&&t.value>2*t.smoothedValue&&t.value>.25*t.smoothedPeakValue,i=t.value>.8*t.smoothedValue,n=t.value<.5*t.smoothedValue,r=!e;(e||c&&i)&&h<t.date?(l=d.utc(t.date)+u,c||(c=!0,o.a.info("Speaking detected"),o.Dn&&o.Dn("speaking"))):(n||!c&&r)&&l<t.date&&(h=d.utc(t.date)+a,c&&(c=!1,o.a.info("Silence detected"),o.Dn&&o.Dn("silence")))})}.call(this,t,e)},t.prototype.toString=function(){return"AudioSpeakerDetection"},t}.apply(e,i))||(t.exports=i)},function(t,e,i){i=[i(0),i(1),i(15),i(17),i(69)];void 0===(i=function(i,n,r,s,o){"use strict";function t(t,e){n.isArray(t,"userMediaStreams"),this.R=(e=e||{}).uri||s.DefaultPCastUri,this.a=e.logger||r.createPCastLogger(this.R),this.Fn=[],this.lt=t}function a(t,e,i){(i=new o(i)).connect(t,e),this.Fn.push(i)}return t.prototype.start=function(t,e){i.forEach(this.lt,i.bind(a,this,t,e=e||{}))},t.prototype.stop=function(){i.forEach(this.Fn,function(t){t.close()}),this.Fn=[]},t.prototype.toString=function(){return"BandwidthMonitor"},t}.apply(e,i))||(t.exports=i)},function(t,e,i){i=[i(0),i(1)];void 0===(i=function(i,n){"use strict";function t(t){this.init(t)}function r(t,e){if(this.Ln&&this.Ln.dispose(),!e)return this.Nn.limitBandwidth(t);e=e.getObservableMembers(),this.Ln=e.subscribe(i.bind(s,this,t),{initial:"notify"})}function s(t,e){e.length!==this.Bn&&(this.Bn=e.length,t/=Math.max(1,this.Bn-1),this.Nn.limitBandwidth(t))}return t.prototype.init=function(t){n.e(t,"publisher"),this.Nn=t,this.Bn=0,this.jn=null,this.Ln=null},t.prototype.connect=function(t,e){n.e(t,"roomService"),e=e||{},t=t.getObservableActiveRoom(),e=e.roomBandwidthLimit||5e6,this.jn=t.subscribe(i.bind(r,this,e),{initial:"notify"})},t.prototype.close=function(){this.jn&&this.jn.dispose(),this.Ln&&this.Ln.dispose(),this.jn=null,this.Ln=null},t.prototype.toString=function(){return"PublisherBandwidthAdjuster"},t}.apply(e,i))||(t.exports=i)},function(t,e,i){i=[i(0),i(1)];void 0===(i=function(l,n){"use strict";var d=[{"9x16":[{3840:2160},{1920:1080},{1366:768},{1280:720},{1024:576},{854:480},{640:360},{320:180}]},{"3x4":[{1600:1200},{1440:1080},{960:720},{800:600},{768:576},{640:480},{480:360},{352:288},{320:240},{176:144},{160:120}]},{"16x9":[{2160:3840},{1080:1920},{768:1366},{720:1280},{576:1024},{480:854},{360:640},{180:320}]},{"4x3":[{1200:1600},{1080:1440},{720:960},{600:800},{576:768},{480:640},{360:480},{288:352},{240:320},{144:176},{120:160}]}],r={fallbackToLower:{id:0,name:"fallbackToLower"},fallbackToHigher:{id:1,name:"fallbackToHigher"},fallbackToLowerThenHigher:{id:2,name:"fallbackToLowerThenHigher"},exact:{id:3,name:"exact"}};function t(t){n.e(t,"options"),t.resolutionSelectionStrategy&&n.w(t.resolutionSelectionStrategy,r,"options.resolutionSelectionStrategy"),t.aspectRatio&&n.S(t.aspectRatio,"options.aspectRatio"),t.resolution&&n.C(t.resolution,"options.resolution"),t.frameRate&&n.C(t.frameRate,"options.frameRate"),this.Vn=t.resolutionSelectionStrategy||r.fallbackToLowerThenHigher.name,this.we=t.aspectRatio||"16x9",this.Wn=parseInt(t.resolution,10)||720,this.zn=function(t,e){switch(n.S(t,"aspectRatio"),n.C(e,"resolution"),t){case"16x9":case"4x3":return e;case"9x16":return i(16/9*e);case"3x4":return i(4/3*e);default:throw new Error("Aspect Ratio not supported")}}.call(this,this.we,this.Wn),this._n=t.frameRate||15}function i(t){return n.C(t,"value"),2*Math.floor((t+1)/2)}function s(t,e){var i,n,r,s,o=f(e,d),a=m(e,d),u=m(t.toString(),o),c=0===u,e=d.length-1===a;if(u<0){if((u=h(t,o))<0)return null}else{if(c)return e?null:(n=f(i=p(++a,d),d),(u=h(this.zn,n))<0?null:(r=p(u,o),s=this.calculateLongerDimensionByAspectRatio(r,i),{resolution:Math.min(r,s),aspectRatio:i,height:parseInt(r,10),width:parseInt(s,10)}));u--}return i=p(a,d),r=p(u,n=g(a,d)),s=n[u][r],{resolution:Math.min(r,s),aspectRatio:i,height:parseInt(r,10),width:s}}function o(t,e){var i,n,r,s,o,a=f(e,d),u=m(e,d),c=m(t.toString(),a),h=c===a.length-1,e=d.length-1===u;if(l.C(c)){if(h)return e?null:(i=p(++u,d),n=this.zn,r=this.calculateLongerDimensionByAspectRatio(n,i),{resolution:Math.min(n,r),aspectRatio:i,height:parseInt(n,10),width:parseInt(r,10)});c++}else if(s=t,o=a,!(c=l.keys(o[o.length-1])[0]>s?null:l.reduce(o,function(t,e,i){if(!t)return i;var n=l.keys(o[t])[0],e=l.keys(e)[0];return!(s<e)&&Math.abs(s-e)<Math.abs(s-n)?i:t})))return;return i=p(u,d),n=p(c,u=g(u,d)),r=u[c][n],{resolution:Math.min(n,r),aspectRatio:i,height:parseInt(n,10),width:parseInt(r,10)}}function f(e,t){return(t=l.find(t,function(t){return Object.prototype.hasOwnProperty.call(t,e)}))?t[e]:null}function m(e,t){return l.findIndex(t,function(t){return Object.prototype.hasOwnProperty.call(t,e)})}function p(t,e){return l.keys(e[t])[0]}function g(t,e){var i=l.keys(e[t]);return e[t][i[0]]}function h(r,s){return l.keys(s[0])[0]<r?-1:l.reduce(s,function(t,e,i){if(!t)return i;var n=l.keys(s[t])[0];return!((e=l.keys(e)[0])<r)&&Math.abs(r-e)<Math.abs(r-n)?i:t})}return t.prototype.getDefaultResolution=function(){var t=this.calculateLongerDimensionByAspectRatio(this.Wn,this.we);switch(this.we){case"9x16":case"3x4":return{resolution:this.Wn,aspectRatio:this.we,height:t,width:this.Wn};default:return{resolution:this.Wn,aspectRatio:this.we,height:this.Wn,width:t}}},t.prototype.getDefaultFrameRate=function(){return this._n},t.prototype.getNextResolution=function(t,e){switch(n.C(t,"height"),n.S(e,"aspectRatio"),this.Vn){case r.fallbackToLower.name:return o.call(this,t,e);case r.fallbackToHigher.name:return s.call(this,t,e);case r.fallbackToLowerThenHigher.name:var i=null;return t>this.zn?i=s.call(this,t,e):(i=o.call(this,t,e))&&i.height||(i=s.call(this,this.Wn,this.we)),i;default:return void r.exact.name}},t.prototype.canResolveNextResolution=function(){return this.Vn!==r.exact.name},t.prototype.calculateLongerDimensionByAspectRatio=function(t,e){switch(e){case"16x9":case"9x16":return i(16/9*t);case"4x3":case"3x4":return i(4/3*t);default:throw new Error("Aspect Ratio not supported")}},t}.apply(e,i))||(t.exports=i)},function(t,e,i){void 0===(e=function(){"use strict";return{errorSeverity:{recoverable:{id:1,name:"RECOVERABLE"},critical:{id:2,name:"CRITICAL"}}}}.apply(e,[]))||(t.exports=e)},function(t,e,i){i=[i(0),i(1),i(4),i(3),i(38),i(73),i(40),i(39),i(19),i(14),i(13),i(20)];void 0===(i=function(y,n,t,e,i,r,s,o,a,b,w,u){"use strict";var c={reconnectOptions:{maxOfflineTime:864e5,maxReconnectFrequency:6e4}};function h(t){n.e(t,"options"),t.roomExpress&&n.e(t.roomExpress,"options.roomExpress"),this.Hn=y.assign(y.clone(c),t),this.Gn=t.roomExpress||new i(this.Hn),this.Jn=!t.roomExpress,this.a=this.Gn.getPCastExpress().getPCast().getLogger()}function k(t,e,i){i&&y.hasIndexOrKey(i,"roomService")&&(i.channelService=i.roomService?new r(i.roomService):null,delete i.roomService),i&&y.hasIndexOrKey(i,"room")&&(i.channel=i.room?new s(i.room):null,delete i.room),t(e,i)}return h.prototype.dispose=function(){this.Oe&&(this.Oe.dispose(),this.Oe=null),this.Jn&&this.Gn.dispose(),this.a.info("Disposed channel express instance")},h.prototype.getRoomExpress=function(){return this.Gn},h.prototype.getPCastExpress=function(){return this.Gn.getPCastExpress()},h.prototype.createChannel=function(t,e){n.e(t,"options"),n.e(t.channel,"options.channel"),(t=y.assign({room:t.channel},t)).room.type=b.types.channel.name,delete t.channel,this.Gn.createRoom(t,y.bind(k,null,e))},h.prototype.joinChannel=function(u,s,c){n.e(u,"options"),n.b(s,"joinChannelCallback"),n.b(c,"subscriberCallback"),u.videoElement&&n.e(u.videoElement,"options.videoElement"),u.streamSelectionStrategy&&n.S(u.streamSelectionStrategy,"options.streamSelectionStrategy");var h,l,d,t=y.assign({type:b.types.channel.name,role:w.roles.audience.name},u),e=y.get(u,["failureCountForBanningAMember"]),i=y.get(u,["banMemberOnCapacityFailureCount"]),f=new o(u.streamSelectionStrategy,this.a,{failureCountForBanningAMember:e,banMemberOnCapacityFailureCount:i}),r=[],m="",p=this,g=null;t.channelId&&(t.roomId=t.channelId),delete t.channelId;function v(){null!==g&&(p.a.info("[%s] Clearing member selection backoff interval",m),clearTimeout(g),g=null);for(var t=0;t<r.length;t++)r[t].dispose();r=[]}p.Gn.joinRoom(t,function(t,e){var i,n,r=!e||y.assign({},e);p.Oe&&(p.Oe.dispose(),p.Oe=null),e&&e.roomService&&(i=e.roomService.leaveRoom,n=e.roomService.getObservableActiveRoom().getValue(),d=e.roomService,m=n?n.getRoomId():"",p.a.info("Joined channel [%s] with [%s] selection strategy",m,f.getStrategy()),r.roomService.leaveRoom=function(t){h&&h.stop("leave-channel"),v(),i(t)}),k(s,t,r)},function n(o,a){v(),p.a.info("[%s] Members changed with status [%s]. Channel has [%s] active members.",m,a,o.length);for(var t=function(){var t=y.filter(o,function(t){return t.getObservableRole().getValue()===w.roles.presenter.name&&0<t.getObservableStreams().getValue().length}),e=(i=f.getNext(t))?i.getObservableStreams().getValue()[0]:null,i=e?e.getPCastStreamId():"";if(!e)return 0===t.length?(f.reset(),c(l=h=null,{status:"no-stream-playing"})):a?(p.a.info("Unable to find a new presenter to replace stream [%s] that ended in channel [%s] with status [%s] and [%s] black-listed members",l,m,a,f.getNumberOfMembersWithFailures()),l&&h&&h.isActive()&&h.stop("presenter-failure"),c(null,{status:a||"unable-to-recover"})):c(null,{status:"no-stream-playing"});if(!i)return p.a.info("Channel [%s] presenter has no stream",m),c(null,{status:"no-stream-playing"});if(l&&h)if(i===l){if(!a)return;p.a.info("[%s] Stream [%s] ended with status [%s], retrying",m,l,a),h.stop("same-presenter-failure")}else p.a.info("[%s] Stream [%s] ended with status [%s], failing over to stream [%s]",m,l,a,i),h.stop("change-presenter");function r(e){return null!==g&&(p.a.warn("[%s] Clearing backoff interval after triggering of another unexpected failure [%s]",m,e),clearTimeout(g),g=null),g=setTimeout(function(){g=null;var t=d?d.getObservableActiveRoom().getValue():null;if(t)return t=t.getObservableMembers().getValue(),n(t,e)},"capacity"===e?5e3:100)}var t=y.assign({},{monitor:{callback:y.bind(function(t,e,i){if(l===t){if(e)return r("unable-to-subscribe");if("app-background"===i.reason)return c(e,i);if(i.retry&&"high-availability"!==f.getStrategy())return p.a.info("Retrying to subscribe to channel [%s] after stream [%s] failed with reason [%s]",m,t,i.status),i.retry();var n=y.get(i,["status"],"");if("ok"!==n){if("custom"===i.reason&&"client-side-failure"!==i.description)return c(e,i);switch(n){case"ended":case"origin-ended":case"origin-stream-ended":f.markDead();break;default:f.markFailed({failedDueToCapacity:"capacity"===n})}return p.a.info("[%s] Monitor subscriber reported status [%s]. Trying next member",t,n),r(n)}}else p.a.info("[%s] Ignore old channel subscriber monitor stream [%s]. Active stream is [%s]",m,t,l)},this,i),options:{conditionCountForNotificationThreshold:8}}},u),s=l?a?"recovered-from-failure":"stream-override":"stream-started";l=i,p.Gn.subscribeToMemberStream(e,t,y.bind(function(t,e,i){if(l===t){var n=y.get(i,["status"],"");if("ok"===n&&(i.reason=s),e||"ok"!==n){switch(p.a.info("[%s] Issue with stream [%s]. Trying next member",t,n,e),n){case"unauthorized":case"not-found":case"ended":case"origin-not-found":case"origin-ended":case"origin-stream-ended":case"unsupported-features":f.markDead();break;default:f.markFailed({failedDueToCapacity:"capacity"===n})}return r(n)}h=i&&i.mediaStream?i.mediaStream:l=null,c(e,i)}else p.a.info("[%s] Ignore old media stream callback for stream [%s]. Active stream is [%s]",m,t,l)},this,i))},e=0;e<o.length;e++)r.push(o[e].getObservableScreenName().subscribe(t)),r.push(o[e].getObservableRole().subscribe(t)),r.push(o[e].getObservableStreams().subscribe(t));t()})},h.prototype.publishToChannel=function(t,e){return n.e(t,"options"),n.b(e,"callback"),t.publishToken&&t.capabilities?(this.a.warn("[%s] Trying to publish with both `publishToken` and `capabilities` set. Only use one of the two options"),void e(new Error("Publishing with both `publishToken` and `capabilities` defined"),{status:"conflicting-options"})):t.streamToken&&t.capabilities?(this.a.warn("[%s] Trying to publish with both `streamToken` and `capabilities` set. Only use one of the two options"),void e(new Error("Publishing with both `streamToken` and `capabilities` defined"),{status:"conflicting-options"})):((t=y.assign({memberRole:w.roles.presenter.name,streamType:u.types.presentation.name,room:t.channel},t)).room.type=b.types.channel.name,delete t.channel,void this.Gn.publishToRoom(t,y.bind(k,null,e)))},h.prototype.publishScreenToChannel=function(t,e){n.e(t,"options"),n.b(e,"callback"),(t=y.assign({memberRole:w.roles.presenter.name,streamType:u.types.presentation.name,room:t.channel},t)).room.type=b.types.channel.name,delete t.channel,this.Gn.publishScreenToRoom(t,y.bind(k,null,e))},h}.apply(e,i))||(t.exports=i)},function(t,e,i){i=[i(0),i(1),i(40)];void 0===(i=function(n,r,s){"use strict";function t(t){r.e(t,"roomService"),this.fe=t}function o(t,e,i){return i&&i.room&&(i.channel=new s(i.room),delete i.room),t(e,i)}return t.prototype.start=function(){return this.fe.start.apply(this.fe,arguments)},t.prototype.getChannelInfo=function(t,e,i){return t?r.S(t,"channelId"):r.S(e,"alias"),r.b(i,"callback"),this.fe.getRoomInfo(t,e,n.bind(o,null,i))},t.prototype.createChannel=function(t,e){return r.e(t,"channel"),r.S(t.name,"channel.name"),r.S(t.type,"channel.type"),r.x(t.description,"channel.description"),r.b(e,"callback"),this.fe.createRoom(t,n.bind(o,null,e))},t.prototype.enterChannel=function(t,e,i){return t?r.S(t,"roomId"):r.S(e,"alias"),r.b(i,"callback"),this.fe.enterRoom(t,e,n.bind(o,null,i))},t.prototype.leaveChannel=function(){return this.fe.leaveRoom.apply(this.fe,arguments)},t.prototype.getChatService=function(){return this.fe.getChatService.apply(this.fe,arguments)},t.prototype.getSelf=function(){return this.fe.getSelf.apply(this.fe,arguments)},t.prototype.getObservableActiveChannel=function(){return this.fe.getObservableActiveRoom.apply(this.fe,arguments)},t.prototype.updateSelf=function(){return this.fe.updateSelf.apply(this.fe,arguments)},t.prototype.updateMember=function(){return this.fe.updateMember.apply(this.fe,arguments)},t.prototype.updateChannel=function(){return this.fe.updateRoom.apply(this.fe,arguments)},t.prototype.revertChannelChanges=function(){return this.fe.revertRoomChanges.apply(this.fe,arguments)},t.prototype.revertMemberChanges=function(){return this.fe.revertMemberChanges.apply(this.fe,arguments)},t.prototype.isInChannel=function(){return this.fe.isInRoom.apply(this.fe,arguments)},t.prototype.toString=function(){return"ChannelService"},t.prototype.stop=function(){return this.fe.stop.apply(this.fe,arguments)},t}.apply(e,i))||(t.exports=i)}],v={},p.m=g,p.c=v,p.d=function(t,e,i){p.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},p.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},p.t=function(e,t){if(1&t&&(e=p(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(p.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)p.d(i,n,function(t){return e[t]}.bind(null,n));return i},p.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return p.d(e,"a",e),e},p.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},p.p="",p(p.s=41);function p(t){if(v[t])return v[t].exports;var e=v[t]={i:t,l:!1,exports:{}};return g[t].call(e.exports,e,e.exports,p),e.l=!0,e.exports}var g,v});